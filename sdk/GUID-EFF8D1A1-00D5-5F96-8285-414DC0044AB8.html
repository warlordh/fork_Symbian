<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="task" />
  <meta name="DC.Title" content="Setting Use Policies" />
  <meta name="abstract" content="A use policy denotes the security check required to use the key. The use policy associated with the key is of type TSecurityPolicy. The policy can be set to check capabilities or the Secure ID associated with the calling process. The calling process should have a WriteUserData capability." />
  <meta name="description" content="A use policy denotes the security check required to use the key. The use policy associated with the key is of type TSecurityPolicy. The policy can be set to check capabilities or the Secure ID associated with the calling process. The calling process should have a WriteUserData capability." />
  <meta name="DC.Relation" scheme="URI" content="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-C3290344-486B-554D-97FC-42DF48E150AA.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-39B459CD-8210-59B5-95F4-85CE36676735.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-695FCEB8-EA04-5C1C-A197-648275BA0281.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Setting Use Policies
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8">
  <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2387653 id2388130 id2388161 id2388223 id2388260 id2388274 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html">
      OS Security Guide
     </a>
     &gt;
     <a href="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html">
      Crypto Services
     </a>
     &gt;
     <a href="GUID-C3290344-486B-554D-97FC-42DF48E150AA.html">
      Certificate and Key Management
     </a>
     &gt;
     <a href="GUID-39B459CD-8210-59B5-95F4-85CE36676735.html">
      Unified Stores
     </a>
     &gt;
     <a href="GUID-695FCEB8-EA04-5C1C-A197-648275BA0281.html" title="The Unified Keystore is responsible for managing cryptographic keys.">
      Unified Keystore
     </a>
     &gt;
     <a href="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html" title="These tutorials explain the tasks that can be performed by client applications using the services provided by the unified keystore.">
      Unified Keystore Tutorials
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Setting
Use Policies
    </h1>
    <div>
     <p>
      A use policy denotes the security check required to use the key.
The use policy associated with the key is of type
      <samp class="codeph">
       TSecurityPolicy
      </samp>
      .
The policy can be set to check capabilities or the Secure ID associated with
the calling process. The calling process should have a
      <samp class="codeph">
       WriteUserData
      </samp>
      capability.
     </p>
     <div class="section" id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-4F90AC15-5BC9-4A2A-BD86-D6CF6FD04E47">
      <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-4F90AC15-5BC9-4A2A-BD86-D6CF6FD04E47">
       <!-- -->
      </a>
      <p>
       The following steps explain the process of setting a use policy
for a key:
      </p>
     </div>
     <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-16DDA72F-9BC5-52FB-A3C6-874815ABF9FC-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2">
      <!-- -->
     </a>
     <ol id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-16DDA72F-9BC5-52FB-A3C6-874815ABF9FC-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2">
      <li class="stepexpand" id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-89755D62-9A44-5F07-9035-6AA97F701C0C-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2-1">
       <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-89755D62-9A44-5F07-9035-6AA97F701C0C-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2-1">
        <!-- -->
       </a>
       <span>
        Create a file system
session using an
        <samp class="codeph">
         RFs
        </samp>
        object.
       </span>
      </li>
      <li class="stepexpand" id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-6A14EBD6-AF2D-5CE8-A232-F04B717CA0B3-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2-2">
       <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-6A14EBD6-AF2D-5CE8-A232-F04B717CA0B3-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2-2">
        <!-- -->
       </a>
       <span>
        <br />
        Create an object of type CUnifiedKeyStore using
        <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-C7A96153-4179-3B3F-878D-1EAA64A98D39">
         <span class="apiname">
          CUnifiedKeyStore::NewL()
         </span>
        </a>
        or
        <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-217FBB3B-CEF5-36F2-A612-EDDA0982053C">
         <span class="apiname">
          CUnifiedKeyStore::NewLC()
         </span>
        </a>
        .
       </span>
      </li>
      <li class="stepexpand" id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-C8F104CE-E857-5615-B847-E3A33EAF7481-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2-3">
       <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-C8F104CE-E857-5615-B847-E3A33EAF7481-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2-3">
        <!-- -->
       </a>
       <span>
        <br />
        Initialise the member functions and keystore using the asynchronous
function
        <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-6C5D732C-1FD1-3EF0-AC90-87690F891B8D">
         <span class="apiname">
          CUnifiedKeyStore::Initialize()
         </span>
        </a>
        .
       </span>
      </li>
      <li class="stepexpand" id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-B1DD3DB8-90D9-52F7-96B5-B2AD5AE3E1F8">
       <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-B1DD3DB8-90D9-52F7-96B5-B2AD5AE3E1F8">
        <!-- -->
       </a>
       <span>
        <br />
        List all keys in the keystore using the
        <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-8B22E1BC-D779-32DC-9C0A-CA37E4C0A81B">
         <span class="apiname">
          CUnifiedKeyStore::List()
         </span>
        </a>
        function.
Retrieve the handle of the key for which the use policy needs to be set.
       </span>
      </li>
      <li class="stepexpand" id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-6CF7703F-8CAC-5DC6-9F43-7E2EE3F39895-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2-5">
       <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-6CF7703F-8CAC-5DC6-9F43-7E2EE3F39895-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-2-5">
        <!-- -->
       </a>
       <span>
        <br />
        Set the use policy for the key using the
        <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-CC8814B6-569C-3426-A319-BFB631211B07">
         <span class="apiname">
          CUnifiedKeyStore::SetUsePolicy()
         </span>
        </a>
        function.
       </span>
      </li>
     </ol>
     <div class="section" id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-46A56876-6A07-4E94-9D00-73BC1270CAB4">
      <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-46A56876-6A07-4E94-9D00-73BC1270CAB4">
       <!-- -->
      </a>
      <p>
       Use policy is set for the selected key.
      </p>
     </div>
     <div class="example" id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-C2150584-293D-50CE-8DDC-19B4D55D8B0B-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-4">
      <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-C2150584-293D-50CE-8DDC-19B4D55D8B0B-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-4">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       Example
      </h2>
      <p>
       The
following code snippet shows how to set use policy for a key.
      </p>
      <pre class="codeblock" id="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-FAD1C292-8E42-5348-B975-3CBA7E8D2820-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-4-3">
       <a name="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8__GUID-FAD1C292-8E42-5348-B975-3CBA7E8D2820-GENID-1-10-1-25-1-1-8-1-5-1-5-1-5-1-4-1-12-1-3-4-3">
        <!-- -->
       </a>
       // Create a file system session object
RFs iFs;
CleanupClosePushL(&amp;iFs);


...


// Initialise the keystore and member functions
CUnifiedKeyStore* keyStore = CUnifiedKeyStore::NewL(fs);
keyStore-&gt;Initialize(iStatus); //iStatus is a TRequestStatus object


...



// Retrieve the handle of the key for which use policy has to be set
TCTKeyAttributeFilter  filter.iUsage = EPKCS15UsageAll;
RPointerArray&lt;CCTKeyInfo&gt; iKeys; // This variable will contain the result of the set use policy operation
keyStore-&gt;List(iKeys, filter, iStatus);


...



// Retrieve the key handle of the appropriate key
_LIT(KLabel,”keylabel”);

// Select the key with the label you are looking for
TInt keyIndex;
for (TInt j = 0; j &lt; iKeys.Count(); j++)
    {
    if (iKeys[j]-&gt;Label() == KLabel) 
        {
        keyIndex = j;
        break;
        }
    }


...



// Set the use policy

TSecurityPolicy usePolicy;
TUint secureId = 0x101FFFFF;
TCapability caps[3];
caps[0] = ECapabilityWriteUserData;
caps[1] = ECapabilityDRM;
caps[2] = ECapabilityReadUserData;

usePolicy = TSecurityPolicy(TSecureId(secureId), caps[0], caps[1], caps[2]);
keyStore-&gt;SetUsePolicy(*iKeys, usePolicy, iStatus);


// Clean up
CleanupStack::PopAndDestroy(); // iFs
      </pre>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html" title="These tutorials explain the tasks that can be performed by client applications using the services provided by the unified keystore.">
        Unified Keystore Tutorials
       </a>
      </div>
     </div>
     <div class="relinfo reltasks">
      <strong>
       Related tasks
      </strong>
      <br />
      <div>
       <a href="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7.html" title="A management policy signifies the security check required to perform management operations on the key. The management policy associated with the key is of type TSecurityPolicy. The policy can be set to check capabilities or the Vendor ID associated with the calling process. The calling process should have a WriteUserData capability.">
        Set Management
Policies
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>