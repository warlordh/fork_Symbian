<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="task" />
  <meta name="DC.Title" content="Decompressing File Archives" />
  <meta name="DC.Relation" scheme="URI" content="GUID-7AAAC6EA-784D-51E6-AD6B-521C9F5C4DBD.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-9208E03A-CC7A-57A9-84BD-778B99040842.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-5D14ADEC-ED83-5FA4-B551-C57CAE4F79BE.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-7AAAC6EA-784D-51E6-AD6B-521C9F5C4DBD.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Decompressing File Archives
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1">
  <a name="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2682564 id2682532 id2682535 id2682521 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html">
      Generic OS Services Guide
     </a>
     &gt;
     <a href="GUID-9208E03A-CC7A-57A9-84BD-778B99040842.html">
      Compression Libraries
     </a>
     &gt;
     <a href="GUID-5D14ADEC-ED83-5FA4-B551-C57CAE4F79BE.html">
      Zip Compression Library
     </a>
     &gt;
     <a href="GUID-7AAAC6EA-784D-51E6-AD6B-521C9F5C4DBD.html" title="The Zip Compression Library, EZLib compresses files to two formats namely zip and gzip. EZLib also allows clients to decompress data from file archives and memory streams. The compression and decompression tasks are performed iteratively until task completion.">
      Zip Compression Library Tutorials
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Decompressing
File Archives
    </h1>
    <div>
     <div>
      <div>
       The Zip Compression Library, EZLib provides file archive
decompression functionality for the Symbian platforms.
      </div>
      <p>
       EZLib
allows clients to decompress data from file archives. The decompression task
is performed by calling the decompression functions iteratively, until the
required task completion.
      </p>
     </div>
     <div class="section">
      <p>
       The input archive file is opened and the properties of all the
files in the archive are retrieved.
      </p>
     </div>
     <a name="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-0D781F2C-8D11-5792-98D5-76091DA8EBBB">
      <!-- -->
     </a>
     <ol id="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-0D781F2C-8D11-5792-98D5-76091DA8EBBB">
      <li class="stepexpand" id="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-E92A26A2-F56D-5FA0-A583-43B227AE670C">
       <a name="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-E92A26A2-F56D-5FA0-A583-43B227AE670C">
        <!-- -->
       </a>
       <span>
        <br />
        Pass the input file archive and create an instance of the
        <a href="GUID-79C613E8-35F8-319B-BE8B-1411CBE5AF00.html">
         <span class="apiname">
          CZipFile
         </span>
        </a>
        class.
  The
        <a href="GUID-79C613E8-35F8-319B-BE8B-1411CBE5AF00.html">
         <span class="apiname">
          CZipFile
         </span>
        </a>
        is a read only interface. It does not
support file compression to a single or multiple zip file archives.
       </span>
      </li>
      <li class="stepexpand" id="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-8E916762-869C-5E9C-B38C-43B55805EB73">
       <a name="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-8E916762-869C-5E9C-B38C-43B55805EB73">
        <!-- -->
       </a>
       <span>
        <br />
        Invoke
        <a href="GUID-79C613E8-35F8-319B-BE8B-1411CBE5AF00.html#GUID-79C613E8-35F8-319B-BE8B-1411CBE5AF00__GUID-7F528528-1814-39A6-BE14-CA1F7AABFD06">
         <span class="apiname">
          CZipFile::GetMembersL()
         </span>
        </a>
        that returns a pointer
of
        <a href="GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html">
         <span class="apiname">
          CZipFileMemberIterator
         </span>
        </a>
        The
        <a href="GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html">
         <span class="apiname">
          CZipFileMemberIterator
         </span>
        </a>
        iterator
class provides functions that point to the first file in the archive and to
navigate through all the entries in the archive. 
 The
        <a href="GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html">
         <span class="apiname">
          CZipFileMemberIterator
         </span>
        </a>
        iterator class can access
each member of the zip archive using
        <a href="GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A.html#GUID-D458AE6A-EC64-3882-BCEA-A44A43DAA99A__GUID-610F12F0-C1B7-39BB-A446-7616BBF84B2C">
         <span class="apiname">
          CZipFileMemberIterator::NextL()
         </span>
        </a>
       </span>
      </li>
      <li class="stepexpand" id="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-BB056063-4391-5EC7-A223-ED752E2F1B32">
       <a name="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-BB056063-4391-5EC7-A223-ED752E2F1B32">
        <!-- -->
       </a>
       <span>
        <br />
        The properties of the member file are retrieved using the functions
of
        <a href="GUID-02A8BC62-D653-39A3-BE0C-92A5F3F43E85.html">
         <span class="apiname">
          CZipFileMember
         </span>
        </a>
        . 
 The
        <a href="GUID-02A8BC62-D653-39A3-BE0C-92A5F3F43E85.html">
         <span class="apiname">
          CZipFileMember
         </span>
        </a>
        class retrieves the properties
of the member file once the member file is accessible.
       </span>
      </li>
      <li class="stepexpand" id="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-4EAC4BD5-551B-58A3-A6B4-D4433027F5C8">
       <a name="GUID-FDDAF8E9-4CAB-5489-B578-A5362E2140C1__GUID-4EAC4BD5-551B-58A3-A6B4-D4433027F5C8">
        <!-- -->
       </a>
       <span>
        <br />
        The files extracted from the archive are stored in the output folder. 
 If the output folder is unavailable a new folder is created prior to
archive decompression.
       </span>
      </li>
     </ol>
     <div class="example">
      <p>
       The following example code illustrates the decompression of file
archive.
      </p>
      <pre class="codeblock">
       /*
    * Decompresses all the files in "inputarchive.zip" using the EZlib.
    *  If an input filename is not specified it is assumed that the
    * input file name is contained in a provided .ini file.
    */
    void CEZlibEZipTests::DoEZlibZipArchiveDecompressL()
    {
    RFs iFs;
    iFS.connect();
    CleanupClosePushL(iFS);
    TInt err = KErrNone;
    HBufC8 *outputBuffer = HBufC8::NewLC(outputBufferSize);

    _LIT(KInputFileLocation, "c:\\private\\E80000B7\\zip\\input\\inputarchive.zip");
    TFileName inputFile(KInputFileLocation);

    RFile input;
    err = input.Open(iFs, inputFile, EFileStream | EFileRead | EFileShareExclusive);
    if(err != KErrNone)
        {
        INFO_PRINTF1(KOpenFileError);
        User::Leave(err);
        }
    CleanupClosePushL(input);

    CZipFile *zipFile = CZipFile::NewL(iFs,input);
    CleanupStack::PushL(zipFile);
    CZipFileMemberIterator *fileMemberIter = zipFile-&gt;GetMembersL();

    //  iZipArchiveEzlibFolder = GenerateZipArchiveFolderNameL(aInputFileName);
    //  iZipArchiveEzlibFolder.Append(KZipArchiveEzlib);

    for(TOLDEZIP::CZipFileMember *fileMember = fileMemberIter-&gt;NextL(); fileMember != NULL; fileMember = fileMemberIter-&gt;NextL())
        {
        TFileName tmpfilename(*(fileMember-&gt;Name()));

        // Check if we have a folder or file
        TPtrC lastChar = tmpfilename.Right(1);
        if(lastChar.Compare(_L("\\")) != 0 &amp;&amp; lastChar.Compare(_L("/")) != 0)
            {
            RFile output;
            err = output.Replace(iFs, tmpfilename, EFileStream | EFileWrite | EFileShareExclusive);
            if(err != KErrNone)
                {
                INFO_PRINTF1(KCreateFileError);
                User::Leave(err);
                }
            CleanupClosePushL(output);

            TOLDEZIP::RZipFileMemberReaderStream *readerStream;
            zipFile-&gt;GetInputStreamL(fileMember, readerStream);
            CleanupStack::PushL(readerStream);

            TPtr8 pOutputBuffer = outputBuffer-&gt;Des();
            do
                {
                err = readerStream-&gt;Read(pOutputBuffer, outputBufferSize);
                output.Write(pOutputBuffer);
                } while(err == KErrNone);
            if(err != KErrEof)
                {
                User::Leave(err);
                }
            CleanupStack::PopAndDestroy(2);
            }
        else
            {
            TFileName fullPath("c:\\private\\E80000B7\\zip\\input\\");
            fullPath.Append(tmpfilename);
            iRfs.MkDir(fullPath);
            }
        }
    CleanupStack::PopAndDestroy(3);
    }
      </pre>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-7AAAC6EA-784D-51E6-AD6B-521C9F5C4DBD.html" title="The Zip Compression Library, EZLib compresses files to two formats namely zip and gzip. EZLib also allows clients to decompress data from file archives and memory streams. The compression and decompression tasks are performed iteratively until task completion.">
        Zip Compression Library Tutorials
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>