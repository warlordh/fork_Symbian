<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="concept" />
  <meta name="DC.Title" content="How to handle changes to the text view" />
  <meta name="DC.Relation" scheme="URI" content="GUID-136540F0-108A-5794-A0FE-D95260F4E59B.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-4F901F56-7F0E-4869-85CA-6109ED0AF5B7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-4CBFA2E3-0EFC-5E10-A960-57A8FF9A6025.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-136540F0-108A-5794-A0FE-D95260F4E59B.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-E9E26499-1102-578E-93F6-A8E14181A25C" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   How to handle changes to the text view
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C">
  <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2400118 id2400464 id2400601 id2400650 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html">
      Text and Localization Guide
     </a>
     &gt;
     <a href="GUID-4F901F56-7F0E-4869-85CA-6109ED0AF5B7.html" title="This section describes about Text Handling and Text Formatting.">
      Text Layout
     </a>
     &gt;
     <a href="GUID-4CBFA2E3-0EFC-5E10-A960-57A8FF9A6025.html">
      Using Text Views (FORM)
     </a>
     &gt;
     <a href="GUID-136540F0-108A-5794-A0FE-D95260F4E59B.html">
      How to use text views
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     How to handle changes to the text view
    </h1>
    <div>
     <p>
      After a change has been made to the text layout, a reformat and redraw should normally take place, otherwise a panic will occur, as the text view needs to be kept up to date with changes to the text content. The following examples demonstrate which handling functions should be used to carry out the necessary reformatting.
     </p>
     <div class="section">
      <h2 class="sectiontitle">
       Reformatting and redrawing after changes to the formatting of a block of text.
      </h2>
      <p>
       To reformat either from the start of the line or the start of the paragraph containing the cursor position and redraw the view, after changes to the formatting of a block of text, use the
       <a href="GUID-CF377A98-F11F-380F-AD10-7F3E261D4421.html#GUID-CF377A98-F11F-380F-AD10-7F3E261D4421__GUID-00FEB3AA-E153-35BE-9BF2-05A8269C1780">
        <span class="apiname">
         CTextView::HandleRangeFormatChangeL()
        </span>
       </a>
       function.
      </p>
      <p>
       In the following example, the code retrieves the current selection and formats it.
      </p>
      <pre class="codeblock" id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-42FFE4EF-2BEF-5AA2-A373-C5A9D494DA13">
       <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-42FFE4EF-2BEF-5AA2-A373-C5A9D494DA13">
        <!-- -->
       </a>
       // Apply italics to the selected region
TCursorSelection cursorSelection;
charFormat.iFontSpec.iFontStyle.SetPosture(EPostureItalic); 
charFormatMask.SetAttrib(EAttFontPosture); // Want to set posture
      </pre>
      <p>
       When formatting text, set the attribute's value in the
       <a href="GUID-3518B92C-D1BD-36D1-B447-728A1052292F.html">
        <span class="apiname">
         TCharFormat
        </span>
       </a>
       object and set the corresponding bit in the format mask.
      </p>
      <ul>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-62AF121F-3BC4-5874-8351-578E687C5ED9">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-62AF121F-3BC4-5874-8351-578E687C5ED9">
         <!-- -->
        </a>
        <p>
         Use
         <a href="GUID-CF377A98-F11F-380F-AD10-7F3E261D4421.html#GUID-CF377A98-F11F-380F-AD10-7F3E261D4421__GUID-E5F8E21C-20B3-3095-BB04-56C5401B674D">
          <span class="apiname">
           CTextView::Selection()
          </span>
         </a>
         to get the start position and length of the selected region.
        </p>
       </li>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-6092691E-80AB-5E48-B3A5-260762848D16">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-6092691E-80AB-5E48-B3A5-260762848D16">
         <!-- -->
        </a>
        <p>
         Apply character formatting to the selection using
         <a href="GUID-39945DA4-B362-3DF6-BF9E-DD079EEA7934.html#GUID-39945DA4-B362-3DF6-BF9E-DD079EEA7934__GUID-3E10E796-78C1-31FB-BDF4-5EDA2B36B20B">
          <span class="apiname">
           CRichText::ApplyCharFormatL()
          </span>
         </a>
         .
        </p>
       </li>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-0C61B3B0-9839-5F27-B1ED-D511D3D8AB6D">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-0C61B3B0-9839-5F27-B1ED-D511D3D8AB6D">
         <!-- -->
        </a>
        <p>
         After reformatting text, handle changes to the layout of the document by an appropriate change handling function.
         <a href="GUID-CF377A98-F11F-380F-AD10-7F3E261D4421.html#GUID-CF377A98-F11F-380F-AD10-7F3E261D4421__GUID-00FEB3AA-E153-35BE-9BF2-05A8269C1780">
          <span class="apiname">
           CTextView::HandleRangeFormatChangeL()
          </span>
         </a>
         deals with block reformatting and redraws the view, and is the appropriate change handling function here.
        </p>
       </li>
      </ul>
      <pre class="codeblock" id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-A129080C-9828-5B99-A48E-F3B07E1305FD">
       <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-A129080C-9828-5B99-A48E-F3B07E1305FD">
        <!-- -->
       </a>
       cursorSelection=iTextView-&gt;Selection(); // get limits of selection
TInt lowerPos=cursorSelection.LowerPos();
TInt length=cursorSelection.Length();
// Apply format to selected region
iRichText-&gt;ApplyCharFormatL(charFormat,charFormatMask,lowerPos,length);
// Ensure selection is cancelled after reformatting
TInt cursorPos=cursorSelection.iCursorPos; // Get new cursor position
// Set pending selection of length zero
TCursorSelection pendingSelection(cursorPos,cursorPos);
// Zero length selection, beginning and ending at new cursor position
iTextView-&gt;SetPendingSelection(pendingSelection);
        // Cancels selection after reformatting complete 
iTextView-&gt;HandleRangeFormatChangeL(cursorSelection); // reformat everything from here
      </pre>
      <p>
       <strong>
        Notes
       </strong>
      </p>
      <ul>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-A1E0FEB8-C5B3-5B09-84C2-4B79BC1E9F04">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-A1E0FEB8-C5B3-5B09-84C2-4B79BC1E9F04">
         <!-- -->
        </a>
        <p>
         <samp class="codeph">
          CTextView
         </samp>
         's change handling functions do not cancel an existing selection. To do so, either of two functions can be used â€”
         <samp class="codeph">
          CancelSelectionL()
         </samp>
         , or, as demonstrated above,
         <samp class="codeph">
          SetPendingSelection()
         </samp>
         .
         <samp class="codeph">
          SetPendingSelection()
         </samp>
         sets the selection which should take effect after
         <samp class="codeph">
          HandleRangeFormatChangeL()
         </samp>
         or
         <samp class="codeph">
          HandleInsertDeleteL()
         </samp>
         has returned. If the selection's anchor and cursor positions are set to the new cursor position, this has the effect of cancelling any selection. This method has the advantage over calling
         <samp class="codeph">
          CancelSelectionL()
         </samp>
         in that the selected region is only drawn once, reducing the likelihood of flicker.
        </p>
       </li>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-630CD46C-1615-537D-8229-1852EA8AAC6C">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-630CD46C-1615-537D-8229-1852EA8AAC6C">
         <!-- -->
        </a>
        <p>
         Formatting can either be applied to the entire document (the default), or just to the visible part of it (the band). Setting the formatting to the band may be desirable when the document has expanded over a certain size.
        </p>
       </li>
      </ul>
     </div>
     <div class="section">
      <h2 class="sectiontitle">
       Reformatting and redrawing after inserting, deleting or replacing text
      </h2>
      <p>
       To Reformat and redraw the view after inserting, deleting or replacing a block of text, use the
       <a href="GUID-CF377A98-F11F-380F-AD10-7F3E261D4421.html#GUID-CF377A98-F11F-380F-AD10-7F3E261D4421__GUID-44D29E1D-3FBF-374E-AE3F-A6CA98A044F1">
        <span class="apiname">
         CTextView::HandleInsertDeleteL()
        </span>
       </a>
       function.
      </p>
      <p>
       In the following example the code inserts several lines of text into the document, followed by a paragraph delimiter.
      </p>
      <ul>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-989A336F-1E0B-5E9C-831A-5F1283C6B18D">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-989A336F-1E0B-5E9C-831A-5F1283C6B18D">
         <!-- -->
        </a>
        <p>
         Before inserting a paragraph delimiter at the end of the text, use
         <a href="GUID-49DBB305-A043-3D23-AC33-6E5C8ABAD1EE.html#GUID-49DBB305-A043-3D23-AC33-6E5C8ABAD1EE__GUID-2445FFDF-E85C-3AA8-9776-BF349F6D8436">
          <span class="apiname">
           CEditableText::DocumentLength()
          </span>
         </a>
         to find the document position of the final character in the document.
        </p>
       </li>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-13A1E9E3-194C-5AD8-832E-05D9C2FE3291">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-13A1E9E3-194C-5AD8-832E-05D9C2FE3291">
         <!-- -->
        </a>
        <p>
         Call
         <a href="GUID-CF377A98-F11F-380F-AD10-7F3E261D4421.html#GUID-CF377A98-F11F-380F-AD10-7F3E261D4421__GUID-44D29E1D-3FBF-374E-AE3F-A6CA98A044F1">
          <span class="apiname">
           CTextView::HandleInsertDeleteL()
          </span>
         </a>
         to handle the block insertion and cause a redraw.
        </p>
       </li>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-05D2B596-3760-569B-A128-91FC90934285">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-05D2B596-3760-569B-A128-91FC90934285">
         <!-- -->
        </a>
        <p>
         Use an object of class
         <a href="GUID-E2ED2E4B-C428-355D-84CC-A4FA0ED50B74.html">
          <span class="apiname">
           TCursorSelection
          </span>
         </a>
         to indicate the start position and length of the inserted text. The second argument has a value of zero because no characters were deleted.
        </p>
       </li>
      </ul>
      <pre class="codeblock" id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-6D026081-0D3A-5CAE-8F84-09F45816F0DF">
       <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-6D026081-0D3A-5CAE-8F84-09F45816F0DF">
        <!-- -->
       </a>
       // Insert lots of text
iRichText-&gt;InsertL(iRichText-&gt;DocumentLength(),_L(
    "To be, or not to be, that is the question "
    ...
    ..."));
iRichText-&gt;InsertL(iRichText-&gt;DocumentLength(),
    CEditableText::EParagraphDelimiter); // end para
TCursorSelection cursorSelection(0,iRichText-&gt;DocumentLength());
iTextView-&gt;HandleInsertDeleteL(cursorSelection,0); // Handle insertion
      </pre>
     </div>
     <div class="section">
      <h2 class="sectiontitle">
       Reformatting and redrawing after a global change
      </h2>
      <p>
       To reformat and redraw the view after a global change has been made to the layout, use the
       <a href="GUID-CF377A98-F11F-380F-AD10-7F3E261D4421.html#GUID-CF377A98-F11F-380F-AD10-7F3E261D4421__GUID-903D1087-42CB-32EB-8379-7B019936AD16">
        <span class="apiname">
         CTextView::HandleGlobalChangeL()
        </span>
       </a>
       function.
      </p>
      <p>
       In the following example, the code sets the
       <span class="keyword">
        formatted
        band
       </span>
       to the part of the document displayed in the view rectangle.
      </p>
      <pre class="codeblock" id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-0ECA95FD-410F-5B94-9DDB-E5D0C5D97EE1">
       <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-0ECA95FD-410F-5B94-9DDB-E5D0C5D97EE1">
        <!-- -->
       </a>
       TBuf&lt;80&gt; message;
iLayout-&gt;SetAmountToFormat(CTextLayout::EFFormatBand);
iTextView-&gt;HandleGlobalChangeL(); // Global document change
      </pre>
     </div>
     <div class="section">
      <h2 class="sectiontitle">
       Reformatting the whole document or visible text
      </h2>
      <p>
       To reformat the whole document, or just the visible text if formatting is set to the band only, use the
       <a href="GUID-CF377A98-F11F-380F-AD10-7F3E261D4421.html#GUID-CF377A98-F11F-380F-AD10-7F3E261D4421__GUID-7A878B50-A9AF-3D54-8035-1DF4FE819454">
        <span class="apiname">
         CTextView::FormatTextL()
        </span>
       </a>
       function.
      </p>
      <p>
       In the following example, the code inserts several lines of text, with increased height to aid visibility, then sets the
       <span class="keyword">
        formatted
        band
       </span>
       .
      </p>
      <ul>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-721E9015-0F7E-59AD-980C-9CB5878AB544">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-721E9015-0F7E-59AD-980C-9CB5878AB544">
         <!-- -->
        </a>
        <p>
         The following code sets the font height to 200 twips and ensures that this height will be applied to all text subsequently inserted. All other character and paragraph formatting is taken from the system-provided default settings.
        </p>
       </li>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-345B17D2-381D-5049-968F-EE5DF872801C">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-345B17D2-381D-5049-968F-EE5DF872801C">
         <!-- -->
        </a>
        <p>
         Apply character formatting to the selection using
         <a href="GUID-39945DA4-B362-3DF6-BF9E-DD079EEA7934.html#GUID-39945DA4-B362-3DF6-BF9E-DD079EEA7934__GUID-3E10E796-78C1-31FB-BDF4-5EDA2B36B20B">
          <span class="apiname">
           CRichText::ApplyCharFormatL()
          </span>
         </a>
         .
        </p>
       </li>
       <li id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-CB155905-65EE-51B8-9627-98D120590E27">
        <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-CB155905-65EE-51B8-9627-98D120590E27">
         <!-- -->
        </a>
        <p>
         Use
         <a href="GUID-CF377A98-F11F-380F-AD10-7F3E261D4421.html#GUID-CF377A98-F11F-380F-AD10-7F3E261D4421__GUID-7A878B50-A9AF-3D54-8035-1DF4FE819454">
          <span class="apiname">
           CTextView::FormatTextL()
          </span>
         </a>
         to global reformat the document. Note that this function does not cause a redraw, which is appropriate here because the document contains no text.
        </p>
       </li>
      </ul>
      <pre class="codeblock" id="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-096F32AB-1F09-55F9-9511-D41DC8FCBE56">
       <a name="GUID-E9E26499-1102-578E-93F6-A8E14181A25C__GUID-096F32AB-1F09-55F9-9511-D41DC8FCBE56">
        <!-- -->
       </a>
       TCharFormat charFormat;
TCharFormatMask charFormatMask;
charFormatMask.SetAttrib(EAttFontHeight); // want to set height to 10 point (200 twips)
charFormat.iFontSpec.iHeight=200;    
iRichText-&gt;ApplyCharFormatL(charFormat,charFormatMask,0,1);
    // apply format from position 0, for 1 character
iTextView-&gt;FormatTextL();
      </pre>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-136540F0-108A-5794-A0FE-D95260F4E59B.html">
        How to use text views
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>