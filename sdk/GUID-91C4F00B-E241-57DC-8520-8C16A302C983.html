<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="concept" />
  <meta name="DC.Title" content="Creating a Personal Area Network (PAN)" />
  <meta name="DC.Relation" scheme="URI" content="GUID-308A481C-2280-59CE-AE85-83047B11BBE4.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-DD13AA8E-BDAD-57EC-81EC-49C8D6D30A86.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-ACB3786B-38EB-58F4-87B6-6A46A390B154.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-0F3E543D-CFEE-5CD8-8BAB-19B3A993388F.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-308A481C-2280-59CE-AE85-83047B11BBE4.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-91C4F00B-E241-57DC-8520-8C16A302C983" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Creating a Personal Area Network (PAN)
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983">
  <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2399699 id2399839 id2399854 id2399868 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-DD13AA8E-BDAD-57EC-81EC-49C8D6D30A86.html" title="The Short Link Services module enables licensees to implement Bluetooth, USB, Infrared and OBEX on Symbian platform devices.">
      Short Link Services Guide
     </a>
     &gt;
     <a href="GUID-ACB3786B-38EB-58F4-87B6-6A46A390B154.html" title="The Bluetooth Comms Profiles collection provides implementations of Bluetooth Profiles. Currently it provides an implementation of the Bluetooth PAN profile.">
      Bluetooth Comms Profiles Collection
     </a>
     &gt;
     <a href="GUID-0F3E543D-CFEE-5CD8-8BAB-19B3A993388F.html">
      PAN Profile
     </a>
     &gt;
     <a href="GUID-308A481C-2280-59CE-AE85-83047B11BBE4.html">
      Bluetooth PAN Profile Tutorial
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Creating a Personal Area Network (PAN)
    </h1>
    <div>
     <p>
      We are looking at a two device PAN in this tutorial. So if you want to run the example it must be installed on both devices. One device will initiate a connection and the other will listen for a connection. We will refer to the listener as D1 and the initiator as D2 when necessary.
     </p>
     <p>
      <strong>
       Using the Tutorial
      </strong>
     </p>
     <p>
      The code fragments in this tutorial are derived from the Bluetooth Example application available in
      <span class="filepath">
       /src/COMMON/DEVELOPERLIBRARY/examples/Bluetooth/BTExample1
      </span>
      . Although the code has been reformatted to the requirements of the tutorial there is always enough information included with the code to find the actual example code.
     </p>
     <p>
      <strong>
       Intended Audience:
      </strong>
     </p>
     <p>
      This tutorial is designed for Symbian licensees only. Several APIs mentioned ad used throughout this tutorial series are only available in a device creators kit environment.
     </p>
     <p>
      <strong>
       Basic procedure:
      </strong>
     </p>
     <p>
      The high level steps to create a PAN are:
     </p>
     <ul>
      <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-72B7C882-CF40-5A36-A9DF-9282433F42E3">
       <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-72B7C882-CF40-5A36-A9DF-9282433F42E3">
        <!-- -->
       </a>
       <p>
        Configure the Pan services extension table and the LAN services table in CommDB.
       </p>
      </li>
      <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8A972D2A-0093-59C6-9051-31B5C68BE785">
       <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8A972D2A-0093-59C6-9051-31B5C68BE785">
        <!-- -->
       </a>
       <p>
        Load the Bluetooth Stack
       </p>
      </li>
      <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-A574A7D0-7E53-5270-A912-31CD9BA31165">
       <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-A574A7D0-7E53-5270-A912-31CD9BA31165">
        <!-- -->
       </a>
       <p>
        Start the PAN connection
       </p>
      </li>
     </ul>
     <div class="section">
      <h2 class="sectiontitle">
       Configuring CommDB PAN IAP
      </h2>
      <p>
       The PAN IAP (
       <samp class="codeph">
        PANServiceExtensions
       </samp>
       table) will need to be configured for both devices. D1 will need to start a PAN listening connection. D2 will look for a listening device (D1) and connect to that device.
      </p>
      <p>
       To configure CommDB tables for PAN do the following:
      </p>
      <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-E4455A56-4DF3-5B28-B181-4B4D804BBCD0">
       <!-- -->
      </a>
      <ol id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-E4455A56-4DF3-5B28-B181-4B4D804BBCD0">
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-657F3E7E-18BE-5D70-B19B-026F821D3E1B">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-657F3E7E-18BE-5D70-B19B-026F821D3E1B">
         <!-- -->
        </a>
        <p>
         Open CommDB.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-2F0F9D67-416C-59E6-8E66-7A9A47543387">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-2F0F9D67-416C-59E6-8E66-7A9A47543387">
          <!-- -->
         </a>
         CCommsDatabase* db = CCommsDatabase::NewL();
CleanupStack::PushL(db);
        </pre>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-6D26A97B-290F-5C4F-B5A4-3435BA9E55F5">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-6D26A97B-290F-5C4F-B5A4-3435BA9E55F5">
         <!-- -->
        </a>
        <p>
         Open a view on the
         <samp class="codeph">
          PANServiceExtensionsTable1
         </samp>
         table.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-4C3A2F04-4F43-5A5C-B826-843794DEA4A3">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-4C3A2F04-4F43-5A5C-B826-843794DEA4A3">
          <!-- -->
         </a>
         CCommsDbTableView* tableView =
db-&gt;OpenTableLC(TPtrC(PAN_SERVICE_EXTENSIONS));
TBuf&lt;KMaxBufferSize&gt; tableName;
tableView-&gt;GotoFirstRecord();
tableView-&gt;ReadTextL(TPtrC(COMMDB_NAME), tableName);
        </pre>
        <p>
         Check that we are looking at the correct table.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C8DB29FE-E08E-5C99-BAE1-C5FD5D5C31C1">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C8DB29FE-E08E-5C99-BAE1-C5FD5D5C31C1">
          <!-- -->
         </a>
         if(tableName == TPtrC(_S("PANServiceExtensionsTable1")))
        </pre>
        <p>
         The above simply ensures that the table name is what was expected.
        </p>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-D3729BF0-D099-54C3-A3DF-2E60185B150B">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-D3729BF0-D099-54C3-A3DF-2E60185B150B">
         <!-- -->
        </a>
        <p>
         Open the table for editing.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-39F9B0B6-4800-574F-A81B-194B99B2418D">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-39F9B0B6-4800-574F-A81B-194B99B2418D">
          <!-- -->
         </a>
         User::LeaveIfError(tableView-&gt;UpdateRecord());
        </pre>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-FE0CE957-3F36-5F2C-8D02-C6A7D020E9CC">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-FE0CE957-3F36-5F2C-8D02-C6A7D020E9CC">
         <!-- -->
        </a>
        <p>
         Set the device to listen for incoming PAN connection requests if necessary.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C0C051FD-CC78-5CAD-8F11-32918A62EA07">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C0C051FD-CC78-5CAD-8F11-32918A62EA07">
          <!-- -->
         </a>
         tableView-&gt;WriteBoolL(TPtrC(PAN_ALLOW_INCOMING),aIsListening);
        </pre>
        <p>
         The value of
         <samp class="codeph">
          aIsListening
         </samp>
         is
         <samp class="codeph">
          ETrue
         </samp>
         for D1, the listening device.
        </p>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8877DB52-0D09-51B7-A70F-9A38C671C6C5">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8877DB52-0D09-51B7-A70F-9A38C671C6C5">
         <!-- -->
        </a>
        <p>
         Decide if the device will prompt for remote devices.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8ED99FED-419C-595B-A255-8B6305ABA1D7">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8ED99FED-419C-595B-A255-8B6305ABA1D7">
          <!-- -->
         </a>
         tableView-&gt;WriteBoolL(TPtrC(PAN_PROMPT_FOR_REMOTE_DEVICES),aUsePANNotifier);
        </pre>
        <p>
         The value of
         <samp class="codeph">
          aUsePANNotifier
         </samp>
         is
         <samp class="codeph">
          EFalse
         </samp>
         when you do not want the user to be prompted for a device. As with step 4 above this is the configuration for D1, the listening device, which will be accepting incoming connections instead of seeking other devices.
        </p>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-B158348B-A10A-5221-A092-2E76B6C31CF7">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-B158348B-A10A-5221-A092-2E76B6C31CF7">
         <!-- -->
        </a>
        <p>
         Set the PeerMacAddress to the Bluetooth device address of the device joining the PAN if known or to
         <samp class="codeph">
          NULL
         </samp>
         if not known.
        </p>
        <p>
         D2 will prompt for a Bluetooth device address (
         <samp class="codeph">
          aDevAddr
         </samp>
         ) when making the connection. So if
         <samp class="codeph">
          aDevAddr
         </samp>
         exists then the device is trying to initiate a PAN with D1, the listening device. The Peer Mac Address of the listener will be returned by the notifier (see "Finding the Bluetooth Device Address") and added to the CommDB table as shown.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-952DBDCE-CBCB-5179-9500-2BD7530A5334">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-952DBDCE-CBCB-5179-9500-2BD7530A5334">
          <!-- -->
         </a>
         if(aDevAddr)
{
 TBuf&lt;KMaxBufferSize&gt; buf;
 aDevAddr-&gt;GetReadable(buf);
 tableView-&gt;WriteTextL(TPtrC(PAN_PEER_MAC_ADDRESSES), buf);
}
        </pre>
        <p>
         D1 is the listener and so will not need a Bluetooth device address when creating the listening connection.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-5C8FFBDD-B575-51B9-8685-051CB7C47F05">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-5C8FFBDD-B575-51B9-8685-051CB7C47F05">
          <!-- -->
         </a>
         else
{
 tableView-&gt;WriteTextL(TPtrC(PAN_PEER_MAC_ADDRESSES), _L(""));
}
        </pre>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-EEFDAB7B-184F-50B9-907B-2EB255BE21FF">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-EEFDAB7B-184F-50B9-907B-2EB255BE21FF">
         <!-- -->
        </a>
        <p>
         Commit the CommDB
         <samp class="codeph">
          PANServiceExtensionsTable
         </samp>
         changes.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8AC18999-8FF4-5720-915F-8A1C8D5BB7D2">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8AC18999-8FF4-5720-915F-8A1C8D5BB7D2">
          <!-- -->
         </a>
         User::LeaveIfError(tableView-&gt;PutRecordChanges());// Finish update
User::LeaveIfError(db-&gt;CommitTransaction());
}
        </pre>
       </li>
      </ol>
      <p>
       The code above comes from
       <samp class="codeph">
        CPanConnections::ConfigureIAPL()
       </samp>
       in "
       <span class="filepath">
        exampleroot/src/panconnection.cpp
       </span>
       ".
      </p>
      <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-CFDC191E-24DA-502B-9A19-AF27101AEA41">
       <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-CFDC191E-24DA-502B-9A19-AF27101AEA41">
        <!-- -->
       </a>
       ConfigureIAPL(TBool aIsListening,TBTDevAddr* aDevAddr,TBool aUsePANNotifier)
{
      </pre>
      <p>
       The function is called when a connection is started. This function is called with three values: aIsListening, aDevAddr, and aUsePANNotifier.
      </p>
      <div class="tablenoborder">
       <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-974413E6-6D10-506F-B8AB-55BCB29F40A0">
        <!-- -->
       </a>
       <table cellpadding="4" cellspacing="0" summary="" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-974413E6-6D10-506F-B8AB-55BCB29F40A0" frame="border" border="1" rules="all">
        <thead align="left">
         <tr>
          <th class="cellrowborder" valign="top" id="d931771e203">
           Attribute
          </th>
          <th class="cellrowborder" valign="top" id="d931771e206">
           Value
          </th>
         </tr>
        </thead>
        <tbody>
         <tr>
          <td class="cellrowborder" valign="top" headers="d931771e203 ">
           <p>
            <samp class="codeph">
             aIsListening
            </samp>
           </p>
          </td>
          <td class="cellrowborder" valign="top" headers="d931771e206 ">
           <p>
            when called from
            <samp class="codeph">
             CPanConnections::StartConnection()
            </samp>
            :
           </p>
           <ul>
            <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-6DCBB16D-FD7E-5479-A4DD-87E7B4B5497D">
             <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-6DCBB16D-FD7E-5479-A4DD-87E7B4B5497D">
              <!-- -->
             </a>
             <p>
              <samp class="codeph">
               ETrue
              </samp>
              if the device is listening for an incoming connection.
             </p>
            </li>
            <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-7FACD95C-C658-5088-A294-C39B2C1C6513">
             <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-7FACD95C-C658-5088-A294-C39B2C1C6513">
              <!-- -->
             </a>
             <p>
              <samp class="codeph">
               EFalse
              </samp>
              if the device is not listening for an incoming connection.
             </p>
            </li>
           </ul>
          </td>
         </tr>
         <tr>
          <td class="cellrowborder" valign="top" headers="d931771e203 ">
           <p>
            <samp class="codeph">
             aDevAddr
            </samp>
           </p>
          </td>
          <td class="cellrowborder" valign="top" headers="d931771e206 ">
           <p>
            The Bluetooth device address.
           </p>
          </td>
         </tr>
         <tr>
          <td class="cellrowborder" valign="top" headers="d931771e203 ">
           <p>
            <samp class="codeph">
             aUsePANNotifier
            </samp>
           </p>
          </td>
          <td class="cellrowborder" valign="top" headers="d931771e206 ">
           <p>
            when called from
            <samp class="codeph">
             CActiveConsole::ProcessKeyPressL()
            </samp>
            :
           </p>
           <ul>
            <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-509E8AC0-CF79-58BD-B4B9-D70E9C6509F4">
             <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-509E8AC0-CF79-58BD-B4B9-D70E9C6509F4">
              <!-- -->
             </a>
             <p>
              <samp class="codeph">
               ETrue
              </samp>
              if the PAN notifier is needed.
             </p>
            </li>
            <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-5BE885F8-2BEB-5AE9-9423-9D1D7BA66997">
             <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-5BE885F8-2BEB-5AE9-9423-9D1D7BA66997">
              <!-- -->
             </a>
             <p>
              <samp class="codeph">
               EFalse
              </samp>
              if the PAN notifier is not needed.
             </p>
            </li>
           </ul>
          </td>
         </tr>
        </tbody>
       </table>
      </div>
      <p id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-DE57E5EA-1C46-5AE4-86CF-06AC92203383">
       <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-DE57E5EA-1C46-5AE4-86CF-06AC92203383">
        <!-- -->
       </a>
       <strong>
        Finding the Bluetooth Device Address
       </strong>
      </p>
      <p>
       The following code shows how to get and manipulate the Bluetooth device address:
      </p>
      <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8C4B51E9-5CC2-5EC1-948C-A3DAD2197253">
       <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8C4B51E9-5CC2-5EC1-948C-A3DAD2197253">
        <!-- -->
       </a>
       ...
TBTDevAddr devAddr; // Bluetooth device address.
//
TMenuMode = iMode; // from console.h
//
iMode = EPan;    //Ask user which device address we should connect to...
RNotifier notify; // get a notifier
User::LeaveIfError(notify.Connect()); // connect to the notifier
TBTDeviceSelectionParamsPckg pckg; // Bluetooth device parameters package
TBTDeviceResponseParamsPckg resPckg; // Response parameters package
TRequestStatus stat;
 // Start the notifier.
notify.StartNotifierAndGetResponse(stat,KDeviceSelectionNotifierUid,pckg,resPckg);
 // Wait for the notifier results.
User::WaitForRequest(stat);
notify.CancelNotifier(KDeviceSelectionNotifierUid);
 // Close the notifier now that we have the device details.
notify.Close();
User::LeaveIfError(stat.Int()); 
 // extract the Bluetooth device address from the notifier results.
devAddr = resPckg().BDAddr();
 // start the PAN connection request, send the Bluetooth device address.
iPanConnection-&gt;StartConnection(&amp;devAddr, EFalse, EFalse);
      </pre>
      <p>
       <strong>
        Note:
       </strong>
       this fragment taken from
       <samp class="codeph">
        CActiveConsole::ProcessKeyPressL()
       </samp>
       in "
       <span class="filepath">
        exampleroot/src/console.cpp
       </span>
       ".
      </p>
     </div>
     <div class="section">
      <h2 class="sectiontitle">
       Loading the Bluetooth Stack
      </h2>
      <p>
       The Bluetooth stack will need to be loaded before a PAN is created.
      </p>
      <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-D7E947FB-72E5-528F-81C5-B5FAC48F7141">
       <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-D7E947FB-72E5-528F-81C5-B5FAC48F7141">
        <!-- -->
       </a>
       Initialise()
{
 _LIT(KPDDName, "EUART1");        
 _LIT(KLDDName, "ECOMM");    
 TInt rerr = KErrNone;
 rerr = StartC32();// For any Serial comms
 // Load required drivers
 User::LoadPhysicalDevice(KPDDName);
 User::LoadLogicalDevice(KLDDName);
 iSockSvr.Connect();
 TProtocolDesc iProtocolInfo;
 TRequestStatus status;
 iSockSvr.FindProtocol(_L("L2CAP"), iProtocolInfo);
 // After Socket server is connected, start L2CAP protocol
 iSockSvr.StartProtocol(iProtocolInfo.iAddrFamily,
 iProtocolInfo.iSockType,iProtocolInfo.iProtocol, status);
 User::WaitForRequest(status);
}
      </pre>
      <p>
       The code above shows how to load the Bluetooth Stack using standard sockets.
      </p>
     </div>
     <div class="section">
      <h2 class="sectiontitle">
       Starting the PAN Connection
      </h2>
      <p>
       Now that you have loaded the Bluetooth stack and configured the PAN service extensions table a PAN connection can be opened.
      </p>
      <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8F3A4A6B-8363-5ADB-8A1A-217AE22B40E8">
       <!-- -->
      </a>
      <ol id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-8F3A4A6B-8363-5ADB-8A1A-217AE22B40E8">
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C880CE0D-67DB-5B63-92A2-57DCA637A05A">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C880CE0D-67DB-5B63-92A2-57DCA637A05A">
         <!-- -->
        </a>
        <p>
         Define the connection preferences.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C88F1DF0-1AF6-50CA-9ACF-54D90A1109B1">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C88F1DF0-1AF6-50CA-9ACF-54D90A1109B1">
          <!-- -->
         </a>
         // EGeneralIAP = 1
PanProfileIAPs iap(EGeneralIAP); // panconnection.h
connPref.SetIapId(iap);
iConnPref.SetDialogPreference(ECommDbDialogPrefDoNotPrompt);
TInt rerr = iSockSvr.Connect();
if(rerr == KErrNone)
{
        </pre>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C2CAC673-1042-567F-81AD-8D1FD6935776">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-C2CAC673-1042-567F-81AD-8D1FD6935776">
         <!-- -->
        </a>
        <p>
         Load the Bluetooth stack.
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-A966FFCA-2422-5472-811D-DEFBC594DC05">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-A966FFCA-2422-5472-811D-DEFBC594DC05">
          <!-- -->
         </a>
         Initialise();
        </pre>
        <p>
         Covered in the previous section.
        </p>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-22D2273F-8029-589A-9C0B-85DBDAEB1778">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-22D2273F-8029-589A-9C0B-85DBDAEB1778">
         <!-- -->
        </a>
        <p>
         Open the connection
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-85DE421F-9882-5BEB-8330-A5EDDE9C4A80">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-85DE421F-9882-5BEB-8330-A5EDDE9C4A80">
          <!-- -->
         </a>
         rerr = iConnection.Open(iSockSvr);
        </pre>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-08794D6C-A40C-505B-9EDC-DB012D4D7B1D">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-08794D6C-A40C-505B-9EDC-DB012D4D7B1D">
         <!-- -->
        </a>
        <p>
         Start the session if the connection opened correctly:
        </p>
        <pre class="codeblock" id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-9D85A068-6F17-5A4A-A03E-5292381FB60F">
         <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-9D85A068-6F17-5A4A-A03E-5292381FB60F">
          <!-- -->
         </a>
         if(rerr == KErrNone)
{
 iConnection.Start(iConnPref,iStat);    
 User::WaitForRequest(iStat);
}
if(iStat==KErrNone)    
{
        </pre>
       </li>
      </ol>
      <p>
       The code above is derived from
       <samp class="codeph">
        CPanConnections::StartIAP()
       </samp>
       in "
       <span class="filepath">
        exampleroot/src/panconnection.cpp
       </span>
       ".
      </p>
      <p>
       That's all there is to creating a PAN.
      </p>
     </div>
     <div class="section">
      <h2 class="sectiontitle">
       What's next?
      </h2>
      <p>
       Having created a PAN you will need to add and remove devices and close the PAN. The following will help:
      </p>
      <ul>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-9273F800-3857-51FD-A443-9AC246203FB2">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-9273F800-3857-51FD-A443-9AC246203FB2">
         <!-- -->
        </a>
        <p>
         <strong>
          Creating a Personal Area Network (PAN)
         </strong>
         - This document
        </p>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-245B7926-AA87-5B13-B46E-C8DF4DBB162C">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-245B7926-AA87-5B13-B46E-C8DF4DBB162C">
         <!-- -->
        </a>
        <p>
         <a href="GUID-685AD682-10DC-553B-9C3A-04D0376138C4.html">
          Adding a device to the PAN
         </a>
        </p>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-D070BE04-D2BB-593C-BEE4-23E0E4637E10">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-D070BE04-D2BB-593C-BEE4-23E0E4637E10">
         <!-- -->
        </a>
        <p>
         <a href="GUID-197648C4-A42C-5769-82B7-F8BA510631D9.html">
          Removing a device from the PAN
         </a>
        </p>
       </li>
       <li id="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-FCFBE512-1321-57F0-9F5B-D13784700CD5">
        <a name="GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-FCFBE512-1321-57F0-9F5B-D13784700CD5">
         <!-- -->
        </a>
        <p>
         <a href="GUID-50CDF6E0-C352-5771-8686-B551267C6BE6.html">
          Closing the PAN
         </a>
        </p>
       </li>
      </ul>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-308A481C-2280-59CE-AE85-83047B11BBE4.html">
        Bluetooth PAN Profile Tutorial
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>