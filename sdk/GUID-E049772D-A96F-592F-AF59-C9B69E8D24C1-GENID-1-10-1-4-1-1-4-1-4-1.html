<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="concept" />
  <meta name="DC.Title" content="Using the extended notifier framework" />
  <meta name="DC.Relation" scheme="URI" content="GUID-FC2F5CDE-D140-5893-894D-D9B93AF6BDC2.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-97CCEF05-8F3D-5802-A33A-ED349084D524.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-FC2F5CDE-D140-5893-894D-D9B93AF6BDC2.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-29486886-CB54-4A83-AD6D-70F971A86DFC.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-94005A46-B4C6-4A30-A8E8-1B9C2D583D50.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-29486886-CB54-4A83-AD6D-70F971A86DFC.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Using the extended notifier framework
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1">
  <a name="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2469732 id2469667 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-97CCEF05-8F3D-5802-A33A-ED349084D524.html">
      Application Framework Guide
     </a>
     &gt;
     <a href="GUID-FC2F5CDE-D140-5893-894D-D9B93AF6BDC2.html">
      Using Uikon
     </a>
     &gt;
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-94005A46-B4C6-4A30-A8E8-1B9C2D583D50.html">
      Classic UI Guide
     </a>
     &gt;
     <a href="GUID-29486886-CB54-4A83-AD6D-70F971A86DFC.html">
      Application and UI frameworks
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Using
the extended notifier framework
    </h1>
    <div>
     <div class="section" id="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1__GUID-41892CE3-A4CC-5761-9469-530D6D18EDFE-GENID-1-10-1-4-1-1-4-1-4-1-2-1">
      <a name="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1__GUID-41892CE3-A4CC-5761-9469-530D6D18EDFE-GENID-1-10-1-4-1-1-4-1-4-1-2-1">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       The framework
      </h2>
      <p>
       Notifiers
allow components with no direct UI linkage to interact with the user via an
interface such as a dialog box. For example, a low level component might want
to warn the user about a low battery level. Typically, such a component would
not have direct access, or knowledge of, a UI. The solution to this problem
is provided by what are known as notifiers and the extended notifier framework.
The UI element (the dialog box) is provided by the device's UI
through what are known as notifier plug-ins.
      </p>
      <p>
       The extended notifier
framework is a system that loads these plug-in DLLs from
       <span class="filepath">
        Z\sys\bin\notifiers
       </span>
       .
      </p>
      <p>
       These
DLLs are expected to export a single factory function at ordinal #1 that returns
an array of notifiers. A special notifier target type is supported by makmake.
The second Uid for notifiers should be 0x10005522.
      </p>
      <p>
       The behaviour of
notifiers is supplied by providing an implementation of the
       <a href="GUID-DE445C4B-22EF-3A1F-8A69-57CB703BFAD0.html">
        <span class="apiname">
         MEikSrvNotifierBase2
        </span>
       </a>
       interface
. A notifier is associated with a channel and a priority. Priority is used
to determine the order of activation if more than one notifier is activated
at any time. Priority only affects notifiers on the same channel (for example,
a screen or LED). This means that two notifiers can be active at the same
time provided that they are on different channels.
      </p>
      <p>
       The channel and
priority used by all the notifiers in the system needs to be considered carefully
to avoid them interfering with each other in unexpected ways. The
       <a href="GUID-DE445C4B-22EF-3A1F-8A69-57CB703BFAD0.html">
        <span class="apiname">
         MEikSrvNotifierBase2
        </span>
       </a>
       derived
class also needs to be implemented correctly. Notifiers run in the UIKON server
thread and are accessed on the client side via
       <a href="GUID-A6B66713-FECA-3BE7-BB81-1AE5551AD83D.html">
        <span class="apiname">
         RNotifier
        </span>
       </a>
       .
Note that if a notifier panics it will lead to a device reset.
      </p>
     </div>
     <div class="section" id="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1__GUID-9322CFDB-D07E-54C3-86B1-13BFB082B175-GENID-1-10-1-4-1-1-4-1-4-1-2-2">
      <a name="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1__GUID-9322CFDB-D07E-54C3-86B1-13BFB082B175-GENID-1-10-1-4-1-1-4-1-4-1-2-2">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       The factory
function
      </h2>
      <p>
       The factory function at ordinal #1 is expected to return
an array of notifiers. The following is a typical implementation:
      </p>
      <pre class="codeblock" id="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1__GUID-F5B8C31B-110E-569A-BE9E-3986E94A506D-GENID-1-10-1-4-1-1-4-1-4-1-2-2-3">
       <a name="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1__GUID-F5B8C31B-110E-569A-BE9E-3986E94A506D-GENID-1-10-1-4-1-1-4-1-4-1-2-2-3">
        <!-- -->
       </a>
       EXPORT_C CArrayPtr&lt;MEikSrvNotifierBase2&gt;* NotifierArray()
    {
    CArrayPtrFlat&lt;MEikSrvNotifierBase2&gt;* notifiers=new CArrayPtrFlat&lt;MEikSrvNotifierBase2&gt;(5);
       if (notifiers)
        {
        TRAPD(err, CreateNotifiersL(notifiers));
        if(err)
            {
            TInt count = notifiers-&gt;Count();
            while(count--)
                {
                (*notifiers)[count]-&gt;Release();
                }
            delete notifiers;
            notifiers = NULL;
            }
        }
    return(notifiers);
    }
      </pre>
      <div class="note">
       <span class="notetitle">
        Note:
       </span>
       <p>
        Ownership of the notifier array or its contents is not
transferred to the framework until this function returns. To avoid memory
leaks, all acquired resources must be freed if anything goes wrong part of
the way through its processing.
       </p>
      </div>
      <p>
       Calling
       <samp class="codeph">
        Release()
       </samp>
       on
a notifier should cause that notifier to free all of its resources, and as
a minimum should call
       <samp class="codeph">
        delete           this;
       </samp>
       . See
       <a href="GUID-DE445C4B-22EF-3A1F-8A69-57CB703BFAD0.html#GUID-DE445C4B-22EF-3A1F-8A69-57CB703BFAD0__GUID-CF772B65-7D65-3ADC-B566-9ED2A263942F">
        <span class="apiname">
         MEikSrvNotifierBase2::Release()
        </span>
       </a>
       .
      </p>
      <p>
       Returning
a
       <samp class="codeph">
        Null
       </samp>
       value from this function causes the framework to leave
with
       KErrNoMemory
       .
      </p>
      <p>
       The
       <samp class="codeph">
        CreateNotifiersL()
       </samp>
       function
should be implemented as follows:
      </p>
      <pre class="codeblock" id="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1__GUID-15535A2D-A1F3-5A18-99B7-B2973BDFB255-GENID-1-10-1-4-1-1-4-1-4-1-2-2-8">
       <a name="GUID-E049772D-A96F-592F-AF59-C9B69E8D24C1-GENID-1-10-1-4-1-1-4-1-4-1__GUID-15535A2D-A1F3-5A18-99B7-B2973BDFB255-GENID-1-10-1-4-1-1-4-1-4-1-2-2-8">
        <!-- -->
       </a>
       LOCAL_C void CreateNotifiersL(CArrayPtrFlat&lt;MEikSrvNotifierBase2&gt;* aNotifiers)
    {
    MEikSrvNotifierBase2* notifier;
    notifier = CMyNotifierA::NewL();
    CleanupStack::PushL(notifier);
       aNotifiers-&gt;AppendL(notifier);
       CleanupStack::Pop(notifier);
    ... 
    ...
    // typically, repeat this procedure for as
    // many notifiers as are implemented
    // in the plug-in DLL.
    }
      </pre>
      <div class="note">
       <span class="notetitle">
        Note:
       </span>
       <p>
        Use of the standard Symbian platform technique
of using the cleanup stack to hold pointers to allocated objects for as long
as these objects have no owner; this prevents memory leaks. For this reason,
avoid using a technique such as
        <samp class="codeph">
         aNotifiers-&gt;AppendL(CMyNotifierA::NewL());
        </samp>
        ,
which, although shorter, will result in a memory leak if the
        <samp class="codeph">
         AppendL()
        </samp>
        operation
fails.
       </p>
      </div>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-FC2F5CDE-D140-5893-894D-D9B93AF6BDC2.html">
        Using Uikon
       </a>
      </div>
     </div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-29486886-CB54-4A83-AD6D-70F971A86DFC.html">
        Application and UI frameworks
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>