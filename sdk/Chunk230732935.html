<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="concept" />
  <meta name="DC.Title" content="Drawing in the view architecture" />
  <meta name="DC.Relation" scheme="URI" content="Chunk406167520.html#GUID-95C188D0-EDB2-46D0-ACDE-19AAD524C9F4" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-94005A46-B4C6-4A30-A8E8-1B9C2D583D50.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-29486886-CB54-4A83-AD6D-70F971A86DFC.html" />
  <meta name="DC.Relation" scheme="URI" content="Chunk1048638081.html#GUID-E50EC0B4-A434-4C30-A1A9-1A976185FF28" />
  <meta name="DC.Relation" scheme="URI" content="Chunk770996938.html#GUID-68B999C2-0993-4804-9624-42C3D88BE5C7" />
  <meta name="DC.Relation" scheme="URI" content="Chunk406167520.html#GUID-95C188D0-EDB2-46D0-ACDE-19AAD524C9F4" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Drawing in the view architecture
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C">
  <a name="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2469732 id2469667 id2469273 id2469204 id2469150 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-94005A46-B4C6-4A30-A8E8-1B9C2D583D50.html">
      Classic UI Guide
     </a>
     &gt;
     <a href="GUID-29486886-CB54-4A83-AD6D-70F971A86DFC.html">
      Application and UI frameworks
     </a>
     &gt;
     <a href="Chunk1048638081.html#GUID-E50EC0B4-A434-4C30-A1A9-1A976185FF28">
      UI architectures
     </a>
     &gt;
     <a href="Chunk770996938.html#GUID-68B999C2-0993-4804-9624-42C3D88BE5C7">
      View architecture
     </a>
     &gt;
     <a href="Chunk406167520.html#GUID-95C188D0-EDB2-46D0-ACDE-19AAD524C9F4">
      Views in the view architecture
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Drawing
in the view architecture
    </h1>
    <div>
     <p>
      The Symbian platform calls
      <a href="GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160.html#GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160__GUID-63295719-90A0-3D53-A643-0C52BF4068A1">
       <span class="apiname">
        CCoeControl::Draw()
       </span>
      </a>
      when
a control area needs to be updated on the display. Controls may implement
      <a href="GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160.html#GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160__GUID-63295719-90A0-3D53-A643-0C52BF4068A1">
       <span class="apiname">
        CCoeControl::Draw()
       </span>
      </a>
      or
leave the drawing to their child controls. For more information on control
hierarchies, see
      <a href="GUID-E244744F-4837-5B46-8E37-4666A28BF0B7.html">
       The
run-time control hierarchy
      </a>
      .
     </p>
     <p>
      The Symbian platform calls
      <a href="GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160.html#GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160__GUID-63295719-90A0-3D53-A643-0C52BF4068A1">
       <span class="apiname">
        CCoeControl::Draw()
       </span>
      </a>
      for
the parent control first, and then recursively for each control.
     </p>
     <p>
      Controls should override
      <a href="GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160.html#GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160__GUID-63295719-90A0-3D53-A643-0C52BF4068A1">
       <span class="apiname">
        CCoeControl::Draw()
       </span>
      </a>
      to draw
their content. The override should do nothing else and should be as fast as
possible. For example, it is bad design to create fonts dynamically, and read
any bitmaps or resources while drawing. A good rule of thumb is that there
should not be trap handlers in the method override; any time-consuming functionality
that can be done beforehand should be cached.
     </p>
     <p>
      In most cases controls are drawn on the display using the screen device
graphics context, accessed with
      <a href="GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160.html#GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160__GUID-6586DB74-AF5C-330B-9D0A-E4637396A04E">
       <span class="apiname">
        CCoeControl::SystemGc()
       </span>
      </a>
      .
The graphics context provides a wide set of
      <a href="GUID-E89F034F-C807-5FF9-B06B-F7CCD2441041.html" title="The Graphics Device Interface (GDI) collection provides important functionality within the Graphics subsystem. The functionality includes graphics device abstraction, linear digital differential analysis, font description and information, printer devices abstraction, line breaking and text rendering.">
       GDI
      </a>
      (Graphics
Device Interface  - common Symbian platform graphics API) drawing primitives
that can be used for drawing virtually anything on screen.
     </p>
     <p>
      An example of a basic override of
      <a href="GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160.html#GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160__GUID-63295719-90A0-3D53-A643-0C52BF4068A1">
       <span class="apiname">
        CCoeControl::Draw()
       </span>
      </a>
      for
a control that is a top-level window in an application is as follows:
     </p>
     <pre class="codeblock" id="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C__GUID-9EF298F3-9B92-48C1-BA7C-0C91143D075C">
      <a name="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C__GUID-9EF298F3-9B92-48C1-BA7C-0C91143D075C">
       <!-- -->
      </a>
      void CMyAppView::Draw( const TRect&amp; /*aRect*/ ) const
    {
    // Get the standard graphics context
    CWindowGc&amp; gc = SystemGc();
    gc.SetPenStyle( CGraphicsContext::ENullPen );
    gc.SetBrushColor( KRgbWhite);
    gc.SetBrushStyle( CGraphicsContext::ESolidBrush );

    // Gets the control's extent
    TRect rect( Rect());

        {
        gc.Clear( rect );
        }
    }
     </pre>
     <p>
      , where
     </p>
     <ul>
      <li>
       <p>
        <span class="parmname">
         CWindowGc&amp; gc = SystemGc();
        </span>
        gets
the graphics context that is used when drawing the control.
       </p>
      </li>
      <li>
       <p>
        <a href="GUID-0AEE5955-C530-35F1-A904-69183331B294.html#GUID-0AEE5955-C530-35F1-A904-69183331B294__GUID-026A1015-0D79-3A66-91BA-5FB343387EE0">
         <span class="apiname">
          CWindowGc::SetPenStyle()
         </span>
        </a>
        ,
        <a href="GUID-0AEE5955-C530-35F1-A904-69183331B294.html#GUID-0AEE5955-C530-35F1-A904-69183331B294__GUID-0A923CAA-7A89-3ED2-A844-2F4147B62FEC">
         <span class="apiname">
          CWindowGc::SetBrushColor()
         </span>
        </a>
        ,
and
        <a href="GUID-0AEE5955-C530-35F1-A904-69183331B294.html#GUID-0AEE5955-C530-35F1-A904-69183331B294__GUID-363A9FB3-75F7-3EB7-A783-91BBAEBCE670">
         <span class="apiname">
          CWindowGc::SetBrushStyle()
         </span>
        </a>
        are used to set the drawing
primatives for the context.
       </p>
      </li>
      <li>
       <p>
        <a href="GUID-101762DC-E498-3325-88AB-B0FF17DC62B6.html">
         <span class="apiname">
          TRect
         </span>
        </a>
        gets the size of the control rectangle.
       </p>
      </li>
      <li>
       <p>
        CWindowGc:Clear(rect)
        clears the control
rectangle.
       </p>
      </li>
     </ul>
     <div class="section" id="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C__GUID-DBACBFCC-F260-4ABE-B55C-BBB23F332E42">
      <a name="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C__GUID-DBACBFCC-F260-4ABE-B55C-BBB23F332E42">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       Drawing with
caches
      </h2>
      <p>
       For controls that perform intensive drawing operations, the drawing
should be cached: a process also known as double-buffering. Here the drawing
is done to a memory context first and then in the
       <a href="GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160.html#GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160__GUID-63295719-90A0-3D53-A643-0C52BF4068A1">
        <span class="apiname">
         CCoeControl::Draw()
        </span>
       </a>
       method
only the context's bitmap is passed to screen. In the Symbian platform, the
easiest way to implement a double buffer is to create a
       <a href="GUID-683A1D42-2764-3EB7-BD19-9E12559199AB.html">
        <span class="apiname">
         CFbsBitmap
        </span>
       </a>
       and
then bind a graphics context to that  - this makes it possible to use the
same GDI interface for drawing as the display context. The drawing is done
to a memory bitmap buffer, and when the Symbian platform updates the invalidated
screen area, the memory buffer is copied to it. Double-buffering is a common
paradigm used in games, but can also be utilized in any application when performance
of drawing controls is important.
      </p>
      <p>
       The following is a short example of how a double buffer is created and
used:
      </p>
      <pre class="codeblock" id="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C__GUID-995DBACE-EE60-4666-BDCF-975EE98B01FD">
       <a name="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C__GUID-995DBACE-EE60-4666-BDCF-975EE98B01FD">
        <!-- -->
       </a>
       iGcBmp = new (ELeave) CWsBitmap(iEikonEnv-&gt;WsSession());
User::LeaveIfError(iGcBmp-&gt;Create(aClientRect.Size(), iEikonEnv-&gt;ScreenDevice()-&gt;DisplayMode()));
iGcDevice = CFbsBitmapDevice::NewL(iGcBmp);
User::LeaveIfError(iGcDevice-&gt;CreateBitmapContext(iGc));
      </pre>
      <p>
       <span class="parmname">
        iGcBmp
       </span>
       is a pointer to
       <a href="GUID-17150D76-BB82-3A4B-8B1A-8BA93CB1A9EF.html">
        <span class="apiname">
         CWsBitmap
        </span>
       </a>
       ,
the bitmap memory buffer, that is created with the same width and height as
the top-level window and with the same color bit depth as the display.
       <span class="parmname">
        iGcDevice
       </span>
       is
a pointer to the
       <a href="GUID-2DEFEC47-F36E-3133-A08D-55F7C2534CC0.html">
        <span class="apiname">
         CBitmapDevice
        </span>
       </a>
       device class and the context
       <span class="parmname">
        iGc
       </span>
       holds
the
       <a href="GUID-FC746873-0570-3900-AD89-42B205FDC0D3.html">
        <span class="apiname">
         CBitmapContext
        </span>
       </a>
       instance.
       <span class="parmname">
        iGc
       </span>
       is
then used instead of
       <span class="parmname">
        CScreenGc
       </span>
       , obtained from the
       <span class="parmname">
        CCoeControl::SystemGc()
       </span>
       method,
when the control draws itself. The double-buffer drawing should be done outside
of the
       <a href="GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160.html#GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160__GUID-63295719-90A0-3D53-A643-0C52BF4068A1">
        <span class="apiname">
         CCoeControl::Draw()
        </span>
       </a>
       method and can be called directly
when needed. Only at the end of the off-screen drawing is the memory buffer
flushed to the screen by calling
       <a href="GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160.html#GUID-B06F99BD-F032-3B87-AB26-5DD6EBE8C160__GUID-9FB682AC-0209-302A-83F3-7BCB1162B998">
        <span class="apiname">
         CCoeControl::DrawDeferred()
        </span>
       </a>
      </p>
      <pre class="codeblock" id="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C__GUID-13A1E553-7A78-422C-85AC-7C89696B2D18">
       <a name="GUID-C6E9D609-E82C-4FAC-9265-F6A4FF61049C__GUID-13A1E553-7A78-422C-85AC-7C89696B2D18">
        <!-- -->
       </a>
       void CMyDrawingExample::Draw(const TRect&amp; /*aRect*/) const
    {
    SystemGc().BitBlt(TPoint(0, 0), iGcBmp);
    }
      </pre>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="Chunk406167520.html#GUID-95C188D0-EDB2-46D0-ACDE-19AAD524C9F4">
        Views in the view architecture
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>