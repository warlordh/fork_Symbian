<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="concept" />
  <meta name="DC.Title" content="Graphics Composition" />
  <meta name="DC.Relation" scheme="URI" content="GUID-99BC101A-9466-59EE-B5C9-7622BAF6E6FF.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-99BC101A-9466-59EE-B5C9-7622BAF6E6FF.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-D93978BE-11A3-5CE3-B110-1DEAA5AD566C.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-EF62BF88-3687-505D-8BD7-EEDF36246E56.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Graphics Composition
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B">
  <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2397524 id2397544 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html">
      Graphics Guide
     </a>
     &gt;
     <a href="GUID-99BC101A-9466-59EE-B5C9-7622BAF6E6FF.html" title="This section provides overview material about some important graphics topics, including introductions to ScreenPlay and the graphics architecture when ScreenPlay is not enabled.">
      Graphics Concepts
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Graphics
Composition
    </h1>
    <div>
     <p>
      Composition is the process of putting together the output elements from
various different sources to create the screen display that the end user sees
on the device.
     </p>
     <p>
      <strong>
       Variant
      </strong>
      : ScreenPlay.
     </p>
     <p>
      In a multi-tasking device many of the activities taking place simultaneously
generate output for display on the screen. Their output can include words,
pictures, video, games and the screen furniture (scroll bars, buttons, icons,
borders, tabs, menus, title bars) familiar to every computer user.
     </p>
     <p>
      Many of these output elements can appear at the same time, either next
to each other or overlapping each other. They can be opaque, such that they
obscure anything behind, or semi-transparent such that the elements underneath
are partially visible.
     </p>
     <p>
      The diagram below illustrates how the display that the viewer sees (looking
down from the top) is a two-dimensional representation composed from a series
of layers.
     </p>
     <div class="fignone" id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-19D41F69-1264-5726-9CDD-C4DD0F231BE3">
      <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-19D41F69-1264-5726-9CDD-C4DD0F231BE3">
       <!-- -->
      </a>
      <span class="figcap">
       Figure 1.            The display is an orthogonal view of a series of layers.
      </span>
      <img src="GUID-7F3F89C0-999A-552E-90BB-17D720C53DE6_d0e189679_href.png" />
     </div>
     <p>
      Composition requires:
     </p>
     <ul>
      <li id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-7C593A87-268F-59E1-B295-9DE2A0DF3092">
       <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-7C593A87-268F-59E1-B295-9DE2A0DF3092">
        <!-- -->
       </a>
       <p>
        Calculations based on
the size, position, visibility, transparency and ordering of the layers to
determine what will be displayed. This is a
        <strong>
         logic
        </strong>
        exercise referred
to as UI Composition.
       </p>
      </li>
      <li id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-B10758D4-8C30-5446-958D-0B81530B69BF">
       <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-B10758D4-8C30-5446-958D-0B81530B69BF">
        <!-- -->
       </a>
       <p>
        Handling of image content,
which is a
        <strong>
         data processing
        </strong>
        exercise referred to as Image Composition.
       </p>
      </li>
     </ul>
     <p>
      For this reason the two are handled separately.
     </p>
     <p>
      <strong>
       UI Composition
      </strong>
     </p>
     <p>
      UI Composition is performed by the Window Server. Each application has
its own window group containing all of its child windows. The Window Server
keeps track of the windows' positions, sizes, visibilities, transparencies
and z-order and is able to establish which windows, and which bits of each
window, are visible. It ensures that each visible bit of window is kept up-to-date
by calling its application when necessary.
     </p>
     <p>
      <strong>
       Image composition
      </strong>
     </p>
     <p>
      Prior to the introduction of ScreenPlay the Window Server did rudimentary
composition in its main thread and rendered composited output to the screen
buffer using the GDI (Graphics Device Interface). To achieve high frame rates,
applications typically bypassed the Window Server using Direct Screen Access
(DSA) and animation DLLs.
     </p>
     <p>
      In
      <a href="GUID-D93978BE-11A3-5CE3-B110-1DEAA5AD566C.html" title="This topic provides an introduction to ScreenPlay and its architecture. ScreenPlay is a new graphics architecture, introduced in Symbian^3 (S^3). ScreenPlay enables device creators to take advantage of improved software performance, hardware acceleration and third party graphics engines. ScreenPlay is sometimes known as the New Graphics Architecture (NGA).">
       ScreenPlay
      </a>
      sources
that generate complex graphical output render directly to graphics surfaces.
The Window Server delegates the composition of surfaces to a composition engine
that device creators can adapt to take advantage of graphics processing hardware.
     </p>
     <p>
      Although the composition engine runs in the Window Server's process, it
is largely transparent to application developers and works quite differently.
Instead of using windows, it uses surfaces to store pixel data and elements
to manipulate size, position, z-order, visibility and transparency.
     </p>
     <p>
      While an element is a simple lightweight object, and easy to manipulate,
a surface stores a large amount of data and its handling requires more consideration.
     </p>
     <p>
      The diagram below is a simplistic representation of how applications create
output which is rendered, composited and displayed.
     </p>
     <div class="fignone" id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-9DF4C86A-C06D-5C5A-9AB6-E9991CC1937A">
      <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-9DF4C86A-C06D-5C5A-9AB6-E9991CC1937A">
       <!-- -->
      </a>
      <span class="figcap">
       Figure 2.            Graphics Composition
      </span>
      <img src="GUID-F31EC49A-FE01-58B2-9CB5-4A3BBCCB7DA7_d0e189743_href.png" />
     </div>
     <p>
      In a device with graphics acceleration hardware (a Graphics Processing
Unit or GPU) there might, in addition to the memory managed by the CPU, be
additional memory managed by the GPU. Image data may therefore be considered
to have been
      <strong>
       software rendered
      </strong>
      (onto a surface in CPU memory) or
      <strong>
       hardware
rendered
      </strong>
      (onto a surface in hardware accelerated GPU memory). The following
diagram shows applications and other graphical data sources rendering to surfaces
in software and hardware.
     </p>
     <div class="fignone" id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-2717F861-0045-5598-A3EC-7CF678BEFA70">
      <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-2717F861-0045-5598-A3EC-7CF678BEFA70">
       <!-- -->
      </a>
      <span class="figcap">
       Figure 3.            Hardware rendered graphics - the wrong way!
      </span>
      <img src="GUID-EADC4EA6-4492-5A00-A29E-6F7747FCAAC9_d0e189760_href.png" />
     </div>
     <p>
      The diagram, however, represents a system with several problem areas that
would render it unsuitable for any practical implementation
     </p>
     <ul>
      <li id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-AF13B0A1-3DC0-576D-81B1-6DF66AA9FA77">
       <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-AF13B0A1-3DC0-576D-81B1-6DF66AA9FA77">
        <!-- -->
       </a>
       <p>
        In practice it is likely
that once data has been rendered to hardware-managed memory it is, to all
intents and purposes, unavailable to software: the CPU is unable to access
it sufficiently quickly. The dotted paths on the diagram above must therefore
be avoided.
       </p>
      </li>
      <li id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-0B109999-94FE-5A5C-B0D0-D3F2157B5CC6">
       <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-0B109999-94FE-5A5C-B0D0-D3F2157B5CC6">
        <!-- -->
       </a>
       <p>
        Furthermore, GDI rendered
data (the UI) is typically 'stored' as redrawing instructions rather than
bitmapped pixel data—so rendering it to bitmaps before composition is likely
to use a lot of memory unnecessarily.
       </p>
      </li>
     </ul>
     <p>
      In ScreenPlay, the UI is therefore composed and rendered onto a single
surface before being composited with any other surfaces. This surface is termed
the
      <strong>
       UI surface
      </strong>
      and is displayed on a layer placed in front of all of
the others. In fact, the UI surface is created for the Window Server during
system start up and is then passed to the composition components as a 'special
case' surface for composition.
     </p>
     <div class="section" id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-6E274D1A-E4CB-4980-B351-B396FEC48DB8">
      <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-6E274D1A-E4CB-4980-B351-B396FEC48DB8">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       Combining Window Server and Composition
      </h2>
      <p>
       The compositing
of surfaces according to their origin means that the physical composition
process behaves differently from the logical composition process that is based
on what the user and the UI are doing. Logically the windows in the UI and
memory rendered surfaces may be on layers that are interleaved yet the memory
rendered surfaces are physically composed behind.
      </p>
      <p>
       ScreenPlay addresses
this issue by associating 'external' surfaces with windows in the Window Server
using the
       <a href="GUID-1460DD8F-9AA1-3B99-8FFD-F309959CCA34.html#GUID-1460DD8F-9AA1-3B99-8FFD-F309959CCA34__GUID-4EBFFA14-418A-3A2A-B147-39BFC96CE45F">
        <span class="apiname">
         RWindowBase::SetBackgroundSurface()
        </span>
       </a>
       method. This
means that the Window Server is able to include them in its logical composition
and make provision for them during data composition. A window with its background
set to a surface in this way becomes transparent in the UI rendered UI surface.
      </p>
      <p>
       In
most cases this is not apparent to the viewer. Surfaces that are physically
composed behind the UI appear in the correct position on the two-dimensional
display. The diagram below illustrates how Window Server-rendered UI content
and external surfaces are composited using the UI surface.
      </p>
      <div class="fignone" id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-3448FD6B-9A39-58CD-8819-39B0B6CC4E13">
       <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-3448FD6B-9A39-58CD-8819-39B0B6CC4E13">
        <!-- -->
       </a>
       <span class="figcap">
        Figure 4.               Hardware composition and the Flattened UI
       </span>
       <img src="GUID-B0797210-4EE3-557B-A5A6-D215D030BA0E_d0e189807_href.png" />
      </div>
      <p>
       Although this method of composition is flexible and powerful, it
does have some limitations, particularly with respect to semi-transparent
hardware-accelerated surfaces.
      </p>
      <p>
       It is not possible, for example, to
include a semi-transparent surface in front of the UI surface. In such cases
the composition engine determines how the display is composed.
      </p>
      <p>
       Here
is a second version of the diagram at the top of the page showing how the
same composition might be achieved in practice. The UI menus, windows and
dialogs are composited by the Window Server onto a single surface. The light
green layer displays a hardware rendered surface so it is actually behind
the layer on which it appears.
      </p>
      <div class="fignone" id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-1FB1194D-FCAE-534C-94DC-AF4CF00E3A1C">
       <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-1FB1194D-FCAE-534C-94DC-AF4CF00E3A1C">
        <!-- -->
       </a>
       <span class="figcap">
        Figure 5.               The UI surface
       </span>
       <img src="GUID-79009102-0490-5C61-9722-C5EE49A1AF2B_d0e189824_href.png" />
      </div>
     </div>
     <div class="section" id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-41E9CA54-759F-5651-95F8-9F39808BE740">
      <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-41E9CA54-759F-5651-95F8-9F39808BE740">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       Composition
Examples
      </h2>
      <p>
       This illustrations below illustrate the use of hardware
accelerated surfaces and the UI surface
      </p>
      <div class="fignone" id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-8178DBA8-E10C-56F3-A828-80746CE6A993">
       <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-8178DBA8-E10C-56F3-A828-80746CE6A993">
        <!-- -->
       </a>
       <span class="figcap">
        Figure 6.               Video rendered to a hardware accelerated surface mapped
to a layer              behind the UI surface
       </span>
       <img src="GUID-FE3C8D39-CE17-5AC7-AB6A-4D6664D52196_d0e189840_href.png" />
      </div>
      <div class="fignone" id="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-51411B10-6DC3-5B74-BCEF-11EC1D0FBCA8">
       <a name="GUID-859CAA08-59C9-5FD3-98DE-6BDD0D6ED50B__GUID-51411B10-6DC3-5B74-BCEF-11EC1D0FBCA8">
        <!-- -->
       </a>
       <span class="figcap">
        Figure 7.               As above with a semi-transparent dialog on the UI surface
       </span>
       <img src="GUID-4616CCC9-7BD3-5D91-873A-6027167329ED_d0e189848_href.png" />
      </div>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-99BC101A-9466-59EE-B5C9-7622BAF6E6FF.html" title="This section provides overview material about some important graphics topics, including introductions to ScreenPlay and the graphics architecture when ScreenPlay is not enabled.">
        Graphics Concepts
       </a>
      </div>
     </div>
     <div class="relinfo relconcepts">
      <strong>
       Related concepts
      </strong>
      <br />
      <div>
       <a href="GUID-D93978BE-11A3-5CE3-B110-1DEAA5AD566C.html" title="This topic provides an introduction to ScreenPlay and its architecture. ScreenPlay is a new graphics architecture, introduced in Symbian^3 (S^3). ScreenPlay enables device creators to take advantage of improved software performance, hardware acceleration and third party graphics engines. ScreenPlay is sometimes known as the New Graphics Architecture (NGA).">
        The ScreenPlay
Architecture
       </a>
      </div>
      <div>
       <a href="GUID-EF62BF88-3687-505D-8BD7-EEDF36246E56.html" title="This topic describes some of the issues surrounding the use of graphics hardware to improve graphics performance. It also provides a summary of the components that device creators need to adapt to take advantage of graphics hardware.">
        Hardware
Acceleration
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>