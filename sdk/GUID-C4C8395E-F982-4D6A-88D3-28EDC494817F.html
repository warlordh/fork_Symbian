<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="task" />
  <meta name="DC.Title" content="Requesting RAM Asynchronously" />
  <meta name="abstract" content="This section describes how an application can request for free RAM asynchronously." />
  <meta name="description" content="This section describes how an application can request for free RAM asynchronously." />
  <meta name="DC.Relation" scheme="URI" content="GUID-50CA5439-29A1-426C-83BA-EC048FE86CDE.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-58035B49-2EAE-5144-B226-28AF2EDD62E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-C3919681-BB41-4CFA-812F-2D7989E952DC.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-F746C61E-BE8A-4F3B-B8F7-92964B36B298.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-C7AA92A9-9595-439A-A3E7-769E36D61FEE.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-50CA5439-29A1-426C-83BA-EC048FE86CDE.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-CE308C71-D8B2-43B3-97FD-B868285ED5FB.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-39A8FBC9-5FD6-4F92-B71E-5C5438ECFD46.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-88752800-83BD-4845-80A0-6B65D8D81924.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Requesting RAM Asynchronously
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F">
  <a name="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2839152 id2682719 id2682707 id2682647 id2682548 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-58035B49-2EAE-5144-B226-28AF2EDD62E7.html">
      Generic Application Support Guide
     </a>
     &gt;
     <a href="GUID-C3919681-BB41-4CFA-812F-2D7989E952DC.html" title="System Resource Monitoring collection contains Out Of Disk (OOD) Monitor component to monitor changes in the disk space levels and Out Of Memory (OOM) Monitor component to handle low RAM situations.">
      System Resource Monitoring
     </a>
     &gt;
     <a href="GUID-F746C61E-BE8A-4F3B-B8F7-92964B36B298.html" title="Out Of Memory (OOM) Monitor component monitors and handles out of memory situations. This component enables applications to improve their performance when the amount of free RAM in the phone is low.">
      Out Of Memory (OOM) Monitor
     </a>
     &gt;
     <a href="GUID-C7AA92A9-9595-439A-A3E7-769E36D61FEE.html" title="This section lists the OOM Monitor tutorials.">
      Using OOM Monitor
     </a>
     &gt;
     <a href="GUID-50CA5439-29A1-426C-83BA-EC048FE86CDE.html" title="This section describes how an application can request for free memory from OOM Monitor for large amount of RAM allocation.">
      Allowing Large Memory Allocation
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Requesting
RAM Asynchronously
    </h1>
    <div>
     <p>
      This section describes how an application can request for free
RAM asynchronously.
     </p>
     <div class="p" id="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-6C258B11-CE78-42F2-828D-E9C68598C193">
      <a name="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-6C258B11-CE78-42F2-828D-E9C68598C193">
       <!-- -->
      </a>
      <p>
       Perform the steps
described in
       <a href="GUID-50CA5439-29A1-426C-83BA-EC048FE86CDE.html" title="This section describes how an application can request for free memory from OOM Monitor for large amount of RAM allocation.">
        Allowing
Large Memory Allocation
       </a>
       .
      </p>
     </div>
     <div class="section" id="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-D36C0590-A436-458B-B7A6-F2E8577E26C6">
      <a name="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-D36C0590-A436-458B-B7A6-F2E8577E26C6">
       <!-- -->
      </a>
      <p>
       Requesting
free RAM asynchronously is recommended as the application is not blocked during
the method call handling.
      </p>
     </div>
     <a name="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-4DD07DEC-6017-4237-BE46-1D69E5FBD744-GENID-1-10-1-12-1-1-8-1-5-1-6-1-6-1-5-1-3-3">
      <!-- -->
     </a>
     <ol id="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-4DD07DEC-6017-4237-BE46-1D69E5FBD744-GENID-1-10-1-12-1-1-8-1-5-1-6-1-6-1-5-1-3-3">
      <li class="stepexpand" id="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-9A69E5AD-E938-4092-A8C2-CB65C37C8962-GENID-1-10-1-12-1-1-8-1-5-1-6-1-6-1-5-1-3-3-1">
       <a name="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-9A69E5AD-E938-4092-A8C2-CB65C37C8962-GENID-1-10-1-12-1-1-8-1-5-1-6-1-6-1-5-1-3-3-1">
        <!-- -->
       </a>
       <span>
        Start an asynchronous
request for a block of memory.
       </span>
       <pre class="codeblock">
        CMemoryAllocatingObject::StartFunctionalityRequiringAllocationL()
    {
    User::LeaveIfError(iOomMonitorSession.Connect());
    iMemoryRequester = CMemoryRequester::NewL(iOomMonitorSession, *this);
    iMemoryRequester-&gt;Start(KLargeValueToAllocate);
    }
       </pre>
      </li>
      <li class="stepexpand" id="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-9A69E5AD-E938-4092-A8C2-CB65C37C8962-GENID-1-10-1-12-1-1-8-1-5-1-6-1-6-1-5-1-3-3-2">
       <a name="GUID-C4C8395E-F982-4D6A-88D3-28EDC494817F__GUID-9A69E5AD-E938-4092-A8C2-CB65C37C8962-GENID-1-10-1-12-1-1-8-1-5-1-6-1-6-1-5-1-3-3-2">
        <!-- -->
       </a>
       <span>
        Implement the active
object and request for free memory.
       </span>
       <pre class="codeblock">
        void CMemoryRequester::Start(TInt aBytesRequested)
    {
    iOomMonitorSession.RequestFreeMemory(aBytesRequested, iStatus);    
    SetActive();
    }
       </pre>
      </li>
     </ol>
     <div class="example">
      <p>
       The following code snippet illustrates an asynchronous request
for free RAM allocation:
      </p>
      <pre class="codeblock">
       const TInt KLargeValueToAllocate = 2097152; //2MB

// Start an asynchronous request for block of memory
CMemoryAllocatingObject::StartFunctionalityRequiringAllocationL()
    {
    User::LeaveIfError(iOomMonitorSession.Connect());
    iMemoryRequester = CMemoryRequester::NewL(iOomMonitorSession, *this);
    iMemoryRequester-&gt;Start(KLargeValueToAllocate);
    }

// Called when the asynchronous request is completed
CMemoryAllocatingObject::MemoryRequestCompleteL(TInt aResult)
    {
    if (aResult == KErrNone)
        {
        DoFunctionRequiring_KLargeValueToAllocate_BytesL();
        }
    iOomMonitorSession.Close();
    }
The active object implementation is the following:

// Start an asynchronous request for block of memory
void CMemoryRequester::Start(TInt aBytesRequested)
    {
    iOomMonitorSession.RequestFreeMemory(aBytesRequested, iStatus);    
    SetActive();
    }
    

// Called when the asynchronous request is completed
void CMemoryRequester::RunL()
    {
    iObserver.MemoryRequestCompleteL(iStatus.Int());
    }
      </pre>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-50CA5439-29A1-426C-83BA-EC048FE86CDE.html" title="This section describes how an application can request for free memory from OOM Monitor for large amount of RAM allocation.">
        Allowing Large Memory Allocation
       </a>
      </div>
     </div>
     <div class="relinfo relconcepts">
      <strong>
       Related concepts
      </strong>
      <br />
      <div>
       <a href="GUID-CE308C71-D8B2-43B3-97FD-B868285ED5FB.html" title="This section explains the OOM Monitor priority and the values that can be set.">
        OOM Monitor
Priority
       </a>
      </div>
      <div>
       <a href="GUID-39A8FBC9-5FD6-4F92-B71E-5C5438ECFD46.html" title="This section provides an overview of the functionality and the architecture of the OOM Monitor component.">
        OOM Monitor
Overview
       </a>
      </div>
      <div>
       <a href="GUID-88752800-83BD-4845-80A0-6B65D8D81924.html" title="This section explains how to set priorities in the configuration file and about out of memory error.">
        OOM Monitor
Reference
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>