<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="concept" />
  <meta name="DC.Title" content="Standard C++ Support on the Symbian Platform" />
  <meta name="DC.Relation" scheme="URI" content="GUID-2C5B58F2-6BD2-5C2B-8E1B-CFB3D7EB6ED9.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-E2DE2C6F-E071-5E88-96F1-D71DDED84609.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-2C5B58F2-6BD2-5C2B-8E1B-CFB3D7EB6ED9.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-D6BEAF0D-844D-51F4-8DB7-FB1D60E17FE3.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-F7FEB759-E64D-5B6D-9017-C5E982E4FC16.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-CDE8CD85-8467-5B36-A0AC-41D1D98151CA.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-E331B72B-84AF-558A-9B8F-73E5E50B58C7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-5B3F5296-D6D0-5D25-8362-141DF5927E52.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-D32E52C9-F05C-5F1E-8B49-243D555C353C.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Standard C++ Support on the Symbian Platform
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2">
  <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2682564 id2682464 id2681976 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-5072BE46-B1B4-5C3A-BF55-BEA7443E7657.html">
      Generic OS Services Guide
     </a>
     &gt;
     <a href="GUID-E2DE2C6F-E071-5E88-96F1-D71DDED84609.html">
      Generic Open Libraries
     </a>
     &gt;
     <a href="GUID-2C5B58F2-6BD2-5C2B-8E1B-CFB3D7EB6ED9.html">
      Standard C++ Library (STLport v5)
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Standard
C++ Support on the Symbian Platform
    </h1>
    <div>
     <p>
      This topic describes the Standard C++ runtime features supported on Symbian^3.
     </p>
     <ul>
      <li id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-F620B47D-35A9-54DF-89FC-031C3B3A50D4">
       <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-F620B47D-35A9-54DF-89FC-031C3B3A50D4">
        <!-- -->
       </a>
       <p>
        <a href="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2.html#GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-B44FDC08-487F-589B-8355-CF6EAB3F25BC">
         Global operator new
        </a>
       </p>
      </li>
      <li id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-2BF296E4-1204-599D-889B-46CD0FEFCC52">
       <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-2BF296E4-1204-599D-889B-46CD0FEFCC52">
        <!-- -->
       </a>
       <p>
        <a href="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2.html#GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-ED64EEBA-A52D-5008-8F5F-11019BC5B1E2">
         new_handler
        </a>
       </p>
      </li>
      <li id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-E53A2527-BF8A-5578-AF29-B4E1862E958E">
       <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-E53A2527-BF8A-5578-AF29-B4E1862E958E">
        <!-- -->
       </a>
       <p>
        <a href="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2.html#GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-FEC1BFE6-0219-5EE8-93D1-C0D5BCFA8A26">
         Global object destruction
        </a>
       </p>
      </li>
      <li id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-303ADDE1-83D6-5449-B508-6C6DBD7DDFC9">
       <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-303ADDE1-83D6-5449-B508-6C6DBD7DDFC9">
        <!-- -->
       </a>
       <p>
        <a href="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2.html#GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-1D9D2701-FD3E-57D1-952B-FB8C057FE055">
         STL
        </a>
       </p>
      </li>
     </ul>
     <div class="section" id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-B44FDC08-487F-589B-8355-CF6EAB3F25BC">
      <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-B44FDC08-487F-589B-8355-CF6EAB3F25BC">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       Global operator
new
      </h2>
      <p>
       In Standard C++, when dynamic memory allocation (using
       <samp class="codeph">
        operator
          new
       </samp>
       ) fails and if a handler is not set to handle it, the
code throws an exception (
       <samp class="codeph">
        std::bad_alloc
       </samp>
       ). But in Symbian
C++, when dynamic memory allocation fails, the code returns
       <strong>
        NULL
       </strong>
       .
      </p>
      <p>
       When
you write Standard C++ code on Symbian C++ ensure that you either use Symbian
C++ semantics of operator new or Standard C++ semantics of operator new in
your code. You can use the global
       <samp class="codeph">
        operator new
       </samp>
       as per the
Standard C++ specification on the Symbian platform by either:
      </p>
      <ul>
       <li id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-3E72A8F5-F68B-5454-8F20-67CC53FDC37F">
        <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-3E72A8F5-F68B-5454-8F20-67CC53FDC37F">
         <!-- -->
        </a>
        <p>
         Building your application
or library using the STD target type.
        </p>
       </li>
       <li id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-40D77F25-4EE4-578A-B51E-451F7655CBA6">
        <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-40D77F25-4EE4-578A-B51E-451F7655CBA6">
         <!-- -->
        </a>
        <p>
         Using the
         <samp class="codeph">
          MMP
         </samp>
         keyword,
         <samp class="codeph">
          STDCPP
         </samp>
         .
        </p>
       </li>
      </ul>
      <p>
       <strong>
        Note:
       </strong>
       For detailed information about problems that can occur
while using the global
       <samp class="codeph">
        operator new
       </samp>
       , see
       <a href="GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46.html#GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46__GUID-39350E32-26C2-5440-B221-10EE693CCF18">
        Use of operator new
       </a>
       .
      </p>
      <p>
       <strong>
        Warning:
       </strong>
       The Symbian build system
does not permit you to mix the Standard C++
       <samp class="codeph">
        operator new
       </samp>
       and
the Symbian C++
       <samp class="codeph">
        operator new
       </samp>
       .
      </p>
      <p>
       <strong>
        Example
       </strong>
      </p>
      <p>
       The
following example code illustrates how to use the global
       <samp class="codeph">
        operator
new
       </samp>
       when you write Standard C++ code on the Symbian platform and
your target type is a non-STD target type, for example,
       <samp class="codeph">
        exe
       </samp>
       .
      </p>
      <p>
       You
must add the
       <samp class="codeph">
        MMP
       </samp>
       keyword,
       <samp class="codeph">
        STDCPP
       </samp>
       in the
       <span class="filepath">
        .mmp
       </span>
       file
as shown in the following code:
      </p>
      <pre class="codeblock" id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-400432AB-79A2-5F17-9F96-22209524BC84">
       <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-400432AB-79A2-5F17-9F96-22209524BC84">
        <!-- -->
       </a>
       //operator_new_example.mmp
Target             operator_new_example.exe
Targettype        exe
//The STDCPP keyword specifies Standard C++ 
STDCPP
Source            operator_new.cpp
Systeminclude        /epoc32/include/stdapis/stlportv5
Systeminclude        /epoc32/include/stdapis
Library            libstdcppv5.lib libc.lib
Capability        all -tcb
      </pre>
      <pre class="codeblock" id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-D3F3E4C0-D08A-5498-89A8-87A70CC02FD3">
       <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-D3F3E4C0-D08A-5498-89A8-87A70CC02FD3">
        <!-- -->
       </a>
       //operator_new.cpp
#include &lt;new&gt;
int main()
    {
    try
        {
        int *ptr = new int(0);
        //do something
        }
    catch(std::bad_alloc)
        {
        return 1;
        }
    delete ptr;
    return 0;
    }
      </pre>
     </div>
     <div class="section" id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-ED64EEBA-A52D-5008-8F5F-11019BC5B1E2">
      <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-ED64EEBA-A52D-5008-8F5F-11019BC5B1E2">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       new_handler
      </h2>
      <p>
       The
       <samp class="codeph">
        new_handler()
       </samp>
       function
of Standard C++ is fully supported on the Symbian platform (the global
       <samp class="codeph">
        operator
new
       </samp>
       restrictions are applicable). You can use the new_handler function
to handle an out of memory scenario caused by the global
       <samp class="codeph">
        operator
new
       </samp>
       when dynamic memory allocation fails.
      </p>
      <p>
       The following code
illustrates how to set and invoke a
       <samp class="codeph">
        new_handler
       </samp>
       :
      </p>
      <pre class="codeblock" id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-E1CD4479-99AF-5547-B350-00699CD2788D">
       <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-E1CD4479-99AF-5547-B350-00699CD2788D">
        <!-- -->
       </a>
       #include &lt;new&gt;
int one_huge_chunk = 0xa000;
int *last_huge_chunk=NULL;
void foo()
    {
    /*
    * This is the new_handler and it frees the last successful allocation so
    * that the subsequent call to operator new has some free memory.
    */
    delete [] last_huge_chunk;
    }
void bar()
    {
    last_huge_chunk    = new int[one_huge_chunk];
    }
int main()
    {
    std::new_handler h_new;
    try
        {
        while(1)
            {
            // Keep allocating until we reach OOM (out of memory) condition. At OOM
            // the default new handler throws std::bad_alloc
            bar();
            }
        }
    catch(std::bad_alloc ba)
    {
    /*
    * Once the handler is set, failure of 'new' will call the handler to
    * get some free memory... 
    */
    h_new = (std::new_handler)&amp;foo;
    try
        {
        /*
        * Try once more to see if our handler actually freed up some memory
        */
        bar();
        }
    catch(...)
        {
        }
    return 0;
    } 
    /*Failed to throw std::bad_alloc*/
    return 1;
    }
      </pre>
      <p>
       <strong>
        Important Note:
       </strong>
       The
       <samp class="codeph">
        targettype
       </samp>
       of
this executable must either be
       <samp class="codeph">
        STDEXE
       </samp>
       /
       <samp class="codeph">
        STDDLL
       </samp>
       or
its
       <span class="filepath">
        .mmp
       </span>
       file must use the
       <samp class="codeph">
        STDCPP
       </samp>
       keyword.
      </p>
     </div>
     <div class="section" id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-FEC1BFE6-0219-5EE8-93D1-C0D5BCFA8A26">
      <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-FEC1BFE6-0219-5EE8-93D1-C0D5BCFA8A26">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       Global object
destructors
      </h2>
      <p>
       Global objects are supported both in a statically or
dynamically loaded Standard C++ DLL. Their constructors are invoked when the
DLL is loaded and their destructors are invoked when the reference count of
the DLL falls to zero.
      </p>
      <p>
       <strong>
        Example
       </strong>
      </p>
      <p>
       The following example
illustrates the construction and destruction of a global object:
      </p>
      <pre class="codeblock" id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-75012329-3172-5B99-833B-24C2FB658FFF">
       <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-75012329-3172-5B99-833B-24C2FB658FFF">
        <!-- -->
       </a>
       // glob_data.cpp
#include &lt;iostream&gt;
// class definition
class AClass
    {
    AClass()
        {
        std::cout &lt;&lt; “ctor()” &lt;&lt; std::endl; // inline constructor
        }
    ~AClass()
        {
        std::cout &lt;&lt; “dtor()” &lt;&lt;std::endl; // inline destructor
        }
    };
AClass GlobData; // global instance of AClass
int main()
    {
    std::cout &lt;&lt; “main()” &lt;&lt; std::endl;
    }
      </pre>
      <p>
       The output of this example must be:
      </p>
      <pre class="codeblock" id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-0AB81D7E-B310-5CEA-86DD-65E697F4D2C2">
       <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-0AB81D7E-B310-5CEA-86DD-65E697F4D2C2">
        <!-- -->
       </a>
       ctor
main
dtor
      </pre>
     </div>
     <div class="section" id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-1D9D2701-FD3E-57D1-952B-FB8C057FE055">
      <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-1D9D2701-FD3E-57D1-952B-FB8C057FE055">
       <!-- -->
      </a>
      <h2 class="sectiontitle">
       STL
      </h2>
      <p>
       Here
are some key facts about STL support on the Symbian platform:
      </p>
      <ul>
       <li id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-F0FCA9CA-7417-5D07-A6AA-F679B3A3A41A">
        <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-F0FCA9CA-7417-5D07-A6AA-F679B3A3A41A">
         <!-- -->
        </a>
        <p>
         The Standard C++ implementation
on the Symbian platform is based on STLPort version 5.1.4.
        </p>
       </li>
       <li id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-FB97F095-533F-582D-BD28-667D1BD6863A">
        <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-FB97F095-533F-582D-BD28-667D1BD6863A">
         <!-- -->
        </a>
        <p>
         The Standard C++ header
files are available in the
         <span class="filepath">
          ${EPOCROOT}/epoc32/include/stdapis/stlportv5
         </span>
         directory.
        </p>
       </li>
       <li id="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-F6381C75-4C30-5627-8AAA-7D8F1FF53565">
        <a name="GUID-2CCD1748-9EDE-5383-9941-A3051E06F3E2__GUID-F6381C75-4C30-5627-8AAA-7D8F1FF53565">
         <!-- -->
        </a>
        <p>
         The Standard C++ library
name that you must use is
         <span class="filepath">
          libstdcppv5.lib
         </span>
         . The value
5 (in the library name) being based on the STL Port version number, which
is 5.
        </p>
       </li>
      </ul>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-2C5B58F2-6BD2-5C2B-8E1B-CFB3D7EB6ED9.html">
        Standard C++ Library (STLport v5)
       </a>
      </div>
     </div>
     <div class="relinfo relconcepts">
      <strong>
       Related concepts
      </strong>
      <br />
      <div>
       <a href="GUID-D6BEAF0D-844D-51F4-8DB7-FB1D60E17FE3.html">
        Copyright
Acknowledgments for Standard C++ (STLport)
       </a>
      </div>
      <div>
       <a href="GUID-F7FEB759-E64D-5B6D-9017-C5E982E4FC16.html">
        Standard
C++ Library Overview
       </a>
      </div>
      <div>
       <a href="GUID-CDE8CD85-8467-5B36-A0AC-41D1D98151CA.html">
        Developing
Applications or Libraries                 Using Standard C++
       </a>
      </div>
      <div>
       <a href="GUID-E331B72B-84AF-558A-9B8F-73E5E50B58C7.html">
        Building
a Standard C++ Application or Library
       </a>
      </div>
      <div>
       <a href="GUID-AF2CE612-F12E-5A18-81A5-C303992D2D46.html">
        Possible
Problems
       </a>
      </div>
      <div>
       <a href="GUID-5B3F5296-D6D0-5D25-8362-141DF5927E52.html">
        Troubleshooting
       </a>
      </div>
      <div>
       <a href="GUID-D32E52C9-F05C-5F1E-8B49-243D555C353C.html">
        Known Issues
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>