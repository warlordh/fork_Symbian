<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="task" />
  <meta name="DC.Title" content="Creating attachments to messages" />
  <meta name="abstract" content="The messaging framework allows you to create attachments to be added to messages." />
  <meta name="description" content="The messaging framework allows you to create attachments to be added to messages." />
  <meta name="DC.Relation" scheme="URI" content="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-B394A824-8745-505E-8429-8B9B6D418387.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-DD27A452-8B0F-5C6D-A2E6-FC21145468B6.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-1963A487-D6A7-4225-8D0C-EC5FAB746854.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-54AB166A-8B24-5065-92AD-5FC1BF3ED89C.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Creating attachments to messages
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E">
  <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2403699 id2403748 id2403786 id2403998 id2404047 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html">
      Messaging Middleware Guide
     </a>
     &gt;
     <a href="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html">
      Messaging Framework
     </a>
     &gt;
     <a href="GUID-B394A824-8745-505E-8429-8B9B6D418387.html">
      Message Server and Store
     </a>
     &gt;
     <a href="GUID-DD27A452-8B0F-5C6D-A2E6-FC21145468B6.html">
      Message Server and Store Tutorials
     </a>
     &gt;
     <a href="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html" title="The MMsvAttachmentManager interface is used to create, add, modify and remove message attachments.">
      Messaging Attachments Tutorial
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Creating
attachments to messages
    </h1>
    <div>
     <p>
      The messaging framework allows you to create attachments to be
added to messages.
     </p>
     <div class="section" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-AD25E60B-49ED-57AB-B727-6A6CB5EBE730">
      <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-AD25E60B-49ED-57AB-B727-6A6CB5EBE730">
       <!-- -->
      </a>
      <p>
       Attachments to
messages are created as empty files before they are filled and added to a
message.
      </p>
     </div>
     <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-C3909B48-18F8-5CCE-8661-EEBB64DDCF28">
      <!-- -->
     </a>
     <ol id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-C3909B48-18F8-5CCE-8661-EEBB64DDCF28">
      <li class="stepexpand" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-0257AD84-72B4-5C9F-B7B2-D0092F847AB7">
       <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-0257AD84-72B4-5C9F-B7B2-D0092F847AB7">
        <!-- -->
       </a>
       <span>
        <br />
        Create an active object implementation. All the
        <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html">
         <span class="apiname">
          MMsvAttachmentManager
         </span>
        </a>
        functions
that modify attachments for an entry are asynchronous, so a request must be
called with an active object implementation.
       </span>
       <pre class="codeblock" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-4667A5C6-7A2C-539B-9D86-8807032D0294">
        <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-4667A5C6-7A2C-539B-9D86-8807032D0294">
         <!-- -->
        </a>
        void CFoo::CreateAttachmentL(CMsvEntry&amp; aEntry )
    {
    _LIT(KFileName, "textfile.txt");
...
    // Wait for request to complete
    User::WaitForRequest(status);

    // Write to the file at the current offset within the file. 
    User::LeaveIfError(file.Write(_L8("text file as attachment")));

    
    CleanupStack::PopAndDestroy(&amp;file);
    CleanupStack::PopAndDestroy(store);
    }
       </pre>
      </li>
      <li class="stepexpand" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-9F363DA2-9281-595A-B115-FD63DDD05D10">
       <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-9F363DA2-9281-595A-B115-FD63DDD05D10">
        <!-- -->
       </a>
       <span>
        Get the details
of the message to which you want to add an attachment using
        <a href="GUID-85BBE389-81F7-3E2F-A789-446D9BE2CC49.html#GUID-85BBE389-81F7-3E2F-A789-446D9BE2CC49__GUID-1864B96D-CB22-3EE1-8E73-023F12C68CB0">
         <span class="apiname">
          CMsvEntry::EditStoreL()
         </span>
        </a>
        .
       </span>
       <pre class="codeblock" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-223B5F86-1D47-5F9A-97A4-45B6B28B277A">
        <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-223B5F86-1D47-5F9A-97A4-45B6B28B277A">
         <!-- -->
        </a>
        CMsvStore* store = aEntry.EditStoreL();
    CleanupStack::PushL(store);
       </pre>
       This function returns
       <a href="GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE.html">
        <span class="apiname">
         CMsvStore
        </span>
       </a>
       in writable mode.
      </li>
      <li class="stepexpand" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-880AB139-CD3E-5283-A67B-0901482BC7B3">
       <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-880AB139-CD3E-5283-A67B-0901482BC7B3">
        <!-- -->
       </a>
       <span>
        Get an
        <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html">
         <span class="apiname">
          MMsvAttachmentManager
         </span>
        </a>
        attachment
manager for the message entry, using
        <a href="GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE.html#GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE__GUID-73CE27F3-855B-3F87-AE11-4B4F2B8F8825">
         <span class="apiname">
          CMsvStore::AttachmentManagerL()
         </span>
        </a>
        .
       </span>
       <pre class="codeblock" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-5719D172-1127-557A-AE3D-C138EFEFAF67">
        <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-5719D172-1127-557A-AE3D-C138EFEFAF67">
         <!-- -->
        </a>
        MMsvAttachmentManager&amp; attManager = store-&gt;AttachmentManagerL();
       </pre>
      </li>
      <li class="stepexpand" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-3D26FDBB-2E55-52BA-AB2A-98AB4B72A2B7">
       <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-3D26FDBB-2E55-52BA-AB2A-98AB4B72A2B7">
        <!-- -->
       </a>
       <span>
        <br />
        Create a new attachment attributes object using the
        <a href="GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F.html#GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F__GUID-CB0C9E14-A0D3-340A-929D-8B2C3BC11300">
         <span class="apiname">
          CMsvAttachment::NewL()
         </span>
        </a>
        function.
       </span>
       <pre class="codeblock" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-D0C29614-2C96-59C0-8B33-3161764637EA">
        <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-D0C29614-2C96-59C0-8B33-3161764637EA">
         <!-- -->
        </a>
        // create a new attachment attributes object
    CMsvAttachment* attachment = CMsvAttachment::NewL(CMsvAttachment::EMsvFile);
    CleanupStack::PushL(attachment);
    
    // set attachment file name
    attachment-&gt;SetAttachmentNameL(KFileName());
       </pre>
      </li>
      <li class="stepexpand" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-0171595B-14E9-5F29-A0A0-ED7C7B2F05F6">
       <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-0171595B-14E9-5F29-A0A0-ED7C7B2F05F6">
        <!-- -->
       </a>
       <span>
        <br />
        Initialise a file handle.
       </span>
       <pre class="codeblock" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-678974F9-CF55-5D2C-A870-06FD0466B29C">
        <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-678974F9-CF55-5D2C-A870-06FD0466B29C">
         <!-- -->
        </a>
        // A file handle
    RFile file;
    CleanupClosePushL(file);
    TRequestStatus status;
       </pre>
      </li>
      <li class="stepexpand" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-1136ACD3-307E-5C19-80BD-80AF901F8F7C">
       <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-1136ACD3-307E-5C19-80BD-80AF901F8F7C">
        <!-- -->
       </a>
       <span>
        <br />
        Create a new attachment using the
        <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD__GUID-DA2E53AD-EC8F-38F9-8D5C-03AC356E7B64">
         <span class="apiname">
          MMsvAttachmentManager::CreateAttachmentL()
         </span>
        </a>
        function. 
 The
        CreateAttachmentL()
        function creates a new empty
attachment file and returns an open writable file handle to the empty attachment
file in the Message Store. You must pass an uninitialised file handle. The
file handle cannot be used until the asynchronous request completes successfully.
If the request is successful, the file handle is opened for writing.
       </span>
       <pre class="codeblock" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-448F438F-AD34-5A31-A79D-ED6DE2004E0A">
        <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-448F438F-AD34-5A31-A79D-ED6DE2004E0A">
         <!-- -->
        </a>
        // CreateAttachmentL API will return an open writable file handle 
    // to an empty attachment file in the message store. 
    attManager.CreateAttachmentL(KFileName, file, attachment, status);
       </pre>
      </li>
      <li class="stepexpand" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-3C167920-96C7-5081-AE58-8A65E68931A9">
       <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-3C167920-96C7-5081-AE58-8A65E68931A9">
        <!-- -->
       </a>
       <span>
        <br />
        Commit the store.
       </span>
       <pre class="codeblock" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-DEAA9B94-C265-5536-A984-E07B5EC60DD7">
        <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-DEAA9B94-C265-5536-A984-E07B5EC60DD7">
         <!-- -->
        </a>
        // Commit the store
    store-&gt;CommitL();
       </pre>
      </li>
     </ol>
     <div class="section" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-F5F40B70-71ED-5150-A5A8-602FB2134C87">
      <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-F5F40B70-71ED-5150-A5A8-602FB2134C87">
       <!-- -->
      </a>
      <p>
       The result of creating
an attachment is an empty file with a handle opened for writing.
      </p>
     </div>
     <div class="section" id="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-52A82DB6-ECA7-5910-A0E7-FC5726F280CE">
      <a name="GUID-91ED5F9C-216D-539D-B4D0-E6F2E087773E__GUID-52A82DB6-ECA7-5910-A0E7-FC5726F280CE">
       <!-- -->
      </a>
      <p>
       You can now add
the attachment to a file and retrieve and modify it.
      </p>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html" title="The MMsvAttachmentManager interface is used to create, add, modify and remove message attachments.">
        Messaging Attachments Tutorial
       </a>
      </div>
     </div>
     <div class="relinfo relconcepts">
      <strong>
       Related concepts
      </strong>
      <br />
      <div>
       <a href="GUID-54AB166A-8B24-5065-92AD-5FC1BF3ED89C.html">
        Messaging
Framework Overview
       </a>
      </div>
     </div>
     <div class="relinfo">
      <strong>
       Related information
      </strong>
      <br />
      <div>
       Attachment
Tutorial
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>