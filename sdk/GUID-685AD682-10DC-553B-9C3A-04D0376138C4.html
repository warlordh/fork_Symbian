<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="copyright" content="(C) Copyright 2010" />
  <meta name="DC.rights.owner" content="(C) Copyright 2010" />
  <meta name="DC.Type" content="concept" />
  <meta name="DC.Title" content="Adding a device to the PAN" />
  <meta name="DC.Relation" scheme="URI" content="GUID-308A481C-2280-59CE-AE85-83047B11BBE4.html" />
  <meta name="DC.Relation" scheme="URI" content="index.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-DD13AA8E-BDAD-57EC-81EC-49C8D6D30A86.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-ACB3786B-38EB-58F4-87B6-6A46A390B154.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-0F3E543D-CFEE-5CD8-8BAB-19B3A993388F.html" />
  <meta name="DC.Relation" scheme="URI" content="GUID-308A481C-2280-59CE-AE85-83047B11BBE4.html" />
  <meta name="DC.Format" content="XHTML" />
  <meta name="DC.Identifier" content="GUID-685AD682-10DC-553B-9C3A-04D0376138C4" />
  <meta name="DC.Language" content="en" />
  <link rel="stylesheet" type="text/css" href="commonltr.css" />
  <title>
   Adding a device to the PAN
  </title>
  <link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->
  <link rel="stylesheet" type="text/css" href="nokiacxxref.css" />
 </head>
 <body id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4">
  <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4">
   <!-- -->
  </a>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
  <div id="sdl_container">
   <div id="leftMenu">
    <div id="expandcontractdiv">
     <a id="collapseTree" href="javascript:tree.collapseAll()">
      Collapse all
     </a>
     <a id="index" href="index.html">
      Symbian^3 Application Developer Library
     </a>
    </div>
    <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">
     &#160;
    </div>
    <script type="text/javascript">
     var currentIconMode = 0; window.name="id2470542 id2399699 id2399839 id2399854 id2399868 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
   </div>
   <div id="sdl_content">
<div class="breadcrumb">
     <a href="index.html" title="Symbian^3 Application Developer Library">
      Symbian^3 Application Developer Library
     </a>
     &gt;
     <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">
      Symbian Guide
     </a>
     &gt;
     <a href="GUID-DD13AA8E-BDAD-57EC-81EC-49C8D6D30A86.html" title="The Short Link Services module enables licensees to implement Bluetooth, USB, Infrared and OBEX on Symbian platform devices.">
      Short Link Services Guide
     </a>
     &gt;
     <a href="GUID-ACB3786B-38EB-58F4-87B6-6A46A390B154.html" title="The Bluetooth Comms Profiles collection provides implementations of Bluetooth Profiles. Currently it provides an implementation of the Bluetooth PAN profile.">
      Bluetooth Comms Profiles Collection
     </a>
     &gt;
     <a href="GUID-0F3E543D-CFEE-5CD8-8BAB-19B3A993388F.html">
      PAN Profile
     </a>
     &gt;
     <a href="GUID-308A481C-2280-59CE-AE85-83047B11BBE4.html">
      Bluetooth PAN Profile Tutorial
     </a>
     &gt;
    </div>
    <h1 class="topictitle1">
     Adding a device to the PAN
    </h1>
    <div>
     <p>
      In the last tutorial we looked at the steps involved in creating a Personal Area Network. Now we will look at adding devices to that PAN.
     </p>
     <p>
      <strong>
       Using the Tutorial
      </strong>
     </p>
     <p>
      The code fragments in this tutorial are derived from the Bluetooth Example application available in
      <span class="filepath">
       /src/COMMON/DEVELOPERLIBRARY/examples/Bluetooth/BTExample1
      </span>
      . Although the code has been reformatted to the requirements of the tutorial there is always enough information included with the code to find the actual example code.
     </p>
     <p>
      <strong>
       Intended Audience:
      </strong>
     </p>
     <p>
      This tutorial is designed for Symbian licensees only. Several APIs mentioned ad used throughout this tutorial series are only available in a device creators kit environment.
     </p>
     <p>
      <strong>
       Basic procedure:
      </strong>
     </p>
     <p>
      The high level steps to add a device to a PAN are:
     </p>
     <ul>
      <li id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-F5CF3FAF-9DEF-5DB8-8462-864D941C15ED">
       <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-F5CF3FAF-9DEF-5DB8-8462-864D941C15ED">
        <!-- -->
       </a>
       <p>
        Connect to the listening device.
       </p>
       <p>
        (See previous tutorial)
       </p>
      </li>
      <li id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-62C8D049-42EE-5311-9D03-E694F230F6B2">
       <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-62C8D049-42EE-5311-9D03-E694F230F6B2">
        <!-- -->
       </a>
       <p>
        Check if there are any open slots on the PAN.
       </p>
      </li>
      <li id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-6A984F04-4F83-5718-8482-36C1A9EB0EE7">
       <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-6A984F04-4F83-5718-8482-36C1A9EB0EE7">
        <!-- -->
       </a>
       <p>
        Add the device to an open slot.
       </p>
       <p>
        This will start the new device to the PAN connection created in the previous tutorial.
       </p>
      </li>
     </ul>
     <div class="section">
      <h2 class="sectiontitle">
       Connecting to a PAN Host
      </h2>
      <p>
       The user will launch the application (BTExample1) and be presented with a list of options. One of the options is to invite another user to join the PAN. This will cause an
       <a href="GUID-A6B66713-FECA-3BE7-BB81-1AE5551AD83D.html#GUID-A6B66713-FECA-3BE7-BB81-1AE5551AD83D__GUID-A5E799C6-E6E4-3C58-A053-F4307179060F">
        <span class="apiname">
         RNotifier::StartNotifierAndGetResponse()
        </span>
       </a>
       to prompt the user to select a device. The result of this operation is that the Bluetooth device address is known. See "
       <a href="GUID-91C4F00B-E241-57DC-8520-8C16A302C983.html#GUID-91C4F00B-E241-57DC-8520-8C16A302C983__GUID-DE57E5EA-1C46-5AE4-86CF-06AC92203383">
        Finding the Bluetooth Device Address
       </a>
       " for more.
      </p>
     </div>
     <div class="section">
      <h2 class="sectiontitle">
       Checking for open slots
      </h2>
      <p>
       The PAN host will need to check to see if there are any open connections. You may recall from the PAN Overview that there are currently two possible roles a member of a PAN may take, PANU or PAN-GN. If the PAN will only require two members the role of both can be PANU, the host will simply check that there are not any current connections before going on to open a connection for the new member. If however the PAN supports two or more connections the host will be operating in the PAN-GN role, which allows up to seven connections.
      </p>
      <p>
       Check that there is a slot available.
      </p>
      <pre class="codeblock" id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-27257112-FF2E-574E-92F7-28306A48A3FF">
       <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-27257112-FF2E-574E-92F7-28306A48A3FF">
        <!-- -->
       </a>
       if(iActiveConnections.Count() == 7)
{
 err = KErrOverflow;
}
      </pre>
      <p>
       If all the slots are currently used return
       <samp class="codeph">
        KErrOverflow
       </samp>
       and end the connection attempt. If there are open slots add the device to one as explained in the next section.
      </p>
     </div>
     <div class="section">
      <h2 class="sectiontitle">
       Adding your device to the PAN
      </h2>
      <p>
       To recap, we have a configured PAN and it has at least one open slot.
      </p>
      <p>
       Add the device address to one of the open connections of the PAN.
      </p>
      <pre class="codeblock" id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-E1A69C4C-C29E-5A1A-AE64-5FF587A9CF10">
       <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-E1A69C4C-C29E-5A1A-AE64-5FF587A9CF10">
        <!-- -->
       </a>
       else if(aDevAddr)
{
 // Add the BT address of the device to the existing RConnection
 iControlAddr = *aDevAddr;
 TPtr8 ptr = iControlAddr.Des();
 err = iConnection.Control(KCOLAgent, KCOAgentPanConnectDevice, ptr);
 ...
}
return err;
      </pre>
      <p>
       <samp class="codeph">
        aDevAddr
       </samp>
       will contain the Bluetooth device address if the notifier was used as discussed above. The device address is packaged into the
       <samp class="codeph">
        ptr
       </samp>
       pointer, which is passed into the
       <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html#GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD__GUID-28A35F19-1B05-3922-8E80-36F00DF3DB65">
        <span class="apiname">
         RConnection::Control()
        </span>
       </a>
       . The control function adds the device address to the PAN.
      </p>
      <p>
       The device is now a member of the PAN.
      </p>
     </div>
     <div class="section">
      <h2 class="sectiontitle">
       What's next?
      </h2>
      <p>
       Having created a PAN and added a device you will need to remove a device and close the PAN. The following will help:
      </p>
      <ul>
       <li id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-F2F7907A-5561-5059-B27B-AE822CE8C6F7">
        <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-F2F7907A-5561-5059-B27B-AE822CE8C6F7">
         <!-- -->
        </a>
        <p>
         <a href="GUID-91C4F00B-E241-57DC-8520-8C16A302C983.html">
          Creating a Personal Area Network
         </a>
        </p>
       </li>
       <li id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-C0FEADF4-82E3-5A2D-8635-EF78790232AD">
        <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-C0FEADF4-82E3-5A2D-8635-EF78790232AD">
         <!-- -->
        </a>
        <p>
         <strong>
          Adding a device to the PAN
         </strong>
         - This document
        </p>
       </li>
       <li id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-6A1ACE35-C68B-5A5F-A5A7-A45195324BA3">
        <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-6A1ACE35-C68B-5A5F-A5A7-A45195324BA3">
         <!-- -->
        </a>
        <p>
         <a href="GUID-197648C4-A42C-5769-82B7-F8BA510631D9.html">
          Removing a device from the PAN
         </a>
        </p>
       </li>
       <li id="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-6B28FE51-3E08-5B74-B7F4-0A7E0FF18142">
        <a name="GUID-685AD682-10DC-553B-9C3A-04D0376138C4__GUID-6B28FE51-3E08-5B74-B7F4-0A7E0FF18142">
         <!-- -->
        </a>
        <p>
         <a href="GUID-50CDF6E0-C352-5771-8686-B551267C6BE6.html">
          Closing the PAN
         </a>
        </p>
       </li>
      </ul>
     </div>
    </div>
    <div>
     <div class="familylinks">
      <div class="parentlink">
       <strong>
        Parent topic:
       </strong>
       <a href="GUID-308A481C-2280-59CE-AE85-83047B11BBE4.html">
        Bluetooth PAN Profile Tutorial
       </a>
      </div>
     </div>
    </div>
    <p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
   </div>
  </div>
  <?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>
 </body>
</html>