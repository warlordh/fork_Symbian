<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Global Surface Updates"/>
<meta name="abstract" content="Global surface updates are surface composition update commands that are submitted to all displays rather than to a single one. This causes the Surface Update Server to broadcast the update to all of the registered composition engine instances. Each of these then determines whether the surface is displayed on its associated screen and if so, forces an update."/>
<meta name="description" content="Global surface updates are surface composition update commands that are submitted to all displays rather than to a single one. This causes the Surface Update Server to broadcast the update to all of the registered composition engine instances. Each of these then determines whether the surface is displayed on its associated screen and if so, forces an update."/>
<meta name="DC.Relation" scheme="URI" content="GUID-81A0A2E9-4BB9-58BF-B2D3-08098E7E9C7C.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-63CB6C7E-44EC-5D0B-A37D-FE78F7D76592.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-81A0A2E9-4BB9-58BF-B2D3-08098E7E9C7C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-8E8FE99A-5F4D-5B0F-87AB-A58EB4BEB6E9.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-63CB6C7E-44EC-5D0B-A37D-FE78F7D76592.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-ADA8CECB-0E70-5B9C-8F36-0714AAF0CD13.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Global Surface Updates</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2384330 id2387228 id2387294 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html">Graphics Guide</a> &gt; <a href="GUID-63CB6C7E-44EC-5D0B-A37D-FE78F7D76592.html" title="The Graphics Composition collection is a key part of ScreenPlay. The collection is made up of components that are concerned with composition. This is the process of putting together the output elements from various different sources to create the display that the viewer sees on the screen.">Graphics Composition Collection</a> &gt; <a href="GUID-81A0A2E9-4BB9-58BF-B2D3-08098E7E9C7C.html" title="The Surface Update component provides a communication mechanism between the composition engine and its clients.">Surface Update Component</a> &gt; </div>
<h1 class="topictitle1">Global
Surface Updates</h1>
<div><p>Global surface updates are surface composition update commands
that are submitted to all displays rather than to a single one. This causes
the Surface Update Server to broadcast the update to all of the registered
composition engine instances. Each of these then determines whether the surface
is displayed on its associated screen and if so, forces an update. </p>

<p> <strong>Variant</strong>: <a href="GUID-D93978BE-11A3-5CE3-B110-1DEAA5AD566C.html" title="This topic provides an introduction to ScreenPlay and its architecture. ScreenPlay is a new graphics architecture, introduced in Symbian^3 (S^3). ScreenPlay enables device creators to take advantage of improved software performance, hardware acceleration and third party graphics engines. ScreenPlay is sometimes known as the New Graphics Architecture (NGA).">ScreenPlay</a>. <strong>Target
audience</strong>: Device creators. </p>

<p>To specify a global surface update, pass the <samp class="codeph">KAllScreens</samp> constant
as the first argument to the <a href="GUID-FAFD23EB-90EF-3F0C-BAB3-74FEC8DF0E06.html#GUID-FAFD23EB-90EF-3F0C-BAB3-74FEC8DF0E06__GUID-2B032364-97A0-31A1-A08C-6D8E8ACC16E1"><span class="apiname">RSurfaceUpdateSession::SubmitUpdate()</span></a> function. </p>

<p>The use of global surface updates means that the client does not need to
track which screen the surface is visible on and call <a href="GUID-FAFD23EB-90EF-3F0C-BAB3-74FEC8DF0E06.html#GUID-FAFD23EB-90EF-3F0C-BAB3-74FEC8DF0E06__GUID-2B032364-97A0-31A1-A08C-6D8E8ACC16E1"><span class="apiname">RSurfaceUpdateSession::SubmitUpdate()</span></a> for
each one. The use of global surface updates is therefore recommended.</p>

<p> <em>Note</em>: You must not mix global surface updates with
updates for specific screens in the same session. </p>

<p>The global surface update feature uses the concept of a surface's <strong>master
display</strong>. When a surface is displayed on more than one screen, its master
display is the one that has the highest priority number. The Surface Update
Server keeps a list of the priorities of all of the displays. </p>

<p>The list of priorities is set up at startup based on the priority assigned
to the composition engine instances. (The priority of a display is defined
as the priority of its associated composition engine instance.) </p>

<div class="section"><h2 class="sectiontitle">Client notifications</h2> <p>When global surface updates
are in use, the Surface Update Server makes copies of all of the notification
requests from the client and sends them on to each of the registered composition
engine instances. The Surface Update Server collects the completed requests
from the composition engine instance and forwards the completion status to
the client as follows: </p>
 <ul>
<li id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-16591C0C-BB58-5D10-984F-32ED5E35F10A"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-16591C0C-BB58-5D10-984F-32ED5E35F10A"><!-- --></a><p>For all of the <samp class="codeph">NotifyWhen...()</samp> notification
types, each composition engine instance determines whether the surface is
visible on its associated screen. If the surface is not visible, it returns <samp class="codeph">KErrNotVisible</samp> to
the Surface Update Server. If all of the composition engine instances return <samp class="codeph">KErrNotVisible</samp>,
the Surface Update Server returns <samp class="codeph">KErrNotVisible</samp> to the client. </p>
 </li>

<li id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-4E6C7843-0C0E-568A-B1D5-0DD10D052FBC"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-4E6C7843-0C0E-568A-B1D5-0DD10D052FBC"><!-- --></a><p> <samp class="codeph">NotifyWhenAvailable()</samp>.
For multi-buffered surfaces, the Surface Update Server sends the notification
to the client when the buffer has been released by all of the displays on
which it is visible. For single-buffered surfaces, the Surface Update Server
sends the notification to the client when the composition engine instances
that correspond to the displays on which it is visible have read the buffer
once. </p>
 </li>

<li id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-043DE46C-130A-582C-9626-C123552A3400"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-043DE46C-130A-582C-9626-C123552A3400"><!-- --></a><p> <samp class="codeph">NotifyWhenDisplayed()</samp>.
The Surface Update Server sends notification to the client when the master
display has displayed the buffer. </p>
 </li>

<li id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-114CC0D5-2955-55AC-8D7A-427D2D1B3215"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-114CC0D5-2955-55AC-8D7A-427D2D1B3215"><!-- --></a><p> <samp class="codeph">NotifyWhenDisplayedXTimes()</samp>.
The Surface Update Server sends notification to the client when the master
display has displayed the buffer the specified number of times. If the master
display becomes unavailable while the request is in progress, the Surface
Update Server reassigns it to the visible display with the next highest priority. </p>
 </li>

</ul>
 </div>

<div class="section"><h2 class="sectiontitle">Sequence diagrams</h2> <p>The following diagrams illustrate
the sequence for global updates in a device that has two composition engine
instances registered with the Surface Update Server. These diagrams make the
following assumptions: </p>
 <ul>
<li id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-030B0A51-35F8-57AA-93B1-0226FE46C039"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-030B0A51-35F8-57AA-93B1-0226FE46C039"><!-- --></a><p> <em>Composition Engine
1</em> is associated with <em>Screen1</em> and <em>Composition Engine 2</em> is
associated with <em>Screen2</em>. </p>
 </li>

<li id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-F6EDF2CF-DE85-55A2-907D-ECFA26576E7E"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-F6EDF2CF-DE85-55A2-907D-ECFA26576E7E"><!-- --></a><p> <em>Composition Engine
1</em>'s priority is higher than <em>Composition Engine 2</em>'s. </p>
 </li>

</ul>
 <p>The first diagram shows the typical sequence when the surface is
visible on <em>Screen2</em> only. <em>Composition Engine 1</em> responds first
with <samp class="codeph">KErrNotVisible</samp>. The Surface Update Server then considers <em>Screen2</em> to
be the surface's master display and waits for it to complete before sending
the notification to the client. </p>
 <div class="fignone" id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-14C89A10-7762-5836-AF7F-B187704510E5"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-14C89A10-7762-5836-AF7F-B187704510E5"><!-- --></a><span class="figcap">Figure 1.               The surface is visible on Screen2 only,             
Composition Engine 1 replies before Composition Engine              2    
       </span>

<img src="GUID-5F9BEEF7-19BC-550F-BD97-60F70B55E906_d0e280879_href.png"/>
</div>
 <p>In the next diagram, the surface is still visible on <em>Screen2</em> only.
This time, however, <em>Composition Engine 2</em> replies before <em>Composition
Engine 1</em>. The Surface Update Server considers <em>Composition Engine 1</em> to
be the master until it receives an error (<samp class="codeph">KErrNotVisible</samp> in
this example) from <em>Composition Engine 1</em>. It then considers <em>Backend2</em> to
be the master. </p>
 <p>Notice that although <em>Screen2</em> has become the
master, <samp class="codeph">RequestComplete()</samp> goes to the client at the point
that <em>Composition Engine 1</em> returns the error. This is because <em>Backend2</em> replied
before <em>Backend1.</em>  </p>
 <div class="fignone" id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-0708D124-F89D-5BCA-85B0-E28E4CCD26C7"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-0708D124-F89D-5BCA-85B0-E28E4CCD26C7"><!-- --></a><span class="figcap">Figure 2.               The surface is visible on Screen2 only,             
Composition Engine 2 replies before Composition Engine              1    
       </span>

<img src="GUID-B4653180-46EB-58A8-B2A8-0DD2C3D30FE7_d0e280929_href.png"/>
</div>
 <p>In this final diagram, the surface is visible on both screens. <em>Screen1</em> is
considered the surface's master display and the client is notified when <em>Composition
Engine 1</em> completes. When <em>Composition Engine 2</em> completes, the Surface
Update Server discards its notification. </p>
 <div class="fignone" id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-FA4BE8A3-33A2-53E7-9124-53D404B0305A"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-FA4BE8A3-33A2-53E7-9124-53D404B0305A"><!-- --></a><span class="figcap">Figure 3.               The surface is visible on both screens.            </span>

<img src="GUID-467EF3F5-754B-550A-A9C7-246D68C91F0A_d0e280949_href.png"/>
</div>
 </div>

<div class="section"><h2 class="sectiontitle">Example</h2> <p>The following code snippet shows using
the global surface update feature to request composition to all of the screens
that are registered with the Surface Update Server. </p>
 <pre class="codeblock" id="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-45C71218-12FC-58A9-877E-27D642F5E949"><a name="GUID-D2ECF215-B53C-5659-BA86-5B658C0C2D2F__GUID-45C71218-12FC-58A9-877E-27D642F5E949"><!-- --></a>TRequestStatus  status;
RRegion *region;
    
// Signifies all screens.
TInt screen = KAllScreens;
    
// The current buffer for composition.
TInt theBuffer = 0; 
    
TSurfaceId surfaceId;
     
// Set surface ID.
...
    
// Render to the surface.
...
    
// Broadcast the request to all registered screens.
surfaceUpdateSession.SubmitUpdate(screen, surfaceId, theBuffer, NULL);
</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-81A0A2E9-4BB9-58BF-B2D3-08098E7E9C7C.html" title="The Surface Update component provides a communication mechanism between the composition engine and its clients.">Surface Update Component</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-8E8FE99A-5F4D-5B0F-87AB-A58EB4BEB6E9.html" title="Each graphics composition surface has at least two interested stakeholders: the process responsible for drawing and maintaining the content and the composition engine, which uses the surface for creating the display. When one of the stakeholders does something to the surface, it usually means that another stakeholder needs to do something too. The Surface Update component provides a channel for the stakeholders to inform each other of changes.">Surface Update
Component Overview</a></div>
<div><a href="GUID-63CB6C7E-44EC-5D0B-A37D-FE78F7D76592.html" title="The Graphics Composition collection is a key part of ScreenPlay. The collection is made up of components that are concerned with composition. This is the process of putting together the output elements from various different sources to create the display that the viewer sees on the screen.">Graphics
Composition Collection</a></div>
<div><a href="GUID-ADA8CECB-0E70-5B9C-8F36-0714AAF0CD13.html" title="This topic provides an introduction to graphics composition surfaces, which are usually simply called surfaces. Surfaces are pixel buffers that have associated metadata describing the width, height, stride and pixel format and are used as input to the composition components. Surfaces can be multi-buffered and are identified by a 128-bit identifier (called the surface ID).">Graphics
Composition Surfaces</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>