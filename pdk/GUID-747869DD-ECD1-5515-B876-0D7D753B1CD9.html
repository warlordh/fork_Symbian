<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Optional Features Query API"/>
<meta name="abstract" content="This document details how to query a device for the presence of single features and multiple features using the Feature Registry."/>
<meta name="description" content="This document details how to query a device for the presence of single features and multiple features using the Feature Registry."/>
<meta name="DC.Relation" scheme="URI" content="GUID-9B32E6D3-D8D2-5353-9491-7E94D95D00EB.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7495B1C8-38B5-5A09-8231-25B3BBC09F51.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0CA63AEB-9A80-51C6-AE7F-E747D6B3B789.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9B32E6D3-D8D2-5353-9491-7E94D95D00EB.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B01EDE29-0861-52B0-97BE-8B41E580817F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9F9D6764-D86E-5665-B51A-04A4D3949FB4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F55EAA3A-5D30-5983-9053-7C3935D99802.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Optional Features Query API</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2859821 id2859830 id2859850 id2860064 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html" title="Provides services to enable and support persistence.">Persistent Data Services Guide</a> &gt; <a href="GUID-7495B1C8-38B5-5A09-8231-25B3BBC09F51.html">Feature Management</a> &gt; <a href="GUID-0CA63AEB-9A80-51C6-AE7F-E747D6B3B789.html" title="The Feature Manager is used to customise software by manipulating feature flags.">Feature Manager</a> &gt; <a href="GUID-9B32E6D3-D8D2-5353-9491-7E94D95D00EB.html">Feature Registry</a> &gt; </div>
<h1 class="topictitle1">Optional Features Query API</h1>
<div><p>This document details how to query a device for the presence of single features and multiple features using the Feature Registry. </p>
<div class="section" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-03094475-44BD-5582-8213-70B66D76B928"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-03094475-44BD-5582-8213-70B66D76B928"><!-- --></a><h2 class="sectiontitle">Single feature queries</h2> <p>A single feature Query API is provided by class <a href="GUID-4A0F7FCB-C3ED-3F0E-AB1D-5D96D5625595.html"><span class="apiname">RFeatureRegistryNotify</span></a>, declared in <span class="filepath">featreg.h</span>, supplied by <span class="filepath">featreg.dll</span> and linked through <span class="filepath">featreg.lib</span>. </p>
 <p>To inquire whether a single feature is supported on the device, use the following static function of class <a href="GUID-9374A36C-BA56-3893-A72B-62544D2FD6AA.html"><span class="apiname">RFeatureRegistry</span></a>: </p>
 <pre class="codeblock" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-4E318BD0-3F0F-5895-8622-44E8F1B3C4D9"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-4E318BD0-3F0F-5895-8622-44E8F1B3C4D9"><!-- --></a>static TInt QuerySupportS(TUid aFeatureUid);</pre>
 <p>This function returns a positive value if the feature is supported, zero if the feature is not supported, otherwise (in the exceptional case) a negative, system-wide error code if support cannot be determined. </p>
 <p>You can choose to deal with the error returns locally. For example, by considering the feature <em>not supported</em>: </p>
 <pre class="codeblock" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-52E31137-03B0-532F-B509-C9EC20049BE7"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-52E31137-03B0-532F-B509-C9EC20049BE7"><!-- --></a>TBool haveUsb = RFeatureRegistry::QuerySupportS(NFeature::KUsb) &gt; 0;</pre>
 <p>Alternatively you can choose to <em>Leave</em> on exceptional error returns: </p>
 <pre class="codeblock" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-41267948-4C7F-504A-ADB5-217AE7AE453A"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-41267948-4C7F-504A-ADB5-217AE7AE453A"><!-- --></a>TBool haveUsb =
              User::LeaveIfError(RFeatureRegistry::QuerySupportS(NFeature::KUsb)) &gt; 0;
</pre>
 <p>The Feature Registry maintains an additional 32-bit data word per feature, which can be obtained using an overload of the <a href="GUID-A206EE27-AA19-3D32-81BD-AF1D3A0D2F21.html"><span class="apiname">QuerySupportS</span></a> function: </p>
 <pre class="codeblock" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-D5AE4FF4-C8CD-5B1E-B234-030E7400EC88"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-D5AE4FF4-C8CD-5B1E-B234-030E7400EC88"><!-- --></a>static TInt QuerySupportS(TUid aFeatureUid, TUint32&amp; aInfo);</pre>
 <p>The contents of this extra word are reserved for future use. </p>
 </div>
 <div class="section" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-3024D6DD-8257-5EF6-8095-B7814A081656"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-3024D6DD-8257-5EF6-8095-B7814A081656"><!-- --></a><h2 class="sectiontitle"> Multiple feature queries</h2> <p>The most efficient way to find out if more than one function is supported is to open and query an instance of the <a href="GUID-9374A36C-BA56-3893-A72B-62544D2FD6AA.html"><span class="apiname">RFeatureRegistry</span></a> class using the following non-static methods of the <samp class="codeph">RFeatureRegistry</samp> class: </p>
 <pre class="codeblock" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-E155717F-4A2D-54DA-85CE-4440EB0D1695"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-E155717F-4A2D-54DA-85CE-4440EB0D1695"><!-- --></a>inline RFeatureRegistry();
TInt Open();
TInt QuerySupport(TUid aFeatureUid);
TInt QuerySupport(TUid aFeatureUid, TUint32&amp; aInfo);
void Close();
</pre>
 <p> <a href="GUID-9374A36C-BA56-3893-A72B-62544D2FD6AA.html"><span class="apiname">RFeatureRegistry</span></a> also has an overload of non-static QuerySupport, which can return the extra word of data stored with each feature. </p>
 <p>An important point about the above non-static APIs is that they only guarantee to return the state of features at the time <a href="GUID-20D0D10F-3401-3F72-8AF6-DC35F6025DC2.html"><span class="apiname">Open()</span></a> was called. To ensure that future run-time feature changes are detected, close the instance immediately after querying it, and re-open it next time queries are to be made. This also frees up resources held by the open instance. </p>
 <p> <strong>Note:</strong> Querying features can have an impact on performance. Therefore, if you are querying frequently (for example, in a loop) it is recommended that you cache the query return. However, if the feature is seldom used (once or twice between switching the device on and off), caching is unnecessary. </p>
 </div>
 <div class="example" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-1E023B69-F2F9-5FAF-B56C-D95443DDC564"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-1E023B69-F2F9-5FAF-B56C-D95443DDC564"><!-- --></a><h2 class="sectiontitle">Optional features query API example</h2> <p>The following code illustrates how to query several features in a non-leaving context (and treating exceptional results as if the feature is not supported). </p>
 <pre class="codeblock" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-5BA833B1-6CC3-5784-A775-82EA3851AC97"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-5BA833B1-6CC3-5784-A775-82EA3851AC97"><!-- --></a>TBool iHaveUsb;
TBool iHaveBluetooth;
...
RFeatureRegistry featReg;
const TBool opened = (featReg.Open() == KErrNone);
iHaveUsb = opened &amp;&amp; (featReg.QuerySupport(NFeature::KUsb) &gt; 0);
iHaveBluetooth = opened &amp;&amp; (featReg.QuerySupport(NFeature::KBluetooth) &gt; 0);
// can always call Close(), even if Open() failed:
featReg.Close();
</pre>
 <p>Or if choosing to <em>Leave</em> on exceptional returns: </p>
 <pre class="codeblock" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-07463560-744A-5821-BAB7-0F72C7048E5E"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-07463560-744A-5821-BAB7-0F72C7048E5E"><!-- --></a>RFeatureRegistry featReg;
User::LeaveIfError(featReg.Open());
CleanupClosePushL(featReg);               // don’t forget this
iHaveUsb = User::LeaveIfError(featReg.QuerySupport(NFeature::KUsb)) &gt; 0;
iHaveBluetooth =
    User::LeaveIfError(featReg.QuerySupport(NFeature::KBluetooth)) &gt; 0;
CleanupStack::PopAndDestroy(&amp;featReg);    // this calls Close()
</pre>
 </div>
 <div class="section" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-F411E1E4-5A9D-5469-8E58-7E0CCD213368"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-F411E1E4-5A9D-5469-8E58-7E0CCD213368"><!-- --></a><h2 class="sectiontitle">Preconditions for Feature Queries</h2> <p>When deciding when and how often to query, you must plan carefully as feature queries will result in a performance overhead. It is recommended that you always query and cache the return value if it is to be used many times in quick succession, particularly in loops. However, if the feature is seldom used (once or twice between switching the device on and off), caching is unnecessary. </p>
 <p>Your UI-provider or system integration team must ensure that the Feature Registry has a valid configuration file for the environment you are using, be it an emulator or a target device or reference board. </p>
 <p>Where optional features are removed from a device, all effort is made to make the failure of any attempt to use the missing features as graceful as possible. Unless individual features are documented to give particular, safe responses when not supported by a device (through a stub DLL, for example), their use as a means to discover the feature cannot be considered safe unless expressly documented as such. In addition, optional features supplied as plug-ins may be more efficiently detected using the Feature Registry. Finally, even if it works now, there is no guarantee that attempts to use a removed feature in future will not have serious consequences including exceptions, leaves or panics. </p>
 </div>
 <div class="section" id="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-BBE1DF47-E2BC-5279-9945-FD35EBB1DEDB"><a name="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-BBE1DF47-E2BC-5279-9945-FD35EBB1DEDB"><!-- --></a><h2 class="sectiontitle">Errors and Panics</h2> <p>If the error <a href="GUID-64F6761A-4716-37C3-8984-FF18FC8B7B7D.html"><span class="apiname">KErrNoMemory</span></a> is returned, this means there is insufficient memory to complete the query. If more memory becomes available subsequent queries may succeed. </p>
 <p>If the error <a href="GUID-253F06EA-F14E-3A8E-BA4C-8E787B5F0670.html"><span class="apiname">KErrCorrupt</span></a> is returned, this is serious. Your UI-provider or system integration team must ensure that the Feature Registry has a valid configuration file for the environment you are using, be it an emulator or a target device or reference board. Refer to the <a href="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9.html#GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-03094475-44BD-5582-8213-70B66D76B928">Single feature queries</a> and <a href="GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9.html#GUID-747869DD-ECD1-5515-B876-0D7D753B1CD9__GUID-3024D6DD-8257-5EF6-8095-B7814A081656">Multiple feature queries</a> sections for example code on how to allow client programs to continue under such circumstances. </p>
 <p>In debug builds you may get panic “FeatReg 1” when you call RFeatureRegistry functions. In release builds, the error value <a href="GUID-253F06EA-F14E-3A8E-BA4C-8E787B5F0670.html"><span class="apiname">KErrCorrupt</span></a> is returned instead of a panic. “1” is the enumeration for <a href="GUID-1584D300-8FEF-3285-8FAE-C6E99DDB7B5A.html"><span class="apiname">EFeatRegBadConfig</span></a>, declared in the exported header file <span class="filepath">featregpan.h</span>. This issue only occurs within Symbian and licensee organisations, and does not apply to external developers. </p>
 </div>
 </div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-9B32E6D3-D8D2-5353-9491-7E94D95D00EB.html">Feature Registry</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-B01EDE29-0861-52B0-97BE-8B41E580817F.html" title="This document details how to identify optional features for querying with the Feature Registry.">Identifying
                Optional Features</a></div>
<div><a href="GUID-9F9D6764-D86E-5665-B51A-04A4D3949FB4.html" title="This document details linkage to the notification API and how to subscribe for notification of feature changes.">Optional Features
                Notification API</a></div>
<div><a href="GUID-F55EAA3A-5D30-5983-9053-7C3935D99802.html">Feature Registry
                Overview</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>