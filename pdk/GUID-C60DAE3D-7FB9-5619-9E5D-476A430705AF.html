<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Querying a database"/>
<meta name="abstract" content="This tutorial shows you how to create a simple SQL database query."/>
<meta name="description" content="This tutorial shows you how to create a simple SQL database query."/>
<meta name="DC.Relation" scheme="URI" content="GUID-582CAA4A-1240-5138-983D-D9C6EEAF5566.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F8824165-4B33-50D1-9706-BD2438B5A2EE.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-868D5B32-1CC4-506E-9C49-C86428B9A50F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-582CAA4A-1240-5138-983D-D9C6EEAF5566.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-22844C28-AB5B-5A6F-8863-7269464684B4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CCB9C61B-FB28-5CD9-A366-4A9584097897.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B61EA8C5-0966-51DE-AC73-01DD34C7D3CC.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-72511204-FC90-54AA-9E2E-833318020318.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3CCA6503-54DA-5558-85DC-93A22A81F565.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-183280EE-0C57-54FE-8ABB-E1CC3BDE525B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B9A3B17E-BDEB-5F66-968C-080335A721AC.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C474376E-1766-5781-B5BF-3786C5B4D72E.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Querying a database</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2859821 id2860178 id2534422 id2534581 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html" title="Provides services to enable and support persistence.">Persistent Data Services Guide</a> &gt; <a href="GUID-F8824165-4B33-50D1-9706-BD2438B5A2EE.html" title="The persistent storage collection.">Persistent Storage</a> &gt; <a href="GUID-868D5B32-1CC4-506E-9C49-C86428B9A50F.html" title="The Symbian SQL component.">Symbian SQL</a> &gt; <a href="GUID-582CAA4A-1240-5138-983D-D9C6EEAF5566.html" title="These are the SQL tutorials.">SQL Tutorials</a> &gt; </div>
<h1 class="topictitle1">Querying
a database</h1>
<div><p>This tutorial shows you how to create a simple SQL database query. </p>

<div class="section" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-0A238212-37C9-5B4B-A449-F8C81CE971A8"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-0A238212-37C9-5B4B-A449-F8C81CE971A8"><!-- --></a><h2 class="sectiontitle">Introduction</h2> <p>This
tutorial shows you how to wrap a SQL query statement into an <a href="GUID-0176BF07-DF94-3259-8F90-DE030E35CE9A.html"><span class="apiname">RSqlStatement</span></a> object
to query a database. </p>
 <p>The SQL statement used for the tutorial is shown
here: </p>
 <p><kbd class="userinput"><span class="parmname">SELECT</span> <span class="cmdname">name</span>  <span class="parmname">FROM</span> <span class="cmdname">countries</span>  <span class="parmname">WHERE</span> <span class="cmdname">population &gt; 10</span> </kbd> </p>
 <p>The (<samp class="codeph">SELECT</samp>)
results of the query will be the value in the '<samp class="codeph">name</samp>' column <samp class="codeph">FROM</samp> the
'<samp class="codeph">countries</samp>' table <samp class="codeph">WHERE</samp> the value of the
'<samp class="codeph">population</samp>' column of the same record is <samp class="codeph">&gt;</samp> the
value specified. </p>
 </div>

<div class="section" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-AF611AF2-85EC-4F02-B43F-A0EFAAEA9CAB"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-AF611AF2-85EC-4F02-B43F-A0EFAAEA9CAB"><!-- --></a><h2 class="sectiontitle">Procedure</h2> <a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-2C39BABE-F2D4-510A-A406-D2C48412B6F8"><!-- --></a><ol id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-2C39BABE-F2D4-510A-A406-D2C48412B6F8">
<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-56D39707-7D55-5843-8966-36223BB20EFC"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-56D39707-7D55-5843-8966-36223BB20EFC"><!-- --></a><p>Prepare the Statement: </p>
 <p>The
steps to prepare a SQL statement are shown here. </p>
 <a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-8B003014-94BB-5B4E-9D9C-8098A3642EA6"><!-- --></a><ol type="a" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-8B003014-94BB-5B4E-9D9C-8098A3642EA6">
<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-A988E274-8B21-5DCB-A616-06CD3C6F5680"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-A988E274-8B21-5DCB-A616-06CD3C6F5680"><!-- --></a><p>Set up some constants
used by the SQL statement object to define the SQL query: </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-37E8467F-7AFC-5DBA-AF29-1A910E5CABC5"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-37E8467F-7AFC-5DBA-AF29-1A910E5CABC5"><!-- --></a>_LIT(kName,"name");
_LIT(kPopulation,"population");
_LIT(kVal,":Value");
_LIT(kQueryString,"SELECT name FROM countries WHERE population &gt; :Value");</pre>
 </div>
 <p>This
defines the query parameters. </p>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-39F138F2-591F-586E-A06F-91981A1F6388"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-39F138F2-591F-586E-A06F-91981A1F6388"><!-- --></a><p>Instantiate the <a href="GUID-0176BF07-DF94-3259-8F90-DE030E35CE9A.html"><span class="apiname">RSqlStatement</span></a> SQL
statement: </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-41EB4CD0-E131-5C85-B799-5940853B9F60"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-41EB4CD0-E131-5C85-B799-5940853B9F60"><!-- --></a>RSqlStatement myStatement;</pre>
 </div>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-5FD16C7C-591D-5006-A177-C899314AA798"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-5FD16C7C-591D-5006-A177-C899314AA798"><!-- --></a><p>Define the indices to
be used in the search: </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-351298BC-348F-57E4-BC30-E6706385D8AA"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-351298BC-348F-57E4-BC30-E6706385D8AA"><!-- --></a>TInt nameIndex = myStatement.ColumnIndex(kName); 
TInt populationIndex = myStatement.ColumnIndex(kPopulation);</pre>
 </div>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-17A647B3-6E8C-54FB-A21E-23425AD343FD"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-17A647B3-6E8C-54FB-A21E-23425AD343FD"><!-- --></a><p>Set the 32-bit integer
value for the SQL parameter 'value': </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-838D0598-1E98-57E8-AC66-68AA590EDFBA"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-838D0598-1E98-57E8-AC66-68AA590EDFBA"><!-- --></a>TInt parameterIndex = myStatement.ParameterIndex(kVal);
err = myStatement.BindInt(parameterIndex,10);</pre>
 </div>
 <p>The SQL
parameter to which the integer is being assigned is identified by the constant <samp class="codeph">kVal</samp> from: </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-71AB4003-65D7-5035-ACFB-E106ACF2AB15"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-71AB4003-65D7-5035-ACFB-E106ACF2AB15"><!-- --></a>_LIT(kVal,":Value");
...
...WHERE population &gt; :Value")  </pre>
 </div>
 <p>The parameter plus constant,
along with other parts of the statement, are converted into: </p>
 <p>in SQL
syntax. </p>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-AEBF05BB-08E7-5628-8B5F-8CD30F08D638"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-AEBF05BB-08E7-5628-8B5F-8CD30F08D638"><!-- --></a><p>Prepare the statement: </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-C518EA02-81AC-5B93-9FAF-1BDC987985DB"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-C518EA02-81AC-5B93-9FAF-1BDC987985DB"><!-- --></a>TInt err;
err = myStatement.Prepare(countriesDatabase,kQueryString);</pre>
 </div>
 <p>This
creates a parameterised SQL statement executable. </p>
 </li>

</ol>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-1153684C-697C-5C84-A15C-99C96820C8FB"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-1153684C-697C-5C84-A15C-99C96820C8FB"><!-- --></a><p>Run the SQL query: </p>
 <a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-186BD930-F9A1-5244-BEA8-3774DC6D3F91"><!-- --></a><ol type="a" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-186BD930-F9A1-5244-BEA8-3774DC6D3F91">
<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-1D0B5C50-E1C6-51DC-8CCE-2C2B4C33F7F6"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-1D0B5C50-E1C6-51DC-8CCE-2C2B4C33F7F6"><!-- --></a><p>Search the records until
a match is found: </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-DEF39928-2DBB-5017-A47C-1BB6475B44B7"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-DEF39928-2DBB-5017-A47C-1BB6475B44B7"><!-- --></a>while((err = myStatement.Next()) == KSqlAtRow)
 {
  Do something with the query results
 }</pre>
 </div>
 <p>Next() fires the executable SQL statement and stops
at and returns the matched record. </p>
 <p>Do something if no results are
found. </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-ADD04732-1D9C-5716-B885-14D92D341149"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-ADD04732-1D9C-5716-B885-14D92D341149"><!-- --></a>if(err == KSqlAtEnd)
    &lt;OK - no more records&gt;;
else
    &lt;process the error&gt;;</pre>
 </div>
 </li>

</ol>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-26B8C900-50D3-59D2-BACD-61C825B2A3A4"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-26B8C900-50D3-59D2-BACD-61C825B2A3A4"><!-- --></a><p>The query is done and
you have the results. In this section we look at a simple way to do something
with the results and we close the SQL statement object. </p>
 <a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-79A55F5A-E42B-5AA2-B451-080E36100E0A"><!-- --></a><ol type="a" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-79A55F5A-E42B-5AA2-B451-080E36100E0A">
<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-5F24A346-F2DA-5544-9AB2-DD046E4D80DD"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-5F24A346-F2DA-5544-9AB2-DD046E4D80DD"><!-- --></a><p>Get the results of the
search: </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-86F158DF-88FF-5128-9B6E-461D6C3163D7"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-86F158DF-88FF-5128-9B6E-461D6C3163D7"><!-- --></a>TPtrC myData;
myData = myStatement.ColumnTextL(nameIndex);
RDebug::Print(_L("Name=%d\n"), myData);</pre>
 </div>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-0C40380F-9A06-5546-A366-33EBAAA5E9D6"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-0C40380F-9A06-5546-A366-33EBAAA5E9D6"><!-- --></a><p>Close the SQL search
statement: </p>
 <div class="p"><pre class="codeblock" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-1D856776-5557-57EC-8047-270A751405B1"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-1D856776-5557-57EC-8047-270A751405B1"><!-- --></a>err = myStatement.Close(); </pre>
 </div>
 <p>When
the database search is finished the object should be closed to free up resources. </p>
 </li>

</ol>
 </li>

</ol>
<p> This section deals with finding and returning the first matching
record</p>
<p>  only. Getting all matches in a database is briefly discussed
at the end of this</p>
<p> section. </p>
 </div>


<div class="section" id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-8F3A39B6-6514-5A48-BE2E-7893D7625A9C-GENID-1-12-1-27-1-1-6-1-1-9-1-8-1-8-1-3-3"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-8F3A39B6-6514-5A48-BE2E-7893D7625A9C-GENID-1-12-1-27-1-1-6-1-1-9-1-8-1-8-1-3-3"><!-- --></a><p>Now that you have
performed a basic database query you can start thinking about more advanced
querying options. The following will show you how: </p>
 <ul>
<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-3F4608F9-92E9-52AA-8843-7535688A0D57"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-3F4608F9-92E9-52AA-8843-7535688A0D57"><!-- --></a><p> <a href="GUID-2610E11C-26FA-538E-A3E1-34AADA35F20B.html" title="This tutorial shows you how to create a simple SQL database query.">Querying
Databases: Basic</a>  </p>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-02919F4F-2F55-5446-9E5B-A1A8CBE9D017"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-02919F4F-2F55-5446-9E5B-A1A8CBE9D017"><!-- --></a><p> <a href="GUID-72511204-FC90-54AA-9E2E-833318020318.html">Reading
to a buffer</a>  </p>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-2A715BF4-6BE3-50A0-8F46-DBD28C1494A7"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-2A715BF4-6BE3-50A0-8F46-DBD28C1494A7"><!-- --></a><p> <a href="GUID-3CCA6503-54DA-5558-85DC-93A22A81F565.html" title="This tutorial describes how to copy data from the table to a memory location.">Reading
to memory</a>  </p>
 </li>

<li id="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-A4C14656-EE85-53B8-8859-F7F56BC49004"><a name="GUID-C60DAE3D-7FB9-5619-9E5D-476A430705AF__GUID-A4C14656-EE85-53B8-8859-F7F56BC49004"><!-- --></a><p> <a href="GUID-183280EE-0C57-54FE-8ABB-E1CC3BDE525B.html">Reading
to a data stream</a>  </p>
 </li>

</ul>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-582CAA4A-1240-5138-983D-D9C6EEAF5566.html" title="These are the SQL tutorials.">SQL Tutorials</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-22844C28-AB5B-5A6F-8863-7269464684B4.html" title="This document introduces you to the Symbian platform implementation of the Structured Query Language(SQL).">SQL Overview</a></div>
<div><a href="GUID-CCB9C61B-FB28-5CD9-A366-4A9584097897.html" title="This tutorial describes how to insert a row into a table.">Inserting
a row into a                 table</a></div>
<div><a href="GUID-B61EA8C5-0966-51DE-AC73-01DD34C7D3CC.html" title="This tutorial describes how to delete rows from a database table.">Deleting
Rows from a Table</a></div>
<div><a href="GUID-72511204-FC90-54AA-9E2E-833318020318.html">Reading to
a                 buffer</a></div>
<div><a href="GUID-3CCA6503-54DA-5558-85DC-93A22A81F565.html" title="This tutorial describes how to copy data from the table to a memory location.">Reading to
memory</a></div>
<div><a href="GUID-183280EE-0C57-54FE-8ABB-E1CC3BDE525B.html">Reading to
a data                 stream</a></div>
<div><a href="GUID-B9A3B17E-BDEB-5F66-968C-080335A721AC.html" title="This tutorial describes how to write data from a data stream to a database.">Writing to
a data                 stream</a></div>
<div><a href="GUID-C474376E-1766-5781-B5BF-3786C5B4D72E.html" title="This tutorial describes the way in which you can execute scalar queries.">Scalar queries</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>