<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Policy Evaluator Plug-in"/>
<meta name="DC.Relation" scheme="URI" content="GUID-44CF5471-564E-5790-935B-51193A4978D6.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B394A824-8745-505E-8429-8B9B6D418387.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-44CF5471-564E-5790-935B-51193A4978D6.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-33C7EEEB-88B8-5587-916D-2C5D122F6010.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-4384066E-158A-5F63-A823-7793DAE680BF.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-E56E21A9-B545-5217-A877-E64D30275157"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Policy Evaluator Plug-in</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-E56E21A9-B545-5217-A877-E64D30275157"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2404348 id2404397 id2404434 id2404448 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html">Messaging Middleware Guide</a> &gt; <a href="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html">Messaging Framework</a> &gt; <a href="GUID-B394A824-8745-505E-8429-8B9B6D418387.html">Message Server and Store</a> &gt; <a href="GUID-44CF5471-564E-5790-935B-51193A4978D6.html" title="This section lists the concepts that are related to Message Server and Store.">Message Server and Store Concepts</a> &gt; </div>
<h1 class="topictitle1">Policy
Evaluator Plug-in</h1>
<div>
<p>This section explains the user prompting function in the Messaging Middleware
module. It also explains how to extract the serial buffer from the various
Message Type Modules (MTM) of messaging components to the User Prompt Service
(UPS) Policy Evaluator plug-in. </p>

<div class="section" id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-8AD9A61F-1BA4-498E-9886-21FCD5EBCA5D"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-8AD9A61F-1BA4-498E-9886-21FCD5EBCA5D"><!-- --></a><h2 class="sectiontitle">Overview</h2> <p>The Messaging Middleware module enables
the users to automatically request the user's permission for sending messages.
The user's permission for outbound messages depends on the capability of the
client application that sends the email or SMS message. The phone users are
prompted to decide if any activity that can be billed (for example, sending
an email message or an SMS message) must be allowed or not. The phone user
is prompted with a dialog box to allow or deny the operation, and to choose
if that decision should apply to one operation, or always for a particular
client application. </p>
 <p>If the client application uses the SendAs server
to send email or SMS messages, then the user is prompted at the SendAs server
stage only and not at the server MTM stage. This behaviour can be configured
at ROM build time. </p>
 <p><strong>Configuration</strong> </p>
 <p>At ROM build time,
the phone manufacturers can configure the following: </p>
 <ul>
<li id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-DB05B857-3581-5868-AFA8-BA94D85ADCE7"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-DB05B857-3581-5868-AFA8-BA94D85ADCE7"><!-- --></a><p>The scope of the permission
granted to send email or SMS messages; that is, for one operation only or
always for a particular client application. </p>
 </li>

<li id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-69B12279-9ECE-5D20-89FB-6C1CE76AB9AA"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-69B12279-9ECE-5D20-89FB-6C1CE76AB9AA"><!-- --></a><p>Whether the user is
prompted for processes that have the network services capability, or not. </p>
 </li>

<li id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-2A1E3811-E3C4-500C-BA51-C320772B5052"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-2A1E3811-E3C4-500C-BA51-C320772B5052"><!-- --></a><p>Whether the user is
prompted for processes that do not have the network services capability, or
not. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-34A30058-A9BD-4C88-823A-DFF24B638C41"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-34A30058-A9BD-4C88-823A-DFF24B638C41"><!-- --></a><h2 class="sectiontitle">Architecture</h2> <p>The request to send email or SMS messages
from a UI application and SendAs servers is passed from a client MTM to the
Message Server, on to the corresponding server MTM, and then to UPS. </p>
 <p>UPS
uses the Policy Evaluator plug-in, which allows a security decision to be
specific to an individual UI application. The Policy Evaluator plug-in prompts
the phone user (using the Dialog creator plug-in) for permission to send a
message, if the client application does not have the correct capability set. </p>
 <div class="fignone" id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-3A131C1E-CAA8-554A-A9A0-119E762D174C"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-3A131C1E-CAA8-554A-A9A0-119E762D174C"><!-- --></a><span class="figcap">Figure 1.               User prompting service architecture            </span>

<img src="GUID-629A9EF6-3029-5165-9B8B-471D341D33C5_d0e486144_href.png"/>
</div>
 <dl>

<dt class="dlterm">UPS</dt>

<dd><p>User Prompt Service </p>
 <p>UPS allows device creators to specify whether
requests made by applications to access services, such as, a request to make
a telephone call, are processed silently, or whether the user is required
to confirm the request. For more information on UPS, see <a href="GUID-1A5C7320-B017-5CD9-B3EA-1301CC08A762.html">User
Prompt Service overview</a>. </p>
 </dd>



<dt class="dlterm">SendAs server</dt>

<dd><p>The following are some of the important SendAs server features: </p>
 <ul>
<li id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-719A5CF7-2026-593D-8C36-36D57B6EDFFD"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-719A5CF7-2026-593D-8C36-36D57B6EDFFD"><!-- --></a><p>Send a message after
the capability policing of the client application has been completed. </p>
 <p>For
more information on capability policing, see the <a href="GUID-4BFEDD79-9502-526A-BA7B-97550A6F0601.html">Platform
Security</a> guide. </p>
 </li>

<li id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-F6FB396F-3CC8-5277-896D-8FFE8333B163"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-F6FB396F-3CC8-5277-896D-8FFE8333B163"><!-- --></a><p>Allow client applications
to launch an editor for a specified message type. </p>
 </li>

<li id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-00D7ABFC-E671-5CDA-A33D-8029E3A97631"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-00D7ABFC-E671-5CDA-A33D-8029E3A97631"><!-- --></a><p>Allow client applications
to query the message type. </p>
 </li>

</ul>
 <p>For more information on SendAs server, see <a href="GUID-63816E09-46C7-503A-ADA0-E350C7ACF3C4.html">SendAs</a>. </p>
 </dd>



<dt class="dlterm">Policy Evaluator</dt>

<dd><p>Policy Evaluator is an ECOM plug-in, which is responsible for generating
fingerprints used to locate previous decision records related to the request.
A default Policy Evaluator is provided by the Symbian platform,
but device creators can also write a Policy Evaluator. For more information
on Policy Evaluator, see <a href="GUID-43080A86-72D3-5422-953E-A5EF79961D7B.html">Writing
a UPS Policy Evaluators</a>. </p>
 </dd>



<dt class="dlterm">Dialog creator</dt>

<dd><p>Dialog creator is an ECOM plug-in, which generates and displays dialog
prompts. Device creators define the Dialog creator plug-in. For more information
on Dialog creator, see <a href="GUID-A8130D83-E684-5B6C-BDFE-EB6EE3CD49E8.html">Writing
a UPS Dialog Creator</a>. </p>
 </dd>


</dl>
 </div>

<div class="section" id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-6E1B9063-7E2E-4710-924A-598AD03FC007"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-6E1B9063-7E2E-4710-924A-598AD03FC007"><!-- --></a><h2 class="sectiontitle">Implementation consideration</h2> <p>The device creator
must implement the Policy Evaluator and Dialog creator plug-ins to get the
full functionality of the UPS service. </p>
 <p>The Policy Evaluator plug-in
can use the destination parameter to check if a particular request made by
a client application is permissible for a particular destination. </p>
 <p>Message
Server that interact with the UPS service can pass the destination parameter
(phone number, server address, and so on.) as a <a href="GUID-52D07F46-2162-380C-A775-C3BB335C42F5.html"><span class="apiname">TDesC</span></a> descriptor.
If there is more than one parameter, the Message Server serialises the list
of addresses to a <a href="GUID-52D07F46-2162-380C-A775-C3BB335C42F5.html"><span class="apiname">TDesC           </span></a> descriptor. </p>
 <p>To
enable the device creator to use this data, the Policy Evaluator plug-in must
convert <a href="GUID-52D07F46-2162-380C-A775-C3BB335C42F5.html"><span class="apiname">TDesC</span></a> to an address list. </p>
 </div>

<div class="section" id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-AE64C9C4-4B75-4E2C-9B3B-5BDD2DE282BD"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-AE64C9C4-4B75-4E2C-9B3B-5BDD2DE282BD"><!-- --></a><h2 class="sectiontitle">Extracting the serial buffer</h2> <p>The following code
snippet shows how to convert the <a href="GUID-FB97E0A3-352A-316F-97C6-69E4741A8120.html"><span class="apiname">TDesC8</span></a> descriptor to the
address list. When the <a href="GUID-AD05E838-D8AD-366B-B5F9-5FC061414D7C.html#GUID-AD05E838-D8AD-366B-B5F9-5FC061414D7C__GUID-899D2AE8-E495-3718-BFDF-96328F436B00"><span class="apiname">CPromptRequest::Destination()</span></a> method
is called, it returns a <samp class="codeph">const</samp>  <a href="GUID-52D07F46-2162-380C-A775-C3BB335C42F5.html"><span class="apiname">TDesC</span></a> reference,
which contains the externalized destination values. </p>
 <p>In order to internalize
this <a href="GUID-52D07F46-2162-380C-A775-C3BB335C42F5.html"><span class="apiname">TDesC</span></a>, the plug-in needs to implement the <a href="GUID-2D8EC1BB-F8FC-3A6A-A953-4303FB2B0222.html"><span class="apiname">Internalise()</span></a> functionality
using the following method: </p>
 <pre class="codeblock" id="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-A6730A8E-D3BA-5E84-81D1-4A97D53B6AFF"><a name="GUID-E56E21A9-B545-5217-A877-E64D30275157__GUID-A6730A8E-D3BA-5E84-81D1-4A97D53B6AFF"><!-- --></a>void InternaliseDestinationParameterL ()
        {    
         const TDesC&amp; d = iRequest-&gt;Destination(); // iRequest is a pointer of type CPromptRequest
         TPtrC8 p(reinterpret_cast&lt;const TUint8*&gt;(d.Ptr()), d.Length() * 2);
         RDesReadStream readStream(p);
         InternalizeL(readStream);
        }
InternalizeL (RReadStream&amp; aStream)
        {
         TInt count = aStream.ReadInt32L ();
         RArray&lt;TPtrC&gt; destinationArray;
         TBuf&lt;1000 &gt; destination ; // 1000 since this is the maximum length if the header info of a mail
         for(TInt I=0;i&lt; count;++I)
               {
                aStream &gt;&gt; destination;
                destinationArray.Append(destination);
               }
        }
</pre>
 <p>The device creator can now use the extracted serial buffer
for displaying dialog prompts. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-44CF5471-564E-5790-935B-51193A4978D6.html" title="This section lists the concepts that are related to Message Server and Store.">Message Server and Store Concepts</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-33C7EEEB-88B8-5587-916D-2C5D122F6010.html">SMS     
           MTM</a></div>
<div><a href="GUID-4384066E-158A-5F63-A823-7793DAE680BF.html">Email</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>