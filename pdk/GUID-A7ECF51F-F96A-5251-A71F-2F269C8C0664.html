<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Accessor Functions for Derived Attributes"/>
<meta name="abstract" content="Explains how to add accessor functions for derived attributes."/>
<meta name="description" content="Explains how to add accessor functions for derived attributes."/>
<meta name="DC.Relation" scheme="URI" content="GUID-05DAF5EF-6F2E-562D-9DB1-0985AD4A1E48.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2D977A02-5928-5441-8AE7-42A722F2A4B8.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-05DAF5EF-6F2E-562D-9DB1-0985AD4A1E48.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Accessor Functions for Derived Attributes</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2402268 id2402299 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-2D977A02-5928-5441-8AE7-42A722F2A4B8.html" title="The User-Side Hardware Abstraction (HAL) component provides a simple interface for programs to read and set hardware-specific settings, for example, the display contrast.">User-Side Hardware Abstraction</a> &gt; <a href="GUID-05DAF5EF-6F2E-562D-9DB1-0985AD4A1E48.html" title="Describes the steps to implement a port of the User-Side Hardware Abstraction component.">Port Implementation Tutorial</a> &gt; </div>
<h1 class="topictitle1">Accessor
Functions for Derived Attributes</h1>
<div><p>Explains how to add accessor functions for derived attributes.</p>

<p>You can change HAL to add accessor functions for new derived attributes.
This step is not often done, because all normal accessor functions are already
defined in <span class="filepath">...\hal\src\userhal.cpp</span>. </p>

<p>Each derived attribute is declared with an associated function name in <a href="GUID-52583CC7-483E-54B5-8094-F0F61BD46B7F.html#GUID-52583CC7-483E-54B5-8094-F0F61BD46B7F__GUID-8648B87A-B712-5458-850A-FDF318669FE3">Config
file</a>. A function with that name must be provided, and it must have
the following signature, which is also defined by the <a href="GUID-0885487F-1482-3BD4-9EA8-9E9643125A0A.html"><span class="apiname">THalImplementation</span></a> typedef: </p>

<pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-53946166-A153-57E1-8FAB-BB3870B0B829"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-53946166-A153-57E1-8FAB-BB3870B0B829"><!-- --></a>TInt Function(TInt aAttrib, TBool aSet, TAny* aInOut);</pre>

<p>This function is called whenever any client of the HAL references the associated
attribute. </p>


<div class="tablenoborder"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-2672A463-7AB1-504E-9D0C-2AA29757178A"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-2672A463-7AB1-504E-9D0C-2AA29757178A" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">aAttrib</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Contains the attribute number. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">aSet</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Defines whether the attribute is being set or being read: <a href="GUID-781E8158-805B-3784-8FED-D7A191822FC3.html"><span class="apiname">ETrue</span></a> means
that the attribute value is being set; <a href="GUID-A759CA2D-8327-348F-9337-4886E619D920.html"><span class="apiname">EFalse</span></a> means that
the attribute value is being read. </p>
 <p>Note that if the attribute, as
defined in the <span class="filepath">config.hcf</span> file, does not have the settable
property, then <samp class="codeph">aSet</samp> is ignored . </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">aInOut</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>A pointer to a <a href="GUID-7A2A43EC-6125-3BFE-834B-23C37F7B40D5.html"><span class="apiname">TInt</span></a> type, that contains: </p>
 <ul>
<li id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-B7598EEB-4B73-5E51-8F92-EC527FCED605"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-B7598EEB-4B73-5E51-8F92-EC527FCED605"><!-- --></a><p>the attribute value
to be set, if <samp class="codeph">aSet</samp> is <a href="GUID-781E8158-805B-3784-8FED-D7A191822FC3.html"><span class="apiname">ETrue</span></a>  </p>
 </li>

<li id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-BEA21EED-2D95-5169-B09C-DD6CC7CE4507"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-BEA21EED-2D95-5169-B09C-DD6CC7CE4507"><!-- --></a><p>the attribute value
to be read, if <samp class="codeph">aSet</samp> is <a href="GUID-A759CA2D-8327-348F-9337-4886E619D920.html"><span class="apiname">EFalse</span></a>. </p>
 </li>

</ul>
 </td>

</tr>

</tbody>

</table>
</div>

<p>Once the config file has been written, the Perl script <span class="filepath">...\hal\group\halcfg.pl</span> can
be used to generate a skeleton implementation file. For example, calling </p>

<p><kbd class="userinput">perl \hal\group\halcfg.pl -s \hal\inc\hal_data.h config.hcf
imp.cpp</kbd> </p>

<p>produces the file <span class="filepath">imp.cpp</span> containing the following
skeleton code for <em>each</em> derived attribute: </p>

<pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-EAA857F6-61FB-5FAE-815E-9B3601CF182C"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-EAA857F6-61FB-5FAE-815E-9B3601CF182C"><!-- --></a>// EAttributeName
TInt Function(TInt /*aAttrib*/, TBool /*aSet*/, TAny* aInOut)
    {
    return KErrNone;
    }
</pre>

<p>The full implementation for the function can now be written. </p>

<p>Notes: </p>

<ul>
<li id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-25545667-6870-5AAF-9271-D7402E9F777E"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-25545667-6870-5AAF-9271-D7402E9F777E"><!-- --></a><p>The <samp class="codeph">aAttrib</samp> parameter
is always marked as a comment because it is not usually needed; it is only
needed if the same function is used to implement more than one attribute. </p>
 </li>

<li id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-8DE7C359-AA59-5158-82BD-2184D874168C"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-8DE7C359-AA59-5158-82BD-2184D874168C"><!-- --></a><p>The <samp class="codeph">aSet</samp> parameter
is marked as a comment if the attribute does not have the <em>settable</em> property. </p>
 </li>

<li id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-27CE60FA-8104-511C-9FC2-3D4557D92BBC"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-27CE60FA-8104-511C-9FC2-3D4557D92BBC"><!-- --></a><p>On some platforms it
may be necessary to access some HAL attributes via a device driver or server,
rather than using <samp class="codeph">UserSvr::HalFunction()</samp> . In this case,
a handle to the device driver or server must be opened on the first access.
Use the <samp class="codeph">HalInternal::Tls()</samp> function to do this. </p>
 </li>

<li id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-72462FB8-F607-56D8-9F0B-FD9980FDCEBD"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-72462FB8-F607-56D8-9F0B-FD9980FDCEBD"><!-- --></a><p>Access to any HAL attribute
requiring the use of a server or device driver can fail due to lack of memory. </p>
 </li>

</ul>

<p>Thee code fragments in the <a href="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664.html#GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-61707920-B82E-5580-8821-4FD1DC3BE77A">example
accessor functions</a> show the cases where the HAL has an attribute that
requires a device driver and another attribute that requires a server. </p>

<p>See also <a href="GUID-F8B8C030-B5E1-5EB3-A672-83BF35555801.html" title="halcfg.pl is a Perl script that is used by the build system to generate the C++ source files from the Config and Values files.">halcfg.pl
Syntax</a>. </p>

<div class="section" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-61707920-B82E-5580-8821-4FD1DC3BE77A"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-61707920-B82E-5580-8821-4FD1DC3BE77A"><!-- --></a><h2 class="sectiontitle">Example accessor
functions for derived attributes using a device driver and a server</h2> <p>This
code fragment shows the implementation of accessor functions for two HAL derived
attributes. One uses a device driver, and the other uses a server to provide
the necessary functionality. </p>
 <p>The examples assume that the attributes
are defined in the <span class="filepath">config.hcf</span> file with function names <samp class="codeph">Attrib1</samp> and <samp class="codeph">Attrib2</samp>. </p>
 <p><strong>Using a device driver</strong> </p>
 <pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-810DF0E3-4AE7-5FFC-8434-A845513BCC65"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-810DF0E3-4AE7-5FFC-8434-A845513BCC65"><!-- --></a>TInt Attrib1(TInt /*aAttrib*/, TBool aSet, TAny* aInOut)
    {
       // Do something with the device driver
       RHwDevice d;
       TInt r=GetDeviceDriverHandle(d);
       if (r==KErrNone)
        {
        if (aSet)
            {
            r=d.Write((TInt)aInOut);
            }
        else
            {
            r=d.Read(*(TInt*)aInOut);
            }
         }
    return r;
    }</pre>
 <pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-88E9FA83-D669-5073-B92A-48A22BFEC4B2"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-88E9FA83-D669-5073-B92A-48A22BFEC4B2"><!-- --></a>TInt GetDeviceDriverHandle(RHwDevice&amp; aDevice)
    {
    // Return the device driver handle for this thread
    // If it doesn't exist, attempt to open a handle
    // Careful with OOM errors

    SHandles* pH=GetHandles();
    if (!pH)
        {
        return KErrNoMemory;    // couldn't allocate TLS memory
        }
    if (pH-&gt;iDevHandle)
        {
        // device driver handle already open
        aDevice.SetHandle(pH-&gt;iDevHandle);
        return KErrNone;
        }

    // note: Someone should have previously loaded the required
    // device driver.  Eg.
    // User::LoadLogicalDevice(_L("HARDWARE.LDD"));
    // This can be done here, but it is inefficient since it will
    // happen once per thread.  It's much better to do it once
    // at Hal start-up.

    TInt r=aDevice.Open();    // open handle to driver
    if (r==KErrNone)
        {
           pH-&gt;iDevHandle=aDevice.Handle();    // store handle
        }
    return r;
    }</pre>
 <pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-264AF5EC-A4F3-5BA7-AC47-576C338D81F2"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-264AF5EC-A4F3-5BA7-AC47-576C338D81F2"><!-- --></a>struct SHandles
    {
    TInt iDevHandle;
    TInt iSvrHandle;
    };
</pre>
 <pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-7F5DC241-B4B1-501F-A7B6-0B864676A4A2"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-7F5DC241-B4B1-501F-A7B6-0B864676A4A2"><!-- --></a>SHandles* GetHandles()
    {
    // Return a pointer to the SHandles structure for this thread
    // If it doesn't exist, attempt to create it

    // This function zeros a newly allocated memory block
    return (SHandles*)HalInternal::Tls(sizeof(SHandles));
    }
</pre>
 <p><strong>Using
a server</strong> </p>
 <pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-E0CB12CC-2F83-5AB6-B1F3-B494AD7346CB"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-E0CB12CC-2F83-5AB6-B1F3-B494AD7346CB"><!-- --></a>TInt Attrib2(TInt /*aAttrib*/, TBool aSet, TAny* aInOut)
    {
    // Do something with the server
    RHwServer s;
    TInt r=GetServerHandle(s);
    if (r==KErrNone)
        {
        if (aSet)
            {
            r=s.Write((TInt)aInOut);
            }
            else
            {
            r=s.Read(*(TInt*)aInOut);
            }
        }
    return r;
    }</pre>
 <pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-C74F36A5-78CA-52A6-A8E9-6BEAAC7B9257"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-C74F36A5-78CA-52A6-A8E9-6BEAAC7B9257"><!-- --></a>TInt GetServerHandle(RHwServer&amp; aServer)
    {
    // Return the server handle for this thread
    // If it doesn't exist, attempt to open a handle
    // Careful with OOM errors

    SHandles* pH=GetHandles();
    if (!pH)
        {
        return KErrNoMemory;    // couldn't allocate TLS memory
        }
    if (pH-&gt;iSvrHandle)
        {
        // server handle already open
           aServer.SetHandle(pH-&gt;iSvrHandle);
           return KErrNone;
        }
    TInt r=aServer.Connect();    // create session with server
    if (r==KErrNone)
        {
        pH-&gt;iSvrHandle=aServer.Handle();    // store handle
        }
    return r;
    }</pre>
 <pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-9527E73D-FAFA-519A-80F1-FD10E5AF3D40"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-9527E73D-FAFA-519A-80F1-FD10E5AF3D40"><!-- --></a>struct SHandles
    {
    TInt iDevHandle;
    TInt iSvrHandle;
    };
</pre>
 <pre class="codeblock" id="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-6C88ED9C-E8D1-5901-BE00-F52130F3509C"><a name="GUID-A7ECF51F-F96A-5251-A71F-2F269C8C0664__GUID-6C88ED9C-E8D1-5901-BE00-F52130F3509C"><!-- --></a>SHandles* GetHandles()
    {
    // Return a pointer to the SHandles structure for this thread
    // If it doesn't exist, attempt to create it

    // This function zeros a newly allocated memory block
    return (SHandles*)HalInternal::Tls(sizeof(SHandles));
    }
</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-05DAF5EF-6F2E-562D-9DB1-0985AD4A1E48.html" title="Describes the steps to implement a port of the User-Side Hardware Abstraction component.">Port Implementation Tutorial</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>