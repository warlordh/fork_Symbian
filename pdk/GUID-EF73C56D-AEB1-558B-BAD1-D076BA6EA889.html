<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Impact of Data Paging on User Side Code Guide"/>
<meta name="abstract" content="Explains cases in which data paging degrades the performance of user side code and sets out strategies to mitigate these effects."/>
<meta name="description" content="Explains cases in which data paging degrades the performance of user side code and sets out strategies to mitigate these effects."/>
<meta name="DC.Relation" scheme="URI" content="GUID-6381BC82-3060-5023-8221-79B18CCB2CDB.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F78B7BF9-5FDD-4EF8-A921-71CCBB830A99.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F123D574-44DE-528A-806C-DB64229BCEA2.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2B7D04D9-98DE-5284-836D-01DB4FA8949D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6381BC82-3060-5023-8221-79B18CCB2CDB.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E21E7992-607A-5A49-B022-189ECA9E76D1.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-BDB847A2-557A-5902-AA6D-C1AE10D8E493.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B35A70D2-1BC8-51DE-95BF-F315DB394582.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Impact of Data Paging on User Side Code Guide</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2387995 id2388574 id2388657 id2388671 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-F78B7BF9-5FDD-4EF8-A921-71CCBB830A99.html" title="The device driver framework and how to implement a device driver.">Device Driver Guide</a> &gt; <a href="GUID-F123D574-44DE-528A-806C-DB64229BCEA2.html">Demand Paging</a> &gt; <a href="GUID-2B7D04D9-98DE-5284-836D-01DB4FA8949D.html">Writable Data Paging</a> &gt; <a href="GUID-6381BC82-3060-5023-8221-79B18CCB2CDB.html" title="Contains guides that describe various aspects of writable data paging in more detail.">Writable Data Paging Guides</a> &gt; </div>
<h1 class="topictitle1">Impact
of Data Paging on User Side Code Guide</h1>
<div><p>Explains cases in which data paging degrades the performance of
user side code and sets out strategies to mitigate these effects. </p>

<div class="section" id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-FCD37C40-C547-483C-AB65-B6465955DE70"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-FCD37C40-C547-483C-AB65-B6465955DE70"><!-- --></a><h2 class="sectiontitle">Purpose</h2> <p>Data paging degrades the performance of
user side code. This document describes strategies to mitigate these effects.
It is intended for application developers whose code uses device drivers. </p>
 <p><strong>Intended Audience:</strong> </p>
 <p>Application developers writing modules
which involve device drivers. </p>
 </div>

<div class="section" id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-2F31D78F-C2E9-42E1-B489-46B69A2A0AED"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-2F31D78F-C2E9-42E1-B489-46B69A2A0AED"><!-- --></a><h2 class="sectiontitle">Mitigating the impact of data paging on user side code</h2> <p>Data
paging is a technique which increases the size of virtual RAM by holding data
on external media and read into physical RAM when accessed. The technique
trades off an increase in available RAM against decreased performance. Developers
must allow for the impact on performance and aim to mitigate it by using the
practices described in this document. </p>
 <p>Data paging is mainly a property
of processes. Processes can be configured to be paged or unpaged when they
are built or put into a ROM image. Threads and the data which they use inherit
the data paging configuration of the creating process and that configuration
can be modified at the level of the thread or the individual items of data. </p>
 <p><strong>Thread scheduling</strong> </p>
 <p>When a platform uses data paging there is
a higher risk of delays, timing-related defects and race conditions. </p>
 <p>When
a thread accesses paged memory, the required page may be paged in (actually
in RAM) or paged out (stored in media). If it is paged out, a page fault results,
slowing performance by a factor of thousands and sometimes up to a million.
The delay can also expose latent race conditions and timing-related defects
in existing code: for instance an asynchronous request to a server may appear
to complete synchronously, returning control to the client before the request
has completed with incorrect behavior as a result. </p>
 <p>The cure for this
problem is to configure data paging when chunks, heaps and threads are created. </p>
 <p>When
creating a thread of class <a href="GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5.html"><span class="apiname">RThread</span></a> you can call the creating
function <a href="GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5.html#GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5__GUID-6C840907-C3F7-34B7-97DB-CEDBA68EA277"><span class="apiname">RThread::Create()</span></a> with an argument of class <a href="GUID-1D0D14AD-43CF-3B52-AD8D-641F75B8098C.html"><span class="apiname">TThreadCreateInfo</span></a> as
argument. You use an instance of this class to configure the data paging attributes
to one of </p>
 <ul>
<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-E4F9029C-DEF9-5305-8006-BC56EA509F72"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-E4F9029C-DEF9-5305-8006-BC56EA509F72"><!-- --></a><p> <a href="GUID-B1A7F7DF-9A43-3C7E-8602-503B7ED5A1A1.html"><span class="apiname">EUnspecified</span></a> (the
thread inherits the paging attributes of the creating process), </p>
 </li>

<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-FC939BA1-0822-53AB-B5BC-26CCD4D77075"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-FC939BA1-0822-53AB-B5BC-26CCD4D77075"><!-- --></a><p> <a href="GUID-7B309F53-DF64-389A-8D74-394D9F16E532.html"><span class="apiname">EPaged</span></a> (the
thread will data page its stack and heap), or </p>
 </li>

<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-973FCF18-4D8D-56F2-8263-46BF47B179B5"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-973FCF18-4D8D-56F2-8263-46BF47B179B5"><!-- --></a><p> <a href="GUID-1F1551D0-77AE-33CE-940B-A9E0C4D4881B.html"><span class="apiname">EUnpaged</span></a> (the
thread will not data page its stack and heap). </p>
 </li>

</ul>
 <p>When creating a chunk of class <a href="GUID-326A2F4D-0E99-31C0-A35D-E8BF45913F07.html"><span class="apiname">RChunk</span></a> you can
call the creating function <a href="GUID-326A2F4D-0E99-31C0-A35D-E8BF45913F07.html#GUID-326A2F4D-0E99-31C0-A35D-E8BF45913F07__GUID-EA7C4105-6D64-3F87-83B6-C97DCDEDB94A"><span class="apiname">RChunk::Create()</span></a> with an argument
of class <a href="GUID-51F7DBCF-BFB6-31F9-8882-5D263A1AD4B4.html"><span class="apiname">TChunkCreateInfo</span></a> as argument. You use an instance
of this class to configure the data paging attributes to one of </p>
 <ul>
<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-A5BF2717-0814-5CBD-9EA5-296890B633C6"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-A5BF2717-0814-5CBD-9EA5-296890B633C6"><!-- --></a><p> <a href="GUID-B1A7F7DF-9A43-3C7E-8602-503B7ED5A1A1.html"><span class="apiname">EUnspecified</span></a> (the
chunk inherits the paging attributes of the creating process), </p>
 </li>

<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-FAC297A5-27A3-5BA3-94CA-64D548368132"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-FAC297A5-27A3-5BA3-94CA-64D548368132"><!-- --></a><p> <a href="GUID-7B309F53-DF64-389A-8D74-394D9F16E532.html"><span class="apiname">EPaged</span></a> (the
chunk will be data paged), or </p>
 </li>

<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-86BE6A49-1B9B-59C7-A90B-BF7498138714"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-86BE6A49-1B9B-59C7-A90B-BF7498138714"><!-- --></a><p> <a href="GUID-1F1551D0-77AE-33CE-940B-A9E0C4D4881B.html"><span class="apiname">EUnpaged</span></a> (the
chunk will not be data paged). </p>
 </li>

</ul>
 <p>The <a href="GUID-326A2F4D-0E99-31C0-A35D-E8BF45913F07.html"><span class="apiname">RChunk</span></a> class also has a function <a href="GUID-D848C0BA-F931-3F95-96B3-B64133FD5928.html"><span class="apiname">IsPaged()</span></a> to
test whether a chunk is data paged. </p>
 <p>When creating a chunk heap of
class <a href="GUID-C5D0C7E7-061F-3BA5-AE24-B83237684B01.html"><span class="apiname">UserHeap</span></a> you can call the creating function <a href="GUID-C5D0C7E7-061F-3BA5-AE24-B83237684B01.html#GUID-C5D0C7E7-061F-3BA5-AE24-B83237684B01__GUID-18A6B89B-4844-37E5-B46E-32188760A8C0"><span class="apiname">UserHeap::ChunkHeap()</span></a> with
an argument of class <a href="GUID-3DCB92FB-9C74-3B73-B229-BF7944087EE9.html"><span class="apiname">TChunkHeapCreateInfo</span></a> as argument.
You use an instance of this class to configure the data paging attributes
to one of </p>
 <ul>
<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-EC970D3F-05F3-52AD-A22C-A512209569A9"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-EC970D3F-05F3-52AD-A22C-A512209569A9"><!-- --></a><p> <a href="GUID-B1A7F7DF-9A43-3C7E-8602-503B7ED5A1A1.html"><span class="apiname">EUnspecified</span></a> (the
heap inherits the paging attributes of the creating process), </p>
 </li>

<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-66682630-3718-5FE2-AFCC-CB6697DFFC58"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-66682630-3718-5FE2-AFCC-CB6697DFFC58"><!-- --></a><p> <a href="GUID-7B309F53-DF64-389A-8D74-394D9F16E532.html"><span class="apiname">EPaged</span></a> (the
heap will be data paged), or </p>
 </li>

<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-6E922E2B-31EF-58C9-9083-C4590BA11FE2"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-6E922E2B-31EF-58C9-9083-C4590BA11FE2"><!-- --></a><p> <a href="GUID-1F1551D0-77AE-33CE-940B-A9E0C4D4881B.html"><span class="apiname">EUnpaged</span></a> (the
heap will not be data paged). </p>
 </li>

</ul>
 <p><strong>Inter-process
communication</strong> </p>
 <p>Data paging impacts on inter-process communication
when a non-paged server accesses paged memory passed from a client. If the
memory being accessed is not paged in, unpredictable delays may occur, and
when the server offers performance guarantees to its clients, all the other
clients will be affected as well. There are three separate solutions to this
problem: </p>
 <ul>
<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-86BB0F84-2660-5682-AA4E-B6922AF54F5F"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-86BB0F84-2660-5682-AA4E-B6922AF54F5F"><!-- --></a><p>pinning memory automatically, </p>
 </li>

<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-4B6D47CE-9585-5CFF-AFE2-8987FAF9899A"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-4B6D47CE-9585-5CFF-AFE2-8987FAF9899A"><!-- --></a><p>pinning memory as requested
by the client, and </p>
 </li>

<li id="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-09AC4F78-64A0-5572-AA8A-791176807734"><a name="GUID-EF73C56D-AEB1-558B-BAD1-D076BA6EA889__GUID-09AC4F78-64A0-5572-AA8A-791176807734"><!-- --></a><p>using separate threads
for paged and unpaged clients. </p>
 </li>

</ul>
 <p>Pinning paged memory means paging it into the RAM cache (if it is
not already present) and preventing it from being paged out until it is unpinned. </p>
 <p>You
can set a server so that all memory passed to it by a client call gets pinned
for the duration of the call. You do so by calling the function <a href="GUID-E5D22145-1B40-39F4-9242-72B64A0FB29C.html"><span class="apiname">SetPinClientDescriptors()</span></a> of
a <a href="GUID-8E316AC4-4676-301A-9A23-659E83AA1D1C.html"><span class="apiname">CServer2</span></a> object after construction but before calling <a href="GUID-8E316AC4-4676-301A-9A23-659E83AA1D1C.html#GUID-8E316AC4-4676-301A-9A23-659E83AA1D1C__GUID-3B6AC8A4-251C-39A7-BFB2-30AD454DF590"><span class="apiname">CServer2::Start()</span></a> for
the first time. This method is easy but wasteful, as all memory gets pinned
not just the data needs and the performance of the paging cache is impacted.
Automatic pinning should therefore only be used as a last resort. </p>
 <p>You
can pin specified items of memory at the request of the client by calling
the <a href="GUID-349EE025-F5DB-3430-9BA9-9FBF685F6B07.html"><span class="apiname">PinArgs()</span></a> function of the <a href="GUID-4AD02F14-1142-372F-9D11-224595932034.html"><span class="apiname">TIpcArgs</span></a> class.
This is the more efficient method as it allows fine-grained control over what
memory is pinned. </p>
 <p>Separate threads for paged and unpaged clients. </p>
 <p><strong>Thread performance</strong> </p>
 <p>The set of pages accessed by a thread over
a given period of time is called its working set. If the working set is paged,
the performance of the thread degrades as the working set increases. When
working with paged memory it is therefore important to minimise the working
set. </p>
 <p>The main solution to this problem is to choose data structures
with high locality, that is data structure residing in single or adjacent
pages. An example of this is a preference for arrays rather than linked lists,
since arrays are usually in adjacent pages while the elements of linked lists
may reside on multiple pages. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-6381BC82-3060-5023-8221-79B18CCB2CDB.html" title="Contains guides that describe various aspects of writable data paging in more detail.">Writable Data Paging Guides</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-E21E7992-607A-5A49-B022-189ECA9E76D1.html" title="Overview of demand paging when applied to code paging.">Code Paging
Overview</a></div>
<div><a href="GUID-BDB847A2-557A-5902-AA6D-C1AE10D8E493.html" title="Code paging is the application of demand paging to executable code.">Code Paging
Guide</a></div>
<div><a href="GUID-B35A70D2-1BC8-51DE-95BF-F315DB394582.html" title="Demand paging is a technique where content appears to be present in RAM, but may in fact be stored on some external media and is transparently loaded when needed.">Demand Paging
Overview</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>