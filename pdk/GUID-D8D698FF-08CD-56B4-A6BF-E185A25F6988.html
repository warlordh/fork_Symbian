<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="Retrieving and modifying attachments to messages"/>
<meta name="abstract" content="The messaging framework allows you to retrieve and modify attachments to messages."/>
<meta name="description" content="The messaging framework allows you to retrieve and modify attachments to messages."/>
<meta name="DC.Relation" scheme="URI" content="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B394A824-8745-505E-8429-8B9B6D418387.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-DD27A452-8B0F-5C6D-A2E6-FC21145468B6.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1963A487-D6A7-4225-8D0C-EC5FAB746854.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-54AB166A-8B24-5065-92AD-5FC1BF3ED89C.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Retrieving and modifying attachments to messages</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2404348 id2404397 id2404434 id2404652 id2404730 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html">Messaging Middleware Guide</a> &gt; <a href="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html">Messaging Framework</a> &gt; <a href="GUID-B394A824-8745-505E-8429-8B9B6D418387.html">Message Server and Store</a> &gt; <a href="GUID-DD27A452-8B0F-5C6D-A2E6-FC21145468B6.html">Message Server and Store Tutorials</a> &gt; <a href="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html" title="The MMsvAttachmentManager interface is used to create, add, modify and remove message attachments.">Messaging Attachments Tutorial</a> &gt; </div>
<h1 class="topictitle1">Retrieving
and modifying attachments to messages</h1>
<div><p>The messaging framework allows you to retrieve and modify attachments
to messages. </p>

<div class="section" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-15885C98-AB41-5250-BC54-8FD519FCC2DB"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-15885C98-AB41-5250-BC54-8FD519FCC2DB"><!-- --></a><p>Attachments may
be retrieved and modified after they have been added to a message. </p>
 </div>

<a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-8EC42591-32C1-5790-B644-E9DD82F4C767"><!-- --></a><ol id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-8EC42591-32C1-5790-B644-E9DD82F4C767"><li class="stepexpand" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-7FB4A7D1-965F-5E58-9606-0B2BBDFA9781"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-7FB4A7D1-965F-5E58-9606-0B2BBDFA9781"><!-- --></a><span>Get the details
of the message to which you want to add an attachment using <a href="GUID-85BBE389-81F7-3E2F-A789-446D9BE2CC49.html#GUID-85BBE389-81F7-3E2F-A789-446D9BE2CC49__GUID-1864B96D-CB22-3EE1-8E73-023F12C68CB0"><span class="apiname">CMsvEntry::EditStoreL()</span></a>. </span>
 This function returns <a href="GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE.html"><span class="apiname">CMsvStore</span></a> in writable mode. 
</li>
<li class="stepexpand" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-BF15138A-9F76-5BD0-A72F-8A125B011CCE"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-BF15138A-9F76-5BD0-A72F-8A125B011CCE"><!-- --></a><span>Get an <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html"><span class="apiname">MMsvAttachmentManager</span></a> attachment
manager for the message entry, using <a href="GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE.html#GUID-8CB90FA2-A6CF-3FA2-81FF-7D22EFD9C2CE__GUID-73CE27F3-855B-3F87-AE11-4B4F2B8F8825"><span class="apiname">CMsvStore::AttachmentManagerL()</span></a>. </span>
</li>
<li class="stepexpand" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-A7041D09-6EA5-54CE-A972-E0D4993C26FC"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-A7041D09-6EA5-54CE-A972-E0D4993C26FC"><!-- --></a><span/><br/>
 Find how many attachments a message entry has using the <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD__GUID-BAA9F4CF-E7F8-3644-8C0D-4387BAB7C432"><span class="apiname">MMsvAttachmentManager::AttachmentCount()</span></a> function. 
</li>
<li class="stepexpand" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-A58AFC6B-ADBA-5D3F-824F-A9EBDEBB2A0A"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-A58AFC6B-ADBA-5D3F-824F-A9EBDEBB2A0A"><!-- --></a><span/><br/>
 Get attachment attributes using the appropriate <a href="GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F.html"><span class="apiname">CMsvAttachment</span></a> functions.
. 
</li>
<li class="stepexpand" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-5574C96C-2E2B-55CC-AE8A-BF44CFD76D4B"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-5574C96C-2E2B-55CC-AE8A-BF44CFD76D4B"><!-- --></a><span/><br/>
 Get attachment information using the <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD__GUID-256088DF-2FD0-32D9-8EEE-EFAC65A8E9AC"><span class="apiname">MMsvAttachmentManager::GetattachmentL()</span></a> function. 
</li>
</ol>

<div class="example" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-94880E70-F23F-5F18-8E0F-A29B99C96E4B"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-94880E70-F23F-5F18-8E0F-A29B99C96E4B"><!-- --></a><h2 class="sectiontitle">Retrieval and
modification example</h2> <p>The following code uses the <a href="GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD.html#GUID-4E2B0CEA-1EDA-3452-895D-3CE1B59FD8FD__GUID-BAA9F4CF-E7F8-3644-8C0D-4387BAB7C432"><span class="apiname">MMsvAttachmentManager::AttachmentCount()</span></a> and <a href="GUID-C7C9E584-2E24-3B65-9E37-F4085F9F7CDB.html"><span class="apiname">GetattachmentL()</span></a> functions to get attachment information. It then calls the various <a href="GUID-8C2B9B89-D6B7-3622-AF26-658F53BCB70F.html"><span class="apiname">CMsvAttachment</span></a> accessor
functions to get the attachment attributes, and to access the attachment file
itself: </p>
 <pre class="codeblock" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-FEEB49D7-E9D4-59E7-B9EC-CF87DA3140FE"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-FEEB49D7-E9D4-59E7-B9EC-CF87DA3140FE"><!-- --></a>void CFoo::GetAttachmentInfoL(MMsvAttachmentManager&amp; attManager)
    {
    // get number of attachments
    TInt numAttach = attManager.AttachmentCount();
    if ( numAttach == 0 ) 
       { // no attachments
       return;
       }

    // Get attachment attributes for the first attachment (index 0)
    CMsvAttachment* attachInfo = attManager.GetAttachmentInfoL(0);

    // Ownership of attachInfo is transferred to the caller - so push it onto the CleanupStack
    CleanupStack::PushL(attachInfo);
    
    // Get attachment's name 
    const TDesC&amp; attachName = attachInfo-&gt;AttachmentName();

    // Get attachment's size 
    TInt attachSize = attachInfo-&gt;Size();
    
    // Get attachment's type 
    CMsvAttachment::TMsvAttachmentType attachType = attachInfo-&gt;Type();
    
    // Get MIME type 
    const TDesC8&amp; attachMType = attachInfo-&gt;MimeType();
    
    // Get completeness flag   
    TBool complete = attachInfo-&gt;Complete(); 

    ...

    // Destroy attachInfo when finished.  
    CleanupStack::PopAndDestroy(attachInfo);
    }</pre>
 <p>You can modify attachment information for an existing
attachment using the <a href="GUID-ECE58326-D542-3C73-AE6F-959DCF64A875.html"><span class="apiname">ModifyattachmentL()</span></a> function. The
attachment information object passed in replaces the existing attachment information
object. </p>
 <pre class="codeblock" id="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-DDA08731-A761-5D7F-91DF-41DBC0D16583"><a name="GUID-D8D698FF-08CD-56B4-A6BF-E185A25F6988__GUID-DDA08731-A761-5D7F-91DF-41DBC0D16583"><!-- --></a>void CFoo::ModifyAttachmentInfoL(CMsvEntry&amp; aEntry)
    {
    // Get the store
    CMsvStore* store = aEntry.EditStoreL();
    CleanupStack::PushL(store);
    
    MMsvAttachmentManager&amp; attManager = store-&gt;AttachmentManagerL();
    
    // Get number of attachments
    TInt numAttach = attManager.AttachmentCount();
    if ( numAttach == 0 ) 
       { // no attachments
       CleanupStack::PopAndDestroy() ; // store
       return;
       }
       
    // Get attachment attributes for the first attachment (index 0)
    CMsvAttachment* attachment = attManager.GetAttachmentInfoL(0);
    CleanupStack::PushL( attachment ) ;
    
    // Rename the file
    TRequestStatus status;
    _LIT(KFileName, "hello.txt");
    
    attachment-&gt;SetAttachmentNameL(KFileName);
    attachment-&gt;SetComplete(EFalse);
    
    // Modify attachment info
    attManager.ModifyAttachmentInfoL(attachment, status);
    
    // Wait for request to complete
    User::WaitForRequest(status);
    attachment-&gt;SetComplete(ETrue);  
    
    store-&gt;CommitL();

    CleanupStack::PopAndDestroy(2, store); // attachment, store
    }</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-3FD2EADD-DC46-516D-B88D-DA523F51C5E3.html" title="The MMsvAttachmentManager interface is used to create, add, modify and remove message attachments.">Messaging Attachments Tutorial</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-54AB166A-8B24-5065-92AD-5FC1BF3ED89C.html">Messaging
Framework Overview</a></div>
</div>
<div class="relinfo"><strong>Related information</strong><br/>
<div><a href="GUID-1963A487-D6A7-4225-8D0C-EC5FAB746854.html">Messaging
Attachments Tutorial</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>