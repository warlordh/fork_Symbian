<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="Setting Management Policies"/>
<meta name="abstract" content="A management policy signifies the security check required to perform management operations on the key. The management policy associated with the key is of type TSecurityPolicy. The policy can be set to check capabilities or the Vendor ID associated with the calling process. The calling process should have a WriteUserData capability."/>
<meta name="description" content="A management policy signifies the security check required to perform management operations on the key. The management policy associated with the key is of type TSecurityPolicy. The policy can be set to check capabilities or the Vendor ID associated with the calling process. The calling process should have a WriteUserData capability."/>
<meta name="DC.Relation" scheme="URI" content="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C3290344-486B-554D-97FC-42DF48E150AA.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-39B459CD-8210-59B5-95F4-85CE36676735.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-695FCEB8-EA04-5C1C-A197-648275BA0281.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Setting Management Policies</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7"><a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2858558 id2859383 id2859414 id2859476 id2859513 id2859527 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html">OS Security Guide</a> &gt; <a href="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html">Crypto Services</a> &gt; <a href="GUID-C3290344-486B-554D-97FC-42DF48E150AA.html">Certificate and Key Management</a> &gt; <a href="GUID-39B459CD-8210-59B5-95F4-85CE36676735.html">Unified Stores</a> &gt; <a href="GUID-695FCEB8-EA04-5C1C-A197-648275BA0281.html" title="The Unified Keystore is responsible for managing cryptographic keys.">Unified Keystore</a> &gt; <a href="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html" title="These tutorials explain the tasks that can be performed by client applications using the services provided by the unified keystore.">Unified Keystore Tutorials</a> &gt; </div>
<h1 class="topictitle1">Setting
Management Policies</h1>
<div><p>A management policy signifies the security check required to perform
management operations on the key. The management policy associated with the
key is of type <samp class="codeph">TSecurityPolicy</samp>. The policy can be set to
check capabilities or the Vendor ID associated with the calling process. The
calling process should have a <samp class="codeph">WriteUserData</samp> capability. </p>

<div class="section" id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-2266077D-AFAE-44ED-B4D2-580016A7ADC6"><a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-2266077D-AFAE-44ED-B4D2-580016A7ADC6"><!-- --></a><p>The following steps explain the process of setting a management
policy for a key:</p>
</div>

<a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-2D99C179-7CBA-54C4-9111-1F57B3E26C95"><!-- --></a><ol id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-2D99C179-7CBA-54C4-9111-1F57B3E26C95"><li class="stepexpand" id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-458FDF48-670D-56B0-9220-E70FA3EB425C"><a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-458FDF48-670D-56B0-9220-E70FA3EB425C"><!-- --></a><span>Create a file system
session using an <samp class="codeph">RFs</samp> object. </span>
</li>
<li class="stepexpand" id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-1A8A68D1-9928-57A2-B5B7-75CF911DA4CA"><a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-1A8A68D1-9928-57A2-B5B7-75CF911DA4CA"><!-- --></a><span/><br/>
 Create an object of type CUnifiedKeyStore using <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-C7A96153-4179-3B3F-878D-1EAA64A98D39"><span class="apiname">CUnifiedKeyStore::NewL()</span></a> or <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-217FBB3B-CEF5-36F2-A612-EDDA0982053C"><span class="apiname">CUnifiedKeyStore::NewLC()</span></a>. 
</li>
<li class="stepexpand" id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-AF7853D6-1288-55E5-8DC3-7F3862DB70B7"><a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-AF7853D6-1288-55E5-8DC3-7F3862DB70B7"><!-- --></a><span/><br/>
 Initialise the member functions and keystore using the asynchronous
function <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-6C5D732C-1FD1-3EF0-AC90-87690F891B8D"><span class="apiname">CUnifiedKeyStore::Initialize()</span></a>. 
</li>
<li class="stepexpand" id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-62AEB118-FA57-56CF-8C0D-241D1DDD2B30"><a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-62AEB118-FA57-56CF-8C0D-241D1DDD2B30"><!-- --></a><span/><br/>
 List all keys in the keystore using the <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-8B22E1BC-D779-32DC-9C0A-CA37E4C0A81B"><span class="apiname">CUnifiedKeyStore::List()</span></a> function.
Retrieve the handle of the key for which the management policy needs to be
set. 
</li>
<li class="stepexpand" id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-677C109A-AFB9-585C-8949-E1F1E046CF24"><a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-677C109A-AFB9-585C-8949-E1F1E046CF24"><!-- --></a><span/><br/>
 Set the management policy for the key using the <a href="GUID-818689D6-EB99-382E-A435-D9C6C5D464DE.html#GUID-818689D6-EB99-382E-A435-D9C6C5D464DE__GUID-E5962EE8-9B11-3051-AD85-0F7301E18855"><span class="apiname">CUnifiedKeyStore::SetManagementPolicy()</span></a> function. 
</li>
</ol>

<div class="section" id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-23DEBEC2-E179-4E83-AA37-EE3E4237CB62"><a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-23DEBEC2-E179-4E83-AA37-EE3E4237CB62"><!-- --></a><p>Management policy is set for the selected key. </p>
 </div>

<div class="example"><h2 class="sectiontitle">Example</h2> <p>The following code snippet shows how to
set management policy for a key. </p>
 <pre class="codeblock" id="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-A8AC1E30-C540-55A9-B12D-C2A46DC8F34A"><a name="GUID-60141F31-6061-5C65-809D-FE7A4F8414F7__GUID-A8AC1E30-C540-55A9-B12D-C2A46DC8F34A"><!-- --></a>//Create a file system session object
RFs iFs;
CleanupClosePushL(&amp;iFs);


...


// Initialise the keystore and member functions
CUnifiedKeyStore* keyStore = CUnifiedKeyStore::NewL(fs);
keyStore-&gt;Initialize(iStatus); //iStatus is a TRequestStatus object


...



// Retrieve the handle of the key for which management policy has to be set
TCTKeyAttributeFilter  filter.iUsage = EPKCS15UsageAll;
RPointerArray&lt;CCTKeyInfo&gt; iKeys; // This variable will contain the result of the set management policy operation
keyStore-&gt;List(iKeys, filter, iStatus);


...



// Retrieve the key handle of the appropriate key
_LIT(KLabel,”keylabel”);

// Select the key with the label you are looking for
TInt keyIndex;
for (TInt j = 0; j &lt; iKeys.Count(); j++)
    {
    if (iKeys[j]-&gt;Label() == KLabel) 
        {
        keyIndex = j;
        break;
        }
    }


...



// Set the management policy

TSecurityPolicy managementPolicy;
TUint vendorId = 0x70000007;
TCapability caps[3];
caps[0] = ECapabilityWriteUserData;
caps[1] = ECapabilityDRM;
caps[2] = ECapabilityReadUserData;

managementPolicy = TSecurityPolicy(TSecureId(secureId), caps[0], caps[1], caps[2]);
keyStore-&gt;SetManagementPolicy(*iKeys, managementPolicy, iStatus);


//Clean up
CleanupStack::PopAndDestroy(); // iFs</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-6C6AED40-D5B3-5613-8F92-FD2CB711AE54.html" title="These tutorials explain the tasks that can be performed by client applications using the services provided by the unified keystore.">Unified Keystore Tutorials</a></div>
</div>
<div class="relinfo reltasks"><strong>Related tasks</strong><br/>
<div><a href="GUID-EFF8D1A1-00D5-5F96-8285-414DC0044AB8.html" title="A use policy denotes the security check required to use the key. The use policy associated with the key is of type TSecurityPolicy. The policy can be set to check capabilities or the Secure ID associated with the calling process. The calling process should have a WriteUserData capability.">Setting Use
Policies</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>