<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Supplier API Tutorial"/>
<meta name="abstract" content="The Supplier API handles the delivery and transformation of Digital Rights Management (DRM) protected content. It transforms imported DRM content in a device into a secure format for storage."/>
<meta name="description" content="The Supplier API handles the delivery and transformation of Digital Rights Management (DRM) protected content. It transforms imported DRM content in a device into a secure format for storage."/>
<meta name="DC.Relation" scheme="URI" content="GUID-8F457DE7-DAC2-56DF-8D6D-76D86584CC79.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E6C91CF2-A616-5E52-8BB2-630C42C8D540.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7EE46FD9-DC9E-5C1F-9AC5-48F5212AF0CA.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-8F457DE7-DAC2-56DF-8D6D-76D86584CC79.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-84B6389A-55CC-53EB-8725-65F753FD7217.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Supplier API Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2858558 id2858692 id2858712 id2858786 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html">OS Security Guide</a> &gt; <a href="GUID-E6C91CF2-A616-5E52-8BB2-630C42C8D540.html">Content Management</a> &gt; <a href="GUID-7EE46FD9-DC9E-5C1F-9AC5-48F5212AF0CA.html">Content Access Framework</a> &gt; <a href="GUID-8F457DE7-DAC2-56DF-8D6D-76D86584CC79.html">Content Access Framework Tutorials</a> &gt; </div>
<h1 class="topictitle1">Supplier
API Tutorial </h1>
<div><p>The Supplier API handles the delivery and transformation of Digital
Rights Management (DRM) protected content. It transforms imported DRM content
in a device into a secure format for storage. </p>

<p>Supplier API comprises of <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CSupplier</span></a> and <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CImportFile</span></a>. </p>

<div class="section" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-17D59A99-1491-513C-BC41-BB4ECA22B931"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-17D59A99-1491-513C-BC41-BB4ECA22B931"><!-- --></a><h2 class="sectiontitle">Introduction</h2> <p>The
Supplier API allows Content Access (CA) agents to publish the supported content
MIME types that can be handled by Content Access Framework (CAF). When a file
arrive on a device (for example, through a browser), applications check for
its MIME types and import the file into CAF. The agent transforms the file
into a secure format for using it in the device. </p>
 <p>The transformation
may not be required because the files arrive in a format fit for use in the
device. However, some agents might require to protect (encrypt) the content
at the moment it arrives, and Supplier API manages this protection. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Procedure</h2><p>The following steps illustrate how to
use Supplier API: </p>
 <a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-A2CD1699-28D5-530C-9552-59277385E353"><!-- --></a><ol id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-A2CD1699-28D5-530C-9552-59277385E353">
<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-DF9A5E76-B282-568C-A5A1-654A88698B0B"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-DF9A5E76-B282-568C-A5A1-654A88698B0B"><!-- --></a><p><a href="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C.html#GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-7501DF89-76B6-52A2-AD3A-6391832F3C5A">Start a new import session</a>  </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-2E539668-4A7B-5F55-83D2-1A092ECBCE7E"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-2E539668-4A7B-5F55-83D2-1A092ECBCE7E"><!-- --></a><p><a href="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C.html#GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-74C3F4CF-2D85-568D-B935-B93E1F857F78">Prepare to import a file</a>  </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-CAAA7C49-B8FD-51CF-9973-2676B3E01837"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-CAAA7C49-B8FD-51CF-9973-2676B3E01837"><!-- --></a><p><a href="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C.html#GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-4023F3AD-6CA3-59E3-8148-F9D76480A05E">Import the file</a>  </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-5D182213-F5AF-5052-BDB4-D940F61BCDFA"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-5D182213-F5AF-5052-BDB4-D940F61BCDFA"><!-- --></a><p><a href="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C.html#GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-52D00B05-3EB5-5C10-A3BC-8AC12B968FF0">Transfer the file to the Content Access Agent</a>  </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-3078BA87-4D9D-5707-8F7F-107EFD372CD0"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-3078BA87-4D9D-5707-8F7F-107EFD372CD0"><!-- --></a><p><a href="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C.html#GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-5436E5BC-793C-5373-B9A9-404D6ECC2EBA">Complete the import</a>  </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-A74B75B3-3A21-5BC0-A24C-186A915C5EAC"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-A74B75B3-3A21-5BC0-A24C-186A915C5EAC"><!-- --></a><p><a href="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C.html#GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-EDAB286B-FBC9-5DAF-A466-7B07F2A2FC29"> Check the output file, if necessary</a>. </p>
 </li>

</ol>
 </div>

<div class="section" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-7501DF89-76B6-52A2-AD3A-6391832F3C5A"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-7501DF89-76B6-52A2-AD3A-6391832F3C5A"><!-- --></a><h2 class="sectiontitle">Start a new
import session</h2> <p>Use <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CSupplier</span></a> to
import files into CAF. </p>
 <p>Create an instance of <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CSupplier</span></a> to
start an import session and set the output path according to an application's
requirements. </p>
 <pre class="codeblock" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-BCD346E6-9077-546A-81DA-E4CE1706CB88"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-BCD346E6-9077-546A-81DA-E4CE1706CB88"><!-- --></a>// Create Supplier 
CSupplier *mySupplier = CSupplier::NewL(); 

// Set output path for DRM protected content 
_LIT(KPath,"C:\\myOutputFiles");
mySupplier-&gt;SetOutputDirectoryL(KPath());</pre>
<div class="note"><span class="notetitle">Note:</span> <ul>
<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-25C5C79D-B6C9-59FE-82D7-A5A04950D94A"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-25C5C79D-B6C9-59FE-82D7-A5A04950D94A"><!-- --></a><p>It is not necessary
to set the output path if the application provides output file handles to
the CA agent. </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-B4029DD4-9A76-5647-9DBB-18A2D64E6089"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-B4029DD4-9A76-5647-9DBB-18A2D64E6089"><!-- --></a><p> <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CSupplier</span></a> uses
its <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CAgentResolver</span></a> member
to determine which CA agent must be used to import each file. For more information,
see <a href="GUID-9993D750-9116-55B2-812A-7A92C50F467F.html">Apparc Recognizer
for CAF</a>. </p>
 </li>

</ul>
</div>
 </div>

<div class="section" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-74C3F4CF-2D85-568D-B935-B93E1F857F78"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-74C3F4CF-2D85-568D-B935-B93E1F857F78"><!-- --></a><h2 class="sectiontitle">Prepare to
import the file</h2> <p>Preparing to import a DRM protected file includes
the following steps: </p>
 <a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-5EEA53C8-1B3F-50A9-8C22-8D61B11CE28B"><!-- --></a><ol id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-5EEA53C8-1B3F-50A9-8C22-8D61B11CE28B">
<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-960C7AB2-5241-521C-BBBE-5B09294F43C0"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-960C7AB2-5241-521C-BBBE-5B09294F43C0"><!-- --></a><p>Checking for supported
MIME types </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-C949EF2E-7B80-5E30-9D0A-AD912579E595"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-C949EF2E-7B80-5E30-9D0A-AD912579E595"><!-- --></a><p>Creating a <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CMetaDataList</span></a> object </p>
 </li>

</ol>
 <p><strong>Checking for supported MIME types</strong> </p>
 <p>Before importing
a file into the content access framework, an application must check if the
MIME type of the file is supported. Each agent publishes a list of supported
MIME types and the list is configured in the agent's resource file. Use <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CSupplier::IsImportSupported()</span></a> to
check the list of supported MIME type of files. </p>
 <pre class="codeblock" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-EB6353F1-D53C-578A-BE4C-B569C4719960"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-EB6353F1-D53C-578A-BE4C-B569C4719960"><!-- --></a>if(!mySupplier-&gt;IsImportSupported(myMimeType)) 
    { 
    return; 
    }</pre>
 <p><strong>Creating a CMetaDataList object </strong> </p>
 <p>The <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CMetaDataList</span></a> object stores information
associated with an import file, and it is passed to the CA agent. For example,
OMA DRM 1.0 files might contain HTTP header<samp class="codeph">              X-Oma-Drm-Separate-Delivery</samp>,
which informs the agent about the time duration within which rights are expected
for the content. </p>
 <p>The following code snippet shows creating a <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CMetaDataList</span></a> object and information
about the duration (for example, 12 seconds) in which rights are expected </p>
 <pre class="codeblock" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-A371B670-1E6D-5513-8D5D-D6559170ED1F"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-A371B670-1E6D-5513-8D5D-D6559170ED1F"><!-- --></a>// Create meta-data array 
CMetaDataArray *metaDataArray = new (ELeave) CMetaDataArray(); 
CleanupStack::PushL(metaDataArray);

// Add any useful information we can think of.... 
metaDataArray-&gt;AddL(_L("Content Type"),_L("application/vnd.oma.drm.dm")); 
metaDataArray-&gt;AddL(_L("X-Oma-Drm-Separate-Delivery"),_L("12"));</pre>
 </div>

<div class="section" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-4023F3AD-6CA3-59E3-8148-F9D76480A05E"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-4023F3AD-6CA3-59E3-8148-F9D76480A05E"><!-- --></a><h2 class="sectiontitle">Import a file</h2> <a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-8FC14D51-FB3B-5FC2-A24D-72AB9244CC93"><!-- --></a><ol id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-8FC14D51-FB3B-5FC2-A24D-72AB9244CC93">
<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-D1491E70-F9DF-5697-810A-9C91EFF5FF21"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-D1491E70-F9DF-5697-810A-9C91EFF5FF21"><!-- --></a><p>Create the <samp class="codeph">CImportFile</samp> object </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-F178800B-A2D5-50BC-B2D7-C363FBDDF43E"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-F178800B-A2D5-50BC-B2D7-C363FBDDF43E"><!-- --></a><p>Generate output files </p>
 </li>

</ol>
 <p><strong>Creating the CImportFile object</strong> </p>
 <p> <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CImportFile()</span></a> allows
to write a file to CAF. Use <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CSupplier::ImportFileL()</span></a> to
create a <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CImportFile</span></a> object
for importing a file. The parameters supplied must indicate whether the agent
generates the output files or if the application generates the output files
for the agents on demand. </p>
 <pre class="codeblock" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-D5A84DF4-6175-5F56-97EE-2EDEA2E772B9"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-D5A84DF4-6175-5F56-97EE-2EDEA2E772B9"><!-- --></a>// Create the import object, passing in the metaDataArray created earlier 
// The application must supply the output files 
            
CImportFile *import = mySupplier-&gt;ImportFileL(sourceMimeType, *metaDataArray);</pre>
 <p>Applications
use the <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CImportFile</span></a> object
to transfer the content to CAF. </p>
 <p> <strong>Note</strong>: </p>
 <ul>
<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-8B63B854-B857-5AC9-90BC-4A777B31A1E5"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-8B63B854-B857-5AC9-90BC-4A777B31A1E5"><!-- --></a><p>You must create new <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CImportFile</span></a> objects to import multiple
files. </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-FC33D732-6026-56DC-9047-A25188E4384A"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-FC33D732-6026-56DC-9047-A25188E4384A"><!-- --></a><p>You can transfer only
one file in an instance, even if multiple output files are produced. </p>
 </li>

</ul>
 <p><strong>Generating output files</strong> </p>
 <p>Use <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CSupplier::ImportFileL()</span></a> to
generate the output files and specify the appropriate parameters. By default,
application generates the output file. Otherwise, the agent or application
can generate the output file based on the specified parameters. </p>
 <p><em>Agents
generating output files</em> </p>
 <p>Applications must specify the following
information if they require agents to generate the output files: </p>
 <ul>
<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-E5B68249-133C-5C82-97AA-D47EFD73D984"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-E5B68249-133C-5C82-97AA-D47EFD73D984"><!-- --></a><p>Specify the file name
in <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CSupplier::ImportFileL()</span></a> indicating
that agent must generate output files. </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-3AEBE53D-B67F-58EA-A51E-E608851EA15B"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-3AEBE53D-B67F-58EA-A51E-E608851EA15B"><!-- --></a><p>Use <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CSupplier::SetOutputDirectoryL()</span></a> to
specify the directory for the files to be generated. Optionally, applications
can decide to store the output files in their private directory. </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-9A4FA11A-CA72-5D46-89DE-8D086F788892"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-9A4FA11A-CA72-5D46-89DE-8D086F788892"><!-- --></a><p>Check for the number
of generated output files and their stored location, when the import operation
is complete. </p>
 </li>

</ul>
 <p><em>Applications generating output files</em></p>
 <p>If the filename
is not passed to the agent, applications provide output files to the agents.
This allows applications to open files in their own private directory and
ask the CAF agent to store the output in those files. This involves the following
considerations: </p>
 <ul>
<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-F48701C5-8FAA-5B36-BF87-118B2D7D6784"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-F48701C5-8FAA-5B36-BF87-118B2D7D6784"><!-- --></a><p>If an agent requires
a new output file handle in order to continue during import, a call to <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CImportFile::WriteData()</span></a> or <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CImportFile::WriteDataComplete()</span></a> returns
an error code of <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">KErrCANewFileHandleRequired</span></a>. </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-CD957292-7438-53D2-9960-9648F07F017C"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-CD957292-7438-53D2-9960-9648F07F017C"><!-- --></a><p>Applications must open
a new output file with write access and call <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CImportFile::ContinueWithNewOutputFile()</span></a> to
supply the new handle to the agent. IF handles are required further, <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CImportFile::ContinueWithNewOutputFile()</span></a> returns <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">KErrCANewFileHandleRequired</span></a> and the
application must repeat this step with another file. </p>
 <p>The agent must
cache its state before returning <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">KErrCANewFileHandleRequired</span></a>. </p>
 </li>

<li id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-CC0B5AF5-C1F0-5AFE-ACA9-5365CA3DAA45"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-CC0B5AF5-C1F0-5AFE-ACA9-5365CA3DAA45"><!-- --></a><p>The application must
not resend the same <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CImportFile::WriteData()</span></a> or <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">CImportFile::WriteDataComplete()</span></a> call. </p>
 </li>

</ul>
<div class="note"><span class="notetitle">Note:</span>  At the end of the import operation the output files are listed
irrespective of whether they were supplied by the application or the agent.</div>
 </div>

<div class="section" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-52D00B05-3EB5-5C10-A3BC-8AC12B968FF0"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-52D00B05-3EB5-5C10-A3BC-8AC12B968FF0"><!-- --></a><h2 class="sectiontitle">Transfer the
file to the Content Access Agent</h2><p>Use <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CImportFile</span></a> to
write the file data to CAF. <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CSupplier</span></a> creates <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CImportFile</span></a> which
only imports a single file. An application must call <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">WriteData()</span></a> to
transfer a field in chunks to the CAF. </p>
 <p>The following code snippet
explains this. </p>
 <pre class="codeblock" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-513744BC-F54A-55F5-A9BD-CA5463CB9DB1"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-513744BC-F54A-55F5-A9BD-CA5463CB9DB1"><!-- --></a>// importing the file data
ImportFile *import; 
TFileName fileName; 
TPath outputfileName; 
TBuf8 data &lt;128&gt; 
_LIT(KDirectoryPath, "C:\\private\\12345678\\");
... 

while(!endofsource) 
    {
    source.read(data); 
    err = import-&gt;WriteData(data); 

    // When application supplies file handles it must always check to see if 
    // the agent needs a new file handle 

    while(err == KErrCANewFileHandleRequired) 
        {               
        RFile newFile; 
        import-&gt;GetSuggestedOutputFileName(fileName); 
        outputFileName.Copy(KDirectoryPath); 
        outputFileName.Append(fileName);
        newFile.Open(outputFileName, EFileWrite); 
        err = import-&gt;ContinueWithNewOutputFile(newFile, outputFileName); 

        // It is possible that the agent needs yet another file handle
        newFile.Close(); // agent makes a copy so we don't need to keep our file handle 
        }
    }</pre>
 </div>

<div class="section" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-5436E5BC-793C-5373-B9A9-404D6ECC2EBA"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-5436E5BC-793C-5373-B9A9-404D6ECC2EBA"><!-- --></a><h2 class="sectiontitle">Complete the
import</h2> <p>When the data is written, use <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CImportFile::WriteDataComplete()</span></a> to
inform the agent that data transfer is complete, allowing it to perform any
final processing. </p>
 <p>The following code snippet explains this step: </p>
 <pre class="codeblock" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-1843B2F1-A862-52DB-998F-AE6224726EFB"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-1843B2F1-A862-52DB-998F-AE6224726EFB"><!-- --></a>err = import-&gt;WriteDataComplete(); 

// When the application supplies file handles it must always check to see if 
// the agent needs a new file handle 
while(err == KErrCANewFileHandleRequired) 
    {
    RFile newFile; 
    import-&gt;GetSuggestedOutputFileName(fileName); 
    outputFileName.Copy(KDirectoryPath); 
    outputFileName.Append(fileName);  
    newFile.Open(outputFileName, EFileWrite);  
    err = import-&gt;ContinueWithNewOutputFile(newFile, outputFileName);
    // It is possible that the agent needs yet another file handle 
    newFile.Close(); // agent makes a copy so we don't need to keep our file handle
    }

// Finished
//At this stage all the agent's work is done and the CImportFile object can be deleted. </pre>
 </div>

<div class="section" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-EDAB286B-FBC9-5DAF-A466-7B07F2A2FC29"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-EDAB286B-FBC9-5DAF-A466-7B07F2A2FC29"><!-- --></a><h2 class="sectiontitle">Check the output
file</h2> <p>When import is complete, use <a href="GUID-E6562DDC-C872-3ADA-BF1C-4A04291E8CF9.html"><span class="apiname">ContentAccess::CImportFile::OutputFileL()</span></a> to
list all the output files produced. The output files can be either content
files or receipts for DRM rights. </p>
 <pre class="codeblock" id="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-A4C87E1E-719D-53CF-9A2F-7EEE8A16919D"><a name="GUID-1B20D403-5FC9-5A61-9D2B-8ACB9D73423C__GUID-A4C87E1E-719D-53CF-9A2F-7EEE8A16919D"><!-- --></a>// loop over all the output files produced 
for(TInt I =0; I &lt; import-&gt;OutputFileCountL(); I++) 
    {
    // Can now retrieve filename, type of file (receipt or content) and MIME type for the file produced
    TPtr filename = import-&gt;OutputFileL(I).FileName(); 
    TOutputType type = import-&gt;OutputFileL(I).OutputType();
    TPtr8 mimetype = import-&gt;OutputFileL(I).MimeType(); 
    }</pre>
 <p> <strong>Note</strong>: </p>
 <p>The MIME type and the file extension
of the output files can be different to the MIME type and file extension of
the imported file. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-8F457DE7-DAC2-56DF-8D6D-76D86584CC79.html">Content Access Framework Tutorials</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-84B6389A-55CC-53EB-8725-65F753FD7217.html"> CAF Overview</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>