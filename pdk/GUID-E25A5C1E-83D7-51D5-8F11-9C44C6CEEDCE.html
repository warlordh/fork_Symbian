<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Starting as Controller"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D009C6A6-3388-554F-BCB5-4F438E7F9E99.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F8C8CE42-E7C9-5AFC-86BC-B78F677F1B05.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9BAEF0E8-5414-597C-B0B7-5F6E02DBF3C5.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-8C8B97BF-E769-5C7B-A6E0-B8CA7F12071C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D009C6A6-3388-554F-BCB5-4F438E7F9E99.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Starting as Controller</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2519078 id2519086 id2519100 id2519115 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-F8C8CE42-E7C9-5AFC-86BC-B78F677F1B05.html" title="Device Services provides device specific services to control phone resources and establish remote controlled connection with the external devices. It also monitors the phone resources and provides stage shutdown mechanism.">Device Services Guide</a> &gt; <a href="GUID-9BAEF0E8-5414-597C-B0B7-5F6E02DBF3C5.html">Accessory Services</a> &gt; <a href="GUID-8C8B97BF-E769-5C7B-A6E0-B8CA7F12071C.html">Bluetooth Remote Control Framework</a> &gt; <a href="GUID-D009C6A6-3388-554F-BCB5-4F438E7F9E99.html">Bluetooth Remote Control Framework Tutorial</a> &gt; </div>
<h1 class="topictitle1">Starting
as Controller</h1>
<div>
<p>The controller is the device that sends commands to a target device. </p>

<p><strong>Intended Audience: </strong> </p>

<p>This tutorial is designed for Symbian licensees and 3rd party application
developers. </p>

<div class="section"><h2 class="sectiontitle">Using the Controller</h2> <p>The following tasks will be
covered in this tutorial: </p>
 <ul>
<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-E2D1E9EE-E004-5401-B714-F98544853EE6"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-E2D1E9EE-E004-5401-B714-F98544853EE6"><!-- --></a><p>Starting a Connectionless
controller </p>
 </li>

<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-869B57EB-77FE-52C3-A211-7DAEEA7E8EF5"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-869B57EB-77FE-52C3-A211-7DAEEA7E8EF5"><!-- --></a><p>Starting a Connection-Oriented
controller </p>
 </li>

<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-11CC8516-F861-505B-9AC3-9F851FDE0DFC"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-11CC8516-F861-505B-9AC3-9F851FDE0DFC"><!-- --></a><p>Stopping a controller </p>
 </li>

</ul>
 <p><strong> Basic procedure</strong> </p>
 <p>The high level steps to start a controller
are: </p>
 <ul>
<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-BF89D59C-7A44-5AF1-B9CD-18E5F5182716"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-BF89D59C-7A44-5AF1-B9CD-18E5F5182716"><!-- --></a><p>Create the Controller
interface </p>
 </li>

<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-E25EFF1D-4176-55D9-B180-610694CDD497"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-E25EFF1D-4176-55D9-B180-610694CDD497"><!-- --></a><p>Open a controller session
on the server. This will either be: </p>
 <ul>
<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-3DCE1277-80CF-50E7-8039-1C2BCA5D264D"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-3DCE1277-80CF-50E7-8039-1C2BCA5D264D"><!-- --></a><p>Connectionless </p>
 <p>This
would be enough to create a connectionless controller. </p>
 </li>

<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-D60CE56B-AEB3-5775-B6E7-DBE16FF0304F"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-D60CE56B-AEB3-5775-B6E7-DBE16FF0304F"><!-- --></a><p>Connection-oriented </p>
 <p>If
you are starting a connection-oriented controller you will need to know the
following: </p>
 <ul>
<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-641DAE94-036F-5168-B6AE-91205E22D234"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-641DAE94-036F-5168-B6AE-91205E22D234"><!-- --></a><p>Device address </p>
 </li>

<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-A37F327B-95D7-5A36-AAEF-E3BCCCC56DF6"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-A37F327B-95D7-5A36-AAEF-E3BCCCC56DF6"><!-- --></a><p>Bearer </p>
 </li>

</ul>
 </li>

</ul>
 </li>

</ul>
 <div class="note"><span class="notetitle">Note:</span>  Starting the Bluetooth stack and setting up the
sockets, housekeeping tasks usually associated with Bluetooth components,
are wrapped up and taken care of in the background by the Remote Control Framework.</div>
</div>

<div class="section"><h2 class="sectiontitle">Starting a connectionless controller</h2> <p>Create a controller
interface by instantiating an interface selector using <a href="GUID-81EE9382-D501-3FCE-ACD9-7BC5236FC462.html#GUID-81EE9382-D501-3FCE-ACD9-7BC5236FC462__GUID-17C0EFFE-AEE4-31E6-97D6-701CFD3E761C"><span class="apiname">CRemConInterfaceSelector::NewL()</span></a>,
as shown here: </p>
 <pre class="codeblock" id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-F7645600-01B3-5DFA-97AD-439CB492E132"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-F7645600-01B3-5DFA-97AD-439CB492E132"><!-- --></a>CRemConInterfaceSelector* iInterfaceSelector;
iInterfaceSelector = CRemConInterfaceSelector::NewL();</pre>
 <p>Create
a core remote control API controller and add the interface selector created
above as shown here: </p>
 <pre class="codeblock" id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-7109464B-CFC1-52B8-8B8F-A0A4831B33DA"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-7109464B-CFC1-52B8-8B8F-A0A4831B33DA"><!-- --></a>CRemConCoreApiController* iCoreController;
iCoreController = CRemConCoreApiController::NewL(*iInterfaceSelector, *this);</pre>
 <p>Open
the interface created above using <a href="GUID-81EE9382-D501-3FCE-ACD9-7BC5236FC462.html#GUID-81EE9382-D501-3FCE-ACD9-7BC5236FC462__GUID-99C2BB74-BD7C-351E-91BD-CCC1D78C7A3C"><span class="apiname">CRemConInterfaceSelector::OpenControllerL()</span></a>. </p>
 <pre class="codeblock" id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-D054087B-AF55-5109-8EF0-804C96C1D979"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-D054087B-AF55-5109-8EF0-804C96C1D979"><!-- --></a>iInterfaceSelector-&gt;OpenControllerL();</pre>
 <p>The
Target Selector Plugin (TSP) discovers the bearer and device address of target
devices as required. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Starting a Connection-Oriented controller</h2> <p>The first
part of starting your Connection-Oriented controller is the same as that described
above for starting a connectionless controller, but to go Connection-Oriented
you will need to provide two additional pieces of information, the device
address and the bearer. </p>
 <p>The following code, which constructs a <samp class="codeph">TUid</samp>,
shows how to set information about the AVRCP bearer (it may be different for
other bearers): </p>
 <pre class="codeblock" id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-4F943A05-C97D-575D-B5A7-31B952A35ED8"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-4F943A05-C97D-575D-B5A7-31B952A35ED8"><!-- --></a>...
 TUid iBearerUid;
 RBuf8 iBearerData;
 iBearerUid = TUid::Uid(KAvrcpBearerUid);</pre>
 <p>To get the device
address you can either use the SDP, a notifier, or the following: </p>
 <pre class="codeblock" id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-6F1643E9-A37D-5BA6-B21B-E7553B894023"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-6F1643E9-A37D-5BA6-B21B-E7553B894023"><!-- --></a>GetDeviceAddressL()
    {
    // MTestManager iManager;
    iManager.MtmWrite(
    _L8( "Type device address and press enter\n0x" ) );
    // Read address in unicode as human readable
    TBuf&lt;12&gt; buf;
    iManager.MtmRead( buf );
    // Translate to machine readable
    TBTDevAddr btAddr;
    LEAVEIFERRORL( btAddr.SetReadable( buf ) );
    // Store as 8 bit machine readable
    iBearerData.Close();
    iBearerData.CreateL( btAddr.Des() );
    }</pre>
 <div class="p"> <div class="note"><span class="notetitle">Note:</span>  The above uses test code. In a real application,
you would need a UI instead of the console. </div>
</div>
 <p>Now that you have
the device address and bearer information you can start the Connection-Oriented
controller by adding the bearer and Bluetooth device address information to
the <samp class="codeph">addr</samp> using the <a href="GUID-3A185192-2A36-33C6-9E09-A04B7BB2D896.html#GUID-3A185192-2A36-33C6-9E09-A04B7BB2D896__GUID-5C3066AE-CDD1-35C0-89FE-23BCC8F8A44E"><span class="apiname">TRemConAddress::BearerUid()</span></a> and <a href="GUID-3A185192-2A36-33C6-9E09-A04B7BB2D896.html#GUID-3A185192-2A36-33C6-9E09-A04B7BB2D896__GUID-AE43EDDD-511F-332C-962A-365AB027D42C"><span class="apiname">TRemConAddress::Addr()</span></a> functions
as follows: </p>
 <pre class="codeblock" id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-7D3E3A30-CDB2-5C14-8811-46F305278A44"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-7D3E3A30-CDB2-5C14-8811-46F305278A44"><!-- --></a>TRemConAddress addr;
addr.BearerUid() = iBearerUid;
addr.Addr() = iBearerData;
iInterfaceSelector-&gt;GoConnectionOrientedL( addr );</pre>
 <p>The <a href="GUID-81EE9382-D501-3FCE-ACD9-7BC5236FC462.html#GUID-81EE9382-D501-3FCE-ACD9-7BC5236FC462__GUID-88822BD1-4274-3A3D-994D-494081653B19"><span class="apiname">CRemConInterfaceSelector::GoConnectionOrientedL()</span></a> function
makes the controller Connection-Oriented. </p>
 <p><strong>Switching to Connectionless </strong> </p>
 <p>It
is possible to switch a Connection-Oriented controller to connectionless if
necessary. The <a href="GUID-81EE9382-D501-3FCE-ACD9-7BC5236FC462.html#GUID-81EE9382-D501-3FCE-ACD9-7BC5236FC462__GUID-ACCD72A4-4273-3CAD-9032-D8460748E15C"><span class="apiname">CRemConInterfaceSelector::GoConnectionlessL()</span></a> is
used as shown here: </p>
 <pre class="codeblock" id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-0F07E60F-77F5-5291-BAF4-19E85689EDDA"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-0F07E60F-77F5-5291-BAF4-19E85689EDDA"><!-- --></a>iInterfaceSelector-&gt;GoConnectionlessL();</pre>
 <p>Of
course you can also switch back to a Connection-Oriented controller as needed. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Stopping a controller</h2> <p>To stop your controller use: </p>
 <pre class="codeblock" id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-9C8B2A81-0F45-5C17-94AB-AE235C596A58"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-9C8B2A81-0F45-5C17-94AB-AE235C596A58"><!-- --></a>delete iInterfaceSelector;</pre>
 </div>

<div class="section"><h2 class="sectiontitle">What's next?</h2> <ul>
<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-8E3BD584-32D3-595B-ABBC-8BE2209C5E7F"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-8E3BD584-32D3-595B-ABBC-8BE2209C5E7F"><!-- --></a><p><a href="GUID-C4A072E1-4385-5C98-98C1-56F297132F11.html">Remote
Control Basics</a>  </p>
 </li>

<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-F460D9E7-AAC2-59E6-887D-D000A3A9771D"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-F460D9E7-AAC2-59E6-887D-D000A3A9771D"><!-- --></a><p><a href="GUID-8E25E84C-E8F3-50B2-82E5-0611A341ED27.html">Starting
as Target</a>  </p>
 </li>

<li id="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-516B6F7D-FC2A-58DA-BECA-279CBB4C5F10"><a name="GUID-E25A5C1E-83D7-51D5-8F11-9C44C6CEEDCE__GUID-516B6F7D-FC2A-58DA-BECA-279CBB4C5F10"><!-- --></a><p><a href="GUID-7DDF477A-1744-589A-82CB-3CB32D56D7CE.html">Commands
and Responses</a>  </p>
 </li>

</ul>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-D009C6A6-3388-554F-BCB5-4F438E7F9E99.html">Bluetooth Remote Control Framework Tutorial</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>