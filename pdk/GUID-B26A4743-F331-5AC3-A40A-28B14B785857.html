<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="reference"/>
<meta name="DC.Title" content="SearchSortExample: enhanced search and sort for Message Store"/>
<meta name="abstract" content="This example demonstrates the enhanced search and sort API for message stores. This API was implemented in Symbian^3."/>
<meta name="description" content="This example demonstrates the enhanced search and sort API for message stores. This API was implemented in Symbian^3."/>
<meta name="DC.Relation" scheme="URI" content="GUID-1DF2D6EC-C445-5A0C-80C4-9C46AAA6EE44.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B394A824-8745-505E-8429-8B9B6D418387.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1DF2D6EC-C445-5A0C-80C4-9C46AAA6EE44.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-B26A4743-F331-5AC3-A40A-28B14B785857"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>SearchSortExample: enhanced search and sort for Message Store</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2404348 id2404397 id2404434 id2404894 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-5DD1010C-1648-5086-BA80-BC25F3C7A2C4.html">Messaging Middleware Guide</a> &gt; <a href="GUID-C290FA5E-8E41-5D19-B8C1-F88491EE6388.html">Messaging Framework</a> &gt; <a href="GUID-B394A824-8745-505E-8429-8B9B6D418387.html">Message Server and Store</a> &gt; <a href="GUID-1DF2D6EC-C445-5A0C-80C4-9C46AAA6EE44.html" title="This describes the example code for the Message Server and Store component.">Message Server and Store Example Code</a> &gt; </div>
<h1 class="topictitle1">SearchSortExample: enhanced search and sort for Message Store</h1>
<div><p>This example demonstrates the enhanced search and sort
API for message stores. This API was implemented in Symbian^3. </p>

<div class="section" id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-B702DCF4-5C83-4AE2-95F5-F09D7DC46255"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-B702DCF4-5C83-4AE2-95F5-F09D7DC46255"><!-- --></a><h2 class="sectiontitle">Purpose</h2> <p>Prior to Symbian^3, the Message Store API had limited support
for selecting and sorting message records and fields. From Symbian^3,
the API implements more extensive search and sort options.</p>
 <p>This example demonstrates the new functionality by implementing the
following use cases: </p>
 <ul>
<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-E9B88EDB-8DD1-5CC2-B6DD-CA8498FE1865"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-E9B88EDB-8DD1-5CC2-B6DD-CA8498FE1865"><!-- --></a><p>Display the
header information for all message entries. </p>
 </li>

<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-5D07456E-DEDE-578D-961F-138E9DBD9470"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-5D07456E-DEDE-578D-961F-138E9DBD9470"><!-- --></a><p>Perform a simple
(single search criteria) non-iterative search-sort and display the
matching entries. This has the following options: </p>
 <ul>
<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-73CAF478-2B69-5883-B7A1-4F8B20D884E8"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-73CAF478-2B69-5883-B7A1-4F8B20D884E8"><!-- --></a><p>case sensitivity
on / off, </p>
 </li>

<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-D158CBA7-4947-589F-9C1E-FFB0E36A8CEF"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-D158CBA7-4947-589F-9C1E-FFB0E36A8CEF"><!-- --></a><p>whole word search
on / off. </p>
 </li>

</ul>
 </li>

<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-F2FC91DD-8198-53BB-9C77-5DC30C071AE1"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-F2FC91DD-8198-53BB-9C77-5DC30C071AE1"><!-- --></a><p>Perform a combined
(more than one search criteria) non-iterative search-sort and display
the number of matching entries. This has the following options: </p>
 <ul>
<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-25CDF7E6-9D22-58C8-8832-03B0723A7F6E"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-25CDF7E6-9D22-58C8-8832-03B0723A7F6E"><!-- --></a><p>case sensitivity
on / off, </p>
 </li>

<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-35902CB3-B4AF-56D0-937A-A840B3F40CDA"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-35902CB3-B4AF-56D0-937A-A840B3F40CDA"><!-- --></a><p>whole word search
on / off. </p>
 </li>

</ul>
 </li>

<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-54A5DEF1-21F3-5B24-85BA-71450C7E3D2D"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-54A5DEF1-21F3-5B24-85BA-71450C7E3D2D"><!-- --></a><p>Perform an iterative
search-sort (searches for entries one at a time) and display the number
of matching entries. </p>
 </li>

<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-5412D0A2-2A38-5F34-AE9E-AE7940345DDC"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-5412D0A2-2A38-5F34-AE9E-AE7940345DDC"><!-- --></a><p>Perform a search-sort
using a query ID. The query ID is generated by a previous search-sort
operation. </p>
 </li>

</ul>
 <p>Before implementing these use cases, the example creates
a POP3/SMTP message store with five message entries. </p>
 </div>

<div class="section" id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-4FBA245A-78AC-4584-8471-240D504C3ED0"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-4FBA245A-78AC-4584-8471-240D504C3ED0"><!-- --></a><h2 class="sectiontitle">Class
summary</h2><p>The example demonstrates the following classes and
enums:</p>
<ul>
<li><p><a href="GUID-5D956759-5D21-3715-916E-F7E703172762.html"><span class="apiname">CMsvSearchSortOperation</span></a></p>
</li>

<li><p><a href="GUID-A1ECA70D-1D50-3B5F-9D22-74D0215146E7.html"><span class="apiname"> CMsvSearchSortQuery</span></a></p>
</li>

<li><p><a href="GUID-D9BB2EF0-262F-3BCF-8F48-F40FE0D4C107.html"><span class="apiname"> TMsvMessagePart</span></a></p>
</li>

<li><p><a href="GUID-A60B4636-F309-3FD6-8D12-D4EE3AC6BC58.html"><span class="apiname"> TMsvSearchSortResultType</span></a></p>
</li>

</ul>
</div>

<div class="section" id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-9331568B-0BA3-5138-BDCC-65AC225A5328"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-9331568B-0BA3-5138-BDCC-65AC225A5328"><!-- --></a><h2 class="sectiontitle">Download</h2> <p>Click on the following link to download the example: <a href="guid-6013a680-57f9-415b-8851-c4fa63356636/zips/guid-dbb3813f-c947-4359-805e-eeada16f1dbb.zip" target="_blank">searchsortexample.zip</a></p>
<p>Click: <a href="guid-6013a680-57f9-415b-8851-c4fa63356636/guid-dbb3813f-c947-4359-805e-eeada16f1dbb.html">browse</a> to view the example code. </p>
 </div>

<div class="section" id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-F8B3E0E7-FB82-5266-AB40-C1149A782E83"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-F8B3E0E7-FB82-5266-AB40-C1149A782E83"><!-- --></a><h2 class="sectiontitle">Design and implementation</h2> <p><strong>Project Implementation</strong> </p>
 <p>The project implements the following classes: </p>
 <p> <strong>CKeyReader:</strong> Derived from <samp class="codeph">CActive</samp>. This reads
keypresses and calls the appropriate example function. </p>
 <p> <strong>CMessAsyncWaiter:</strong> Derived from <samp class="codeph">CActive</samp>. This
handles the <samp class="codeph">CMsvSearchSortOperation::RequestL()</samp> asynchronous
request. This <samp class="codeph">RequestL()</samp> function takes <samp class="codeph">CMessAsyncWaiter::iStatus</samp> as one of its parameters and then waits on the status. When the
search is complete the client is notified of the event's completion
by <samp class="codeph">CMessAsyncWaiter::RunL()</samp> being called, after which
the example prepares the buffer and displays the results. </p>
 <p> <strong>CSearchsortExample:</strong> Derived from <samp class="codeph">CBase</samp> and <samp class="codeph">MMsvSessionObserver</samp>. <samp class="codeph">MMsvSessionObserver</samp> is an interface for notification of events from a Message Server
session. </p>
 <p> <samp class="codeph">CSearchsortExample</samp> implements <samp class="codeph">HandleSessionEventL()</samp> to handle the two event types <samp class="codeph">EMsvEntriesCreated</samp> and <samp class="codeph">EMsvServerReady</samp>.
It also creates the SMTP message entries and carries out searching
and sorting. </p>
 <p><strong>Simple non-iterative search-sort</strong> </p>
 <p>The example starts by creating a message server session using <samp class="codeph">CMsvSession</samp>, which represents a channel of communication
between a client thread (client-side MTM, user interface MTM, or message
client application) and the Message Server thread. Then it creates
an instance of <samp class="codeph">CMsvSearchSortOperation</samp> to perform
the search-sort operation, and passes the session object into it. </p>
 <p>A search-sort query is created using <a href="GUID-A1ECA70D-1D50-3B5F-9D22-74D0215146E7.html#GUID-A1ECA70D-1D50-3B5F-9D22-74D0215146E7__GUID-B39D5F47-158A-38C8-8552-B3B5581554F7"><span class="apiname">CMsvSearchSortQuery::NewL()</span></a> and is configured using various member functions of class <a href="GUID-A1ECA70D-1D50-3B5F-9D22-74D0215146E7.html"><span class="apiname">CMsvSearchSortQuery</span></a> for instance whether to search for
whole or partial words and the case sensitivity. </p>
 <p>The search
and sort options are added to the query using <samp class="codeph">CMsvSearchSortQuery::AddSearchOptionL()</samp> and <samp class="codeph">CMsvSearchSortQuery::AddSortOptionL()</samp>. </p>
 <p>The search-sort operation is started by calling <a href="GUID-5D956759-5D21-3715-916E-F7E703172762.html#GUID-5D956759-5D21-3715-916E-F7E703172762__GUID-6C81A72A-3BEC-3D18-9CAD-46E9309C3FEB"><span class="apiname">CMsvSearchSortOperation::RequestL()</span></a>, passing the query as a parameter. If no iterator parameter is specified,
the search defaults to non-iterative. </p>
 <p>An instance of the <samp class="codeph">CMessAsyncWaiter</samp> class is created for handling the asynchronous
search request. This object is waited on until the Message Server
completes the request. The results of the search are stored in an
array using <a href="GUID-5D956759-5D21-3715-916E-F7E703172762.html#GUID-5D956759-5D21-3715-916E-F7E703172762__GUID-1D6974D1-FF31-3B7C-A726-47A8510E9819"><span class="apiname">CMsvSearchSortOperation::GetResultsL()</span></a>. </p>
 <p>The result count is displayed by calling <a href="GUID-5D956759-5D21-3715-916E-F7E703172762.html#GUID-5D956759-5D21-3715-916E-F7E703172762__GUID-5E95F638-1252-3C63-A408-8FBAB445918D"><span class="apiname">CMsvSearchSortOperation::GetResultCountL()</span></a>. </p>
 <p>The query ID of the search is retrieved from the Message
server, for later use, using the <a href="GUID-5D956759-5D21-3715-916E-F7E703172762.html#GUID-5D956759-5D21-3715-916E-F7E703172762__GUID-989B6F32-DE88-373B-9CA4-5474BB6858CD"><span class="apiname">CMsvSearchSortOperation::GetQueryId()</span></a> function. </p>
 <p><strong>Simple iterative search-sort</strong> </p>
 <p>Iterative
search-sort follows the same steps as described above, except that
an iterator parameter is passed to the <samp class="codeph">RequestL()</samp> function. To retrieve the results, <a href="GUID-5D956759-5D21-3715-916E-F7E703172762.html#GUID-5D956759-5D21-3715-916E-F7E703172762__GUID-3F38D82E-D350-3C80-8146-A339F1E189D8"><span class="apiname">CMsvSearchSortOperation::GetNextResultL()</span></a> is called in a <samp class="codeph">while</samp> loop to retrieve one entry
at a time. Iterative searching is useful when the client may not have
enough memory to store an array of results. </p>
 <p><strong>Combined search-sort</strong> </p>
 <p>A combined search-sort is done by adding additional search
options using <samp class="codeph">CMsvSearchSortQuery::AddSearchOptionL()</samp>. </p>
 <p><strong>Search-sort using a query ID</strong> </p>
 <p>A query ID
identifies a search-sort query. It is obtained by calling <a href="GUID-5D956759-5D21-3715-916E-F7E703172762.html#GUID-5D956759-5D21-3715-916E-F7E703172762__GUID-1893C3C7-4F77-3630-B115-A161CCA2665A"><span class="apiname">CMsvSearchSortOperation::GetQueryIdL()</span></a> following the completion
of <a href="GUID-5D956759-5D21-3715-916E-F7E703172762.html#GUID-5D956759-5D21-3715-916E-F7E703172762__GUID-6C81A72A-3BEC-3D18-9CAD-46E9309C3FEB"><span class="apiname">CMsvSearchSortOperation::RequestL()</span></a>. In this
example, the query ID generated by the simple non-iterative search-sort
is used to repeat the same search-sort. The overloaded <samp class="codeph">CMsvSearchSortOperation::RequestL()</samp> function is used to initiate a search-sort operation with a query
ID. </p>
 <p>After the request completes, a list of index entry ID
objects (<a href="GUID-A4B1F874-27C0-3BB6-9D29-C35C75A5DB98.html"><span class="apiname">TMsvId</span></a> or <a href="GUID-5A23B804-2C06-3407-9D48-1BFB212D699F.html"><span class="apiname">TMsvEntry</span></a> depending on how the query was configured, using <a href="GUID-A1ECA70D-1D50-3B5F-9D22-74D0215146E7.html#GUID-A1ECA70D-1D50-3B5F-9D22-74D0215146E7__GUID-B040D6BA-670D-3CBF-B1F7-9AFD1F99267B"><span class="apiname">CMsvSearchSortQuery::SetResultType()</span></a>) is retrieved using <samp class="codeph">CMsvSearchSortOperation::GetResultsL()</samp>. Finally the matching results are displayed in the console. </p>
 </div>

<div class="section" id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-AE5E0880-9CAB-57E5-83CB-196D487935DE"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-AE5E0880-9CAB-57E5-83CB-196D487935DE"><!-- --></a><h2 class="sectiontitle">Building
and configuring</h2> <p>To build the example: </p>
 <ul>
<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-61C94258-567F-575E-A75C-29D2165FC2CA"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-61C94258-567F-575E-A75C-29D2165FC2CA"><!-- --></a><p>You can build
the example from your IDE or the command line. </p>
 <p>If you use
an IDE, import the <span class="filepath">bld.inf</span> file of the example
into your IDE, and use the build command of the IDE. </p>
 <p>If you
use the command line, open a command prompt, and set the current directory
to the source code directory of the example. You can then build the
example with the SBSv1 build tools with the following commands: </p>
 <p><kbd class="userinput">bldmake bldfiles</kbd> </p>
 <p><kbd class="userinput">abld
build</kbd> </p>
 </li>

<li id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-F470E492-C920-58E0-860C-5CCE24B0C7F4"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-F470E492-C920-58E0-860C-5CCE24B0C7F4"><!-- --></a><p>For the emulator,
the example builds an executable called <span class="filepath">searchsortexample.exe</span> in the <span class="filepath">epoc32\release\winscw\&lt;udeb                
or urel&gt;\</span> folder. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-B72B706B-BB9F-5A0D-A36A-03135FE99E5C"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-B72B706B-BB9F-5A0D-A36A-03135FE99E5C"><!-- --></a><h2 class="sectiontitle">Running
the example</h2> <p> <span class="filepath">searchsortexample.exe</span> takes user input from the console. The menu for the current example
is as shown below: </p>
 <div class="fignone" id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-53020118-A1E3-56C3-AA81-9CED04533E27"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-53020118-A1E3-56C3-AA81-9CED04533E27"><!-- --></a>
<img src="GUID-656E2E4F-D7C5-5FDC-B1E6-DFA5970BB3F0_d0e492438_href.jpg"/>
</div>
 <p>The user input is handled by <samp class="codeph">CKeyReader::RunL()</samp>. </p>
 <p>For simple and combined non-iterative search-sort, the
user provides the following inputs: 1) the text in the "To" field
to search for, 2) whether case sensitivity is on of off, 3) whether
whole word searching is on or off. </p>
 <p>The input values are saved
in variables which are passed to the function <samp class="codeph">CSearchsortExample::SearchSortRequestWithoutIteratorL()</samp>, and the settings are made accordingly. </p>
 <p>For the combined
search-sort the 2nd and 3rd search options (size and subject) are
hard coded. The iterative search-sort searches by size, which is also
hard coded. </p>
 <p>To execute a search-sort using a query ID, <a href="GUID-5D956759-5D21-3715-916E-F7E703172762.html#GUID-5D956759-5D21-3715-916E-F7E703172762__GUID-2856FD49-D254-3B1D-9F92-634B8BF7B325"><span class="apiname">CMsvSearchSortOperation::RequestL(CMsvSearchSortQuery *,TBool,TRequestStatus
&amp;,TInt)</span></a> must first have been called because it generates
the query ID. So, either option 2 or 3 must have been called before
option 5. </p>
 </div>

<div class="section" id="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-23202235-0D1E-4D86-83E1-9EC7A315E682"><a name="GUID-B26A4743-F331-5AC3-A40A-28B14B785857__GUID-23202235-0D1E-4D86-83E1-9EC7A315E682"><!-- --></a><h2 class="sectiontitle">See
also</h2><p><a href="GUID-32C1FC8B-F7D2-5275-BDF2-0D662551294C.html">Search-Sort Overview</a></p>
</div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-1DF2D6EC-C445-5A0C-80C4-9C46AAA6EE44.html" title="This describes the example code for the Message Server and Store component.">Message Server and Store Example Code</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>