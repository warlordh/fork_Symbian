<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Nanokernel Timer"/>
<meta name="abstract" content="This document describes nanokernel timers."/>
<meta name="description" content="This document describes nanokernel timers."/>
<meta name="DC.Relation" scheme="URI" content="GUID-1AFAD1C4-340B-4119-94A8-F50E9D8DA8E6.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F78B7BF9-5FDD-4EF8-A921-71CCBB830A99.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C22974D8-CFB9-4A83-BE58-CCC97EA8DF13.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CFE0A4EB-845C-43B6-A732-AA155AFD99D6.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1AFAD1C4-340B-4119-94A8-F50E9D8DA8E6.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Nanokernel Timer</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666"><a name="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2387995 id2388032 id2388267 id2388334 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-F78B7BF9-5FDD-4EF8-A921-71CCBB830A99.html" title="The device driver framework and how to implement a device driver.">Device Driver Guide</a> &gt; <a href="GUID-C22974D8-CFB9-4A83-BE58-CCC97EA8DF13.html" title="This set of documents explains how to write a device driver.">Device Driver Writing Guide</a> &gt; <a href="GUID-CFE0A4EB-845C-43B6-A732-AA155AFD99D6.html" title="This document introduces user requests and synchronisation methods used by device drivers.">User Requests and Synchronisation</a> &gt; <a href="GUID-1AFAD1C4-340B-4119-94A8-F50E9D8DA8E6.html" title="This document introduces the use of timers by device drivers.">Timers</a> &gt; </div>
<h1 class="topictitle1">Nanokernel
Timer</h1>
<div><p>This document describes nanokernel timers.</p>

<div class="section" id="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-2788AEE3-FF4A-49CD-9093-00D28EEA49A6"><a name="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-2788AEE3-FF4A-49CD-9093-00D28EEA49A6"><!-- --></a><h2 class="sectiontitle">Creation</h2> <p> <a href="GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2.html"><span class="apiname">NTimer</span></a> is
a basic relative timer provided by the nanokernel. It can generate either
a single interrupt or periodic interrupts. A timeout handler is called when
the timer expires, either from the timer ISR or from the nanokernel timer
thread. These timer objects can manipulated from any context. The timers are
driven from a periodic system tick interrupt, usually a 1ms period. The use
of <samp class="codeph">NTimer</samp> is as follows: </p>
</div>

<div class="section" id="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-AA99FC77-5D00-41C5-A000-A2692DB32B10"><a name="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-AA99FC77-5D00-41C5-A000-A2692DB32B10"><!-- --></a><h2 class="sectiontitle">Start</h2> <p>The
nanokernel timer can be used in either single mode or in periodic mode. Typically,
the timer is started with <a href="GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2.html#GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2__GUID-0491D2BD-CF23-33A0-8531-28DD41AABE44"><span class="apiname">NTimer::OneShot()</span></a> for a timeout
period and then is made periodic by calling <a href="GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2.html#GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2__GUID-F544F71E-3BB8-3570-A8DE-44009BBFFD3D"><span class="apiname">NTimer::Again()</span></a>.
The timeout value specified for the timer is in nanokernel ticks. The time
out callback function can be chosen to be called in either an ISR context
or a DFC context (running in the kernel's nanokernel timer thread, called <samp class="codeph">DfcThread1</samp>). </p>
 <pre class="codeblock" id="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-680FD449-139A-57D2-AEC1-527E44ABC3AC"><a name="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-680FD449-139A-57D2-AEC1-527E44ABC3AC"><!-- --></a>TInt NTimer::OneShot(TInt aTime, TBool aDfc);
// If aDfc is TRUE then, the timeout function is called in a DFC context; 
// if aDfc is FALSE, the timeout function is called in a ISR context.

// Starts timer in zero-drift mode, to avoid delays in re-queuing
// the timer
TInt NTimer::Again(TInt aTime); 

// NTimer::OneShot() starts a nanokernel timer in one-shot mode with 
// ISR callback. It queues the timer to expire in the specified number 
// of nanokernel ticks. The actual wait time will be at least that 
// much and may be up to one tick more. The expiry handler will be 
// called in ISR context.
//
iRxPollTimer.OneShot(KRxTimeout);</pre>
</div>

<div class="section" id="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-96D4B91A-580A-4D0C-BFA5-2FFDDA8DF12A"><a name="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-96D4B91A-580A-4D0C-BFA5-2FFDDA8DF12A"><!-- --></a><h2 class="sectiontitle">Callback function </h2> <p>The
timeout callback function is called when a timer started with <a href="GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2.html#GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2__GUID-0491D2BD-CF23-33A0-8531-28DD41AABE44"><span class="apiname">NTimer::OneShot()</span></a> or <a href="GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2.html#GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2__GUID-F544F71E-3BB8-3570-A8DE-44009BBFFD3D"><span class="apiname">NTimer::Again()</span></a> expires.
A driver should implement the function to process the timeout event as appropriate
for the situation. </p>
 <pre class="codeblock" id="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-68C267FE-87B0-5B68-AB6B-69BEBB77B1D9"><a name="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-68C267FE-87B0-5B68-AB6B-69BEBB77B1D9"><!-- --></a>/**
 Timer callback function. Called when the NTimer expires
 typedef void(* NTimerFn)(TAny*); is the nanokernel timer callback
 function. This is used for Rx timeout.

 @params    aPtr
         pointer refernce passed during timer initialization
 */
void DExUartPhysicalChannelH4::RxPollTimerCallback(TAny* aPtr)
    {
    ... // design specific
    }</pre>
</div>

<div class="section" id="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-3D2ED5C0-35AD-4695-8945-256B5866BF61"><a name="GUID-F54BB3B5-D069-4524-A215-6F2CCA372666__GUID-3D2ED5C0-35AD-4695-8945-256B5866BF61"><!-- --></a><h2 class="sectiontitle">Cancellation</h2> <p>A
timer can be cancelled using <a href="GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2.html#GUID-D8CF05A3-5C9B-3662-92DA-3290C6EE7FD2__GUID-F03A72CF-AD7F-363E-A351-8DA50416D949"><span class="apiname">NTimer::Cancel()</span></a>. It removes
the timer object from the nanokernel timer queue. If the timer has already
expired, or is inactive, then it does nothing. </p>
 <p>If a timer was queued
and a DFC callback was requested, then the expiry handler might run even after <samp class="codeph">Cancel()</samp> has
been called. This occurs when the <samp class="codeph">DfcThread1</samp> is preempted
just before calling the expiry handler for this timer, and the preempting
thread/ISR/IDFC calls <samp class="codeph">Cancel()</samp> on the timer. </p>
</div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-1AFAD1C4-340B-4119-94A8-F50E9D8DA8E6.html" title="This document introduces the use of timers by device drivers.">Timers</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>