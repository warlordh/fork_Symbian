<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="SIP High Level API"/>
<meta name="DC.Relation" scheme="URI" content="GUID-057F1F82-56AF-5696-853E-79196A3D567E.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6425B722-4095-56E3-9198-70BA3E06C617.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-057F1F82-56AF-5696-853E-79196A3D567E.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>SIP High Level API</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2397554 id2397680 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-6425B722-4095-56E3-9198-70BA3E06C617.html">Multimedia Protocols Guide</a> &gt; <a href="GUID-057F1F82-56AF-5696-853E-79196A3D567E.html">SIP</a> &gt; </div>
<h1 class="topictitle1">SIP
High Level API</h1>
<div>
<p>The SIP High Level API encapsulates the SIP call flows inside the <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> and <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> APIs. The following SIP functionality is supported using <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> and <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> APIs: </p>

<ul>
<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-0A13EB92-CD3F-5F33-AE9F-3333BDFB5B03"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-0A13EB92-CD3F-5F33-AE9F-3333BDFB5B03"><!-- --></a><p>REGISTER - An application
that wants to start a SIP session must register to the SIP server. For more
information, see <a href="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09.html#GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-02CBB3C7-9B7C-5B49-8F29-56F235FF320E">Registration</a>. </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-63D5BA93-28C1-5CE6-A1AD-78AD21EF5C6F"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-63D5BA93-28C1-5CE6-A1AD-78AD21EF5C6F"><!-- --></a><p>INVITE - An invite session
is created for activities such as setting up a voice call, and a game session.
For more information, see <a href="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09.html#GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-EE044B0B-4664-57DA-BAE1-F9A3B99C453C">Session
initiation</a>. </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-40206112-EC3B-57EF-B316-F7C938EB2118"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-40206112-EC3B-57EF-B316-F7C938EB2118"><!-- --></a><p>SUBSCRIBE - SIP supports
subscription to events for example, message waiting, notifying the subscriber
about the current state of the event and any changes to its state. For more
information, see <a href="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09.html#GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-BF804D44-35A2-5997-9706-B48C2C30F2BE">Initiating
a session using SUBSCRIBE</a>. </p>
 </li>

</ul>

<p>The <samp class="codeph">INVITE</samp> and <samp class="codeph">SUBSCRIBE</samp> methods must
be registered. <a href="GUID-A412D2E5-C4BE-33F7-A610-ECBD1BD6BBF9.html"><span class="apiname">CSubConSIPInviteParamSet</span></a> and <a href="GUID-8ABE119B-CF5D-3FED-A26F-E889AE6B7663.html"><span class="apiname">CSubConSIPSubscribeParamSet</span></a> classes
provide the parameters. </p>

<p> <strong>Note</strong>: SIP High Level API is included in the Symbian OS v9.2 onwards. </p>

<div class="section" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-02CBB3C7-9B7C-5B49-8F29-56F235FF320E"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-02CBB3C7-9B7C-5B49-8F29-56F235FF320E"><!-- --></a><h2 class="sectiontitle">Registration</h2> <p>An
endpoint, for example a SIP enabled phone, that wants to start a SIP session
must use <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> to register with the SIP registrar.
For more information about RConnection, see<a href="GUID-BD8446C5-3ADE-59A6-A13A-A5482D6FC56F.html">Connection
Management</a> . <a href="GUID-506C0ECB-9424-3579-877E-1435F76B2594.html"><span class="apiname">ESOCK</span></a> provides an interface for the
user to access the SIP high level API. <a href="GUID-506C0ECB-9424-3579-877E-1435F76B2594.html"><span class="apiname">ESOCK</span></a> interacts
with the SIP high level API through the <samp class="codeph">Connection</samp> and <samp class="codeph">SubConnection</samp> providers.
Connection and SubConnection providers are <samp class="codeph">ESOCK</samp> server side
components that are loaded and called when <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> and <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> APIs
are used. </p>
 <p>The following figure shows the architectural layer where
the application interacts with SIP connection providers using SIPPARAMS. The
second layer comprising <a href="GUID-D4F08503-F1EF-3531-9C3C-4AF24A6255F0.html"><span class="apiname">RSocket</span></a>, <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a>,
and <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> constitute the SIPPARAMS. </p>
 <div class="fignone" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-57FDC30F-E5AD-5C9D-8D80-71B35CB905D4"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-57FDC30F-E5AD-5C9D-8D80-71B35CB905D4"><!-- --></a><span class="figcap">Figure 1.               Interface of Connection and Sub Connection.         
  </span>

<img src="GUID-FFE6BAF8-C093-53FC-8672-365BAF38E048_d0e558544_href.png"/>
</div>
 <p>The SIP high level API models the SIP with Connection and SubConnection
providers and makes it stackable against the unified comms-infras architecture.
This enables the future connection convergence. </p>
 <p><strong> Initial setup</strong> </p>
 <p>A
profile data store is required to get registered with the SIP Registrar. A
SIP registration profile is a data store containing the information required
for registration such as AOR which is the IP address of registrar. The data
profile must contain the following fields: </p>
 <ul>
<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-9419A4E2-40DB-52E4-9B70-89DEF5594CF6"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-9419A4E2-40DB-52E4-9B70-89DEF5594CF6"><!-- --></a><p>data profile type: Internet,
IMS, others </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-36207215-4ECE-5D08-AEFB-6D801DBA0902"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-36207215-4ECE-5D08-AEFB-6D801DBA0902"><!-- --></a><p>profile name IETF, IMS,
others </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-FF904FF9-9D4B-5B34-986F-8F565BDE8E41"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-FF904FF9-9D4B-5B34-986F-8F565BDE8E41"><!-- --></a><p>IAP name </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-C66C0664-B9A8-59C8-8C44-88634D7D2E94"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-C66C0664-B9A8-59C8-8C44-88634D7D2E94"><!-- --></a><p>profile AOR list (IP
address) </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-D85CF1F0-98CA-5947-90EB-0C4D0B96EBCC"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-D85CF1F0-98CA-5947-90EB-0C4D0B96EBCC"><!-- --></a><p>autoregistration </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-FC499704-39DC-55E1-80EC-3A3F8F0A8C53"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-FC499704-39DC-55E1-80EC-3A3F8F0A8C53"><!-- --></a><p>private ID </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-ED9C3D8E-A8CC-5D65-B381-81EC51264980"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-ED9C3D8E-A8CC-5D65-B381-81EC51264980"><!-- --></a><p>security negotiation </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-B400C58A-E180-54B7-A536-7B7103CD4274"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-B400C58A-E180-54B7-A536-7B7103CD4274"><!-- --></a><p>sigcomp </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-AB1D459F-CCEA-5D20-8FCE-02939F716093"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-AB1D459F-CCEA-5D20-8FCE-02939F716093"><!-- --></a><p>server (IP address of
registrar, outbound proxy) </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-999CAACE-4E8F-5EDA-877E-2A46580D9BA9"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-999CAACE-4E8F-5EDA-877E-2A46580D9BA9"><!-- --></a><p>server param (username,
realm, pwd) </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-B4AAE1EE-1A67-5FBE-8F75-9BCB01E2ECE2"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-B4AAE1EE-1A67-5FBE-8F75-9BCB01E2ECE2"><!-- --></a><p>default </p>
 </li>

</ul>
 <p>Manual registration by specifying parameters is not possible. If
connection details are not available, the connection is set up using the default <span class="filepath">profile.flag</span> file. </p>
 <p id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-D17BC438-09C2-58E9-ABE8-F18B8A285B4D"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-D17BC438-09C2-58E9-ABE8-F18B8A285B4D"><!-- --></a><strong>Creating an RConnection</strong> </p>
 <p>Create
an <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> to register to the SIP Registrar using the
following steps. <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> must be opened on an existing
socket server session, <a href="GUID-EF29C1D7-B1E5-370F-AE37-66231A6BE449.html"><span class="apiname">RSocketServ</span></a>. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-AC8B369E-1DC8-5868-95E2-B09FCFE4987E"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-AC8B369E-1DC8-5868-95E2-B09FCFE4987E"><!-- --></a>RSocketServ    socketServer;        // Create a client interface object to the socket server
RConnection    con;                        // Create an RConnection object
TRequestStatus status = KErrNone;                // object to hold the request completion status

// Establish the connection to the Socket server

User::LeaveIfError(socketServer.Connect());        // Returns KErrorNone if the connection is successful
CleanupClosePushL(socketServer);

TUint KAFSip = 0x10000;             //SIP protocol family id
TInt err = con.Open (socketServer,KAFSip);            //open the connection
TInt err1 = con.Start();                    // Start Rconnection to initiate the registration
</pre>
 <p>When registration to the SIP registrar is successful, <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> is
used to establish the SIP Invite or SIP Subscribe session. The <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> and <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> that
is established and opened are used for either inviting a call session or subscribing
for the message status. </p>
 </div>

<div class="section" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-565742FA-20AB-57A8-AB81-19664F9B2BC8"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-565742FA-20AB-57A8-AB81-19664F9B2BC8"><!-- --></a><h2 class="sectiontitle">Session initiation</h2> <p><strong>SIP
Params</strong> </p>
 <p>SIPPARAMS is used to simplify the interaction with the
SIP stack by abstracting the SIP functionality using the <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> and <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> APIs.  It
supports the basic SIP functionality. The complete SIP functionality is made
available through the SIP stack APIs. </p>
 <p id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-EE044B0B-4664-57DA-BAE1-F9A3B99C453C"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-EE044B0B-4664-57DA-BAE1-F9A3B99C453C"><!-- --></a><strong>Initiating
a session using INVITE</strong> </p>
 <p> <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> is used
to establish a SIP Invite session. A SIP invitation starts when an endpoint
such as a VoIP Softphone or VoIP Hardware tries to establish a session with
a remote compliant endpoint. A successful SIP invitation consists of an INVITE-OK-ACK
triplet message exchange. The calling endpoint tries to start a session with
SIP INVITE. This is followed by OK from the called endpoint, and by ACK from
the calling endpoint that finally establishes the SIP session. </p>
 <p>A SIP
session can be terminated by using BYE-200OK message exchange. Either the
calling or the called party can initiate the termination. </p>
 <p> <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> establishes
the SIP session using the three way communication of INVITE-OK-ACK and terminates
the call using BYE-200OK. </p>
 <p> <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> when
used on behalf of the calling endpoint, handles the message exchange independently
and provides the status whether the session is established, denied or not
reachable. The calling endpoint must fill the necessary SIP session parameters
that are used to determine the target. </p>
 <p> <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> when
used on behalf of the called endpoint alerts the user of an incoming call
such as a SIP invitation. The incoming call can be either accepted or rejected
using <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a>. The application is notified about
the outcome. The information about the calling endpoint is provided in a set
of specific parameters. </p>
 <p>The SIP parameters for an outgoing call is
set using <a href="GUID-A412D2E5-C4BE-33F7-A610-ECBD1BD6BBF9.html"><span class="apiname">CSubConSIPInviteParamSet</span></a> class. The following
code shows how to initiate a call. It is assumed that you have already registered
with the SIP registrar by creating an <samp class="codeph">RConnection</samp> object
and called <samp class="codeph">Open()</samp>. For more information, see <a href="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09.html#GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-D17BC438-09C2-58E9-ABE8-F18B8A285B4D">Creating an RConnection</a>. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-0DCB4778-33E7-5604-A7C4-ED534B48FA33"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-0DCB4778-33E7-5604-A7C4-ED534B48FA33"><!-- --></a>RSubConnection    subCon;    // Create an RSubConnection object
err=subCon.Open(socketServer,RSubConnection::ECreateNew,con); // Open subconnection onto the Rconnection
</pre>
 <p>Set the SIP Invite parameters. The following code shows how
to set the SIP Invite parameters. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-904E8A67-646D-5589-9144-60D4C2598A62"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-904E8A67-646D-5589-9144-60D4C2598A62"><!-- --></a>RSubConParameterBundle     sipBundle;            // create parameter bundle

// create SIP parameter set family
CSubConParameterFamily * family = CSubConParameterFamily::NewL(sipBundle,KSubConnCallDescrParamsFamily);

// create invite parameter set object
CSubConSIPInviteParamSet* sip = CSubConSIPInviteParamSet::NewL(*family,CSubConParameterFamily::ERequested);</pre>
 <p>Set
the SIP header values to the parameter set. The following code shows how to
set the SIP header values to the parameter set. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-E298FDDC-28CE-506D-A301-B5F04DC7D7AD"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-E298FDDC-28CE-506D-A301-B5F04DC7D7AD"><!-- --></a>_LIT8(KTo,"Sip:user@10.112.165.91");        //'To' header, SIP URI of called endpoint
TPtrC8 ptrTo(KTo());
sip-&gt;SetToL(ptrTo);         //Set'To', the target SIP URI to the SIP parameter set

_LIT8(KFrom, "Sip:user@10.112.165.62");        //'From' header, SIP URI of the calling endPoint
TPtrC8 ptrFrom(KFrom());
sip-&gt;SetFromL(ptrFrom);                //Set the 'From' header field to the SIP parameter set

_LIT8(KContact,"Sip:user@10.112.165.62");            //'Contact' header, the actual location of the calling endpoint
TPtrC8 ptrContact (KContact());
sip-&gt;SetContactL(ptrContact);                //Set the 'Contact' to the SIP parameter set 

_LIT8(KRequestUri, "Sip:user@10.112.165.91");    //Request URI, the actual Next hop or the Target
TPtrC8 ptrRequestUri(KRequestUri());
sip-&gt;SetRequestUriL(ptrRequestUri);             //Set the 'RequestUri' to the SIP parameter set</pre>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-916B4C73-B97B-5EC0-A70E-EFDD0FB51210"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-916B4C73-B97B-5EC0-A70E-EFDD0FB51210"><!-- --></a>TInt err = SubCon.SetParameters(sipBundle);         //Set The SIP parameters in the SubConnection
sipBundle.Close();                    //close the parameter bundle</pre>
 <p id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-8676EB5B-FA5D-51EC-9FAD-C36BB29A6392"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-8676EB5B-FA5D-51EC-9FAD-C36BB29A6392"><!-- --></a><strong>Establishing the INVITE
session</strong> </p>
 <p>To establish the SIP Invite session, use <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> to
start the subconnection. This initiates the Invite request. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-4A8E0FB2-7096-583F-9DF6-D0B2255F618A"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-4A8E0FB2-7096-583F-9DF6-D0B2255F618A"><!-- --></a>//Start the subconnection, effectively sending an Invite
TInt subConRet = subCon.Start(); 
// Session is established</pre>
 <p id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-BF804D44-35A2-5997-9706-B48C2C30F2BE"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-BF804D44-35A2-5997-9706-B48C2C30F2BE"><!-- --></a><strong>Initiating
a session using SUBSCRIBE</strong> </p>
 <p>An endpoint subscribes to a specific
service using a SIP SUBSCRIBE-200OK message exchange. The end point is notified
by means of a NOTIFY-200OK message exchange. To send the subscription and
receive notifications use <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a>. <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> is
also used to unsubscribe, which stops any further notifications. </p>
 <p>The
following code shows how you subscribe to a session and receive notifications.
It assumes that you have already registered with the SIP registrar by creating
an <samp class="codeph">RConnection</samp> object and calling <samp class="codeph">Open()</samp> on
it as explained in <a href="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09.html#GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-D17BC438-09C2-58E9-ABE8-F18B8A285B4D">Creating
an RConnection</a> section. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-B68FF753-0D48-54C2-8DE1-282658CE96BA"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-B68FF753-0D48-54C2-8DE1-282658CE96BA"><!-- --></a>RSubConnection    subCon;// Create an RSubConnection object
// Open subconnection onto the Rconnection
err=subCon.Open(socketServer,RSubConnection::ECreateNew,con);
</pre>
 <p>Set the SIP Subscribe parameters using <a href="GUID-8ABE119B-CF5D-3FED-A26F-E889AE6B7663.html"><span class="apiname">CSubConSIPSubscribeParamSet</span></a>.
This class provides the SIP subscribe parameters that are passed through the
subconnection to the SIP stack. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-3512DB0A-EE9E-5B59-92D5-46F65CB9F4B4"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-3512DB0A-EE9E-5B59-92D5-46F65CB9F4B4"><!-- --></a>RSubConParameterBundle     sipBundle;                 //    create parameter bundle

//create SIP parameter set family
CSubConParameterFamily * family = CSubConParameterFamily::NewL(sipBundle,KSubConnCallDescrParamsFamily);

// create subscribe parameter set object
CSubConSIPSubscribeParamSet* sip = CSubConSIPSubscribeParamSet::NewL(*family,CSubConParameterFamily::ERequested);</pre>
 <p>Set <samp class="codeph">the
required information that is, to</samp>, <samp class="codeph">from</samp>, <samp class="codeph">contact,</samp> and <samp class="codeph">reqURI</samp> header
values to the SIP subscribe parameter set as explained in <a href="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09.html#GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-EE044B0B-4664-57DA-BAE1-F9A3B99C453C">Initiating a session using INVITE</a> section. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-11671200-F24E-5278-9408-EE75399B25C2"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-11671200-F24E-5278-9408-EE75399B25C2"><!-- --></a>// Set the required information
_LIT8(KEventType, "messagewaiting");    // subscription event type
TPtrC8 ptrEventType (KEventType());
sip-&gt;SetEventTypeL(ptrEventType);     //Set the subscription event type to 'messagewaiting'

_LIT8(KAcceptType,  "application");    //accept type
TPtrC8 ptrAcceptType(KAcceptType());
sip-&gt;SetAcceptTypeL(ptrAcceptType); //set the accept type field to 'application'

_LIT8(KAcceptSubType,   "indication"); //accept subtype
TPtrC8 ptrAcceptSubType(KAcceptSubType());
sip-&gt;SetAcceptSubTypeL(ptrAcceptSubType);    //set the accept subtype

sip-&gt;SetExpires(3600);    // set the subscription Refresh timings

sip-&gt;SetAutoRefresh(ETrue); // set Auto Refresh to 'on' 

// pass SIP subscribe parameters through the subconnection
Tint err = subCon.SetParameters(sipBundle);
sipBundle.Close(); //close the parameter bundle

subCon.Start();    // Start the subscription
</pre>
 <p>To receive notifications to the subscribed events, <a href="GUID-106A74C7-9B70-3397-973C-E317C1F40C58.html"><span class="apiname">CSubConSIPNotificationEvent</span></a> class
is used. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-4D3A9189-1AA5-5275-A5B6-425085006A25"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-4D3A9189-1AA5-5275-A5B6-425085006A25"><!-- --></a>// Wait and receive notifications to events
while(ETrue)
{
TNotificationEventBuf evtBuf;         // Sub-connection event notification object

    TRequestStatus reqStatus;             // request status object

    User::WaitForRequest(reqStatus);
    TInt eventId = evtBuf.Id();                     // get sub-type id
    TInt groupId = evtBuf.GroupId();         // get group id of the event

if (eventId == KSubConSIPNotificationEventType &amp;&amp; groupId == KSubConSIPEventsUid)
        {
                CSubConSIPNotificationEvent * evtRes = (CSubConSIPNotificationEvent*)CSubConNotificationEvent::NewL(evtBuf);
                CleanupStack::PushL(evtRes);    
                ....................
                ....................
                CleanupStack::PopAndDestroy(evtRes);    

            // Since We do not want to receive more notifications in this stage, break from the loop.

                break;
        }

// we can wait again for another notification
subCon.EventNotification( evtBuf,EFalse, reqStatus);  //request for notification
}</pre>
 <p>Unsubscribe to events and unregister, refer to steps in the <a href="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09.html#GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-FB267A38-FFB3-5360-9DC8-3E42C5C546A4">Terminating
the session</a> section. </p>
 <p><strong>Setting authentication parameters</strong> </p>
 <p>A
remote party or a server may require authentication before it allows an endpoint
to establish a session with another endpoint. <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> provides
an authentication mechanism where the authentication information such as realm,
username and password must be provided while initiating the call. If a challenge
is received then <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> provides the realm and
initiates a new session with authentication parameters. </p>
 <p>Authentication
parameters are set in a subconnection parameter bundle as shown in the following
code fragment. Set the SIP authenticate parameter set using <a href="GUID-155DBCFD-76A4-3852-855E-0E0E8F1EC775.html"><span class="apiname">CSubConSIPAuthenticateParamSet</span></a>.
This class provides the SIP authenticate parameter values that are passed
through the subconnection to the SIP stack. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-BE7DB575-79EE-5D13-B3CB-041579DD5D57"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-BE7DB575-79EE-5D13-B3CB-041579DD5D57"><!-- --></a>RSubConParameterBundle     sipBundle;                         //    create parameter bundle
// Add authorisation parameters as new family
CSubConParameterFamily * family1 = CSubConParameterFamily::NewL(sipBundle,KSubConAuthorisationFamily );

// create authenticate parameter set object
CSubConSIPAuthenticateParamSet * authParam = CSubConSIPAuthenticateParamSet::NewL(*family1,CSubConParameterFamily::ERequested);
</pre>
 <p>Set <samp class="codeph">the required information that is, to</samp>, <samp class="codeph">from</samp>, <samp class="codeph">contact</samp>, <samp class="codeph">reqURI</samp> header field values to the SIP authenticate parameter set, similar to that
in <a href="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09.html#GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-EE044B0B-4664-57DA-BAE1-F9A3B99C453C">Initiating
a session using INVITE</a> section. </p>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-55C1E9B8-B6CB-565D-9163-31421965C01A"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-55C1E9B8-B6CB-565D-9163-31421965C01A"><!-- --></a>_LIT8(KRealm, "SFTF");
_LIT8(KUserName, "MyUserName");
_LIT8(KPwd, "pass123");

authParam-&gt;SetRealmL(KRealm);    //set the Realm parameter
authParam-&gt;SetUserNameL(KUserName);    // set the username
authParam-&gt;SetPasswordL(KPwd);                    //set the password

TInt err = subCon.SetParameters(sipBundle); //set the Authenticate parameters to the subconnection
sipBundle.Close();                    //close the parameter bundle</pre>
 <p>To
terminate the call session or unsubscribe to events and unregister, follow
the steps in <a href="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09.html#GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-FB267A38-FFB3-5360-9DC8-3E42C5C546A4">Terminating
the session</a> section. </p>
 </div>

<div class="section" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-FB267A38-FFB3-5360-9DC8-3E42C5C546A4"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-FB267A38-FFB3-5360-9DC8-3E42C5C546A4"><!-- --></a><h2 class="sectiontitle">Terminating
the session</h2> <p>To terminate the SIP INVITE or SUBSCRIBE session: </p>
 <ul>
<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-E1DABB93-F761-554F-82F9-78CAF0116A2C"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-E1DABB93-F761-554F-82F9-78CAF0116A2C"><!-- --></a><p>send BYE message by
closing the <a href="GUID-0AFDA357-EE44-3788-9CAB-162B874134BF.html"><span class="apiname">RSubConnection</span></a> session </p>
 </li>

<li id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-D8757702-DB58-5F75-A00A-9251B3975CFF"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-D8757702-DB58-5F75-A00A-9251B3975CFF"><!-- --></a><p>unregister with the
SIP registrar by closing the <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> session. </p>
 </li>

</ul>
 <pre class="codeblock" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-F5281FE3-651C-5DAD-9569-5A7C967233F0"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-F5281FE3-651C-5DAD-9569-5A7C967233F0"><!-- --></a>Int ret = subCon.Stop();    // Terminate the session, send BYE message

subCon.Close();        // close the subconnection

con.Stop();      // Terminate the connection

con.Close();        // Close the connection </pre>
 </div>

<div class="section" id="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-B6F7F947-1E4B-4DFD-80B4-70E5E890685A"><a name="GUID-4120651F-E0B9-5927-96B9-2662C51F5A09__GUID-B6F7F947-1E4B-4DFD-80B4-70E5E890685A"><!-- --></a><h2 class="sectiontitle">See also</h2> <p> <a href="GUID-FA4F1E9F-8775-51E4-99DD-D334E73319C5.html">Socket Server Protocols Overview</a>  </p>
 <p> <a href="GUID-6BB74A83-C6EA-5BC2-B60F-8186CC896725.html">Sockets Client Overview</a>  </p>
 <p><a href="GUID-BD8446C5-3ADE-59A6-A13A-A5482D6FC56F.html">Connection Management</a></p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-057F1F82-56AF-5696-853E-79196A3D567E.html">SIP</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>