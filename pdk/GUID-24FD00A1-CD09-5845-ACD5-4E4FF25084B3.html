<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Heap Management Guide"/>
<meta name="abstract" content="This document describes Heap management."/>
<meta name="description" content="This document describes Heap management."/>
<meta name="DC.Relation" scheme="URI" content="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Heap Management Guide</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2392072 id2392081 id2393700 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html" title="Provides a framework for accessing file systems.">User Library and File Server</a> &gt; <a href="GUID-A63025D1-7FD4-5120-8A1F-537D6B70103D.html" title="The User Library allows the applications and services that run on a phone to access the functionality provided by the Symbian platform Kernel.">User Library</a> &gt; <a href="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html" title="Memory is allocated to programs in chunks, the documentation in this set explains how to allocate, manage and release that memory.">Memory Management</a> &gt; </div>
<h1 class="topictitle1">Heap
Management Guide</h1>
<div><p>This document describes Heap management. </p>

<div class="section" id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-55CC7147-D437-4579-ADD9-F8418E19E7AC"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-55CC7147-D437-4579-ADD9-F8418E19E7AC"><!-- --></a><h2 class="sectiontitle">Purpose</h2> <p>The
heap is the area of memory used for dynamic memory allocation. Each thread
has a chunk which contains that thread's program stack. For the main thread
of a process, this chunk also contains the thread's heap. A request for memory
is allocated from this heap. </p>
 </div>

<div class="section" id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-D2FA14DD-D30F-4E7C-945B-BCD081FAFF3D"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-D2FA14DD-D30F-4E7C-945B-BCD081FAFF3D"><!-- --></a><h2 class="sectiontitle">Description</h2> <p>The
following are the Heap management APIs: </p>
 <ul>
<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-1CB48994-7F7D-5108-843B-ED0F7296F9E6"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-1CB48994-7F7D-5108-843B-ED0F7296F9E6"><!-- --></a><p>Heap Management is provided
by <a href="GUID-EFAFDD75-7E59-306A-882D-317F5564979E.html"><span class="apiname">RHeap</span></a>  </p>
 </li>

<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-A1551D95-6B6E-5CDA-A064-D2E0C9DCEEF2"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-A1551D95-6B6E-5CDA-A064-D2E0C9DCEEF2"><!-- --></a><p> <a href="GUID-9DB4A58C-6FC8-3292-A547-4C161BD188FC.html"><span class="apiname">RAllocator</span></a> is
the base class for <a href="GUID-EFAFDD75-7E59-306A-882D-317F5564979E.html"><span class="apiname">RHeap</span></a>  </p>
 </li>

</ul>
 <p>There are three <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html"><span class="apiname">User</span></a> functions that implement
the <samp class="codeph">RHeap</samp> functionality, they are shown here: </p>
 <a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-B67B7A5B-F895-5B08-9C37-490F5E853182"><!-- --></a><ol id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-B67B7A5B-F895-5B08-9C37-490F5E853182">
<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-B62CFCE3-C729-558F-AD2E-B9F5B363D82E"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-B62CFCE3-C729-558F-AD2E-B9F5B363D82E"><!-- --></a><p>To allocate a block
of memory: <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-96661CE0-03D4-3F0D-A725-4B5CD49CAD2D"><span class="apiname">User:: AllocL()</span></a> </p>
 </li>

<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-CF3BB275-A11F-52DB-9ABC-1D5C2AB95BC3"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-CF3BB275-A11F-52DB-9ABC-1D5C2AB95BC3"><!-- --></a><p>To free a block of allocated
memory: <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-A1B58B92-E9B2-3C0F-89B3-BA3230A1E14F"><span class="apiname">User::Free()</span></a> (Do not attempt to use this block
of memory again). </p>
 </li>

<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-B992EBC5-3FAB-55F4-ACA0-701F58109BF6"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-B992EBC5-3FAB-55F4-ACA0-701F58109BF6"><!-- --></a><p>To manage an allocated
block of memory to either grow or shrink the memory block as required: <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-076A396B-D9F1-3CB9-8D93-AF2E1D0C9415"><span class="apiname">User::ReAlloc()</span></a>.
This will preserve the data of the allocated block and move it into the new
resized block. </p>
 </li>

</ol>
 </div>

<div class="section" id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-16FCE4DE-D650-423B-AAED-5AADCEA10B1E"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-16FCE4DE-D650-423B-AAED-5AADCEA10B1E"><!-- --></a><h2 class="sectiontitle">Managing Heaps</h2> <p>Managing
heaps is very important to the increase the efficiency of virtual memory usage
when performing heap allocation. This reduces the virtual memory fragmentation
caused by heap allocation. The best way to manage heaps is to increment the
initially defined heaps to make an memory allocation. There by an entirely
new heap is created. The newly created heap may be added to the pool of heaps
from which an allocation may be made. The additional heaps are of a constant,
relatively large, size thereby reducing the risk of virtual memory fragmentation. </p>
 <p><strong>Accessing Heap</strong> </p>
 <p>A constant unsigned integer <a href="GUID-42DFD47A-05B0-3A63-B5E7-FDA41C701BF8.html"><span class="apiname">RHeapMinCellSize</span></a> is
defined to specify the minimum heap cell size that can be allocated and also
the minimum size needed to split the cell and add it to free list. It is exported
both from the kernel (<span class="filepath">EKERN.EXE</span>) as well as from the
user side (<span class="filepath">EUSER.DLL</span>). This can be configured during
the rom build time using patchdata (tool support). An entry needs to be added
in OBY / IBY file. </p>
 <p><strong> Heap
Balancing</strong> </p>
 <p>Memory heap balancing controls a size of a plurality
of memory heaps. The macros <span class="filepath">__UHEAP_MARK</span> and <span class="filepath">__UHEAP_MARKEND</span> are
used to enclose a section of code where you need to check whether the heap
is balanced. The description of these defined macros are listed below. </p>
 <p>__UHEAP_MARK
- to record the number of cells allocated in the heap </p>
 <p>__UHEAP_MARKEND
- a panic occurs to indicating a memory leak, if the heap does not have the
same number of cells allocated at the point of call </p>
 <p><strong>Monitoring Memory Leaks</strong> </p>
 <p>Monitoring heap usage for user-side
processes is chosen by the Memory Monitor client and provides the client with
data about the monitored processes dynamic memory usage of the following events:
allocation, de-allocation, reallocation, allocation failure, reallocation
failure, and heap corruption. </p>
 <p><strong>How
it works</strong> </p>
 <p>The EUser library contains the dynamic memory allocation
functions used by all applications on the device. These have been instrumented
such that they can optionally output Binary Trace log events to a kernel-side
buffer whenever the dynamic memory functions are called by an application. </p>
 <p>The
traces are enabled by the use of a special shim library <span class="filepath">eexe_monitor_heap.lib</span> which
must be linked with the application which is to be monitored. At run-time,
the Symbian platform Memory Monitor uses the ULogger tool to configure the
Binary Trace system to record dynamic memory event traces from applications,
and to retrieve the dynamic memory events from the BTrace buffer when they
occur. These events are then made available to Client Analyser programs via
a client/server interface upon request. The SOMM does not require any special
code to be compiled into application and can be used on debug targets (real
device and emulator) as well as release targets. </p>
 </div>

<div class="section" id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-9545237F-A0A6-4CB5-8D55-052A7FB1DEB6"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-9545237F-A0A6-4CB5-8D55-052A7FB1DEB6"><!-- --></a><h2 class="sectiontitle">Using Heap
Manager</h2> <p>Memory management is provided through the <a href="GUID-EFAFDD75-7E59-306A-882D-317F5564979E.html"><span class="apiname">RHeap</span></a> memory
allocator implementation, an implementation of <a href="GUID-9DB4A58C-6FC8-3292-A547-4C161BD188FC.html"><span class="apiname">RAllocator</span></a>.
In most cases though you would use the User functions that implement the <samp class="codeph">RHeap</samp> functions,
which are far easier to use. Much of the overhead involved in using <samp class="codeph">RHeap</samp> directly
is hidden away under the <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html"><span class="apiname">User</span></a> implementation. </p>
 <p>Use
the heap manager to: </p>
 <ul>
<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-599F41F7-9FB9-5220-A780-CDD7B5596989"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-599F41F7-9FB9-5220-A780-CDD7B5596989"><!-- --></a><p>allocate memory blocks </p>
 </li>

<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-A28C8217-8577-5022-9625-E03122D306C0"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-A28C8217-8577-5022-9625-E03122D306C0"><!-- --></a><p>release memory blocks
that are no longer required by the program </p>
 </li>

<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-B7625FD0-FB67-5FE6-9F2B-812AB807FC4B"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-B7625FD0-FB67-5FE6-9F2B-812AB807FC4B"><!-- --></a><p>return the number of
blocks and the number of bytes currently allocated. </p>
 </li>

<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-E680FD7A-F975-50F0-BD81-93D9EE6B73A8"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-E680FD7A-F975-50F0-BD81-93D9EE6B73A8"><!-- --></a><p>return the number of
bytes that are unused and the largest allocation that would succeed without
requesting more pages of memory. </p>
 </li>

<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-7C9B9299-914A-5B74-9DAB-05DAD1B96E84"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-7C9B9299-914A-5B74-9DAB-05DAD1B96E84"><!-- --></a><p>change the size of the
allocated memory block. </p>
 </li>

</ul>
 <p id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-0FD6F35E-2EB8-56BA-995C-23304EEBD4E0"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-0FD6F35E-2EB8-56BA-995C-23304EEBD4E0"><!-- --></a><strong>Allocate a memory block</strong> </p>
 <p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-67554CF1-F7D1-37E3-8088-1625B3FCEBB4"><span class="apiname">User::Alloc()</span></a> Is
used to allocate a block of memory of the size indicated by the single parameter. </p>
 <p><strong>Usage</strong> </p>
 <p>Use <samp class="codeph">User::AllocL()</samp> to: </p>
 <ul>
<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-E5972E33-7060-59A8-ABF3-8CC9E89F4670"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-E5972E33-7060-59A8-ABF3-8CC9E89F4670"><!-- --></a><p>allocate and commit
a region of the size requested. </p>
 </li>

</ul>
 <p><strong>Free
allocated memory</strong> </p>
 <p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-A1B58B92-E9B2-3C0F-89B3-BA3230A1E14F"><span class="apiname">User::Free()</span></a> Is used to release
a block of memory that had previously been allocated. Once freed a program
cannot use the same physical memory block. </p>
 <p><strong>Usage</strong> </p>
 <p>Use <samp class="codeph">User::Free()</samp> to: </p>
 <ul>
<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-D390DE7A-BCBC-5762-977A-E14E2E0D49CF"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-D390DE7A-BCBC-5762-977A-E14E2E0D49CF"><!-- --></a><p>release an allocated
block of memory. </p>
 </li>

</ul>
 <p><strong>Modify
allocated memory</strong> </p>
 <p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-076A396B-D9F1-3CB9-8D93-AF2E1D0C9415"><span class="apiname">User::ReAlloc()</span></a> Is used to
allocate a block of memory of the size indicated by the single parameter. </p>
 <p><strong>Usage</strong> </p>
 <p>Use <samp class="codeph">User::ReAllocL()</samp> to: </p>
 <ul>
<li id="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-E737B5FF-ACC8-593F-9650-C73C69D8FC88"><a name="GUID-24FD00A1-CD09-5845-ACD5-4E4FF25084B3__GUID-E737B5FF-ACC8-593F-9650-C73C69D8FC88"><!-- --></a><p>change the current size
of an allocated memory block. </p>
 </li>

</ul>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html" title="Memory is allocated to programs in chunks, the documentation in this set explains how to allocate, manage and release that memory.">Memory Management</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-9636A30F-39EB-54E6-8125-4487D4002FE0.html" title="Memory is allocated to programs in chunks, the documentation in this set explains how to allocate, manage and release that memory.">Memory  
              Management</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>