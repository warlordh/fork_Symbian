<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Sessions and Request Management"/>
<meta name="abstract" content="Describes how the MultiMediaCard Controller manages the sessions and sets the order of requests."/>
<meta name="description" content="Describes how the MultiMediaCard Controller manages the sessions and sets the order of requests."/>
<meta name="DC.Relation" scheme="URI" content="GUID-C6825C8F-8020-58CF-A09E-34558B1542DE.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CFD2236E-7775-5532-89CD-7D0E1E219FD8.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2F114BC9-9B5D-5989-9CF3-37A43377DC58.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-79B2CF91-FB95-5E7C-81CC-235A6A660D88.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9573F7B9-76E9-5DCB-A498-C0DE59606911.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C6825C8F-8020-58CF-A09E-34558B1542DE.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Sessions and Request Management</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2400576 id2400607 id2400622 id2400630 id2400650 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-CFD2236E-7775-5532-89CD-7D0E1E219FD8.html" title="Provides an overview of generic driver support.">Generic Driver Support</a> &gt; <a href="GUID-2F114BC9-9B5D-5989-9CF3-37A43377DC58.html" title="Provides the physical device drivers, called media drivers, and associated libraries that manage storage media hardware.">Media Drivers</a> &gt; <a href="GUID-79B2CF91-FB95-5E7C-81CC-235A6A660D88.html" title="The MMC Controller provides kernel extensions that manages access to the MultiMediaCard hardware on behalf of media drivers or any other device driver.">MMC Controller</a> &gt; <a href="GUID-9573F7B9-76E9-5DCB-A498-C0DE59606911.html" title="Describes the technology, architecture, and behaviour of the MMC Controller.">Concepts</a> &gt; <a href="GUID-C6825C8F-8020-58CF-A09E-34558B1542DE.html" title="This section describes the detailed structure and operation of the MMC Controller.">MMC Controller Operation</a> &gt; </div>
<h1 class="topictitle1">Sessions
and Request Management</h1>
<div><p>Describes how the MultiMediaCard Controller manages the sessions
and sets the order of requests. </p>

<p>When a number of drivers have a session with the MultiMediaCard Controller,
the MultiMediaCard Controller can have many requests to service. </p>

<div class="section" id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-9A51615A-4C00-572F-9AF4-1ED9CBC358F3"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-9A51615A-4C00-572F-9AF4-1ED9CBC358F3"><!-- --></a><h2 class="sectiontitle">Session queues</h2> <p>To
handle sessions, the MultiMediaCard controller implements a scheduler. The
MultiMediaCard stack has three internal queues: </p>
 <ul>
<li id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-0EB9FF38-2B49-5897-B663-352CEDAD8EF8"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-0EB9FF38-2B49-5897-B663-352CEDAD8EF8"><!-- --></a><p>an entry queue - this
is the queue onto which a session is initially added when a client submits
the session object by calling <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html#GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A__GUID-8DA6B49E-FED0-3E83-8D2F-EA7B61C28015"><span class="apiname">DMMCSession::Engage()</span></a> on
it. This is anchored in the <samp class="codeph">DMMCStack::iEntryQueue</samp> private
member. </p>
 </li>

<li id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-21EF4132-1FA5-5FB2-9E9E-543DCD8AC8F7"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-21EF4132-1FA5-5FB2-9E9E-543DCD8AC8F7"><!-- --></a><p>a ready queue - this
is the queue into which a session is moved when it is ready to be handled;
the scheduler moves all the sessions from the entry queue into the ready queue
when it can. This is anchored in the <samp class="codeph">DMMCStack::iReadyQueue</samp> private
member. </p>
 </li>

<li id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-5C903A7D-0540-5F09-9F41-147A98A5B4B9"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-5C903A7D-0540-5F09-9F41-147A98A5B4B9"><!-- --></a><p>a working set queue
- this is the queue of sessions to be processed as chosen by the scheduler.
This queue is limited to eight sessions. The scheduler moves a session from
the ready queue to the working set queue if all current sessions in the working
set queue are blocked and there are less than eight sessions in it. This is
anchored in the <samp class="codeph">DMMCStack::iWorkSet</samp> private member. </p>
 </li>

</ul>
 <p>All three queues are circular queues as implemented using the internal
Symbian platform class <samp class="codeph">TMMCSessionRing</samp>. </p>
 <div class="fignone" id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-E8B1FA7F-1759-52BC-A9D8-80FF7E39FE51"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-E8B1FA7F-1759-52BC-A9D8-80FF7E39FE51"><!-- --></a>
<img src="GUID-B30D6027-EB0F-578F-9B2F-AFC2DFD27E39_d0e397444_href.png"/>
</div>
 </div>

<div class="section" id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-FF74AAF0-D1F6-59A7-A859-B73DF946C92F"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-FF74AAF0-D1F6-59A7-A859-B73DF946C92F"><!-- --></a><h2 class="sectiontitle">The scheduler</h2> <p>Every
time one of the following events occurs, the MultiMediaCard stack invokes
its scheduler to deal with that event: </p>
 <ul>
<li id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-06C336CB-581E-59A3-96BA-D9C4BD43154E"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-06C336CB-581E-59A3-96BA-D9C4BD43154E"><!-- --></a><p>a client submitting
a session to the MultiMediaCard controller </p>
 </li>

<li id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-FFA95B03-F68F-5B1A-8A36-2D8F0D490AD1"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-FFA95B03-F68F-5B1A-8A36-2D8F0D490AD1"><!-- --></a><p>a client aborting a
session </p>
 </li>

<li id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-00D34161-C53E-5BED-9818-F0CCEED8FDF4"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-00D34161-C53E-5BED-9818-F0CCEED8FDF4"><!-- --></a><p>a card interrupt occurring. </p>
 </li>

</ul>
 <p>The stack invokes the scheduler by calling the internal function <samp class="codeph">DMMCStack::Scheduler()</samp>. </p>
 </div>

<div class="section" id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-193EAA8E-32F0-4331-A137-39DB3A47623D"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-193EAA8E-32F0-4331-A137-39DB3A47623D"><!-- --></a><h2 class="sectiontitle">Blocking a
session</h2><p>Sometimes, the MultiMediaCard controller has to perform
its processing in a DFC context. In those cases the Controller postpones operation
by queuing a DFC; the DFC call-back function then resumes the operation by
invoking the scheduler again. This means that the scheduler may be running
as part of a kernel executive call, a DFC or an interrupt service routine. </p>
 <p>In
general, the MultiMediaCard controller processes a session in stages, issuing
commands, checking responses, reading or writing data etc. Each stage is usually
done asynchronously, first setting up the activity and then setting up a means
of being notified when that activity is complete, for whatever reason (e.g.
issuing a command and setting up an interrupt when a response has been received). </p>
 <p>If
a session is waiting on an asynchronous operation, it is blocked. When one
session is blocked, the stack tries to process another session which isnâ€™t
blocked. </p>
 <p>The blocking of sessions is set up and implemented internally
to Symbian platform. However, the platform specific layer can block a session
by calling the <a href="GUID-B5193656-9819-3E00-A335-EEF1726115A5.html#GUID-B5193656-9819-3E00-A335-EEF1726115A5__GUID-E7B38752-F9AB-3A66-8FB6-E321717A63B5"><span class="apiname">DMMCStack::BlockCurrentSession()</span></a> function
with the <a href="GUID-8A9A2DD2-C630-3651-8374-17BCF2A09AC4.html"><span class="apiname">KMMCBlockOnASSPFunction</span></a> bit set in the parameter
passed to that function. </p>
 <p>Internally, the <samp class="codeph">DMMCSession::iBlockOn</samp> private
data member is set when a session is blocked. This is a bit-mask variable
containing the reason that the session is blocked. </p>
</div>

<div class="section" id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-E0D63F8B-D4BC-48E5-8601-D1B0FCFB1644"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-E0D63F8B-D4BC-48E5-8601-D1B0FCFB1644"><!-- --></a><h2 class="sectiontitle">Scheduler algorithm</h2><p>The
following flow-diagram shows the algorithm used by the scheduler. </p>
 <div class="fignone" id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-78F3CD78-61F3-5DD8-8D0D-9D5251D11158"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-78F3CD78-61F3-5DD8-8D0D-9D5251D11158"><!-- --></a>
<img src="GUID-AA53650C-664C-53F0-8BE9-445677FC1FE2_d0e397517_href.png"/>
</div>
 <p>The <a href="GUID-B5193656-9819-3E00-A335-EEF1726115A5.html"><span class="apiname">DMMCStack</span></a> private members referenced in this
diagram have the following meaning: </p>
 
<div class="tablenoborder"><a name="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-E1F971E8-949B-527B-B0EC-8D21BBB0EDE0"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-28844FE0-AE0F-531C-826E-CDA8400A0581__GUID-E1F971E8-949B-527B-B0EC-8D21BBB0EDE0" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">DMMCStack::iAbortReq</samp> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Set to <a href="GUID-781E8158-805B-3784-8FED-D7A191822FC3.html"><span class="apiname">ETrue</span></a> when there are sessions on the stack
that have been marked for abort by the client. This is set as a result of
a call to <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html#GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A__GUID-84B74DDE-4D86-3D25-BDC6-CEF580E8C0FB"><span class="apiname">DMMCSession::Abort()</span></a>. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">DMMCStack::iAttention</samp> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Set to <a href="GUID-781E8158-805B-3784-8FED-D7A191822FC3.html"><span class="apiname">ETrue</span></a> when there are sessions ready to
run. This is set when a session is submitted to the stack as a result of a
call to <a href="GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A.html#GUID-0186BEDE-8E28-3F8C-8CAE-A8B92F41F47A__GUID-8DA6B49E-FED0-3E83-8D2F-EA7B61C28015"><span class="apiname">DMMCSession::Engage()</span></a>, or when a session becomes
unblocked. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">DMMCStack::iCompReq</samp> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Set to <a href="GUID-781E8158-805B-3784-8FED-D7A191822FC3.html"><span class="apiname">ETrue</span></a> when there are sessions on the stack
ready to complete. This is set internally by the controller through calls
to the private functions <samp class="codeph">DMMCStack::MarkComplete()</samp> or <samp class="codeph">DMMCStack::CompleteAll()</samp>. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">DMMCStack::iInitialise</samp> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Set to <a href="GUID-781E8158-805B-3784-8FED-D7A191822FC3.html"><span class="apiname">ETrue</span></a> when stack initialization (CIM_INIT_STACK)
has been forced. This is set when the controller needs to re-power the stack,
and to power up a card on client requests. </p>
 </td>

</tr>

</tbody>

</table>
</div>
</div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-C6825C8F-8020-58CF-A09E-34558B1542DE.html" title="This section describes the detailed structure and operation of the MMC Controller.">MMC Controller Operation</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>