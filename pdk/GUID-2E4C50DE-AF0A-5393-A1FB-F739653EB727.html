<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Interfacing File Systems to the 64-bit File Server"/>
<meta name="abstract" content="Describes the changes to existing file system interface APIs."/>
<meta name="description" content="Describes the changes to existing file system interface APIs."/>
<meta name="DC.Relation" scheme="URI" content="GUID-C473F6B1-35E7-5A1E-B451-4EBD7064CCDC.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F3BD37EC-0CCB-5859-908F-215E22C9FC20.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C473F6B1-35E7-5A1E-B451-4EBD7064CCDC.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Interfacing File Systems to the 64-bit File Server</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2392072 id2399453 id2399496 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-0DF9E318-BE97-531E-AB39-A7B5E8787C87.html" title="Provides a framework for accessing file systems.">User Library and File Server</a> &gt; <a href="GUID-F3BD37EC-0CCB-5859-908F-215E22C9FC20.html" title="The File Server component manages all files on a Symbian platform phone. This section describes how to extend the File Server for your phone hardware.">File Server Extensions</a> &gt; <a href="GUID-C473F6B1-35E7-5A1E-B451-4EBD7064CCDC.html" title="This section discusses how to access large files using the 64-bit file server client API; how to intercept large file access from file server plugins and how to interface 3rd-party file systems with the file server to support large files.">Large File Access</a> &gt; </div>
<h1 class="topictitle1">Interfacing
File Systems to the 64-bit File Server</h1>
<div><p>Describes the changes to existing file system interface APIs. </p>

<div class="section" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-9F86B97F-2CBB-54DD-AF18-22B4A8C1AC48"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-9F86B97F-2CBB-54DD-AF18-22B4A8C1AC48"><!-- --></a><h2 class="sectiontitle">Introduction</h2><p>64-bit
versions of some functions have been added to the plugin framework to allow
you to handle large files. Other functions have been modified that they may
now handle larger files. Changes you may need to make to existing code are
detailed here. </p>
 <p>This is a list of 32-bit functions that have been replaced
with 64-bit equivalents to enable large files to be handled: </p>
<ul>
<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-EAFE1663-169F-58C9-BA7E-2CE8ED1AD79C"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-EAFE1663-169F-58C9-BA7E-2CE8ED1AD79C"><!-- --></a><p> <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-E591EB49-0E32-3428-8318-AB34B7469E79"><span class="apiname">CFileCB::Size()</span></a>  </p>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-D0232F4A-3CDC-5EA6-8664-304D39D42549"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-D0232F4A-3CDC-5EA6-8664-304D39D42549"><!-- --></a><p> <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-DA4988F5-651B-3CBA-BB7A-C435B985B53E"><span class="apiname">CFileCB::SetSize(TInt
aSize)</span></a>  </p>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-C1B2845F-E1F7-5264-AEFB-B962CEDAA6E6"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-C1B2845F-E1F7-5264-AEFB-B962CEDAA6E6"><!-- --></a><p> <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-64C7E8C3-44A1-30BC-95D5-B8A919DD4751"><span class="apiname">CFileCB::ReadL(TInt
aPos,TInt&amp; aLength,const TAny* aDes,const RMessagePtr2&amp; aMessage)</span></a>  </p>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-1989817D-F04E-5659-9F91-CA1782EE0362"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-1989817D-F04E-5659-9F91-CA1782EE0362"><!-- --></a><p> <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-0D0B98AC-709C-3512-8251-F6BB08E65098"><span class="apiname">CFileCB::WriteL(TInt
aPos,TInt&amp; aLength,const TAny* aDes,const RMessagePtr2&amp; aMessage)</span></a>  </p>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-82DA2B2C-2DAC-5627-A013-FE45BC38CC3D"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-82DA2B2C-2DAC-5627-A013-FE45BC38CC3D"><!-- --></a><p> <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-494116CC-1BF8-3226-89BB-110DE6CA3279"><span class="apiname">CFileCB::SetSizeL(TInt
aSize)</span></a>  </p>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-2A02A7C7-F45D-52CE-BA5F-D1816D766127"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-2A02A7C7-F45D-52CE-BA5F-D1816D766127"><!-- --></a><p> <a href="GUID-FADDE053-CC1C-39BC-A52D-27093041BE20.html#GUID-FADDE053-CC1C-39BC-A52D-27093041BE20__GUID-A0CC2AA6-0887-32E5-A067-4A61092861DB"><span class="apiname">CMountCB::ReadSectionL(const
TDesC&amp; aName,TInt aPos,TAny* aTrg,TInt aLength,const RMessagePtr2&amp;
aMessage)</span></a>  </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-71C79849-81B6-56EF-8983-615ADFFD229F"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-71C79849-81B6-56EF-8983-615ADFFD229F"><!-- --></a><h2 class="sectiontitle">Using the CFileCB
functions Size() and SetSize()</h2><div class="p">New functions have been added to
the class <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html"><span class="apiname">CFileCB</span></a> to allow the handling of 64-bit file
sizes. File system plugins using the existing 32-bit functions to support
large files should replace these with the 64-bit functions:<ul>
<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-B99707D7-7DC6-5434-9A66-B33BC6291A44"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-B99707D7-7DC6-5434-9A66-B33BC6291A44"><!-- --></a><p>use <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-C7D33970-B958-333E-B338-E99C6BE6CA64"><span class="apiname">CFileCB::Sze64()</span></a> instead
of <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-E591EB49-0E32-3428-8318-AB34B7469E79"><span class="apiname">CFileCB::Size()</span></a>  </p>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-EAD06C55-4CCB-5974-B22B-7CBA66C4D353"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-EAD06C55-4CCB-5974-B22B-7CBA66C4D353"><!-- --></a><p>use <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-FC2D5C0E-105E-37F3-9F5F-E24183071A3B"><span class="apiname">CFileCB::SetSize64(TInt64
aSize, TBool aDriveLocked)</span></a> instead of <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-DA4988F5-651B-3CBA-BB7A-C435B985B53E"><span class="apiname">CFileCB::SetSize(TInt
aSize)</span></a>. </p>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-803F0BB8-0A85-5296-9088-50EA3FBB2A73"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-803F0BB8-0A85-5296-9088-50EA3FBB2A73"><!-- --></a><div class="p">Replace 32-bit function
calls by 64-bit function calls and change <samp class="codeph">TInt</samp> variables
to <samp class="codeph">TInt64</samp>. <pre class="codeblock" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-991F4BF5-984B-5799-8A1D-B89BFEA5C59C"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-991F4BF5-984B-5799-8A1D-B89BFEA5C59C"><!-- --></a>CFileCB file;
TInt64    iSize;      
...
file-&gt;SetSize64(iSize, EFalse);</pre>
</div>
</li>

</ul>
</div>
 <p> The 32-bit versions of these functions are used widely by the
file server and the file system. Alter calls to the 32-bit versions of these
functions to handle large files. </p>
 </div>

<div class="section" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-BF5DB004-7BBC-5960-8726-1CAF98CE2790"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-BF5DB004-7BBC-5960-8726-1CAF98CE2790"><!-- --></a><h2 class="sectiontitle">Using the CFileCB
functions ReadL(), WriteL() and SetSizeL()</h2><p>If you use the <samp class="codeph">ReadL()</samp>, <samp class="codeph">WriteL()</samp> and <samp class="codeph">SetSize()</samp> functions, you must modify the implementation to replace them with their
64-bit versions: </p>
<ul>
<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-119274EC-FDC6-54C1-8725-C3ACEB37ED67"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-119274EC-FDC6-54C1-8725-C3ACEB37ED67"><!-- --></a><p> <a href="GUID-463972E3-5932-3AC1-84F7-BE865ECE57C7.html"><span class="apiname">ReadL(TInt64
aPos, TInt&amp; aLength, TDes8* aDes, const RMessagePtr2&amp; aMessage, TInt
aOffset)</span></a>  </p>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-A73F8B1E-C7E2-5789-86BF-4AEDDDF1D175"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-A73F8B1E-C7E2-5789-86BF-4AEDDDF1D175"><!-- --></a><p> <a href="GUID-7137C656-D259-3DF6-A9B8-78821DD26B3A.html"><span class="apiname">WriteL(TInt64
aPos, TInt&amp; aLength, const TDesC8* aDes, const RMessagePtr2&amp; aMessage,
TInt aOffset)</span></a>  </p>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-CEFC6B27-5ECE-5F2B-AEEC-2C2A02DEA54F"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-CEFC6B27-5ECE-5F2B-AEEC-2C2A02DEA54F"><!-- --></a><p> <a href="GUID-198B428B-06C2-3CC8-A692-9C8AB944FF6C.html"><span class="apiname">SetSizeL(TInt64
aSize)</span></a>  </p>
 </li>

</ul>
The file system plugin developer must implement the extended interface
class <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-E57D0ED6-C351-37F4-8E80-5A64144B6655"><span class="apiname">CFileCB::MExtendedFileInterface</span></a> to perform 64-bit
file accesses.<p>The file server retrieves the extended interface by calling <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-CBCFC605-C942-3D4E-8ABA-2EF454E5A44B"><span class="apiname">CFileCB::GetInterface()</span></a> with <samp class="codeph">EExtendedFileInterface</samp> as an argument. Sub-classes of <samp class="codeph">CFileCB</samp> that support large
file access will need to inherit this class and implement the interface. </p>
 <a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-CE9AD3AD-2CD6-5894-BFAA-BF247EC88625"><!-- --></a><ol id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-CE9AD3AD-2CD6-5894-BFAA-BF247EC88625">
<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-36045756-CA8F-515D-9B98-76981D57BF8D"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-36045756-CA8F-515D-9B98-76981D57BF8D"><!-- --></a><p>Derive <samp class="codeph">CYourFileSystemFileCB</samp> from
the classes <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html"><span class="apiname">CFileCB</span></a> and <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-E57D0ED6-C351-37F4-8E80-5A64144B6655"><span class="apiname">CFileCB::MExtendedFileInterface</span></a>. </p>
 <div class="p"><pre class="codeblock" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-81EFD4A3-46DF-5082-8DF8-9287A7D5BDCB"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-81EFD4A3-46DF-5082-8DF8-9287A7D5BDCB"><!-- --></a>class CYourFileSystemFileCB : public CFileCB,
                              ...
                              public CFileCB::MExtendedFileInterface
    {
public:
    // Implement this function to return the CFileCB::MExtendedFileInterface 
    // interface pointer to the file server.
    
    virtual TInt GetInterface(TInt aInterfaceId,
                              TAny*&amp; aInterface,
                              TAny* aInput);

public:
    // Implement the CFileCB::MExtendedFileInterface interface extension functions 
    // for 64-bit Read, Write and SetSize.
    virtual void ReadL(TInt64 aPos,
                       TInt&amp; aLength,
                       TDes8* aDes,
                       const RMessagePtr2&amp; aMessage,
                       TInt aOffset);
    virtual void WriteL(TInt64 aPos,
                        TInt&amp; aLength,
                        const TDesC8* aDes,
                        const RMessagePtr2&amp; aMessage,
                        TInt aOffset);
    virtual void SetSizeL(TInt64 aSize);
    ...
    }</pre>
 </div>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-70154DA9-F20B-5434-BFDA-4CD132394EE1"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-70154DA9-F20B-5434-BFDA-4CD132394EE1"><!-- --></a><p>In the function <samp class="codeph">CYourFileSystemFileCB::GetInterface()</samp>,
return the pointer to a <samp class="codeph">CYourFileSystemFileCB</samp> object through
the <samp class="codeph">aInterface</samp> output parameter when the input parameter <samp class="codeph">aInterfaceId</samp> is <a href="GUID-AC7AF411-725C-33C5-AE33-5F41701705B6.html#GUID-AC7AF411-725C-33C5-AE33-5F41701705B6__GUID-2FC24879-6235-3063-BB4B-CB57E4465E6E"><span class="apiname">CFileCB::TInterfaceId::EExtendedFileInterface</span></a>. This enables the file server to invoke the 64-bit functions for file access. </p>
 <div class="p"><pre class="codeblock" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-ED0A64F5-9EFF-5963-A884-8E5F44896C5E"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-ED0A64F5-9EFF-5963-A884-8E5F44896C5E"><!-- --></a>TInt CYourFileSystemFileCB::GetInterface(TInt aInterfaceId, 
                                         TAny*&amp; aInterface,
                                         TAny* aInput)
    {
    switch(aInterfaceId)
        {
        // For supporting large file ReadFileSection
        case CFileCB::EExtendedFileInterface:
            aInterface = (CFileCB::MExtendedFileInterface*) (this);
            return KErrNone;
        ...
        default:
            return(CFileCB::GetInterface(aInterfaceId, aInterface, aInput));
        }
    }</pre>
 </div>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-68E292D2-8D32-59C4-879F-F092F18F1C89"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-68E292D2-8D32-59C4-879F-F092F18F1C89"><!-- --></a><p>Implement the <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-E57D0ED6-C351-37F4-8E80-5A64144B6655"><span class="apiname">CFileCB::MExtendedFileInterface</span></a> functions <samp class="codeph">ReadL()</samp>, <samp class="codeph">WriteL()</samp> and <samp class="codeph">SetSizeL()</samp> in <samp class="codeph">CYourFileSystemFileCB</samp> class
to provide the 64-bit file access functionality. </p>
 <div class="p"><pre class="codeblock" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-5375842E-6856-5EEB-B164-4A005B7AD879"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-5375842E-6856-5EEB-B164-4A005B7AD879"><!-- --></a>void CYourFileSystemFileCB::ReadL(TInt64 aPos,
                                TInt&amp; aLength,
                                TDes8* aDes,
                                const RMessagePtr2&amp; aMessage,
                                TInt aOffset)
    {
    // 64-bit Read implementation.
    ...
    }

void CYourFileSystemFileCB::WriteL(TInt64 aPos,
                                 TInt&amp; aLength,
                                 const TDesC8* aDes,
                                 const RMessagePtr2&amp; aMessage,
                                 TInt aOffset)
    {
    // 64-bit Write implementation.
    ...
    }

void CYourFileSystemFileCB::SetSizeL(TInt64 aSize)
    {
    // 64-bit Set Size implementation.
    ...
    }</pre>
 </div>
 </li>

</ol>
<div class="note"><span class="notetitle">Note:</span>   <p>The <a href="GUID-63DF657C-434D-353D-A536-8AF9D97C8260.html#GUID-63DF657C-434D-353D-A536-8AF9D97C8260__GUID-E57D0ED6-C351-37F4-8E80-5A64144B6655"><span class="apiname">CFileCB::MExtendedFileInterface</span></a>  also
supports fair scheduling. Implementations of the functions <a href="GUID-E57D0ED6-C351-37F4-8E80-5A64144B6655.html#GUID-E57D0ED6-C351-37F4-8E80-5A64144B6655__GUID-A89B2E8F-4DEA-355E-9DCD-A4AACE016A10"><span class="apiname">CFileCB::MExtendedFileInterface::ReadL()</span></a> and <a href="GUID-E57D0ED6-C351-37F4-8E80-5A64144B6655.html#GUID-E57D0ED6-C351-37F4-8E80-5A64144B6655__GUID-DE844202-026F-3BE3-90D5-2E426E1A0D7D"><span class="apiname">CFileCB::MExtendedFileInterface::WriteL()</span></a> should also support <a href="GUID-5B24741C-7CE0-58E8-98C9-1D1CACCD476F.html#GUID-5B24741C-7CE0-58E8-98C9-1D1CACCD476F__GUID-CBF527A2-EF30-5D4D-9BF4-631748315BE9">Fair
scheduling</a>.</p>
</div>
 </div>

<div class="section" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-43DF580B-45D3-501B-A014-5CDF0B0B3FE2"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-43DF580B-45D3-501B-A014-5CDF0B0B3FE2"><!-- --></a><h2 class="sectiontitle">Using the CMountCB
function ReadSectionL()</h2><p>To enable large files access, calls to the
32-bit <a href="GUID-FADDE053-CC1C-39BC-A52D-27093041BE20.html#GUID-FADDE053-CC1C-39BC-A52D-27093041BE20__GUID-E5D9D0D9-2748-3F95-9E33-4127195A3FE6"><span class="apiname">CMountCB::ReadSectionL()</span></a> function should be replaced
by calls to the 64-bit <a href="GUID-FADDE053-CC1C-39BC-A52D-27093041BE20.html#GUID-FADDE053-CC1C-39BC-A52D-27093041BE20__GUID-B6078FAE-CC95-3DE0-B4C7-1B957CC650A2"><span class="apiname">CMountCB::ReadSection64L()</span></a> function. </p>
<pre class="codeblock">ReadSection64L(const TDesC&amp; aName, TInt64 aPos, TAny* aTrg, TInt aLength, const RMessagePtr2&amp; aMessage)</pre>
 <p>To enable 64-bit file access, you must implement the extended interface
class <samp class="codeph">CMountCB::MFileExtendedInterface</samp>. </p>
 <p>The file
server retrieves the interface by calling <a href="GUID-FADDE053-CC1C-39BC-A52D-27093041BE20.html#GUID-FADDE053-CC1C-39BC-A52D-27093041BE20__GUID-CABEF8F6-637C-3223-80C6-FBC8B7247030"><span class="apiname">CMountCB::GetInterface()</span></a> with <samp class="codeph">EFileExtendedInterface</samp> as
an argument. Sub-classes of <a href="GUID-FADDE053-CC1C-39BC-A52D-27093041BE20.html"><span class="apiname">CMountCB</span></a> that support large
file accesses need to inherit this class and implement the interface. </p>
 <a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-6298E69C-4275-5626-A3BE-799B780BD6EE"><!-- --></a><ol id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-6298E69C-4275-5626-A3BE-799B780BD6EE">
<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-83E32E94-CDCF-5410-8915-B59618EC150D"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-83E32E94-CDCF-5410-8915-B59618EC150D"><!-- --></a><p>Derive <samp class="codeph">CYourFileSystemMountCB</samp> from
the classes <a href="GUID-FADDE053-CC1C-39BC-A52D-27093041BE20.html#GUID-FADDE053-CC1C-39BC-A52D-27093041BE20__GUID-75BD3B63-51EB-3FCB-A96F-DE65C73E3983"><span class="apiname">CMountCB::MFileAccessor</span></a> and <a href="GUID-FADDE053-CC1C-39BC-A52D-27093041BE20.html"><span class="apiname">CMountCB</span></a>. </p>
 <div class="p"><pre class="codeblock" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-CB2471A8-2373-5C2C-949B-152A203E9639"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-CB2471A8-2373-5C2C-949B-152A203E9639"><!-- --></a>class CYourFileSystemMountCB : public CMountCB, public CMountCB::MFileAccessor
    {
    ...  

public:
    // Implement this function to return the CMountCB::MFileExtendedInterface
    // interface pointer to file server.
    virtual TInt GetInterface(TInt aInterfaceId,
                              TAny*&amp; aInterface,
                              TAny* aInput);
    ...

public:
    // The CMountCB::MFileExtendedInterface interface extension function 
    // for 64-bit read file section implementation
    virtual void ReadSection64L(const TDesC&amp; aName, 
                                      TInt64 aPos, 
                                      TAny* aTrg, 
                                      TInt aLength,
                                      const RMessagePtr2&amp; aMessage);
    ...
    }</pre>
 </div>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-A560B3AF-296F-5B8F-943C-FDB3ED1C8C8F"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-A560B3AF-296F-5B8F-943C-FDB3ED1C8C8F"><!-- --></a><p>When your implementation
of <samp class="codeph">GetInterface()</samp> is passed <a href="GUID-8B0D74A4-37CC-3ED5-851A-C677161EC0C1.html#GUID-8B0D74A4-37CC-3ED5-851A-C677161EC0C1__GUID-DD96F07B-9F44-39AF-B217-8FB7DECC932E"><span class="apiname">TInterfaceIds::EFileAccessor</span></a> through
the <samp class="codeph">aInterfaceId</samp> parameter, return a pointer to the <samp class="codeph">CYourFileSystemMountCB</samp> object
through the <samp class="codeph">aInterface</samp> output parameter. </p>
 <div class="p"><pre class="codeblock" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-AB4D1F74-73C3-5C54-8CF5-42C5471AA657"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-AB4D1F74-73C3-5C54-8CF5-42C5471AA657"><!-- --></a>TInt CYourFileSystemMountCB::GetInterface(TInt aInterfaceId, TAny*&amp; aInterface, TAny* aInput)
    {
    switch(aInterfaceId)
        {
        case (CMountCB::EFileAccessor):
            ((CMountCB::MFileAccessor*&amp;) aInterface) = this;
            return KErrNone;
        ...
        default:
            return(CMountCB::GetInterface(aInterfaceId, aInterface, aInput));
        }
    }</pre>
 </div>
 </li>

<li id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-F4D62E80-382F-5D25-9A11-6D6AB2044EBD"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-F4D62E80-382F-5D25-9A11-6D6AB2044EBD"><!-- --></a><p>Implement <samp class="codeph">CYourFileSystemMountCB::ReadSection64L()</samp> to
perform a 64-bit read from a file. </p>
 <div class="p"><pre class="codeblock" id="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-79DED59B-B1E9-58BC-8394-974D0DA16DE7"><a name="GUID-2E4C50DE-AF0A-5393-A1FB-F739653EB727__GUID-79DED59B-B1E9-58BC-8394-974D0DA16DE7"><!-- --></a>void CYourFileSystemMountCB::ReadSection64L(const TDesC&amp; aName,
                                                  TInt64 aPos,
                                                  TAny* aTrg,
                                                  TInt aLength,
                                                  const RMessagePtr2&amp; aMessage)
    {
    // 64-bit Read File Section implementation.
    ...
    }</pre>
 </div>
 </li>

</ol>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-C473F6B1-35E7-5A1E-B451-4EBD7064CCDC.html" title="This section discusses how to access large files using the 64-bit file server client API; how to intercept large file access from file server plugins and how to interface 3rd-party file systems with the file server to support large files.">Large File Access</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>