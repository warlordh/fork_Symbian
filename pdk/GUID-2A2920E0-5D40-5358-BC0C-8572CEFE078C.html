<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="SQL Expressions"/>
<meta name="abstract" content="This document explains how the optimizer changes expressions."/>
<meta name="description" content="This document explains how the optimizer changes expressions."/>
<meta name="DC.Relation" scheme="URI" content="GUID-831F9AA3-0209-53DC-96C4-04157F22870C.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F8824165-4B33-50D1-9706-BD2438B5A2EE.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-868D5B32-1CC4-506E-9C49-C86428B9A50F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C6D3827F-8F73-593E-A339-B510EEB9771F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-831F9AA3-0209-53DC-96C4-04157F22870C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-22844C28-AB5B-5A6F-8863-7269464684B4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-78773BCA-ADF6-53E6-AC80-5CB2AE1F8BCC.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E51836E1-D33E-506C-B75B-19B8E3CC313A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1F12E3F5-45B2-55EC-B021-00338277C608.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-43CA02E7-0101-5824-B91B-E15EE20C829A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-49A3419F-D20A-5C5D-B2FF-51724EF37704.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C2FAEBB2-4A1A-5BB0-9670-4801525CBC6A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B994E6F7-228A-5433-B87F-91857C5D93D6.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-4FC23DB7-4758-5DA4-81FF-0DAB169E2757.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-126FCCCC-0E7D-59AE-959A-2F94A7319C4B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-ACCCB148-DAF9-59EC-B585-8EF632B9BF04.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B7E978C1-45CA-554C-8028-D901B97BA2E0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>SQL Expressions</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2859821 id2860178 id2534422 id2534459 id2534479 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html" title="Provides services to enable and support persistence.">Persistent Data Services Guide</a> &gt; <a href="GUID-F8824165-4B33-50D1-9706-BD2438B5A2EE.html" title="The persistent storage collection.">Persistent Storage</a> &gt; <a href="GUID-868D5B32-1CC4-506E-9C49-C86428B9A50F.html" title="The Symbian SQL component.">Symbian SQL</a> &gt; <a href="GUID-C6D3827F-8F73-593E-A339-B510EEB9771F.html">SQL Concept Guides</a> &gt; <a href="GUID-831F9AA3-0209-53DC-96C4-04157F22870C.html" title="This topic discusses tips for SQL developers.">SQL Developer Tips</a> &gt; </div>
<h1 class="topictitle1">SQL Expressions</h1>
<div><p>This document explains how the optimizer changes expressions. </p>

<div class="section" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-D895B0EA-EC70-4664-BDBB-D49D05AB1360"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-D895B0EA-EC70-4664-BDBB-D49D05AB1360"><!-- --></a><h2 class="sectiontitle">Introduction</h2> <p>The way an expression is written really
does matter. When written well expressions not only clearly state what is
intended but they can also improve the performance of the SQL engine significantly.
This document provides several tips designed to help you improve your SQL
expressions. </p>
 <p><strong>Intended
audience:</strong> </p>
 <p>This document is intended to be used by Symbian platform
licensees and third party application developers. </p>
 </div>

<div class="section" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-5E95EACE-CC82-55CD-BF88-C8C92A3222E8"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-5E95EACE-CC82-55CD-BF88-C8C92A3222E8"><!-- --></a><h2 class="sectiontitle">Expression
Rewriting Optimizations</h2> <p>In an earlier section we described how
the optimizer would only make use of an index if one of the columns being
indexed occurred on one side of certain equality and comparison operators
(“<strong>=</strong> ”, “<strong>IN</strong> ”, “<strong>&lt;</strong> ”, “<strong>&gt;</strong> ”, “<strong>&lt;=</strong> ”,
“<strong>&gt;=</strong> ”, and sometimes “<strong>IS NULL</strong> ”). </p>
 <p>While this is technically
true, prior to the stage of the analysis where the optimizer is looking for
these kinds of expressions, it may have first modified the <samp class="codeph">WHERE</samp> clause
(or the <samp class="codeph">ON</samp> or <samp class="codeph">HAVING</samp> clause) from what was
originally entered by the programmer. </p>
 <p>The next few paragraphs will
describe some of these rewriting rules. </p>
 <p>The query optimizer always
rewrites the <samp class="codeph">BETWEEN</samp> operator as a pair of inequalities.
So, for example, if the input SQL is this: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-B864D593-8201-5A83-B8CF-55A4A1B8F42F"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-B864D593-8201-5A83-B8CF-55A4A1B8F42F"><!-- --></a>
SELECT * FROM demo324 WHERE x BETWEEN 7 AND 23;
</pre>
 <p>What the query optimizer ultimately sees is this: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-CC868858-4B31-5626-A85D-78816D033E69"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-CC868858-4B31-5626-A85D-78816D033E69"><!-- --></a>
SELECT * FROM demo324 WHERE x&gt;=7 AND x&lt;=23;
</pre>
 <p>In this revised form, the optimizer might be able to use an
index on the “x” column to speed the operation of the query. </p>
 <p>Another
rewriting rule is that a disjunction of two or more equality tests against
the same column is changed into a single IN operator. So if you write: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-AC72BB25-5BC4-520A-A93E-F8BC9D57A437"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-AC72BB25-5BC4-520A-A93E-F8BC9D57A437"><!-- --></a>
SELECT * FROM demo324 WHERE x=7 OR x=23 OR x=47;
</pre>
 <p>The WHERE clause will be rewritten into the following form: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-03269149-6080-5039-8817-A2A2A58195D2"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-03269149-6080-5039-8817-A2A2A58195D2"><!-- --></a>
SELECT * FROM demo324 WHERE x IN (7,23,47);
</pre>
 <p>The original format was not a candidate for use of indexes.
But after the disjunction is converted into a single IN operator the usual
index processing logic applies and the query can be made much faster. </p>
 <p>In
order for this rewriting rule to be applied, however, all terms of the disjunction
must be equality comparisons against the same column. It will not work to
have a disjunction involving two or more columns or involving expressions.
So, for instance, the following statements will not be optimized: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-2D2F87A3-BD6F-5849-819F-BA0226E4E215"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-2D2F87A3-BD6F-5849-819F-BA0226E4E215"><!-- --></a>
SELECT * FROM demo324 WHERE x=7 OR y=23;
SELECT * FROM demo324 WHERE x=7 OR +x=23;
</pre>
 </div>

<div class="section" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-4A75E712-CCF5-568A-894E-2684BA7A9D79"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-4A75E712-CCF5-568A-894E-2684BA7A9D79"><!-- --></a><h2 class="sectiontitle"> Put Constant
Subexpressions inside Subqueries</h2> <p>The query parser and compiler
in SQLite are designed to be small, fast, and lean. A consequence of this
design is that SQLite does not do much in the way of constant folding or common
subexpression elimination. SQLite evaluates SQL expressions mostly as written. </p>
 <p>One
way to work around the lack of constant folding in SQLite is to enclose constant
subexpressions within a subquery. SQLite does optimize constant subqueries
– it evaluates them once, remembers the result, and then reuses that result
repeatedly. </p>
 <p>An example will help clarify how this works. Suppose you
have a table that contains a timestamp recorded as the fractional julian day
number: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-0A40E590-A590-5AE2-9BC3-9EE627F92207"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-0A40E590-A590-5AE2-9BC3-9EE627F92207"><!-- --></a>
CREATE TABLE demo325(tm DATE, data BLOB);
</pre>
 <p>A query against this table to find all entries after November
8, 2006 might look like the following: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-89C0CA35-B2FC-5217-9E79-52C6C92CEFF8"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-89C0CA35-B2FC-5217-9E79-52C6C92CEFF8"><!-- --></a>
SELECT data FROM demo325 WHERE tm&gt;julianday('2006-11-08');
</pre>
 <p>This query works fine. The problem is that the “julianday('2006-11-08')”
function gets called repeatedly, once for each row tested, even though the
function returns the same value each time. It is much more efficient to call
the function one time only and reuse the result over and over. You can accomplish
this by moving the function call inside a subquery as follows: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-326760B0-E190-572D-ADD6-03786B6CB4FD"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-326760B0-E190-572D-ADD6-03786B6CB4FD"><!-- --></a>
SELECT data FROM demo325 WHERE tm&gt;(SELECT julianday('2006-11-08'));
</pre>
 <p>There are, of course, some cases where multiple evaluations
of a function in the WHERE clause is desirable. For example, suppose you want
to return roughly one out of every eight records, chosen at random. A suitable
query would be: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-1E734B78-91B6-542E-9EDC-52A378944D48"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-1E734B78-91B6-542E-9EDC-52A378944D48"><!-- --></a>
SELECT data FROM demo325 WHERE (random()&amp;7)==0;
</pre>
 <p>In this case, moving the function evaluation into a subquery
would not work as desired: </p>
 <pre class="codeblock" id="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-34B1C0C6-09E7-5994-9DD9-ABB4D5327BA7"><a name="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C__GUID-34B1C0C6-09E7-5994-9DD9-ABB4D5327BA7"><!-- --></a>
SELECT data FROM demo325 WHERE (SELECT random()&amp;7)==0;
</pre>
 <p>In this last example, the result would be either all of the
records in the table (probability 12.5%) or none of them (probability 87.5%).
The difference here, of course, is that the <samp class="codeph">random()</samp> function
is not constant whereas the <samp class="codeph">julianday()</samp> function is. </p>
 <p>The
SQL compiler does not have any way of knowing this so it always assumes the
worst: that every function works like <samp class="codeph">random()</samp> and can potentially
return a different answer even with the same inputs. Use a subquery if you
truly want to make a subexpression constant. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-831F9AA3-0209-53DC-96C4-04157F22870C.html" title="This topic discusses tips for SQL developers.">SQL Developer Tips</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-22844C28-AB5B-5A6F-8863-7269464684B4.html" title="This document introduces you to the Symbian platform implementation of the Structured Query Language(SQL).">SQL Overview</a></div>
<div><a href="GUID-78773BCA-ADF6-53E6-AC80-5CB2AE1F8BCC.html" title="This topic introduces you to the SQL server.">SQL Server
Guide</a></div>
<div><a href="GUID-1F12E3F5-45B2-55EC-B021-00338277C608.html" title="Used to access and query relational databases using the SQL query language.">SQL DB Overview</a></div>
<div><a href="GUID-43CA02E7-0101-5824-B91B-E15EE20C829A.html" title="This guide gives advice for avoiding the use of transient tables.">Avoid Transient
Tables</a></div>
<div><a href="GUID-49A3419F-D20A-5C5D-B2FF-51724EF37704.html">Prevent Datafile
Corruption</a></div>
<div><a href="GUID-C2FAEBB2-4A1A-5BB0-9670-4801525CBC6A.html" title="This document includes several tips for using SQL indexes.">SQL Index
Tips</a></div>
<div><a href="GUID-B994E6F7-228A-5433-B87F-91857C5D93D6.html" title="This guide provides some tips for using COMMIT statements.">SQL Insertion
Tips</a></div>
<div><a href="GUID-4FC23DB7-4758-5DA4-81FF-0DAB169E2757.html" title="This guide gives tips for using the database schema.">SQL Schema
Tips</a></div>
<div><a href="GUID-126FCCCC-0E7D-59AE-959A-2F94A7319C4B.html" title="This guide provides tips for using certain SQL statements.">SQL Statement
Tips</a></div>
<div><a href="GUID-ACCCB148-DAF9-59EC-B585-8EF632B9BF04.html" title="This guide explains how to use CROSS JOIN phrases to override the optimizer's ordering of tables.">SQL Joins</a></div>
<div><a href="GUID-B7E978C1-45CA-554C-8028-D901B97BA2E0.html" title="This guide gives details of how to use the ANALYZE command to help the optimizer."> ANALYZE
Command</a></div>
<div><a href="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217.html" title="This guide provides tips for using the WHERE clause."> SQL WHERE
CLause Tips</a></div>
</div>
<div class="relinfo"><strong>Related information</strong><br/>
<div><a href="GUID-E51836E1-D33E-506C-B75B-19B8E3CC313A.html">SQLite</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>