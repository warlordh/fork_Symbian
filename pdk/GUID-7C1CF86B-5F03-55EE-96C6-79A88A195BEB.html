<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Opening a Session - Reference"/>
<meta name="abstract" content="This topic provides additional information with regard to opening a session with Bluetooth GPS PSY."/>
<meta name="description" content="This topic provides additional information with regard to opening a session with Bluetooth GPS PSY."/>
<meta name="DC.Relation" scheme="URI" content="GUID-CD8BF818-ED63-5504-8382-346776D3B78F.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7F476137-5E7F-5288-9F4A-6C20F0A1AD9B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5CBF9CB3-1914-571C-B634-715EAF1272DA.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5454AFE9-ADC2-5980-85FC-3FF457B638D0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CD8BF818-ED63-5504-8382-346776D3B78F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-51177BB6-D906-57BD-91DD-EC263F900225.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Opening a Session - Reference</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2402590 id2403469 id2403500 id2403620 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-7F476137-5E7F-5288-9F4A-6C20F0A1AD9B.html">Location Based Services (LBS) Guide</a> &gt; <a href="GUID-5CBF9CB3-1914-571C-B634-715EAF1272DA.html" title="The Data Source Modules collection contains components that enable the LBS subsystem to obtain position data.">Data Source Modules</a> &gt; <a href="GUID-5454AFE9-ADC2-5980-85FC-3FF457B638D0.html" title="The Bluetooth GPS Positioning Module (Bluetooth GPS PSY) connects the LBS subsystem to an external Bluetooth GPS device.">Bluetooth GPS Positioning Module</a> &gt; <a href="GUID-CD8BF818-ED63-5504-8382-346776D3B78F.html" title="These documents describe NMEA and PNOK messages supported by the Bluetooth GPS PSY.">Bluetooth GPS PSY Reference</a> &gt; </div>
<h1 class="topictitle1">Opening a Session - Reference</h1>
<div><p>This topic provides additional information with regard to opening a session with Bluetooth GPS PSY. </p>
<div class="section"><h2 class="sectiontitle">Required background</h2> <p>Knowledge of the <a href="GUID-D0318BB6-0B9F-5A1C-AB0B-61BA22D28661.html" title="Client applications use the Location Acquisition API to obtain the position of the mobile device from the LBS subsystem.">Location Acquisition API</a> is helpful in understanding this topic. </p>
 </div>
 <div class="section"><h2 class="sectiontitle">Introduction</h2> <p>Steps that describe how to open the default PSY or a Bluetooth GPS PSY Session are provided <a href="GUID-51177BB6-D906-57BD-91DD-EC263F900225.html" title="This topic describes how to open a session with the Bluetooth GPS PSY.">here</a>. The sections that follow provide information on error codes and Bluetooth GPS PSY behavior during use. </p>
 </div>
 <div class="section" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-2C9F2B48-5E92-5C25-9C16-B93C34B223B7"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-2C9F2B48-5E92-5C25-9C16-B93C34B223B7"><!-- --></a><h2 class="sectiontitle">Error codes</h2> <p>This section describes some of the error codes that can be returned on construction of the Bluetooth GPS PSY. A client must check for error codes when it calls <a href="GUID-1EAEB7EF-0AC7-37C7-B35F-C9B780FFC575.html#GUID-1EAEB7EF-0AC7-37C7-B35F-C9B780FFC575__GUID-AF3D9B5F-8025-3AFF-A101-82025520EBD6"><span class="apiname">RPositioner::Open()</span></a> to create a subsession that uses the Bluetooth GPS PSY. </p>
 
<div class="tablenoborder"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-F6E6958C-3ABE-5EF8-9C54-377732F4E51A"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-F6E6958C-3ABE-5EF8-9C54-377732F4E51A" frame="border" border="1" rules="all"><thead align="left"><tr><th class="cellrowborder" valign="top" id="d1175062e60">Error Code</th>
 <th class="cellrowborder" valign="top" id="d1175062e63">Conditions for code return</th>
 </tr>
 </thead>
 <tbody><tr><td class="cellrowborder" valign="top" headers="d1175062e60 "><p> <samp class="codeph"> KErrNone</samp>  </p>
 </td>
 <td class="cellrowborder" valign="top" headers="d1175062e63 "><p>An instance of the Bluetooth GPS PSY was successfully constructed. </p>
 </td>
 </tr>
 <tr><td class="cellrowborder" valign="top" headers="d1175062e60 "><p> <samp class="codeph">KErrNoMemory</samp>  </p>
 </td>
 <td class="cellrowborder" valign="top" headers="d1175062e63 "><p>Construction of the PSY fails because the device is out of memory. </p>
 </td>
 </tr>
 <tr><td class="cellrowborder" valign="top" headers="d1175062e60 "><p> <samp class="codeph">KErrAlreadyExists</samp>  </p>
 </td>
 <td class="cellrowborder" valign="top" headers="d1175062e63 "><p>The PSY instance is already registered. This means some internal error in the Location Server Framework or in the PSY itself. The client application may need to be restarted to reload the PSY. </p>
 </td>
 </tr>
 <tr><td class="cellrowborder" valign="top" headers="d1175062e60 "><p> <samp class="codeph"> KErrOverflow</samp>  </p>
 </td>
 <td class="cellrowborder" valign="top" headers="d1175062e63 "><p>One of the parameters set in the PSY Central Repository initialisation file <samp class="codeph">101FE999.txt</samp> (<samp class="codeph">101FE999.cre</samp>) is out of range. </p>
 </td>
 </tr>
 <tr><td class="cellrowborder" valign="top" headers="d1175062e60 "><p> <samp class="codeph"> KErrUnderflow</samp>  </p>
 </td>
 <td class="cellrowborder" valign="top" headers="d1175062e63 "><p>One of the parameters set in the PSY Central Repository initialisation file is out of range. </p>
 </td>
 </tr>
 <tr><td class="cellrowborder" valign="top" headers="d1175062e60 "><p>Any other general Symbian platform error code </p>
 </td>
 <td class="cellrowborder" valign="top" headers="d1175062e63 "><p>Any other system error. </p>
 </td>
 </tr>
 </tbody>
 </table>
</div>
 <p>The following sections give more information about the behaviour of the Bluetooth GPS PSY during use. </p>
 </div>
 <div class="section" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-B253E1BD-59C4-5725-9899-16E495233DAA"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-B253E1BD-59C4-5725-9899-16E495233DAA"><!-- --></a><h2 class="sectiontitle">Loading the PSY and device selection</h2> <p>The Bluetooth GPS PSY is loaded dynamically when a client makes a request that requires its use (by one of the methods described above). </p>
 <p>If the mobile device is not already connected to a Bluetooth GPS device the PSY attempts to connect to one as follows: </p>
 <a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-00F3A5C5-5758-5FBB-9ECD-21E713F97A73"><!-- --></a><ol id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-00F3A5C5-5758-5FBB-9ECD-21E713F97A73"><li id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-383EE17B-8DE8-56D0-85EE-B825F8045996"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-383EE17B-8DE8-56D0-85EE-B825F8045996"><!-- --></a><p>The PSY automatically attempts to connect to the GPS device to which it was last successfully connected. The device address used is the one stored in the Central Repository setting <a href="GUID-2B93F706-EBA0-3201-BC03-CEEC2CDE3912.html"><span class="apiname">KBluetoothGpsPsyDeviceAddress</span></a>. The user may be queried for a passkey as part of this process in order to pair with the Bluetooth GPS device. </p>
 <p>Figure 1 shows this procedure, followed by an exchange of NMEA initialisation messages between the PSY and the GPS device. </p>
 </li>
 <li id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-9485F04B-ADA8-5DCF-B041-EE5702DB3AF9"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-9485F04B-ADA8-5DCF-B041-EE5702DB3AF9"><!-- --></a><p>If the PSY cannot connect to the GPS device to which it was last connected, it tries to connect to each of the GPS devices in the list managed through the <a href="GUID-2A137918-D949-5017-BB00-B93CFA8AA65F.html" title="The Bluetooth GPS PSY Configuration API enables client applications to manage a list of Bluetooth GPS devices.">Bluetooth GPS PSY Configuration API</a>. </p>
 </li>
 <li id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-97D7A84D-AFB9-5EBB-83E4-0CF7DFBEFB20"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-97D7A84D-AFB9-5EBB-83E4-0CF7DFBEFB20"><!-- --></a><p>If the PSY still cannot connect to a Bluetooth GPS device, the Bluetooth subsystem displays a device selection dialog asking for the Bluetooth GPS device details. </p>
 <p>If a connection can be made to the device, its address is stored in the Central Repository setting <samp class="codeph">KBluetoothGpsPsyDeviceAddress</samp>. The PSY tries to use this GPS device the next time it receives a client request (see [1] above). </p>
 <p>If a connection cannot be made to the device, or the device selection dialog is cancelled, the PSY remains loaded, but not connected to a Bluetooth GPS device. In this situation the PSY cannot obtain a position fix and must be reloaded. This can be achieved by restarting the application that loaded the PSY. </p>
 </li>
 </ol>
 <div class="fignone" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-9508DDA6-15FC-5C5F-B296-BBB2FE0E5DEA"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-9508DDA6-15FC-5C5F-B296-BBB2FE0E5DEA"><!-- --></a><span class="figcap">Figure 1. 
             Figure 1. Loading the Bluetooth GPS PSY 
          </span> <img src="GUID-6C9355AF-80BA-5DBD-81A4-E9475A118C94_d0e467707_href.png"/></div>
 </div>
 <div class="section" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-6C12D640-CE1E-5368-90E5-D9EF34C6B1CF"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-6C12D640-CE1E-5368-90E5-D9EF34C6B1CF"><!-- --></a><h2 class="sectiontitle">Bluetooth GPS Device initialisation</h2> <p>After connecting to a Bluetooth GPS device, the PSY does the following: </p>
 <ul><li id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-8DD56AFC-EE40-590A-AEE5-77CFA6986013"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-8DD56AFC-EE40-590A-AEE5-77CFA6986013"><!-- --></a><p>Attempts to switch the GPS device to NMEA mode. </p>
 <p>If the device cannot be switched to NMEA mode it cannot be used by the PSY. </p>
 </li>
 <li id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-9719862D-0824-599D-B3FE-972F6B24A159"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-9719862D-0824-599D-B3FE-972F6B24A159"><!-- --></a><p>Queries if the device supports PNOK NMEA extensions. </p>
 <p>If it supports PNOK, the PSY sets low power mode. For PNOK capable devices, the PSY is able to receive and report hardware status change messages through the Bluetooth GPS PSY Events API. </p>
 </li>
 <li id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-19C8DD06-8843-56E4-B0FB-739E44B9B372"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-19C8DD06-8843-56E4-B0FB-739E44B9B372"><!-- --></a><p>Requests that NMEA messages are sent with an interval of 1 second. </p>
 <p>NMEA messages are sent continuously to the PSY, but these are processed only when a location request is received from the Location Server. </p>
 </li>
 <li id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-4E3EE2A5-26DE-5F39-8F16-E60C5C0F96DE"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-4E3EE2A5-26DE-5F39-8F16-E60C5C0F96DE"><!-- --></a><p>Waits for requests for location from the Location Server. </p>
 </li>
 </ul>
 </div>
 <div class="section" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-CB2663ED-4711-5162-BE0C-FF2DB31C3B49"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-CB2663ED-4711-5162-BE0C-FF2DB31C3B49"><!-- --></a><h2 class="sectiontitle">Making a location request</h2> <p>When a location request is received from the Location Server, the PSY returns any cached position fix it has if it meets the position quality specified with the request. The position quality includes the horizontal and vertical position accuracy and the age of the position fix. These parameters can be specified by a Location Acquisition API client as part of the location request (see <a href="GUID-F6B5F777-D12F-5913-AECE-047DF8C72F1F.html" title="This document demonstrates how a client application uses the Location Acquisition API to get a position.">How to Get Location Information</a> for more information). </p>
 <p>If the cached position does not meet the quality criteria specified with the request, the PSY reads NMEA messages from the Bluetooth GPS device to obtain a position. The position is cached by the PSY and returned to the client. </p>
 <div class="fignone" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-2573FE3F-E638-5245-9138-490D1567F74E"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-2573FE3F-E638-5245-9138-490D1567F74E"><!-- --></a><span class="figcap">Figure 2. 
             Figure 2. Location request using the Bluetooth GPS PSY. 
          </span> <img src="GUID-B495BE4E-6567-5141-A857-31EF12B19362_d0e467766_href.png"/></div>
 </div>
 <div class="section" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-CDA4A58C-EE1B-5C34-A786-C2FC112C3C74"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-CDA4A58C-EE1B-5C34-A786-C2FC112C3C74"><!-- --></a><h2 class="sectiontitle">Tracking</h2> <p>The term <em>tracking</em> is used to describe the situation where a client specifies that it wants to receive periodic position updates from the Location Server. To start tracking a client calls <a href="GUID-E60595B9-B6E2-38E1-BE1E-A82113C7EC94.html#GUID-E60595B9-B6E2-38E1-BE1E-A82113C7EC94__GUID-AF7F4C64-937E-306C-B6C1-9CE0457F37DF"><span class="apiname">TPositionUpdateOptions::SetUpdateInterval()</span></a> before making its first <a href="GUID-1EAEB7EF-0AC7-37C7-B35F-C9B780FFC575.html#GUID-1EAEB7EF-0AC7-37C7-B35F-C9B780FFC575__GUID-321F6046-3551-3ACE-B0A3-26D51FAEB477"><span class="apiname">RPositioner::NotifyPositionUpdate()</span></a> call. See <a href="GUID-F6B5F777-D12F-5913-AECE-047DF8C72F1F.html" title="This document demonstrates how a client application uses the Location Acquisition API to get a position.">How to Get Location Information</a> for more information about using tracking. </p>
 <p>An NMEA-compliant Bluetooth GPS device sends periodic NMEA messages containing position fixes to the PSY. This is the required behaviour for tracking and means a client tracking request does not cause major changes to the behaviour of the PSY. A tracking request does prevent the PSY from entering the standby state, so that it is always ready to return the next position update. </p>
 </div>
 <div class="section" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-1C02463D-FBDF-5E04-9842-438C8ABD6DF4"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-1C02463D-FBDF-5E04-9842-438C8ABD6DF4"><!-- --></a><h2 class="sectiontitle">Cancelling a location request</h2> <p>A client cancels a location request by calling <a href="GUID-1EAEB7EF-0AC7-37C7-B35F-C9B780FFC575.html#GUID-1EAEB7EF-0AC7-37C7-B35F-C9B780FFC575__GUID-BF6665C5-2FC2-3C0D-8C4C-C46DC39B2027"><span class="apiname">RPositioner::CancelRequest()</span></a>. Calling this method informs the PSY that the position fix is no longer required. However, the PSY still obtains the fix from hardware and caches it for possible future use. </p>
 <div class="fignone" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-D9389737-6481-55F7-8CF7-02A43C6409AE"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-D9389737-6481-55F7-8CF7-02A43C6409AE"><!-- --></a><span class="figcap">Figure 3. 
             Figure 3. Cancelling a location request. 
          </span> <img src="GUID-0554F7DB-9102-5BB4-AD10-D6FDE77F1117_d0e467809_href.png"/></div>
 </div>
 <div class="section" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-C88E20CE-C7AD-5439-AE03-E83C18C3694B"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-C88E20CE-C7AD-5439-AE03-E83C18C3694B"><!-- --></a><h2 class="sectiontitle">Unloading the Bluetooth GPS PSY</h2> <p>The PSY is unloaded when the last client subsession using it is closed by calling <a href="GUID-1EAEB7EF-0AC7-37C7-B35F-C9B780FFC575.html#GUID-1EAEB7EF-0AC7-37C7-B35F-C9B780FFC575__GUID-DE09BADB-6D90-3995-A893-F949F9C37A2B"><span class="apiname">RPositioner::Close()</span></a>. The PSY closes the Bluetooth connection to the GPS device. </p>
 <div class="fignone" id="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-7DAC1058-31B3-57D6-B1AD-EC3A384E6966"><a name="GUID-7C1CF86B-5F03-55EE-96C6-79A88A195BEB__GUID-7DAC1058-31B3-57D6-B1AD-EC3A384E6966"><!-- --></a><span class="figcap">Figure 4. 
             Figure 4. Unloading the Bluetooth GPS PSY. 
          </span> <img src="GUID-BD347690-2644-59E5-8CC6-769A77274D51_d0e467827_href.png"/></div>
 </div>
 </div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-CD8BF818-ED63-5504-8382-346776D3B78F.html" title="These documents describe NMEA and PNOK messages supported by the Bluetooth GPS PSY.">Bluetooth GPS PSY Reference</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-51177BB6-D906-57BD-91DD-EC263F900225.html" title="This topic describes how to open a session with the Bluetooth GPS PSY.">
                Opening a Session with Bluetooth GPS PSY</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>