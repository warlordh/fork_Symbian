<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Importing Private Keys"/>
<meta name="DC.Relation" scheme="URI" content="GUID-33DC841A-D16E-5EEB-986C-CE6816B2EDB0.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A5DCCEB1-77DA-53C9-A1A3-07615DFCD403.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-BD7B20B9-0C04-5F71-8562-246BB60AE769.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B1FE58B4-58CC-57CB-8BB2-43CD781BF41A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-33DC841A-D16E-5EEB-986C-CE6816B2EDB0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6DF71555-1AB0-5B50-9FEA-E775F3AFEF8B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E90A22C7-0AD7-55C4-83BB-165E1AA1E296.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-62AE0683-642D-539A-A590-3D8210591BD9.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Importing Private Keys</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B"><a name="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2858558 id2859383 id2859628 id2859706 id2859720 id2859729 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-315452C2-A1E2-5888-A694-6D2DE73A3F5E.html">OS Security Guide</a> &gt; <a href="GUID-2663ED06-8C97-5867-B7F6-6167EBFEA223.html">Crypto Services</a> &gt; <a href="GUID-A5DCCEB1-77DA-53C9-A1A3-07615DFCD403.html">File-Based Certificate and Key Stores</a> &gt; <a href="GUID-BD7B20B9-0C04-5F71-8562-246BB60AE769.html">keytool</a> &gt; <a href="GUID-B1FE58B4-58CC-57CB-8BB2-43CD781BF41A.html">keytool Tutorials</a> &gt; <a href="GUID-33DC841A-D16E-5EEB-986C-CE6816B2EDB0.html">Manipulating Keys and Keystores</a> &gt; </div>
<h1 class="topictitle1">Importing
Private Keys</h1>
<div>
<p>The Symbian key store supports two types of key, DSA keys
and RSA keys. You can use <samp class="codeph">keytool</samp> to import private keys
stored into files. The keys must be stored in pkcs#8 DER encoded format. No
other type of encoding is supported. This means that you cannot import keys
stored in PEM format. The pkcs#8 encoding allows private keys to be stored
either in cleartext or encrypted using a password based cryptography scheme
(PBE). </p>

<p>Suppose the keystore is empty and you want to populate it by importing
private keys which are stored in your Symbian device file system. Start by
importing an RSA private key stored in the file pkcs8rsa.001: </p>

<p><kbd class="userinput">keytool –import c:\keystore\data\pkcs8rsa.001</kbd> </p>

<p>Since the keystore is empty, you should create a passphrase for it. A passphrase
is used to PBE encrypt the actual storage which the keystore uses as back-end.
After you enter a passphrase, the resulting output should be similar to: </p>

<pre class="codeblock" id="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-B7273601-4175-5B04-862D-CE39FD629D84"><a name="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-B7273601-4175-5B04-862D-CE39FD629D84"><!-- --></a>Symbian KeyStore Manipulation Tool
Copyright (c) 2004-2009 Nokia Corporation and/or its subsidiary(-ies).  All rights reserved.
Key imported successfully.
    Algorithm: RSA    Size: 512 bits
    Usage: Pkcs15 Sign     Code: 0x4
    Owner: 0x101f7e95
    User: 0x101f7e95
    Access Flags: Extractable
    ID: 4d 15 e9 01 …
    Label: c:\keystore\data\pkcs8rsa.001
    Native: Yes
    Start Date: not set     End Data: not set
</pre>

<p>A key always has a label associated with it. A label can be specified during
the import operation with the –label option, if this option is not present
the full path to the key file is taken as label. In this case, it is c:\keystore\data\pkcs8rsa.001.
Labels must be unique within a specific key store implementation. If a label
is not unique, an error occurs. For instance if the key store contains a certificate
with label abc: </p>

<pre class="codeblock" id="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-CBD728E3-35A7-5238-BBF4-3C0AC677C0D6"><a name="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-CBD728E3-35A7-5238-BBF4-3C0AC677C0D6"><!-- --></a>c:\&gt;keytool –list abc
Symbian KeyStore Manipulation Tool
Copyright (c) 2004-2009 Nokia Corporation and/or its subsidiary(-ies).  All rights reserved.
abc is a 1024 bits RSA key
</pre>

<p>If you try to import a key with the same label, an error will occur as
shown: </p>

<pre class="codeblock" id="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-1096FC57-312C-5F17-8DD5-047C156375BE"><a name="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-1096FC57-312C-5F17-8DD5-047C156375BE"><!-- --></a>c:\&gt;keytool –label abc –import c:\keystore\data\pkcs8rsa
Symbian KeyStore Manipulation Tool
Copyright (c) 2004-2009 Nokia Corporation and/or its subsidiary(-ies).  All rights reserved.
The given label is invalid, or already present in the keystore.
Error code: KErrAlreadyExist
</pre>

<p>However, this happens because of the attempt to insert the key in a keystore
implementation where the same label already exists. Remember that if you do
not specify the key store implementation to use in a command, the first (index
0) is used by default. You can insert the key with label abc in the keystore
implementation with index 1 (if such an implementation exists), as shown in
the following example: </p>

<pre class="codeblock" id="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-4FEBD5D3-FF18-57AD-AB49-350BEBBEF519"><a name="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-4FEBD5D3-FF18-57AD-AB49-350BEBBEF519"><!-- --></a>c:\&gt;keytool –label abc –store 1 –import c:\keystore\data\pkcs8rsa 
Symbian KeyStore Manipulation Tool
Copyright (c) 2004-2009 Nokia Corporation and/or its subsidiary(-ies).  All rights reserved.
Key imported successfully
    Algorithm: RSA    Size: 512 bits
    Usage: Pkcs15 Sign     Code: 0x4
    Owner: 0x101f7e95
    User: 0x101f7e95
    Access Flags: Extractable
    ID: 4d 15 e9 01 …
    Label: abc
    Native: Yes
    Start Date: not set     End Data: not set
</pre>

<p><strong>Setting key attributes </strong> </p>

<p>During key import, a number of key attributes can be specified. Most key
attributes can only be specified during import. The following options are
available to the import command: </p>


<div class="tablenoborder"><a name="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-A4CCE64E-5B99-5A79-BEFE-B5174B97C457"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-A4CCE64E-5B99-5A79-BEFE-B5174B97C457" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p>access </p>
 </td>

<td class="cellrowborder" valign="top"><p>Specifies the access attribute of the key. The only valid values
are Extractable for a key which can be exported and Sensitive for a key which
can only be exported in encrypted form. Other access flags are set automatically
by the key store. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p>usage </p>
 </td>

<td class="cellrowborder" valign="top"><p>Specifies the key usage as defined in the PKCS#15 standard. The
valid values depend on the type of the key being imported: </p>
 <ul>
<li id="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-6B3F680B-A6C9-563D-A200-950B8527CCB7"><a name="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-6B3F680B-A6C9-563D-A200-950B8527CCB7"><!-- --></a><p>DSA: The valid values
are sign and signrecover, which are identical from the keystore point of view.
External applications might consider them differently though. </p>
 </li>

<li id="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-778663EE-CE4A-51F4-9B96-76F2106C0234"><a name="GUID-2E02B840-FF86-5535-BA0E-5C4C3B600E9B__GUID-778663EE-CE4A-51F4-9B96-76F2106C0234"><!-- --></a><p>RSA: The valid values
are sign, signrecover, decrypt and unwrap. </p>
 </li>

</ul>
 </td>

</tr>

</tbody>

</table>
</div>

<p><strong>Wildcards </strong> </p>

<p>If you need to import a large set of keys, the above procedure might be
lengthy. <samp class="codeph">keytool</samp> offers wildcards to solve this problem.
You can specify a set of key files to be imported using the wild cards “*”
and “?”. For instance, suppose you want to import all the RSA key files in
the directory c:\keystore\data. You can do that depending on the actual file
names, with a command similar to: </p>

<p><kbd class="userinput">keytool –import c:\keystore\data\pkcs8rsa*.001</kbd> </p>

<p>The imported keys will have the file names as labels. </p>

<p><strong>Importing cleartext private keys </strong> </p>

<p>The pkcs8 private key format allows both cleartext and encrypted content.
All the previous examples refer to cleartext keys. In this case, no further
action is required from the user. </p>

<p><strong>Importing encrypted private keys </strong> </p>

<p>Importing encrypted private keys requires further user interaction. This
is because the keys are PBE encrypted and it is necessary to decrypt them
to perform a key import. You must, therefore, enter the passphrase for a given
encrypted key. </p>

<div class="note"><span class="notetitle">Note:</span> Either <span class="filepath">secdlg</span> or <span class="filepath">tsecdlg</span> need
to be in <span class="filepath">\epoc32\release\winscw\udeb</span>. However, if both
of them are there, it will cause a panic.</div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-33DC841A-D16E-5EEB-986C-CE6816B2EDB0.html">Manipulating Keys and Keystores</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-6DF71555-1AB0-5B50-9FEA-E775F3AFEF8B.html">Listing Keystore
Contents</a></div>
<div><a href="GUID-E90A22C7-0AD7-55C4-83BB-165E1AA1E296.html">Removing
Keys</a></div>
<div><a href="GUID-62AE0683-642D-539A-A590-3D8210591BD9.html">Working with
Multiple Keystore Implementations</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>