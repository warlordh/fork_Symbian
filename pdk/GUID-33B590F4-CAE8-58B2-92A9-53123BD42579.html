<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="SMS Tutorial"/>
<meta name="DC.Relation" scheme="URI" content="GUID-33C7EEEB-88B8-5587-916D-2C5D122F6010.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1A43A45B-80AE-56A0-A94C-64BA75519C67.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-DA6BB8BB-DD92-57A7-AD1B-F9CFF8CD433F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-33C7EEEB-88B8-5587-916D-2C5D122F6010.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9AF990D7-C490-5D60-9816-E84B5165A5B2.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>SMS Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2403778 id2403787 id2403795 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-1A43A45B-80AE-56A0-A94C-64BA75519C67.html">Messaging Application Guide</a> &gt; <a href="GUID-DA6BB8BB-DD92-57A7-AD1B-F9CFF8CD433F.html">Mobile Messaging</a> &gt; <a href="GUID-33C7EEEB-88B8-5587-916D-2C5D122F6010.html">SMS MTM</a> &gt; </div>
<h1 class="topictitle1">SMS
Tutorial</h1>
<div>
<p>Short Messaging Service (SMS) provides short text messaging between mobile
phones. Messages can be written and read by phone users. This tutorial demonstrates
the end-to-end procedure for creating and sending SMS messages. </p>


<div class="section"><h2 class="sectiontitle">Required background</h2> <p>Before you start, you must
understand: </p>
 <ul>
<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-784C3290-1D72-5F2F-83FE-E1E85F515B71"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-784C3290-1D72-5F2F-83FE-E1E85F515B71"><!-- --></a><p><a href="GUID-33C7EEEB-88B8-5587-916D-2C5D122F6010.html">SMS
MTM</a>  </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-72E82D46-00A0-5410-B05A-D8B6703B7132"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-72E82D46-00A0-5410-B05A-D8B6703B7132"><!-- --></a><p><a href="GUID-CADAABB4-C957-502E-BA4D-E9614C0D3878.html">Schedule
Send</a>  </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-CF3038DC-659A-5038-AC70-B6FC6BBF4E52"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-CF3038DC-659A-5038-AC70-B6FC6BBF4E52"><!-- --></a><p><a href="GUID-B394A824-8745-505E-8429-8B9B6D418387.html">Message
Server and Store</a>  </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-66775375-1A93-522F-B72F-CE353A566CB5"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-66775375-1A93-522F-B72F-CE353A566CB5"><!-- --></a><p><a href="GUID-8B843382-D27A-5E36-8F60-304903F3AA41.html">Message
Type Module</a>  </p>
 </li>

</ul>
 </div>


<div class="section"><h2 class="sectiontitle">Introduction</h2> <p>The SMS MTM provides functionality
for creating, storing and sending an SMS message, replying to a received SMS
message and forwarding an existing SMS message. A reply to a received SMS
message may include the original message text, including any EMS components.
Configurable parameters can apply either at a global level or on an individual
message basis. See <a href="GUID-CBFDD753-BAE3-5C40-B947-EB8CDA11CD23.html">SMS
concepts</a> for detailed information on how SMS functionality is implemented
in the Symbian platform. </p>
 <p>Global settings that are applied to the SMS
MTM are known as SMS service settings. Each SMS message entry has its own
individual group of settings known as SMS message settings. See <a href="GUID-24414E32-94DC-5870-847B-A797C495F756.html" title="The global settings that are applied to SMS MTM are known as the SMS service settings. Each SMS message entry has its own individual group of settings known as SMS message settings.">SMS
Settings</a> for more information. </p>
 <p>This tutorial explains <a href="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html#GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-21F18C1C-F081-5D6A-BD41-B349346AAFF4">how
to create and send messages</a>. It also explains <a href="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html#GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-CB828B5E-4517-538E-9F20-90AEC17C823A">how to handle incoming messages</a>. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Creating
and sending messages</h2> <a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-D5EBB762-72EE-5CFA-834D-597CC61FC76C"><!-- --></a><ol id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-D5EBB762-72EE-5CFA-834D-597CC61FC76C">
<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-3E213996-72AA-5860-A5E0-C7F80B2AF7A2"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-3E213996-72AA-5860-A5E0-C7F80B2AF7A2"><!-- --></a><p><a href="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html#GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-AD21D94E-91FA-50D2-B32C-BE4103D97B9B">Get a client MTM object</a>. </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-3226C878-5EB0-5511-8CD1-31A966CF0618"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-3226C878-5EB0-5511-8CD1-31A966CF0618"><!-- --></a><p><a href="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html#GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-89F63F2A-F868-553F-97AE-F5F207DA33CB">Create a message</a>. </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-3423C3F4-8CF2-50D7-A57B-BA089C78B171"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-3423C3F4-8CF2-50D7-A57B-BA089C78B171"><!-- --></a><p><a href="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html#GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-53C7AD41-91B5-5143-B002-C2F8981B9855">Set the message body</a>. </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-77B95197-7981-5FB9-AD02-726EA90EDACC"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-77B95197-7981-5FB9-AD02-726EA90EDACC"><!-- --></a><p><a href="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html#GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-766E0370-D4B6-55DE-AC30-699665324BD3">Set the message address</a>. </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-FE9BA0F1-F921-50B7-921B-A0AD5E67F4DF"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-FE9BA0F1-F921-50B7-921B-A0AD5E67F4DF"><!-- --></a><p><a href="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html#GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-0BD23194-9ED1-5F9B-94B5-EC54678B738B">Set the additional message fields, if required</a>. </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-183E7CE5-2015-52EC-8D5F-F33E81A51F35"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-183E7CE5-2015-52EC-8D5F-F33E81A51F35"><!-- --></a><p><a href="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579.html#GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-E698D0A6-D312-5759-A2EE-029871BA2076">Send the message</a>. </p>
 </li>

</ol>
<p><strong>Get a client MTM object</strong></p>
<p>The Messaging Framework is based
around a server program to which a connection (a session) must be made before
any operation on messaging can be done. The session class is called <a href="GUID-2DA04D96-F0AD-3FDC-9E36-1C27D889AF4B.html"><span class="apiname">CMsvSession</span></a>,
and message client applications typically create an instance of this class
upon start-up.</p>
<pre class="codeblock">// Create message server sessioniMsvSession = CMsvSession::OpenSyncL(*this);</pre>
<p>The <a href="GUID-A7121632-37BA-3CDC-AC80-8C6973F59108.html"><span class="apiname">OpenSyncL()</span></a> method takes a parameter of type <a href="GUID-BDE23754-4536-3AF7-8549-3B953F51167C.html"><span class="apiname">MMsvSessionObserver</span></a>.
For this code to work, the containing class must implement this observer interface.
It enables the server to call the client to inform it of significant events,
such as new MTMs being registered. </p>
 </div>

<div class="section" id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-CB828B5E-4517-538E-9F20-90AEC17C823A"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-CB828B5E-4517-538E-9F20-90AEC17C823A"><!-- --></a><h2 class="sectiontitle">Handling incoming
messages </h2> <p>Messaging receives SMS messages through a number of watcher
components. When a message is received its contents are read and a new entry
for the message is created in the Message Store (in the global inbox folder).
Typically these messages are then be read by the user through an SMS application,
but other messaging clients can receive notifications when a new message is
created in the store and can process the message if appropriate. </p>
 <p>To
receive such notifications, a class must implement the <a href="GUID-BDE23754-4536-3AF7-8549-3B953F51167C.html"><span class="apiname">MMsvSessionObserver</span></a> session
observer interface. The interface has just one function: </p>
 <pre class="codeblock" id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-0F785EE7-2B7D-5864-A5E1-212B0EB0E9A0"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-0F785EE7-2B7D-5864-A5E1-212B0EB0E9A0"><!-- --></a>void HandleSessionEventL(TMsvSessionEvent aEvent, TAny* aArg1, TAny* aArg2, TAny* aArg3)=0;</pre>
 <p>When a new message is created in the store, the framework calls this
function with <samp class="codeph">aEvent</samp> set to <samp class="codeph">EMsvEntriesCreated</samp>,
and <samp class="codeph">aArg1</samp> is set to a <samp class="codeph">CMsvEntrySelection*</samp> that
specifies the IDs of the entries that have been created. The following code
snippet checks the event type and gets the entry ID selection: </p>
 <pre class="codeblock" id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-9FAAFFD2-AFA2-58B4-9FE4-B0126F1B8BCC"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-9FAAFFD2-AFA2-58B4-9FE4-B0126F1B8BCC"><!-- --></a>void CClientApp::HandleSessionEventL(TMsvSessionEvent aEvent, TAny* aArg1, TAny* , TAny* )
    {
    CMsvEntrySelection* entries = NULL;

    switch (aEvent)
        {
        case EMsvEntriesCreated:
            entries = static_cast&lt;CMsvEntrySelection*&gt;(aArg1);
            break;
        default:
            break;
        }</pre>
 <p>The observer receives notifications for all types
of entry, so it is necessary to read the message properties to check that
the entry is appropriate to process. </p>
 <p>The following code snippet does
the first stage of checking: </p>
 <a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-75586A5B-9361-56CA-A18E-879FA38F6D3E"><!-- --></a><ol id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-75586A5B-9361-56CA-A18E-879FA38F6D3E">
<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-B216D3CF-B462-547A-ABD6-A94696D8545D"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-B216D3CF-B462-547A-ABD6-A94696D8545D"><!-- --></a><p>Gets the index entry
for the message. Getting an index entry is quick compared to getting the entire
message. Therefore, it is recommended that you perform the required checks
on this first. </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-2B4F2DBA-E443-5F9A-9BD3-23F184E0E475"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-2B4F2DBA-E443-5F9A-9BD3-23F184E0E475"><!-- --></a><p>Tests if the entry is
an SMS message, by checking the index entry's <samp class="codeph">iMtm</samp> and <samp class="codeph">iType</samp> fields </p>
 </li>

<li id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-3B839895-2DE9-5FD2-A566-23F857800F89"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-3B839895-2DE9-5FD2-A566-23F857800F89"><!-- --></a><p>Tests if it is an incoming
message, by checking that the entry is in the Inbox. </p>
 </li>

</ol>
 <pre class="codeblock" id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-DF3AB59E-2391-5A44-9BB9-0E9718562511"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-DF3AB59E-2391-5A44-9BB9-0E9718562511"><!-- --></a>if (entries)
    {
    TInt count = entries-&gt;Count();

    // check each entry to see if we want to process it
    while (count--)
        {
        // get the index entry
        TMsvId serviceId;
        TMsvEntry entry;
        iMtm-&gt;Session().GetEntry((*entries)[count], serviceId, entry);
        // if the entry is an SMS message
        if (entry.iMtm == KUidMsgTypeSMS &amp;&amp; entry.iType == KUidMsvMessageEntry
            // and if it's an incoming message (as its in the inbox)
            &amp;&amp; entry.Parent() == KMsvGlobalInBoxIndexEntryId)</pre>
 <p>An
application can now perform further checks, for example, for particular message
content. </p>
 <pre class="codeblock" id="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-9A15B728-19AD-5869-9D9A-55B0B9E8D4BB"><a name="GUID-33B590F4-CAE8-58B2-92A9-53123BD42579__GUID-9A15B728-19AD-5869-9D9A-55B0B9E8D4BB"><!-- --></a>//    sets the client MTM's context to the message 
             
iMtm-&gt;SwitchCurrentEntryL((*entries)[count]);
iMtm-&gt;LoadMessageL();
</pre>
 <p>If you determine that your application must process the message,
you can prevent the user from seeing the message in the Inbox of the standard
messaging application. To do this, you can set the message entry's visible
flag to false using <a href="GUID-5A23B804-2C06-3407-9D48-1BFB212D699F.html#GUID-5A23B804-2C06-3407-9D48-1BFB212D699F__GUID-05E571D2-785A-37AE-9162-DDED472F7B7B"><span class="apiname">TMsvEntry::SetVisible(EFalse)</span></a>. You
must delete the message once its processing is complete. </p>
 </div>

<div class="section"><h2 class="sectiontitle">SMS example</h2> <p><a href="GUID-2D9B17E7-2B7A-5E16-AB06-D9507457A85D.html" title="This example code demonstrates how to send and receive SMS messages using the Messaging Framework APIs.">smsexample:
SMS example</a>  </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-33C7EEEB-88B8-5587-916D-2C5D122F6010.html">SMS MTM</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-9AF990D7-C490-5D60-9816-E84B5165A5B2.html">BIO Watcher
Overview</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>