<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Media Driver Migration Guide"/>
<meta name="abstract" content="Describes the issues that need to be considered, when migrating media drivers to a writable data demand paging environment."/>
<meta name="description" content="Describes the issues that need to be considered, when migrating media drivers to a writable data demand paging environment."/>
<meta name="DC.Relation" scheme="URI" content="GUID-6381BC82-3060-5023-8221-79B18CCB2CDB.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F78B7BF9-5FDD-4EF8-A921-71CCBB830A99.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F123D574-44DE-528A-806C-DB64229BCEA2.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2B7D04D9-98DE-5284-836D-01DB4FA8949D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-6381BC82-3060-5023-8221-79B18CCB2CDB.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Media Driver Migration Guide</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2387995 id2388574 id2388657 id2388671 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-F78B7BF9-5FDD-4EF8-A921-71CCBB830A99.html" title="The device driver framework and how to implement a device driver.">Device Driver Guide</a> &gt; <a href="GUID-F123D574-44DE-528A-806C-DB64229BCEA2.html">Demand Paging</a> &gt; <a href="GUID-2B7D04D9-98DE-5284-836D-01DB4FA8949D.html">Writable Data Paging</a> &gt; <a href="GUID-6381BC82-3060-5023-8221-79B18CCB2CDB.html" title="Contains guides that describe various aspects of writable data paging in more detail.">Writable Data Paging Guides</a> &gt; </div>
<h1 class="topictitle1">Media
Driver Migration Guide</h1>
<div><p>Describes the issues that need to be considered, when migrating
media drivers to a writable data demand paging environment. </p>

<div class="section" id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-AB10DA2D-B7CC-47FD-B68A-1610B6BEAAE6"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-AB10DA2D-B7CC-47FD-B68A-1610B6BEAAE6"><!-- --></a><h2 class="sectiontitle">Purpose</h2> <p>This
document explains the points that have to be considered when migrating existing
media drivers to a writable data paging environment. </p>
  </div>

<div class="section" id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-EB26A48A-3A34-44E8-9651-C7ED658CED51"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-EB26A48A-3A34-44E8-9651-C7ED658CED51"><!-- --></a><h2 class="sectiontitle">Issues Involved</h2> <p>The
two main issues that have to be addressed when migrating existing media drivers
are: </p>
 <ul>
<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-68A44C67-6D4E-5D7E-A13B-0A82154073B2"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-68A44C67-6D4E-5D7E-A13B-0A82154073B2"><!-- --></a><p>A deadlock condition
can occur between the driver and the client process, where both are trying
to access the same page of paged memory</p>
 </li>

<li><p>A deadlock condition can occur between the driver and the client process,
where the client is allocating on the kernel heap, the paging system tries
to page out some data and the media driver also tries to allocate on the kernel
heap while servicing the resulting request.</p>
</li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-56A3815D-E07B-5195-85C3-0B93C08745C3"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-56A3815D-E07B-5195-85C3-0B93C08745C3"><!-- --></a><p>Unpredictable delays
in servicing a DFC can occur, since memory might need to be paged in.</p>
 </li>

</ul>
 <p>To address the above issues, the following points will have to be
considered/undertaken: </p>
 <ul>
<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-A15DB387-AB22-51BB-A4AD-0353932B788C"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-A15DB387-AB22-51BB-A4AD-0353932B788C"><!-- --></a><p>Pass data by value to
DoRequest/DoControl </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-0FB5B141-94FE-54E4-9915-2DD50F840879"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-0FB5B141-94FE-54E4-9915-2DD50F840879"><!-- --></a><p>Return results by using
a return code </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-9B3D3D25-010E-58C3-9C48-13AF494C3E62"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-9B3D3D25-010E-58C3-9C48-13AF494C3E62"><!-- --></a><p>Use of a dedicated DFC
queue </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-AADA0BD7-75E7-5A11-98EB-F7EF3E1B5139"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-AADA0BD7-75E7-5A11-98EB-F7EF3E1B5139"><!-- --></a><p>Determine if unpredictable
delays in servicing DFCs are acceptable </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-E5B45EC9-DF21-51A9-814C-17CF3C13DFAE"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-E5B45EC9-DF21-51A9-814C-17CF3C13DFAE"><!-- --></a><p>Validate the arguments
in the client context as far as possible </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-E6E4F7E2-1BE4-5590-AB05-777637C9B32B"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-E6E4F7E2-1BE4-5590-AB05-777637C9B32B"><!-- --></a><p>Move user memory accesses
to client context where possible </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-F4B44B27-9AE6-5A8C-B88C-C1809DAF6B89"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-F4B44B27-9AE6-5A8C-B88C-C1809DAF6B89"><!-- --></a><p>Replace the use of small
fixed-size structures with the use of the TClientDataRequest object </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-990D43F2-21C3-5C55-AC13-89C7153EA83B"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-990D43F2-21C3-5C55-AC13-89C7153EA83B"><!-- --></a><p>Pin user memory accessed
from DFCs </p>
<p>Do not allocate on the kernel heap while handling page out
requests.</p>
 <p>The paging algorithm can be over ridden and pages of memory
can be kept in memory (pinned). This situation can be reversed by 'unpinning'
the page. The TClientBufferRequest API provides this functionality. </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-67DB522A-DEB2-5FEA-ACA4-D80D09D80926"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-67DB522A-DEB2-5FEA-ACA4-D80D09D80926"><!-- --></a><p>Re-write the driver
to use shared chunks </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-A298C045-2260-55B5-89B9-595E3AF5472F"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-A298C045-2260-55B5-89B9-595E3AF5472F"><!-- --></a><p>No fast mutex may be
held when calling APIs that access user memory </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-F9F79078-0CBC-5E8F-899F-117D148C605A"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-F9F79078-0CBC-5E8F-899F-117D148C605A"><!-- --></a><p>No kernel mutex may
be held </p>
 </li>

<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-D378D276-CAF0-5B8B-BDA2-4D18EB87F96A"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-D378D276-CAF0-5B8B-BDA2-4D18EB87F96A"><!-- --></a><p>Use the new APIs, (See
the <a href="GUID-592B6D20-4ABA-5C79-9734-D18E2CE4A86C.html" title="Overview of data paging, the next phase in Symbian's implementation of demand paging.">Writable Data Paging
Overview</a> ). </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-32E564F3-D66A-472B-A3C1-D2D61807A5F2"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-32E564F3-D66A-472B-A3C1-D2D61807A5F2"><!-- --></a><h2 class="sectiontitle">See
also</h2> <ul>
<li id="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-77417650-C1F4-5ABC-9E75-54D274556FCD"><a name="GUID-FBE6E61F-5A2E-5A7A-BC59-51F072EBED7D__GUID-77417650-C1F4-5ABC-9E75-54D274556FCD"><!-- --></a><p> <a href="GUID-E7C55048-5B7A-5BF2-B7F4-4D731659B88C.html" title="Explains techniques for writing device drivers on data paged systems and migrating device drivers to data paged systems.">Device
Driver Writing and Migration Guide</a>  </p>
 <p>This document explains
techniques for writing device drivers on data paged systems and migrating
device drivers to data paged systems. </p>
 </li>

</ul>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-6381BC82-3060-5023-8221-79B18CCB2CDB.html" title="Contains guides that describe various aspects of writable data paging in more detail.">Writable Data Paging Guides</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>