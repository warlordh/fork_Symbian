<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Render Stages Overview"/>
<meta name="abstract" content="Render stages are ROM-based plug-ins to the Window Server render stage framework. They can be chained to form a rendering pipeline, which takes the draw operations that are produced by the Window Server and ultimately passes them to the UI surface. Render stages can selectively filter, modify, or redirect the draw operation stream, as required—for example, to perform transition effects (TFX)."/>
<meta name="description" content="Render stages are ROM-based plug-ins to the Window Server render stage framework. They can be chained to form a rendering pipeline, which takes the draw operations that are produced by the Window Server and ultimately passes them to the UI surface. Render stages can selectively filter, modify, or redirect the draw operation stream, as required—for example, to perform transition effects (TFX)."/>
<meta name="DC.Relation" scheme="URI" content="GUID-3A2785D4-6185-50C3-8D7E-5D94CD2B7C98.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-57A777A3-5D67-5CBB-B224-B7AD422A451B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0C4B86B5-530A-5839-86C1-46E7ABE281E0.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5D81D4E2-BE8B-58CE-A745-4F044DE2FB5F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3A2785D4-6185-50C3-8D7E-5D94CD2B7C98.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3A2785D4-6185-50C3-8D7E-5D94CD2B7C98.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-98EA7E2B-4AC6-55AE-985F-B5EE1E0A79E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-22093E74-EFE7-5642-93DE-1573E18F7C08.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Render Stages Overview</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2384330 id2384499 id2384574 id2384967 id2384982 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html">Graphics Guide</a> &gt; <a href="GUID-57A777A3-5D67-5CBB-B224-B7AD422A451B.html" title="The Windowing collection contains two components—the Window Server, which manages the use of the screen by applications, and the Window Server Plugins component.">Windowing Collection</a> &gt; <a href="GUID-0C4B86B5-530A-5839-86C1-46E7ABE281E0.html" title="The Window Server component manages the use of the screen by applications and handles key and pointer events.">Window Server Component</a> &gt; <a href="GUID-5D81D4E2-BE8B-58CE-A745-4F044DE2FB5F.html" title="This section describes the generic Window Server plug-in framework and is mainly aimed at system integrators, UI platform providers and device and hardware manufacturers.">Window Server Plug-in Framework</a> &gt; <a href="GUID-3A2785D4-6185-50C3-8D7E-5D94CD2B7C98.html" title="This section provides information about the render stage framework in ScreenPlay. This framework enables device creators to change the lower layers of the rendering pipeline without changing the Window Server code.">Render Stages</a> &gt; </div>
<h1 class="topictitle1">Render
Stages Overview</h1>
<div><p>Render stages are ROM-based plug-ins to the Window Server render
stage framework. They can be chained to form a rendering pipeline, which takes
the draw operations that are produced by the Window Server and ultimately
passes them to the UI surface. Render stages can selectively filter, modify,
or redirect the draw operation stream, as required—for example, to perform
transition effects (TFX). </p>

<p> <strong>Variant</strong>: <a href="GUID-D93978BE-11A3-5CE3-B110-1DEAA5AD566C.html" title="This topic provides an introduction to ScreenPlay and its architecture. ScreenPlay is a new graphics architecture, introduced in Symbian^3 (S^3). ScreenPlay enables device creators to take advantage of improved software performance, hardware acceleration and third party graphics engines. ScreenPlay is sometimes known as the New Graphics Architecture (NGA).">ScreenPlay</a>. <strong>Target
audience</strong>: Device creators. </p>

<p>Render stages therefore provide a mechanism for device creators to customize
the Window Server rendering pipeline without modifying the Window Server code.
In addition, in ScreenPlay the render stages are able to monitor and modify
display control attributes, and scale and position the application extent
within the full UI area. </p>

<p>Instead of using a concrete rendering API, the Window Server uses abstract
APIs, for which the render stage plug-ins provide the concrete implementations. </p>

<div class="section" id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-B431C15F-B567-5A6F-8E3F-1A45CE2FACDE"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-B431C15F-B567-5A6F-8E3F-1A45CE2FACDE"><!-- --></a><h2 class="sectiontitle">Architecture</h2> <p>The
following diagram shows where render stages fit into the Window Server architecture. </p>
 <div class="fignone" id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-B1321BD9-2EF4-5BB3-8226-880C460526C1"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-B1321BD9-2EF4-5BB3-8226-880C460526C1"><!-- --></a><span class="figcap">Figure 1.               Window Server architecture showing render stages    
       </span>

<img src="GUID-25A63716-D637-589D-BAB7-B962455F2DC6_d0e247301_href.png"/>
</div>
 <p>Symbian provides default render stage plug-ins, which are of production
quality and reproduce the rendering behavior in Symbian OS v9.4. In ScreenPlay,
device creators can replace the render stage plug-ins with their own bespoke
plug-ins. In the non-ScreenPlay variant, the interfaces are prototypes and
the render stage plug-ins should not be replaced in a real device. Note that
different APIs are used in ScreenPlay from the non-ScreenPlay variant. This
section documents the ScreenPlay APIs. </p>
 </div>

<div class="section" id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-E225354D-1EFC-513E-843E-42528C3FCCCF"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-E225354D-1EFC-513E-843E-42528C3FCCCF"><!-- --></a><h2 class="sectiontitle">Typical use
case</h2> <p>The primary use case is that a device creator adds a render
stage plug-in into the render stage chain in order to create transition effects
(TFX). For example, the device creator could add a TFX engine render stage
as shown in the following diagram. This could be used to slide in menus and
other elements of the user interface. </p>
 <p>The TFX render stage might redirect
relevant draw operations onto a TFX surface. Then later the TFX render stage
could inject those captured drawing operations into the displayed scene over
a sequence of frames, in order to create the desired effect. </p>
 <div class="fignone" id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-75F4A91E-D764-5BF4-8B21-74689EB43E7A"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-75F4A91E-D764-5BF4-8B21-74689EB43E7A"><!-- --></a><span class="figcap">Figure 2.               A typical render stage configuration, showing some of
the key              interfaces            </span>

<img src="GUID-0F2AE495-F6D8-5351-BD83-76D579564C2E_d0e247323_href.png"/>
</div>
 <p>The render stages are stacked on top of each other—effectively they
are chained into a pipeline, in which the Window Server "talks" only to the
first render stage. This render stage in turn talks only to the second render
stage. Notice that the second render stage uses a concrete rendering API to
control the UI surface. This is in contrast to the first render stage, which
uses the abstract <a href="GUID-44844998-D8BF-3F2F-9BA2-FB9BB497F8C0.html"><span class="apiname">MWsGraphicsContext</span></a> API, which acts as
a proxy for the concrete API. </p>
 <p>Let us look at how it works in sequence.
Redraw stores hold GDI draw operations and then play them back. The abstract
interface for GDI draw operations is <a href="GUID-44844998-D8BF-3F2F-9BA2-FB9BB497F8C0.html"><span class="apiname">MWsGraphicsContext</span></a> and
the redraw stores pass the draw operations on to the first render stage in
the chain using <a href="GUID-44844998-D8BF-3F2F-9BA2-FB9BB497F8C0.html"><span class="apiname">MWsGraphicsContext</span></a> calls. The first render
stage in the chain processes these and passes a possibly modified stream of
GDI operations on to the second render stage (which is the final render stage
in this example). This final render stage converts the GDI operations into
concrete rendering calls (such as BitGDI or OpenVG) for rendering into the
UI surface. However, alternatives are possible. For example, redraw stores
can also include <samp class="codeph">DrawWsGraphic()</samp> calls, which when played
back result in the execution of Content Rendering Plug-ins (CRPs). </p>
 <p>Window
Server clients can introduce <a href="GUID-495EA1C8-E95F-54AE-B4D1-0F463003C2D7.html" title="This topic provides an introduction to displaying an external surface on a window. The surface is then known as a background surface. This feature is available in ScreenPlay only.">external
surfaces</a> into the scene using <a href="GUID-1460DD8F-9AA1-3B99-8FFD-F309959CCA34.html#GUID-1460DD8F-9AA1-3B99-8FFD-F309959CCA34__GUID-4EBFFA14-418A-3A2A-B147-39BFC96CE45F"><span class="apiname">RWindowBase::SetBackgroundSurface()</span></a>.
These are tracked through the window tree using the abstract interface for
the composition context. The final render stage converts these abstract interface
calls into calls to the <a href="GUID-63CB6C7E-44EC-5D0B-A37D-FE78F7D76592.html" title="The Graphics Composition collection is a key part of ScreenPlay. The collection is made up of components that are concerned with composition. This is the process of putting together the output elements from various different sources to create the display that the viewer sees on the screen.">composition
interface</a>. </p>
 <p>Note that render stage chains are on a per-screen
basis. If there are multiple screens, there are multiple render stage chains.
The chains can use the same render stage classes, but they use different object
instances of those classes. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Implementing the interfaces</h2> <p>After it constructs
the render stage chain, the Window Server requests various interfaces from
the top render stage using the Window Server's object provider mechanism.
Some of the interfaces are mandatory, some are optional. </p>
 <p>Usually each
render stage in the chain implements the interfaces and passes the calls through
to the next render stage. For example, a TFX render stage might redirect some
GDI draw operations and play them back later, so that what passes in at the
top is not the same as what passes out at the bottom. In this case, the render
stage provides its own implementation of the interface, although that implementation
generally calls the implementation provided by the next stage. </p>
 <p>However,
sometimes a render stage does not need to make any modification to what passes
through the interface. Then the render stage does not provide an implementation—it
simply passes the draw operations through to the next render stage. For example,
generally only the final render stage needs to implement the <a href="GUID-B1E048A2-D5E8-3E7F-A6AC-6B8F3ED3067C.html"><span class="apiname">MWsScreenDevice</span></a> interface,
which provides information about the screen size and orientation. </p>
 <p>The
following diagram shows a concrete render stage implementing three of the
main <a href="GUID-11BC2AAA-FDB8-5600-8488-F27A9552E336.html" title="This topic builds on the Render Stages Overview and provides an introduction to the main render stage interfaces.">render stage interfaces</a>.
Although this is the usual practice, it is not mandatory. The concrete render
stage could instead delegate the implementation of some of the interfaces
to helper classes. </p>
 <div class="fignone" id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-84104CD3-C78C-50C7-9155-50596B3EE3EF"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-84104CD3-C78C-50C7-9155-50596B3EE3EF"><!-- --></a><span class="figcap">Figure 3.               A concrete render stage class implementing key render
stage              interfaces            </span>

<img src="GUID-973CF8E7-18C8-5E24-BC7A-97148FAEF3E4_d0e247392_href.png"/>
</div>
 </div>

<div class="section" id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-5D81D1A7-26A0-5461-9AC5-3EF359D283CB"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-5D81D1A7-26A0-5461-9AC5-3EF359D283CB"><!-- --></a><h2 class="sectiontitle">Advanced use
case</h2> <p>Render stages can optionally create their own <strong>visuals tree</strong> to
mirror the structure of the Window Server's window tree. The render stage
can then temporarily change the attributes of nodes in the tree and introduce
new nodes that the Window Server does not know about. This enables the render
stage chain to introduce sophisticated transition effects. </p>
 <p>To create
a visuals tree, the render stage must implement the <a href="GUID-028CC583-AC32-3D60-943A-A80F84E05DD2.html"><span class="apiname">MWsWindowTreeObserver</span></a> interface.
The Window Server uses this to communicate the structure of the window tree
to the render stage, so that the render stage can build up its replica tree. </p>
 <p>Similarly
render stages can optionally capture the drawing for each window from the
Window Server redraw stores and build up their own <strong>visuals stores</strong> to
store the drawing for the nodes in the visuals tree. To do this, the render
stage must implement the <a href="GUID-21240143-D578-3114-9836-F765F70A987C.html"><span class="apiname">MWsDrawAnnotationObserver</span></a>. The
Window Server uses this to communicate which node in the tree each batch of
drawing operations relates to. </p>
 <div class="fignone" id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-97D46D41-589A-504D-B7C0-9092E6E5DF17"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-97D46D41-589A-504D-B7C0-9092E6E5DF17"><!-- --></a><span class="figcap">Figure 4.               Render stage that has a visuals tree and visual stores
           </span>

<img src="GUID-3248A2B1-54D0-56E3-B770-DC595B01EA04_d0e247428_href.png"/>
</div>
 <p>Render stages that implement their own visuals stores typically
use the Window Server's <strong>change-tracking</strong> rendering mode. This is an
optimization of the <a href="GUID-22093E74-EFE7-5642-93DE-1573E18F7C08.html" title="This topic provides a brief introduction to the Window Server's rendering loop, which takes place in two stages, known as the upper loop and the lower loop.">Window
Server rendering loop</a> for render stages that build visuals stores.
The render stage is then responsible for playing back the drawing operations
in the visuals store whenever the screen is to be updated. Typically this
is done using a painter's-style algorithm. </p>
 <p>By implementing a visuals
tree and visuals stores, render stages can perform more complex TFX than is
possible otherwise. However, implementing a visuals tree and visuals stores
is not necessary for some TFX, such as sliding windows onto the screen. </p>
 <p> <em>Note</em>:
The painter's algorithm (sometimes called priority fill) is a common solution
in 3D computer graphics. The algorithm mimics the painting technique of painting
the distant parts of a scene before parts that are in the foreground, even
though this may result in covering up some of the distant areas. The algorithm
sorts the polygons in a scene by their depth and then draws them in order
from the back to the front. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Configuring the render stage chain</h2> <p>Parameters in
the <a href="GUID-1D529BDC-6665-58E2-AB3F-7023D8A84F69.html" title="This topic provides a reference to the wsini.ini file parameters. Some of the parameters are general, some are screen-specific and some are specific to individual plug-ins.">wsini.ini file</a> control
the configuration of the render stages as follows: </p>
 <ul>
<li id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-D7209CD8-A745-557E-B472-ECB188EF4A09"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-D7209CD8-A745-557E-B472-ECB188EF4A09"><!-- --></a><p>The <samp class="codeph">PLUGINS</samp> parameter
controls which render stages are loaded when the Window Server starts up.
In addition, a separate section specifies details (such as ID and type) for
each plug-in. </p>
 </li>

<li id="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-3F59881C-911B-5CD0-9704-78773F7B639B"><a name="GUID-2E8929E6-9555-51D2-B41D-6F1D05A4DB87__GUID-3F59881C-911B-5CD0-9704-78773F7B639B"><!-- --></a><p>The <samp class="codeph">RENDERSTAGES</samp> parameter
configures the render stage chain and the <samp class="codeph">CHANGETRACKING</samp> parameter
selects change-tracking rendering mode (instead of the default dirty-rectangle
tracking mode). You can specify these separately for each screen, so that
different effects can be used for each screen. </p>
 </li>

</ul>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-3A2785D4-6185-50C3-8D7E-5D94CD2B7C98.html" title="This section provides information about the render stage framework in ScreenPlay. This framework enables device creators to change the lower layers of the rendering pipeline without changing the Window Server code.">Render Stages</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-3A2785D4-6185-50C3-8D7E-5D94CD2B7C98.html" title="This section provides information about the render stage framework in ScreenPlay. This framework enables device creators to change the lower layers of the rendering pipeline without changing the Window Server code.">Render Stages</a></div>
<div><a href="GUID-98EA7E2B-4AC6-55AE-985F-B5EE1E0A79E7.html" title="This topic provides information about creating and configuring a render stage plug-in. It applies to ScreenPlay and is aimed at device creators and system integrators who want to create a customized rendering pipeline.">Creating
a Render Stage Plug-in</a></div>
<div><a href="GUID-22093E74-EFE7-5642-93DE-1573E18F7C08.html" title="This topic provides a brief introduction to the Window Server's rendering loop, which takes place in two stages, known as the upper loop and the lower loop.">Window Server
Rendering Loop</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>