<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="Enabling Application Level Roaming"/>
<meta name="abstract" content="Application-level roaming (ALR) enables your application to roam to use the best available data connection while operational."/>
<meta name="description" content="Application-level roaming (ALR) enables your application to roam to use the best available data connection while operational."/>
<meta name="DC.Relation" scheme="URI" content="GUID-D280276A-6E4C-41B7-B6EA-700B33B04981.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-D280276A-6E4C-41B7-B6EA-700B33B04981.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-49205F79-C17B-4126-BDB2-D759B91B5894"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Enabling Application Level Roaming</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387726 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-D280276A-6E4C-41B7-B6EA-700B33B04981.html" title="The IP Connection Management package provides services to accommodate automatic IP connection selection, application-assisted roaming logic, contention management for IP connections, IP connection monitoring and logging, settings management for IP connections, UI dialogs related to IP connections and managing PDP contexts.">IP Connection Management</a> &gt; </div>
<h1 class="topictitle1">Enabling
Application Level Roaming</h1>
<div><p>Application-level roaming (ALR) enables your application to roam
to use the best available data connection while operational.</p>

<div class="section" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-9B1466E3-661E-4BAB-A7F7-7F587FF8EBF1"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-9B1466E3-661E-4BAB-A7F7-7F587FF8EBF1"><!-- --></a>       <p>To use application-level
roaming: </p>
     </div>

<a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-4DD07DEC-6017-4237-BE46-1D69E5FBD744-GENID-1-12-1-17-1-1-6-1-3-2"><!-- --></a><ol id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-4DD07DEC-6017-4237-BE46-1D69E5FBD744-GENID-1-12-1-17-1-1-6-1-3-2"><li class="stepexpand" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-9A69E5AD-E938-4092-A8C2-CB65C37C8962-GENID-1-12-1-17-1-1-6-1-3-2-1"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-9A69E5AD-E938-4092-A8C2-CB65C37C8962-GENID-1-12-1-17-1-1-6-1-3-2-1"><!-- --></a><span>Initiate an Internet
connection using the Connection Manager API and the Internet destination network.
In this example it is assumed that the best available access point for Internet
is GPRS. </span>
            <p> RConnection handle is returned to the application. </p>
 
       
</li>
<li class="stepexpand" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-247DC723-B5D7-4E6B-B3E9-380DA63230B2"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-247DC723-B5D7-4E6B-B3E9-380DA63230B2"><!-- --></a><span>Register for mobility
API sending <a href="GUID-54ACF1D8-F501-37EB-A558-CEF005D84F14.html"><span class="apiname">NewL(RConnection handle, MMobilityProtocolResp&amp;)</span></a> to
the Connection Manager API.</span>
</li>
<li class="stepexpand" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-65B2CBFA-9631-4172-8B1A-665F09729871"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-65B2CBFA-9631-4172-8B1A-665F09729871"><!-- --></a><span>Use Sockets Client
API to open <a href="GUID-30FCE6D7-B7E2-317F-A72A-4AB908E92B34.html"><span class="apiname">RSockets</span></a> with <a href="GUID-BED8A733-2ED7-31AD-A911-C1F4707C67FD.html"><span class="apiname">RConnection</span></a> handle. </span>
 <p> RSocket handle is returned to the application.</p>

</li>
<li class="stepexpand" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-663CEB0D-A36D-46CB-8C2D-700D7DA76EF8"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-663CEB0D-A36D-46CB-8C2D-700D7DA76EF8"><!-- --></a><span>Initiate normal
socket communication to the Sockets Client API. This data transfer uses GPRS.
  A WLAN access point becomes available. The Connection Manager API sends <a href="GUID-EA7C9217-8989-3486-B50F-9EA5844A6F2F.html"><span class="apiname">PreferredCarrierAvailable(old
access point, new access point, is upgrade, not seamless</span></a>) to the
application.  The application decides to switch to the better access point.
It closes the old socket using the Sockets Client API. </span>
</li>
<li class="stepexpand" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-417D1229-320F-4B07-A429-9274163C7E01"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-417D1229-320F-4B07-A429-9274163C7E01"><!-- --></a><span>Send <a href="GUID-99D7A3EF-ACF5-3E11-B356-E77497884F1F.html"><span class="apiname">MigrateToPreferredCarrier()</span></a> to
the Connection Manager API.  Note: The application can also<a href="GUID-7B5530C5-A13F-3BC6-BC69-9B05993AFCB1.html"><span class="apiname"> IgnorePreferredCarrier()</span></a>.
In that case it would just keep using the existing socket.  The connection
is moved in the Connection Manager API. The WLAN access point is activated
and RConnection handle is moved from the GPRS interface to WLAN. <a href="GUID-EB635CFD-84A5-334B-8F48-85265E40A5A2.html"><span class="apiname"> NewCarrierActive(new
IAP)</span></a> is returned to the application.  The WLAN access point is now
ready to be used. </span>
</li>
<li class="stepexpand" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-284D53C0-516A-4F05-8422-918A6FCA036C"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-284D53C0-516A-4F05-8422-918A6FCA036C"><!-- --></a><span>Use Sockets Client
API to open RSockets with RConnection handle. This data transfer uses WLAN.</span>
</li>
<li class="stepexpand" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-27CF0583-4A43-4386-AFF6-E37E6DA15A64"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-27CF0583-4A43-4386-AFF6-E37E6DA15A64"><!-- --></a><span>Transfer data using
the Sockets Client API to confirm that the connection works.</span>
</li>
<li class="stepexpand" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-B7B7D14A-D241-49C2-84D0-147B780A70FF"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-B7B7D14A-D241-49C2-84D0-147B780A70FF"><!-- --></a><span>Send <a href="GUID-91FB265C-9924-3F59-8C7B-C68D65D72ABC.html"><span class="apiname">NewCarrierAccepted()</span></a> to
the Connection Manager API. This is the point of no return.</span>
</li>
<li class="stepexpand" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-239B2867-A34A-45EE-A843-8C913709CD47"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-239B2867-A34A-45EE-A843-8C913709CD47"><!-- --></a><span>Continue transferring
data using the Sockets Client API. This data transfer uses WLAN.</span>
</li>
</ol>

<div class="section" id="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-B55F3ECE-2C77-446C-8313-ED3B72BBF4DF"><a name="GUID-49205F79-C17B-4126-BDB2-D759B91B5894__GUID-B55F3ECE-2C77-446C-8313-ED3B72BBF4DF"><!-- --></a>       <p>ALR is enabled.</p>
 
   </div>

<div class="example"><pre class="codeblock">class CALRApplication : public CActive, public MMobilityProtocolResp
    {
...
    public: // From MMobilityProtocolResp
    void PreferredCarrierAvailable( TAccessPointInfo aOldAPInfo,
                                        TAccessPointInfo aNewAPInfo,
                                        TBool aIsUpgrade,
                                        TBool aIsSeamless );
  void NewCarrierActive( TAccessPointInfo aNewAPInfo, TBool aIsSeamless );
  void Error( TInt aError );
  private:    // Data
  RConnection  iConnection;
  CActiveCommsMobilityApiExt*   iMobility;
    };
// When the connection starts, iMobility is created and it registers the connection to receive mobility messages.
iMobility = CActiveCommsMobilityApiExt::NewL( iConnection, *this );When apreferred access point becomes available, the implementation of CALRApplication::PreferredCarrierAvailable is called. MigrateToPreferredCarrier Mobility message is sent to the middleware in order to roam to this preferred access point.
void CALRApplication::PreferredCarrierAvailable( TAccessPointInfo aOldAPInfo,TAccessPointInfo aNewAPInfo,TBool aIsUpgrade,TBool aIsSeamless ){
    // aOldAPInfo contains the current IAP used by the connection.
    // aNewAPInfo contains the newly available IAP that can be used by the connection.
 if ( aIsSeamless )
        {
        // It is Seamless. E.g. Mobile IP enabled.
        }
    else
        {
        // sockets used by the connection should be closed here.
        // We ask to migrate to the Preferred Carrier.
        iMobility-&gt;MigrateToPreferredCarrier();
        }
    }
Once the connection roamed to the new access point, the implementation ofCALRApplication::NewCarrierActive is called. The application reopens its sockets on the connection. If the socket connection is fine, the application sends the NewCarrierAccepted Mobility message to the middleware.

void CALRApplication::NewCarrierActive( TAccessPointInfo aNewAPInfo, TBool aIsSeamless )
    {
    // aNewAPInfo contains the newly started IAP used now by the connection.
    if ( aIsSeamless )
        {
        // It is Seamless. E.g. Mobile IP enabled.
        }
    else
        {
        // sockets used by the connection should be reopened here.
        // We accept the new IAP.
        iMobility-&gt;NewCarrierAccepted();
        }
    }</pre>
</div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-D280276A-6E4C-41B7-B6EA-700B33B04981.html" title="The IP Connection Management package provides services to accommodate automatic IP connection selection, application-assisted roaming logic, contention management for IP connections, IP connection monitoring and logging, settings management for IP connections, UI dialogs related to IP connections and managing PDP contexts.">IP Connection Management</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>