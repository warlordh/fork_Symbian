<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Kernel API Validity Checks"/>
<meta name="abstract" content="Describes the pre-condition checks that Kernel APIs can do when they are called."/>
<meta name="description" content="Describes the pre-condition checks that Kernel APIs can do when they are called."/>
<meta name="DC.Relation" scheme="URI" content="GUID-DC8D3736-EDCF-54CB-A614-2AAC4664F1CA.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F78B7BF9-5FDD-4EF8-A921-71CCBB830A99.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-DC8D3736-EDCF-54CB-A614-2AAC4664F1CA.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Kernel API Validity Checks</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2387995 id2388473 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-F78B7BF9-5FDD-4EF8-A921-71CCBB830A99.html" title="The device driver framework and how to implement a device driver.">Device Driver Guide</a> &gt; <a href="GUID-DC8D3736-EDCF-54CB-A614-2AAC4664F1CA.html" title="This section describes how device drivers can use the services that the Kernel provides.">Kernel-Side Services</a> &gt; </div>
<h1 class="topictitle1">Kernel
API Validity Checks</h1>
<div><p>Describes the pre-condition checks that Kernel APIs can do when
they are called. </p>

<ul>
<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-5D68233C-71CB-5779-B73D-675543F03817"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-5D68233C-71CB-5779-B73D-675543F03817"><!-- --></a><p><a href="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745.html#GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-55866E19-257D-5C0B-BFD2-31F0A5B74070">What does checking the validity of calls mean?</a>  </p>
 </li>

<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-3F5064A8-174B-503C-AA02-08797E804126"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-3F5064A8-174B-503C-AA02-08797E804126"><!-- --></a><p><a href="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745.html#GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-E2945D82-0EC5-53AD-82DE-AD47C21E870C">What happens if a validity check fails?</a>  </p>
 </li>

<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-C9DCF427-9283-5476-9F16-88C94FC18D28"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-C9DCF427-9283-5476-9F16-88C94FC18D28"><!-- --></a><p><a href="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745.html#GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-BB0C87D0-CC1E-5EC9-872C-AA50C99F323F">Which conditions are checked?</a>  </p>
 </li>

</ul>

<div class="section" id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-55866E19-257D-5C0B-BFD2-31F0A5B74070"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-55866E19-257D-5C0B-BFD2-31F0A5B74070"><!-- --></a><h2 class="sectiontitle">What does checking
the validity of calls mean?</h2> <p>A kernel-side function or service almost
always requires that various preconditions apply before that function or service
can be called. There are also times when a call to a kernel-side function
or service from device drivers may not be appropriate, for example, calls
to some specific functions from within Interrupt Service Routines (ISRs) or
from within Deferred Function Calls (DFCs). </p>
 <p>For example, before you
call <a href="GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D.html#GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D__GUID-71A20F01-5E5F-3B27-92BA-3B3BF7D578C9"><span class="apiname">Kern::CloseHandle()</span></a>, the following conditions apply: </p>
 <ul>
<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-8B1908C7-BBC0-58DB-BA95-D6E550B53E2D"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-8B1908C7-BBC0-58DB-BA95-D6E550B53E2D"><!-- --></a><p>the calling thread must
be in a critical section </p>
 </li>

<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-DBBDB602-3451-5745-B80C-4779BCDCEDC7"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-DBBDB602-3451-5745-B80C-4779BCDCEDC7"><!-- --></a><p>interrupts must be enabled </p>
 </li>

<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-094CE1C9-0F5E-5ECE-96CE-187CAF998633"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-094CE1C9-0F5E-5ECE-96CE-187CAF998633"><!-- --></a><p>the kernel must be unlocked </p>
 </li>

<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-765B8EFA-F539-5169-B593-F077942E2164"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-765B8EFA-F539-5169-B593-F077942E2164"><!-- --></a><p>no fast mutex can be
held </p>
 </li>

</ul>
 <p>If conditions such as these are not met before you call the kernel-side
function or service, then you risk damaging the integrity of the kernel and
the whole system, with a very high risk of causing the kernel to fault followed
by a re-boot of the device. </p>
 <p>The pre-conditions that apply vary with
the function called; they are listed as part of the reference documentation
for that function. </p>
 <p>To help device driver test suites check that device
driver code is valid, stringent checks can be switched on in debug (non-production)
builds of Symbian platform (and in the resulting test ROM images). These checks
help to catch non-compliant device driver code during the testing phase of
a new device. This minimizes the risk of production devices failing because
of faulty device driver code. </p>
 </div>

<div class="section" id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-E2945D82-0EC5-53AD-82DE-AD47C21E870C"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-E2945D82-0EC5-53AD-82DE-AD47C21E870C"><!-- --></a><h2 class="sectiontitle">What happens
if a validity check fails?</h2> <p>Validity checking is done by code that
is conditionally compiled into a build of Symbian platform. Such code has
an impact on the performance of the device on which it runs, but is always
restricted to test devices. On production builds of Symbian platform, validity
checking is switched off, which means that the code is not compiled in and
has no effect on performance. </p>
 <p>Validity checking is switched ON for
a build of Symbian platform if <em>one or both</em> of the following macros
is defined in <span class="filepath">...\e32\kernel\kern_int.mmh</span> : </p>
 <ul>
<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-47071D73-190A-5996-9E82-67AE907A4918"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-47071D73-190A-5996-9E82-67AE907A4918"><!-- --></a><p><a href="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745.html#GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-F97EBEF0-D07C-5F40-ADE6-BD050B54A010">__KERNEL_APIS_CONTEXT_CHECKS_WARNING__</a> </p>
 </li>

<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-FAFC6553-92CB-52A5-843D-C9A2136F22F6"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-FAFC6553-92CB-52A5-843D-C9A2136F22F6"><!-- --></a><p><a href="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745.html#GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-A2D9762E-6A1A-5307-9BEE-4EA9A86350EF">__KERNEL_APIS_CONTEXT_CHECKS_FAULT__</a> </p>
 </li>

</ul>
 <p>Validity checking is switched OFF for a build of Symbian platform
if <em>both</em> macros are <em>undefined</em> (in practice they will be marked
as a comment rather than being completely deleted from the <span class="filepath">.mmh</span> file). </p>
 <p id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-F97EBEF0-D07C-5F40-ADE6-BD050B54A010"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-F97EBEF0-D07C-5F40-ADE6-BD050B54A010"><!-- --></a><strong> __KERNEL_APIS_CONTEXT_CHECKS_WARNING__</strong> </p>
 <p>If
this macro is defined, then calling a kernel-side function when the necessary
pre-conditions have not been satisfied causes a text message to be written
to a trace port. The message has the format: </p>
 <pre class="codeblock" id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-637F4DA3-5B60-542B-8BC7-BEF67A884FFD"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-637F4DA3-5B60-542B-8BC7-BEF67A884FFD"><!-- --></a>Description of pre-condition that has not been met
The name of the function checking the pre-condition</pre>
 <p>For example,
when you call <a href="GUID-A3CC1D95-4681-3349-A67C-F113A614041D.html#GUID-A3CC1D95-4681-3349-A67C-F113A614041D__GUID-CF1F6A0E-342A-3EDD-953C-3176D7D7F0A0"><span class="apiname">DLogicalChannel::Close()</span></a>, you must be in
a critical section. If you are not, then you will see the following text in
your trace: </p>
 <pre class="codeblock" id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-73E792DA-9C83-5885-A5E3-9293341ACFFC"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-73E792DA-9C83-5885-A5E3-9293341ACFFC"><!-- --></a>Assertion failed: Calling thread must be in a critical section
DLogicalChannel::Close</pre>
 <p id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-A2D9762E-6A1A-5307-9BEE-4EA9A86350EF"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-A2D9762E-6A1A-5307-9BEE-4EA9A86350EF"><!-- --></a><strong>__KERNEL_APIS_CONTEXT_CHECKS_FAULT__</strong> </p>
 <p>If
this macro is defined, then calling a kernel-side function when the necessary
pre-conditions have not been satisfied: </p>
 <a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-6735A9D4-C120-54E1-884C-1008221652DC"><!-- --></a><ol id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-6735A9D4-C120-54E1-884C-1008221652DC">
<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-B4E5922D-FB75-5DD5-BF9B-F0D2833FAB9B"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-B4E5922D-FB75-5DD5-BF9B-F0D2833FAB9B"><!-- --></a><p>causes a text message
to be written to a trace port, as happens if <samp class="codeph"/><a href="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745.html#GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-F97EBEF0-D07C-5F40-ADE6-BD050B54A010">__KERNEL_APIS_CONTEXT_CHECKS_WARNING__</a> is defined. </p>
 </li>

<li id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-821EAF7B-E8D5-5D9E-85BA-AEF3A88C5EBD"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-821EAF7B-E8D5-5D9E-85BA-AEF3A88C5EBD"><!-- --></a><p>causes the kernel to
fault, specifying the function name as the fault category, and zero as the
fault number. The crash debugger is also started if this is present on the
device. </p>
 </li>

</ol>
 <p><strong>__KERNEL_APIS_CONTEXT_CHECKS_WARNING__
and __KERNEL_APIS_CONTEXT_CHECKS_FAULT__</strong> </p>
 <p>If both macros are defined,
then validity checking behaves as if <a href="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745.html#GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-A2D9762E-6A1A-5307-9BEE-4EA9A86350EF">__KERNEL_APIS_CONTEXT_CHECKS_FAULT__</a> is defined. </p>
 </div>

<div class="section" id="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-BB0C87D0-CC1E-5EC9-872C-AA50C99F323F"><a name="GUID-A90D9D85-53DC-5368-89F2-137BE5D50745__GUID-BB0C87D0-CC1E-5EC9-872C-AA50C99F323F"><!-- --></a><h2 class="sectiontitle">Which conditions
are checked?</h2> <p>The section <a href="GUID-63456B20-3A61-554A-BBA4-C23B176E39A8.html#GUID-63456B20-3A61-554A-BBA4-C23B176E39A8__GUID-5F986149-D75B-5B3F-92F3-7B4FB89F4718">pre-conditions</a> within the larger section <a href="GUID-63456B20-3A61-554A-BBA4-C23B176E39A8.html" title="Reference documentation for kernel side function APIs, specifies a wide variety of pre-conditions and post-conditions.">Pre-Conditions
and Post-Conditions for Kernel APIs</a> gives you some context for the
most common pre-conditions that apply when calling kernel-side functions.
This list is not exhaustive. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-DC8D3736-EDCF-54CB-A614-2AAC4664F1CA.html" title="This section describes how device drivers can use the services that the Kernel provides.">Kernel-Side Services</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>