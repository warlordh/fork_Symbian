<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="How to format currency values"/>
<meta name="abstract" content="Describes how to format currency values for current locale."/>
<meta name="description" content="Describes how to format currency values for current locale."/>
<meta name="DC.Relation" scheme="URI" content="GUID-C497F36F-BCA8-569D-826A-64EAD75C887C.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-29556884-7A9C-5E53-8756-A2C018D877DD.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C497F36F-BCA8-569D-826A-64EAD75C887C.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>How to format currency values</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2402365 id2402379 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-29556884-7A9C-5E53-8756-A2C018D877DD.html" title="This document introduces you to the localisation package.">Localisation</a> &gt; <a href="GUID-C497F36F-BCA8-569D-826A-64EAD75C887C.html" title="Provides access to locale-sensitive information.">Locale Settings</a> &gt; </div>
<h1 class="topictitle1">How
to format currency values</h1>
<div><p>Describes how to format currency values for current locale.</p>

<div class="section" id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-D09EB90D-6A64-46C8-A47D-1D122307AD4D"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-D09EB90D-6A64-46C8-A47D-1D122307AD4D"><!-- --></a><h2 class="sectiontitle">From 6.1 onward</h2> <p>From 6.1, the <a href="GUID-53299759-C2DD-3ABC-A055-9AFE7C5081C6.html"><span class="apiname">TLocale</span></a> class
provides the <samp class="codeph">FormatCurrency()</samp> functions that can format currency
values into a descriptor. The functions can handle both small and large values.
They render the currency amount as text, using the current locale's formatting
requirements. These include items such as:</p>
 <ul>
<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-DC19903D-A39D-52D1-B1F7-06373F96F7CD"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-DC19903D-A39D-52D1-B1F7-06373F96F7CD"><!-- --></a><p> the appropriate currency
symbol</p>
 </li>

<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-518DBCEB-70B0-5E53-AB13-245403BF98C3"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-518DBCEB-70B0-5E53-AB13-245403BF98C3"><!-- --></a><p> whether the currency
symbol is placed before or after the currency amount</p>
 </li>

<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-6BF3E2BC-1327-52FE-955D-E7D5BAF3CD8B"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-6BF3E2BC-1327-52FE-955D-E7D5BAF3CD8B"><!-- --></a><p>whether there is space
between the currency amount and the currency symbol</p>
 </li>

<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-340BC8A9-A189-56A2-9041-D3711041E436"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-340BC8A9-A189-56A2-9041-D3711041E436"><!-- --></a><p>the number of decimal
places</p>
 </li>

<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-9A7E86A9-6C2A-561A-AED0-BD513D128C54"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-9A7E86A9-6C2A-561A-AED0-BD513D128C54"><!-- --></a><p>the way a negative currency
value is rendered.</p>
 </li>

</ul>
 <p>There are four overloaded variants of <samp class="codeph">FormatCurrency()</samp>,
two of which are suitable for rendering currency values that fit into a <a href="GUID-7A2A43EC-6125-3BFE-834B-23C37F7B40D5.html"><span class="apiname">TInt</span></a> type,
and the other two of which are suitable for rendering very large currency
values that fit into a <a href="GUID-AAE85115-A8AA-3F6C-BA8C-69F5A23B0D90.html"><span class="apiname">TInt64</span></a> type.</p>
 <p>Both pairs of
functions behave in the same way, and the following code fragments will also
apply to the <samp class="codeph">TInt64</samp> variants.</p>
 <p>The first code fragment
uses the <samp class="codeph">void FormatCurrency(TDes&amp;,TInt);</samp> variant.</p>
 <pre class="codeblock" id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-537D91F4-9F9C-5466-8001-AEB490544E71"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-537D91F4-9F9C-5466-8001-AEB490544E71"><!-- --></a>...
TLocale locale;

TInt amount;
TBuf&lt;64&gt; buffer;

locale.set();
locale.FormatCurrency(buffer,amount);
...
</pre>
 <p>On return, the descriptor buffer contains the currency value
formatted as text using the currency symbol and formatting appropriate to
the current locale. Note, however, that the caller is responsible for ensuring
that the descriptor buffer is large enough. Too small a buffer results in
a <samp class="codeph">USER 11</samp> panic.</p>
 <p>The second code fragment uses the <samp class="codeph">void
FormatCurrency(TDes&amp;,TDesOverflow&amp;,TInt);</samp> variant.</p>
 <pre class="codeblock" id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-1E2BD59A-DD14-5E6A-87FB-E4DA19AA5813"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-1E2BD59A-DD14-5E6A-87FB-E4DA19AA5813"><!-- --></a>
class TestOverflow : public TDesOverflow
    {
    void Overflow(TDes&amp; aBufferThatOverflowed);
    };

void TestOverflow::Overflow(TDes&amp; aBufferThatOverflowed)
    {
    _LIT(KTextOverflow,"Overflowed");
    aBufferThatOverflowed = KTextOverflow;
    }

...
TLocale locale;
TestOverflow ovfl;

TInt amount;
HBufC* bufPtr;

bufPtr = HBufC::NewL(10);

locale.set();
locale.FormatCurrency(*bufPtr,ovfl,amount);
...</pre>
 <p>In this fragment, if the formatted text cannot fit into
the buffer, <samp class="codeph">*bufPtr</samp>, then <samp class="codeph">TestOverflow::Overflow()</samp> is
called which simply sets the text "Overflowed" into the buffer. In practice,
application code would probably perform more sophisticated recovery which
might include re-allocating the buffer and re-trying the <samp class="codeph">FormatCurrency()</samp> operation.</p>
 </div>

<div class="section" id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-F82759A3-E704-474C-8A4D-3E2FB9F451BD"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-F82759A3-E704-474C-8A4D-3E2FB9F451BD"><!-- --></a><h2 class="sectiontitle">Before 6.1</h2> <p>Before 6.1, the <samp class="codeph">FormatCurrency()</samp> function
is not available and the procedure for formatting a currency value needs more
code and explicitly uses more of the functionality of the <samp class="codeph">TLocale</samp> class.</p>
 <p>In
the following example code fragments, the formatting is done by a function
called <samp class="codeph">foo()</samp>. This function takes a descriptor that, on return,
holds the formatted currency value. The function assumes that the descriptor
is big enough to hold the formatted text. The example holds the currency value
as a <a href="GUID-2D851BBB-15A1-309A-813D-E397D55A6431.html"><span class="apiname">TReal</span></a> value.</p>
 <p><samp class="codeph">foo()</samp> uses the <samp class="codeph">AppendNum()</samp> and <samp class="codeph">Append()</samp> descriptor
functions to format and append the currency value and symbol to <samp class="codeph">aBuffer</samp> using
an object of class <a href="GUID-28F1EA9D-9F02-3E8C-A07F-4D65C955860C.html"><span class="apiname">TRealFormat</span></a> to determine the character
representation of the currency value.</p>
 <p>The code formats the following
locale-dependent aspects of currency information: </p>
 <ul>
<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-3C344A41-3AA2-57A2-89F2-779D26FB37CE"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-3C344A41-3AA2-57A2-89F2-779D26FB37CE"><!-- --></a><p>the number of decimal
places</p>
 </li>

<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-1862BBE9-D48E-52AB-B8A8-4D0DF4F0C94D"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-1862BBE9-D48E-52AB-B8A8-4D0DF4F0C94D"><!-- --></a><p>the decimal and thousands
separators (<samp class="codeph">iPoint</samp> and <samp class="codeph">iTriad</samp>) </p>
 </li>

<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-E44611AA-8BC5-5907-9A71-D1375F68C5B5"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-E44611AA-8BC5-5907-9A71-D1375F68C5B5"><!-- --></a><p>whether <span class="keyword">triads</span> are
allowed or not (<samp class="codeph">iTriLen</samp>)</p>
 </li>

<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-A0713C22-602A-5FC2-9505-414DA4F4CFE9"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-A0713C22-602A-5FC2-9505-414DA4F4CFE9"><!-- --></a><p>An <samp class="codeph">iTriLen</samp> value
of 1 signifies that triads are allowed throughout the currency amount. A value
of zero means that no triads are allowed.</p>
 </li>

</ul>
 <pre class="codeblock" id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-B557FADA-0BBC-55EC-945D-38B503F173D5"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-B557FADA-0BBC-55EC-945D-38B503F173D5"><!-- --></a>void foo(TDes&amp; aBuffer, TReal aCurrencyAmount)
    {
            // get system locale settings
    TLocale locale; 
    TRealFormat realFormat; 
    realFormat.iType=EFixed; 

            // convert number to the general form "nnn.ddd" where
            // "n" is the integer and "d" is the decimal portion.
            // iWidth is the maximum number of characters allowed to represent the number
    realFormat.iWidth=30; 
    realFormat.iDecimalPlaces=locale.CurrencyDecimalPlaces(); 
    realFormat.iPoint=locale.DecimalSeparator(); 
    realFormat.iTriad=locale.ThousandsSeparator();
    realFormat.iTriLen=(locale.CurrencyTriadsAllowed() ? 1 : 0);
    ...</pre>
 <p>Note the following points:</p>
 <ul>
<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-E12C4EB4-F3E7-5262-BA23-EE1B83011624"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-E12C4EB4-F3E7-5262-BA23-EE1B83011624"><!-- --></a><p>Use <samp class="codeph">CurrencySymbolPosition()</samp> and <samp class="codeph">CurrencySpaceBetween()</samp> to
decide whether the currency symbol should be placed before or after the currency
amount and whether or not to insert a space between the symbol and the amount.</p>
 </li>

<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-1F1A8FAD-E5AB-5570-B72E-9FECF0716B0A"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-1F1A8FAD-E5AB-5570-B72E-9FECF0716B0A"><!-- --></a><p>Use <samp class="codeph">CurrencyNegativeInBrackets()</samp> to
decide whether or not negative currency amounts should be enclosed in brackets.
If this is the case, and the value is negative, an open bracket is appended
and any minus sign is removed by appending the currency value to the buffer
as a negative value.</p>
 </li>

<li id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-ABEABD32-AF6C-5265-BB39-D7BB075D2190"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-ABEABD32-AF6C-5265-BB39-D7BB075D2190"><!-- --></a><p>Use <samp class="codeph">CurrencySpaceBetween()</samp> to
decide whether or not to insert a space between the currency symbol and the
currency value.</p>
 </li>

</ul>
 <pre class="codeblock" id="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-87F2B73E-7E6C-5423-A08A-7C66443D11F1"><a name="GUID-28C7424E-2B32-53F2-8A31-8FB6815B4148__GUID-87F2B73E-7E6C-5423-A08A-7C66443D11F1"><!-- --></a>... 
_LIT(KTxtOpenBracket,"(");
_LIT(KTxtCloseBracket,")");
_LIT(KTxtSpace," ");
TCurrencySymbol symbol;

    // Get system wide currency symbol setting
symbol.Set(); 

    // Append an open bracket, if the amount is negative and the locale demands it. 
if ((aCurrencyAmount&lt;0) &amp;&amp; (locale.CurrencyNegativeInBrackets()))
    {
    aBuffer.Append(KTxtOpenBracket);
    }

    // Position the currency symbol before the currency value, and insert space between the
    // symbol and the amount if the locale demands them.
if (locale.CurrencySymbolPosition() == ELocaleBefore)
    { 
    aBuffer.Append(symbol);
    if (locale.CurrencySpaceBetween())
        {
        aBuffer.Append(KTxtSpace); 
        }
    }

    // Append negative currency value and remove the sign if the locale demands
    // negative values in brackets
if ((locale.CurrencyNegativeInBrackets()) &amp;&amp; (aCurrencyAmount&lt;0))
    {
    aBuffer.AppendNum(-aCurrencyAmount,realFormat);
    }
else
    {
    aBuffer.AppendNum(aCurrencyAmount,realFormat); 
    }

    // Position the currency symbol after the currency value, and insert space between the
    // amount and the symbol if the locale demands them.
if (locale.CurrencySymbolPosition() == ELocaleAfter)
    {
    if (locale.CurrencySpaceBetween())
        {
        aBuffer.Append(KTxtSpace);
        }
    aBuffer.Append(symbol);
    }

    // Finally, append the closing bracket, if the value is negative and
    // the locale demands brackets around negative values.
if ((aCurrencyAmount&lt;0) &amp;&amp; (locale.CurrencyNegativeInBrackets()))
    {
    aBuffer.Append(KTxtCloseBracket);
    }
}</pre>
 <p>Note that the currency symbol cannot be set using the <samp class="codeph">TLocale</samp> class.
Use <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-1CBBEEF4-0E5A-33AB-833F-6AF14BA57793"><span class="apiname">User::SetCurrencySymbol()</span></a> to do this.</p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-C497F36F-BCA8-569D-826A-64EAD75C887C.html" title="Provides access to locale-sensitive information.">Locale Settings</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>