<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Pond Configuration Reference"/>
<meta name="abstract" content="This topic describes the file that configures the Comms pond."/>
<meta name="description" content="This topic describes the file that configures the Comms pond."/>
<meta name="DC.Relation" scheme="URI" content="GUID-A248C2C0-5F64-5484-85B2-57C86E3499E1.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-8F2D6AC8-8357-55C7-970B-CD2684BA9B04.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-12D1F61B-6BC6-5215-A832-E84C0F480765.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A248C2C0-5F64-5484-85B2-57C86E3499E1.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-55E4D84B-1B90-5BA4-9CE0-6D26EA208F13.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B4F15CA3-CAD4-5A87-9610-A656CA337B72.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A467E933-C4B4-5518-96D6-471E44B216B3.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-0995EBF6-D203-57B3-9F53-972AEB8F3D3C.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Pond Configuration Reference</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2682451 id2518193 id2518202 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-8F2D6AC8-8357-55C7-970B-CD2684BA9B04.html" title="The Communications Framework is the base for all communications, network and telephony services that Symbian platform provides. The Communications Framework manages the communications threads and the flow of information between those threads. The Framework also manages and stores the communications related settings.">Communications Framework Guide</a> &gt; <a href="GUID-12D1F61B-6BC6-5215-A832-E84C0F480765.html" title="Comms Framework Utilities provides the infrastructure that allows communication between Communications threads and processes. The utilities also provide specialised memory management behaviour that meets the requirements of Communications.">Communications Framework Utilities</a> &gt; <a href="GUID-A248C2C0-5F64-5484-85B2-57C86E3499E1.html" title="This topic describes essential memory management aspects of the Communications Framework.">Memory Management in the Communications Framework</a> &gt; </div>
<h1 class="topictitle1">Pond Configuration Reference</h1>
<div><p>This topic describes the file that configures the Comms pond. </p>

<div class="section" id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-EB90011A-618E-5117-B0DC-961ECB723BA1"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-EB90011A-618E-5117-B0DC-961ECB723BA1"><!-- --></a>
<p>At the moment, there is only one pond in the Comms Frameowrk. This pond manages the pools of MBufs available to the device drivers and to the Comms Framework components. The pond is initialised by the Root Server when the device starts. For each pool, you specify the initial and maximum number of buffers and the size of these buffers by specifying options in the <span class="filepath">c32start.ini</span> file. This file is located in <span class="filepath">z\private\101f7988</span>. 
</p>
 
</div>
 
<div class="section" id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-0F32ADF3-116E-50C6-9F28-445D11C8402E"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-0F32ADF3-116E-50C6-9F28-445D11C8402E"><!-- --></a><h2 class="sectiontitle">Options</h2>
 
<p>To describe the pond, define <samp class="codeph">MBufSizeAllocInfo</samp> <em>&lt;n&gt;</em> for each pool. </p>
 
<p>Each <samp class="codeph">MBufSizeAllocInfo</samp> <em>&lt;n&gt;</em> line describes a pool of RMBufs. The <em>&lt;n&gt;</em> suffix must be a unique number. </p>
 
<pre class="codeblock" id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-766646D3-E426-5080-8721-0BDA63B66662"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-766646D3-E426-5080-8721-0BDA63B66662"><!-- --></a># MBufSizeAllocInfo[n] = size, initial, growth, threshold
# for example 
MBufSizeAllocInfo1 = 128, 128, 64, 48 
MBufSizeAllocInfo2 = 1600, 64, 16, 12 </pre>
 
<p>The following table lists the<samp class="codeph">MBufSizeAllocInfo</samp> parameters in the order they must be specified: </p>
 

<div class="tablenoborder"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-258EAC07-2AA8-5195-8251-E5EDA097BB73"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-258EAC07-2AA8-5195-8251-E5EDA097BB73" frame="border" border="1" rules="all">



<thead align="left">
<tr>
<th class="cellrowborder" valign="top" id="d1055823e75">Parameter</th>
 
<th class="cellrowborder" valign="top" id="d1055823e78">Unit</th>

 <th class="cellrowborder" valign="top" id="d1055823e81">Description</th>
 
 </tr>
 
 </thead>
 
 <tbody>
 <tr>
 <td class="cellrowborder" valign="top" headers="d1055823e75 "><p> <samp class="codeph">size</samp>  </p>
 </td>
 
 <td class="cellrowborder" valign="top" headers="d1055823e78 "><p>bytes </p>
 </td>
 
 <td class="cellrowborder" valign="top" headers="d1055823e81 "><p>Size of the payload of the <samp class="codeph">RMBuf.</samp>  </p>
 </td>
 
 </tr>
 <tr>
 <td class="cellrowborder" valign="top" headers="d1055823e75 "><p> <samp class="codeph">initial</samp>  </p>
 </td>
 
 <td class="cellrowborder" valign="top" headers="d1055823e78 "><p>buffers </p>
 </td>
 
 <td class="cellrowborder" valign="top" headers="d1055823e81 "><p>Amount of pre-allocated <samp class="codeph">RMBuf</samp> s in the pool at startup.  </p>
 </td>
 
 </tr>
 <tr>
 <td class="cellrowborder" valign="top" headers="d1055823e75 "><p> <samp class="codeph">growth</samp>  </p>
 </td>
 
 <td class="cellrowborder" valign="top" headers="d1055823e78 "><p>buffers </p>
 </td>
 
 <td class="cellrowborder" valign="top" headers="d1055823e81 "><p>Amount of <samp class="codeph">RMBuf</samp> s added to the pool when it grows. </p>
 </td>
 
 </tr>
 <tr>
 <td class="cellrowborder" valign="top" headers="d1055823e75 "><p> <samp class="codeph">threshold</samp>  </p>
 </td>
 
 <td class="cellrowborder" valign="top" headers="d1055823e78 "><p>buffers </p>
 </td>
 
 <td class="cellrowborder" valign="top" headers="d1055823e81 "><p>Minimum amount of free <samp class="codeph">RMBuf</samp> s before making the pool grow. When the amount of free buffers in the pool falls below the <samp class="codeph">threshold</samp> value, the pond adds <samp class="codeph">growth</samp> buffers to the pool. </p>
 </td>
 
 </tr>
 
 </tbody>
 
 </table>
</div>
 
 <p>The initial allocation of memory is defined by the sum of the initial allocations from each of the <samp class="codeph">MBufSizeAllocInfo</samp> <em>&lt;n&gt;</em> specifications. </p>
 
 <p>If no <samp class="codeph">MBufSizeAllocInfo</samp> <em>&lt;n&gt;</em> options are provided, the system builds a default pool of 128-byte buffers, initially set at 128 buffers, with a growth of 64 buffers and a threshold of 40 buffers. </p>
 
 </div>
 
 <div class="section" id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-8F0E62BA-455A-5C58-9AB1-70C79F5BA573"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-8F0E62BA-455A-5C58-9AB1-70C79F5BA573"><!-- --></a><h2 class="sectiontitle">Recommendations</h2>
  
 <p>Growth thresholds are typically set at around 25% so that the background allocator can allocate new buffers before the current pool is exhausted. Systems where there is potential to use buffers in sudden bursts should set the threshold to a higher number or start with a larger initial number of buffers. </p>
 
 <p>Legacy code may rely on 128-byte buffers. 128-byte buffers also work well as the small buffers used when adding headers to the data. You should always specify a pool of 128-byte buffers in your <samp class="codeph">c32start.ini</samp> file. You should also avoid having a pool of buffers smaller than 128 bytes, because some legacy code may assume 128 bytes as the minimum size. </p>
 
 <p>The Maximum Transmission Unit (MTU) is an important characteristic of Communications protocols. The MTU is the maximum size of the data packet in a given layer. For example, the Ethernet protocol fixes its MTU to 1,500 bytes, and the 802.11 protocol has a 2,272-bytes MTU. To ensure that incoming data can be written into a single buffer rather than split, you need to specify your pools according to the protocols in use in your system. For each of these protocols, the pond should contain a pool with buffers as large or larger than the MTU. Protocols with similar MTUs usually share the same pool, to avoid increasing the allocation time with searches through too many pools. </p>
 
 <p>Increasing the number of pools increases the time required to fulfil an allocation request. Therefore, you should keep the number of pools small. You need to find a balance between searching many pools for a single adequate buffer and searching fewer pools but having to construct a chain of buffers to fulfil an allocation request. </p>
 
 <p> <strong>Note</strong>: if the <samp class="codeph">c32start.ini</samp> configuration specifies more memory than the device has available, or an impossible combination of initial pool sizes and total pond size, the pond initialisation will fail and the Root Server will panic during device start-up. </p>
 
 </div>
 
 <div class="example" id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-E4D29345-47E1-549F-BEB0-C94E7DDFF00B"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-E4D29345-47E1-549F-BEB0-C94E7DDFF00B"><!-- --></a><h2 class="sectiontitle">Example</h2>
  
 <p>Here is a sample <span class="filepath">c32start.ini</span> file: </p>
 
 <pre class="codeblock" id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-2EE0270A-1892-552D-9D10-E19227069A73"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-2EE0270A-1892-552D-9D10-E19227069A73"><!-- --></a>[Global]

MBufSizeAllocInfo1 = 128, 128, 64, 48
MBufSizeAllocInfo2 = 1600, 64, 16, 12</pre>
 
<p>This file corresponds to the following configuration: </p>
 
<a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__UL_BA85BF6A92C7451CB25A8428AEBA90E3"><!-- --></a><ul id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__UL_BA85BF6A92C7451CB25A8428AEBA90E3">
<li id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-03BFDFCF-61CF-5BE9-A967-C4EFCD00C07F"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-03BFDFCF-61CF-5BE9-A967-C4EFCD00C07F"><!-- --></a><p>The pond contains two pools for a total of 128x128 + 64x1600 = 118,784 bytes (116kB). </p>
 </li>
 
<li id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-EB782141-97DD-509C-9EA0-507DFA8A8981"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-EB782141-97DD-509C-9EA0-507DFA8A8981"><!-- --></a><p>The first pool contains 128-byte buffers. It starts with 128 buffers and will grow by 64 buffers whenever fewer than 48 free buffers remain. </p>
 </li>
 
<li id="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-0D4FBD06-4F91-5393-A419-C5538D5FC2F1"><a name="GUID-6FEE5676-8BFB-53E6-A652-7178295C342E__GUID-0D4FBD06-4F91-5393-A419-C5538D5FC2F1"><!-- --></a><p>The second pool contains 1,600-byte buffers. It starts with 64 buffers and will grow by 16 buffers whenever fewer than 12 free buffers remain. </p>
 </li>
 
</ul>
 
</div>
 
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-A248C2C0-5F64-5484-85B2-57C86E3499E1.html" title="This topic describes essential memory management aspects of the Communications Framework.">Memory Management in the Communications Framework</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-55E4D84B-1B90-5BA4-9CE0-6D26EA208F13.html" title="This topic describes memory management in the Communications Framework.">Overview</a></div>
<div><a href="GUID-B4F15CA3-CAD4-5A87-9610-A656CA337B72.html" title="This topic describes Comms buffers (MBuf) and Comms chains.">Comms Buffers (MBuf) and Comms Chains</a></div>
<div><a href="GUID-A467E933-C4B4-5518-96D6-471E44B216B3.html" title="This topic describes Comms ponds in more detail.">Advanced Pond Guide</a></div>
<div><a href="GUID-0995EBF6-D203-57B3-9F53-972AEB8F3D3C.html">Memory Metrics</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>