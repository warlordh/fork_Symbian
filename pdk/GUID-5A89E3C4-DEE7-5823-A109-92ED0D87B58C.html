<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Deriving from COpenFont"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-762A665F-43D0-53ED-B698-0CBD3AC46391.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B798C19D-4030-564A-A208-D84738259D72.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-89AD2E29-DF29-5B2B-9894-B7ECD62854F4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F477E82D-2929-5C69-BF6D-A69A61AC9EA5.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1CF78E25-8C83-5812-AE6F-8612B3F9CDA9.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Deriving from COpenFont</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C"><a name="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2535736 id2535744 id2535786 id2535806 id2535827 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-1DCA2F4D-ABE6-52A0-AC4E-5AAC1AB5909D.html">Text and Localization Guide</a> &gt; <a href="GUID-762A665F-43D0-53ED-B698-0CBD3AC46391.html" title="The Font and Text Services Collection contains the Font Store and related plug-ins and the Text Rendering component. Application developers can select fonts from the Font Store. Device creators can create and add fonts.">Font and Text Services Collection</a> &gt; <a href="GUID-B798C19D-4030-564A-A208-D84738259D72.html" title="The Font Store is encapsulated by the Font and Bitmap Server. It represents all of the fonts stored as files in the file system. Font files may be of the native Symbian bitmap format or they may require rasterising into bitmaps. Font rasterisers are ECOM plug-ins to the Font Store.">Font Store Component</a> &gt; <a href="GUID-89AD2E29-DF29-5B2B-9894-B7ECD62854F4.html">Font Store Tutorials</a> &gt; <a href="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html" title="This section provides instructions for creating a font rasterizer. The code examples in this tutorial are take from the FreeType font rasterizer.">Writing a Font Rasterizer Plug-in Tutorial</a> &gt; </div>
<h1 class="topictitle1">Deriving
from COpenFont</h1>
<div>
<div class="section"><h2 class="sectiontitle">Overview</h2> <p>Write a class derived from <samp class="codeph">COpenFont</samp> to
represent an instance of a typeface at a particular size, provide bitmaps
of the glyphs, and determine whether a particular character is defined in
the typeface. An object of this type is created by <samp class="codeph">COpenFontFile::GetNearestFontInPixelsL()</samp> when
it is called by the Font and Bitmap server. </p>
 <p>To derive from <samp class="codeph">COpenFont</samp>: </p>
 <ul>
<li id="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C__GUID-855B3E95-D4FB-514D-9C9A-E325D4572F8B"><a name="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C__GUID-855B3E95-D4FB-514D-9C9A-E325D4572F8B"><!-- --></a><p>Write a function to
construct the derived object on the shared heap. The base class constructor
must be called when creating the derived object. </p>
 </li>

<li id="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C__GUID-1B4CA215-8150-580D-A9F2-3E7000A3317C"><a name="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C__GUID-1B4CA215-8150-580D-A9F2-3E7000A3317C"><!-- --></a><p>Provide an implementation
for <samp class="codeph">COpenFont</samp>'s pure virtual function <samp class="codeph">RasterizeL()</samp>. </p>
 </li>

</ul>
 <p>These are discussed further in the following sections. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Construction using the shared heap </h2> <p>The derived
object must be created on a shared heap because it is shared by several processes,
e.g. the Font and Bitmap Server and its clients. The following code fragment
shows how the FreeType implementation creates the object on the shared heap <samp class="codeph">aHeap</samp>: </p>
 <pre class="codeblock" id="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C__GUID-BF5816D4-8EFA-5A63-860F-F6F42A49914D"><a name="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C__GUID-BF5816D4-8EFA-5A63-860F-F6F42A49914D"><!-- --></a>CFreeTypeFont* CFreeTypeFont::NewL(RHeap* aHeap,
    COpenFontSessionCacheList* aSessionCacheList,
    CFreeTypeFontFile* aFontFile,TInt aSizeInPixels)
    {
    CFreeTypeFont* f =
        (CFreeTypeFont*)aHeap-&gt;AllocL(sizeof(CFreeTypeFont));
    new(f) CFreeTypeFont(aHeap,aSessionCacheList,aFontFile);
    CleanupStack::PushL(f);
    f-&gt;ConstructL(aSizeInPixels);
    CleanupStack::Pop();
    return f;
    }</pre>
 <p>Note that we use <samp class="codeph">aHeap-&gt;AllocL()</samp> to
obtain memory, then construct in place using a placement argument to <samp class="codeph">new</samp>. </p>
 <p>The
base class constructor is called when creating the derived object. Pass the
arguments <samp class="codeph">aHeap</samp> and <samp class="codeph">aSessionCacheList</samp> supplied
to <samp class="codeph">COpenFontFile::GetNearestFontInPixelsL()</samp>, and pass the
address of the <samp class="codeph">COpenFontFile</samp> object that creates the <samp class="codeph">COpenFont</samp> (i.e.,
'this') as <samp class="codeph">aFile</samp>. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Implementing RasterizeL()</h2> <p>The derived class's <samp class="codeph">RasterizeL()</samp> function
is called by the Font and Bitmap Server to return the bitmap for a specified
Unicode character. The function prototype is given below: </p>
 <pre class="codeblock" id="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C__GUID-806BC2E7-F34E-5809-BE79-56319147D77B"><a name="GUID-5A89E3C4-DEE7-5823-A109-92ED0D87B58C__GUID-806BC2E7-F34E-5809-BE79-56319147D77B"><!-- --></a>virtual void RasterizeL(TInt aCode,TOpenFontGlyphData* aGlyphData) = 0;</pre>
 <p> Implementations
must create a bitmap, in Symbian's run-length-encoded format, for the Unicode
character <samp class="codeph">aCode</samp>. The bitmap must be placed in <samp class="codeph">aGlyphData-&gt;iBitmapBuffer</samp>,
and the character metrics must be placed in <samp class="codeph">aGlyphData-&gt;iMetricsBuffer</samp>.
The other parts of <samp class="codeph">aGlyphData</samp> should be left alone. </p>
 <p>The
actual rasterization task should be passed to the rasterization engine. One
way of doing this is to call some rasterization member function of the <samp class="codeph">COpenFontFile</samp> object,
to which a pointer can be obtained by calling <samp class="codeph">COpenFont::File()</samp>.
The derived <samp class="codeph">COpenFontFile</samp> object can then call a rasterizer
function via a pointer it owns to the rasterizer context object. Note that <em>if</em> the
rasterizer context object is derived from <samp class="codeph">COpenFontRasterizerContext</samp>,
it will have utility functions for writing bits to the bitmap buffer in Symbian's
run-length-encoded format. </p>
 <p>The FreeType implementation follows this
strategy. <samp class="codeph">CFreeTypeFont::RasterizeL()</samp> calls <samp class="codeph">CFreeTypeFontFile::RasterizeL()</samp>,
which calls <samp class="codeph">CFreeTypeContext::RasterizeL()</samp>. </p>
 <p><strong>The
run-length-encoded bitmap format</strong> </p>
 <p>The run-length-encoded format
is a packed binary format starting on a byte boundary and made up of a number
of sections. </p>
 <p>Each section starts with a five-bit header. If the first
bit of the header is 0 the next four bits are a repeat count, starting with
the least significant bit, and a single row of bits follows (the number of
bits in a row is specified by <samp class="codeph">aGlyphData-&gt;iMetricsBuffer.Width()</samp>).
If the first bit of the header is 1 the next four bits are a count of non-repeating
rows, again starting with the least significant bit, and that many rows of
bits follow. </p>
 <p>See <a href="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395.html">How
to derive from COpenFontRasterizerContext</a> for an implementation of
this algorithm. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-CD464A4E-56D5-5645-B493-DE7BF8F6DB6D.html" title="This section provides instructions for creating a font rasterizer. The code examples in this tutorial are take from the FreeType font rasterizer.">Writing a Font Rasterizer Plug-in Tutorial</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-F477E82D-2929-5C69-BF6D-A69A61AC9EA5.html">Creating
a Font Rasterizer Plug-in</a></div>
<div><a href="GUID-1CF78E25-8C83-5812-AE6F-8612B3F9CDA9.html">Deriving
from COpenFontRasterizer</a></div>
<div><a href="GUID-BCF6FEF0-1792-5DEA-A2D7-896E47163547.html">Deriving
from COpenFontFile</a></div>
<div><a href="GUID-F44D974F-AADE-5E6C-8D69-8D3EEE4BD395.html">Deriving
from COpenFontRasterizerContext</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>