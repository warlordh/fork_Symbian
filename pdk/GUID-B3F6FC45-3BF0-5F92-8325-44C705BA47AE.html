<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Boot Table Functions"/>
<meta name="abstract" content="Describes how to implement the functions that the bootstrap implementation must provide."/>
<meta name="description" content="Describes how to implement the functions that the bootstrap implementation must provide."/>
<meta name="DC.Relation" scheme="URI" content="GUID-08867AEC-5866-5583-9AAB-068CB51F5C18.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-53944506-5CA2-52BA-8D5A-9EE72092612B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-5EB03086-A87D-5588-8927-7A7F8DB38366.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-08867AEC-5866-5583-9AAB-068CB51F5C18.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Boot Table Functions</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2387855 id2387899 id2387913 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-53944506-5CA2-52BA-8D5A-9EE72092612B.html" title="Describes what is the bootstrap and how to implement it for a specific platform.">Bootstrap</a> &gt; <a href="GUID-5EB03086-A87D-5588-8927-7A7F8DB38366.html" title="This section describes how to implement a port of the bootstrap.">Port Implementation Tutorial</a> &gt; <a href="GUID-08867AEC-5866-5583-9AAB-068CB51F5C18.html" title="The platform-specific layer of the bootstrap must implement a set of standard functions and definitions that are used by the generic layer.">Platform-Specific Source Code</a> &gt; </div>
<h1 class="topictitle1">Boot
Table Functions</h1>
<div><p>Describes how to implement the functions that the bootstrap implementation
must provide.</p>

<p>The <a href="GUID-9595FD6F-1EDE-51A8-B00D-029CFDFE0F38.html" title="Describes the boot table.">boot table</a> function
entries are summarised in the following table. Each is identified by its <samp class="codeph">TBootTableEntry</samp> enumerator
that defines its position in the table. Click the enumerator symbol for more
detail on what the function must do. </p>


<div class="tablenoborder"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-D7774430-469D-5E6F-8419-F23DD3E517A0"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-D7774430-469D-5E6F-8419-F23DD3E517A0" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p> <strong>Enumerator symbol</strong>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <strong>Summary description</strong>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-D52E6FFC-7B8B-500C-96B3-9603EA0A3E76">BTF_WriteC</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Outputs a character to the debug port. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-1C4372C8-DFC8-5989-AC10-5A12F661AE70">BTF_RamBanks</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Gets a list of possible RAM banks. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-84D468E7-7F0E-53ED-A52F-491869900286">BTF_SetupRamBank</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Does any required setup for each RAM bank. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-52792290-48DA-5F1A-A7AD-0105A8AA37CF">BTF_RomBanks</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Gets a list of possible ROM banks. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-CE98DDA6-D809-5DEB-85A0-0332D2472CAA">BTF_SetupRomBank</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Does any required setup for each ROM bank. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-62CD8D6F-6E12-5DFC-85BC-EA24000BA588">BTF_HwBanks</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Gets a list of required I/O mappings. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-B3C6ACE9-A803-59D4-8EBD-314363905427">BTF_Reserve</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Reserves physical RAM if required. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4DEA1D4C-EC7B-5F9A-A293-A7F80899044B">BTF_Params</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Gets a list of configuration parameters. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-EEF889E7-915F-57E9-8E2D-DC17B24C7728">BTF_Final</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Does any final setup required before booting the kernel. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4C8986CB-0D5A-5D61-8A4B-DAC1B9D2C8B5">BTF_Alloc</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Allocates RAM during boot. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-9723F1BA-6B97-5E6A-A913-8B17C100787D">BTF_GetPdePerm</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Gets MMU PDE permissions for a mapping. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-ACAEB6E1-F8D2-51E9-AB57-4E4658E4F004">BTF_GetPtePerm</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Gets MMU PTE permissions for a mapping. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-DF0A1707-49C5-5050-B096-77704EA449DA">BTF_PTUpdate</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Called when a page table entry is updated. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p><a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-37E8A845-6326-52F1-9607-5488B1E009A8">BTF_EnableMMU</a> </p>
 </td>

<td class="cellrowborder" valign="top"><p>Enables the MMU. </p>
 </td>

</tr>

</tbody>

</table>
</div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-D52E6FFC-7B8B-500C-96B3-9603EA0A3E76"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-D52E6FFC-7B8B-500C-96B3-9603EA0A3E76"><!-- --></a><h2 class="sectiontitle">BTF_WriteC</h2> <p><strong>What the function should do</strong> </p>
 <p>On non-debug bootstrap builds,
where <samp class="codeph">CFG_DebugBootRom</samp> is set to FALSE, the function should
return immediately without doing anything. </p>
 <p>On debug bootstrap builds,
where <samp class="codeph">CFG_DebugBootRom</samp> is set to TRUE, the function should
output a single character to the debug port. </p>
 <p>It may be necessary to
examine the <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html#GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098__GUID-FCFF2134-D89D-3861-9870-BF1B57D1241B"><span class="apiname">TRomHeader::iDebugPort</span></a> field to determine the
correct destination for the character. The function should not modify any
registers, but may change flags. </p>
 <p>This function can be called with
the MMU either disabled or enabled. Different I/O port addresses will normally
be required in these two cases. To simplify handling of this the following
macro is provided: </p>
<pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-44BA5E00-45E0-5864-834A-DCC95A926F8A"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-44BA5E00-45E0-5864-834A-DCC95A926F8A"><!-- --></a>GET_ADDRESS    Rd,    PHYSICAL,    LINEAR</pre>
 <p>Where <samp class="codeph">Rd</samp> specifies any <samp class="codeph">ARM</samp> general purpose register. <samp class="codeph">PHYSICAL</samp> is
the physical address of the peripheral, <samp class="codeph">LINEAR</samp> is its linear
address. </p>
 <p>On the direct memory model, the <samp class="codeph">PHYSICAL</samp> address
is always loaded into <samp class="codeph">Rd</samp>. On the moving or multiple memory
models the macro performs a runtime check of the <samp class="codeph">CP15</samp> control
register to determine whether the MMU is enabled. If the MMU is enabled, then
the <samp class="codeph">LINEAR</samp> address is loaded into <samp class="codeph">Rd</samp>, otherwise
the <samp class="codeph">PHYSICAL</samp> address is loaded. </p>
 <p>Note that <samp class="codeph">CFG_DebugBootRom</samp> is
set in the <a href="GUID-2E4F8732-F253-5E0D-9A37-9476541E6004.html" title="Describes how to write the file providing build-time configuration options.">platform
specific configuration header file</a>. </p>
 <p><strong>Entry conditions</strong> </p>
<ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-7375F514-78DB-5620-A076-3F0D0A4E595C"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-7375F514-78DB-5620-A076-3F0D0A4E595C"><!-- --></a><p> <samp class="codeph">R0</samp> bottom
8 bits contain the character to be output </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-F6F936BB-2240-5C4E-AF93-9A5C63ACC28F"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-F6F936BB-2240-5C4E-AF93-9A5C63ACC28F"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the super page, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-333CCEE2-F3EB-5800-8F12-AE33A9FAC225"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-333CCEE2-F3EB-5800-8F12-AE33A9FAC225"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-D3BF3853-8542-5F0A-B3AC-4CCE02015C8A"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-D3BF3853-8542-5F0A-B3AC-4CCE02015C8A"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-1C4372C8-DFC8-5989-AC10-5A12F661AE70"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-1C4372C8-DFC8-5989-AC10-5A12F661AE70"><!-- --></a><h2 class="sectiontitle">BTF_RamBanks</h2> <p><strong>What the function should do</strong> </p>
 <p>This function should return a
pointer to a list of RAM banks that are present. </p>
 <p>The list should be
a sequence of two-word entries. Each entry has the following format: </p>
 <div class="fignone" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-3B76398A-AE4C-563B-BB52-3701983D01B4"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-3B76398A-AE4C-563B-BB52-3701983D01B4"><!-- --></a>
<img src="GUID-921AF7A3-C711-5979-877B-4B6D977888E8_d0e289398_href.png"/>
</div>
 <p>The list is terminated by an entry that has a zero MAXSIZE. </p>
 <p>Of
the 32 flag bits, only one is currently defined; all undefined flags should
be zero. Flag 0, which is bit 0 of the first word is the <samp class="codeph">RAM_VERBATIM</samp> flag
and is interpreted as follows: </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-415A4838-2858-5EE5-B9F4-D55CDD9AE02C"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-415A4838-2858-5EE5-B9F4-D55CDD9AE02C"><!-- --></a><p>If clear, the specified
physical address range may or may not contain RAM, and may be only partially
occupied. In this case generic bootstrap code will probe the range to establish
if any RAM is present, and if so, which parts of the range are occupied. This
process is accompanied by calls to <a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-84D468E7-7F0E-53ED-A52F-491869900286">BTF_SetupRamBank</a>. In order for the probing algorithm to work MAXSIZE must be a power of 2
(greater than or equal to 64K), and BASE must be a multiple of MAXSIZE. </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-6CB0DED5-838E-5F58-8796-A191ED7199D4"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-6CB0DED5-838E-5F58-8796-A191ED7199D4"><!-- --></a><p>If set, the specified
physical range is known to be fully occupied by RAM, and furthermore, that
all memory controller setup for that range has already been completed. In
this case <a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-84D468E7-7F0E-53ED-A52F-491869900286">BTF_SetupRamBank</a> will
not be called for this range. </p>
 </li>

</ul>
 <p>Note that all banks declared in this list and subsequently found
to be occupied will be treated as standard RAM available for any purpose.
For this reason, internal RAM or TCRAM banks are not generally included in
the list. </p>
 <p><strong>Entry
conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-61BC32CF-36E0-598F-A97B-D3C1C032951C"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-61BC32CF-36E0-598F-A97B-D3C1C032951C"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the superpage, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-156C3C48-F4C5-5E4E-9472-C273DF805061"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-156C3C48-F4C5-5E4E-9472-C273DF805061"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-16D3C3A1-CDE2-5249-95D6-B8B37C1C2C44"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-16D3C3A1-CDE2-5249-95D6-B8B37C1C2C44"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-03864AFE-0A45-551B-ADA7-6FB530F7CB4D"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-03864AFE-0A45-551B-ADA7-6FB530F7CB4D"><!-- --></a><p>the MMU is disabled. </p>
 </li>

</ul>
 <p><strong>Exit
conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-C38E1D41-7589-5368-8872-48FE33CA989A"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-C38E1D41-7589-5368-8872-48FE33CA989A"><!-- --></a><p> <samp class="codeph">R0</samp> should
contain the base address of the list of banks </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-487A2C0B-DC61-5F7F-97FE-5065667134E0"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-487A2C0B-DC61-5F7F-97FE-5065667134E0"><!-- --></a><p> <samp class="codeph">R0</samp> -<samp class="codeph">R3</samp> and
flags may be modified, but no other registers should be modified. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-84D468E7-7F0E-53ED-A52F-491869900286"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-84D468E7-7F0E-53ED-A52F-491869900286"><!-- --></a><h2 class="sectiontitle">BTF_SetupRamBank</h2> <p><strong>What the function should do</strong> </p>
 <p>The function should do any required
setup for each RAM bank. </p>
 <p>This function is called <em>twice</em> for
each RAM bank that does <em>not</em> have the <samp class="codeph">RAM_VERBATIM</samp> flag
set (see the reference to the flag bits in the description of <a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-1C4372C8-DFC8-5989-AC10-5A12F661AE70">BTF_RamBanks</a>). </p>
 <p>The first call is prior to RAM bus width detection,
and the second call is after width detection. </p>
 <p>This function is only
required if the system has a complex and very variable RAM setup, for example
several banks of potentially different widths. Typical systems have one or
two banks of RAM of known width and all memory controller initialisation can
be done in the<a href="GUID-F67FA7B5-F6D1-5C5C-8E10-A8E317A778E4.html#GUID-F67FA7B5-F6D1-5C5C-8E10-A8E317A778E4__GUID-C111DA06-F7EE-5E70-8D86-26BA2213B506">InitialiseHardware()</a> function;
in this case this function can simply return without performing any operation. </p>
 <p><strong>Entry conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4080EA07-03AE-5D7C-9931-71DC7A7844D6"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4080EA07-03AE-5D7C-9931-71DC7A7844D6"><!-- --></a><p> <samp class="codeph">R1</samp> holds
the physical base address of a bank </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-02D174D3-A176-55A1-81C6-BEDBA72023FC"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-02D174D3-A176-55A1-81C6-BEDBA72023FC"><!-- --></a><p> <samp class="codeph"> R3 = 0xFFFFFFFF</samp> for
the first call</p>
 <p> <samp class="codeph"> R3 = 0x0000000Y</samp> for the second call,
where the bottom 4 bits represent the validity of each of the 4 byte lanes
(bit 0=1 if D0-7 are valid, bit 1=1 if D8-15 are valid, etc.) </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-0DD72D2D-D26D-59B1-B60B-5DA41D8B4FF0"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-0DD72D2D-D26D-59B1-B60B-5DA41D8B4FF0"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the super page, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-7EF8D070-7843-5164-BEC5-E6EC7A2B4159"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-7EF8D070-7843-5164-BEC5-E6EC7A2B4159"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-86030AEF-E1C5-5CCA-8E95-C9A360286609"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-86030AEF-E1C5-5CCA-8E95-C9A360286609"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-88F1940A-A7A2-5340-8278-BB2CC269B3DE"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-88F1940A-A7A2-5340-8278-BB2CC269B3DE"><!-- --></a><p>the MMU is disabled. </p>
 </li>

</ul>
 <p><strong>Exit
conditions</strong> </p>
 <p>Other than flags, no registers should be modified. </p>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-52792290-48DA-5F1A-A7AD-0105A8AA37CF"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-52792290-48DA-5F1A-A7AD-0105A8AA37CF"><!-- --></a><h2 class="sectiontitle">BTF_RomBanks</h2> <p><strong>What the function should do</strong> </p>
 <p>This function should return a
pointer to a list of XIP ROM banks that are present. It is not called if the
bootstrap is found to be running in RAM; in this case it is assumed that all
XIP code is in RAM. </p>
 <p>The list should be a sequence of four-word entries.
Each entry has the following format: </p>
 <div class="fignone" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-35A65482-24F6-5F9A-83B8-ED490F651A9A"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-35A65482-24F6-5F9A-83B8-ED490F651A9A"><!-- --></a>
<img src="GUID-4E6520E8-4BF1-55D1-B643-81B8D2816D1D_d0e289638_href.png"/>
</div>
 <p>The list is terminated by a zero value four-word entry. </p>
 <p>Only
the first, second and fourth words of each entry are actually used by the
rest of the bootstrap. The third is there mainly to support autodetection
schemes. </p>
 <p>The <a href="GUID-25941CD2-D124-55DD-8716-ACC93E3F1D6C.html#GUID-25941CD2-D124-55DD-8716-ACC93E3F1D6C__GUID-7361BC74-7164-52EE-9A5B-D254560D1939">ROM_BANK</a> macro
can be used to declare ROM bank entries. </p>
 <p><strong>Entry conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-ABFD5EA9-459A-5961-9181-FC5A15463AE7"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-ABFD5EA9-459A-5961-9181-FC5A15463AE7"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the super page, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-888C592D-F49A-508B-80EF-E729D33C1FAE"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-888C592D-F49A-508B-80EF-E729D33C1FAE"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-CC543EA9-34B7-5806-B987-6565CD07B052"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-CC543EA9-34B7-5806-B987-6565CD07B052"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-618F3F1A-E91B-55AA-80D5-D2E894720AB9"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-618F3F1A-E91B-55AA-80D5-D2E894720AB9"><!-- --></a><p>the MMU is disabled. </p>
 </li>

</ul>
 <p><strong>Exit
conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-DAC651F9-6EF3-584D-92D2-388E7EC8A13B"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-DAC651F9-6EF3-584D-92D2-388E7EC8A13B"><!-- --></a><p> <samp class="codeph">R0</samp> should
contain the base address of the list of ROM banks. </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-F8A205C2-4605-512A-A721-B6D2506D7263"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-F8A205C2-4605-512A-A721-B6D2506D7263"><!-- --></a><p> <samp class="codeph">R0</samp> -<samp class="codeph">R3</samp> and
flags may be modified, but no other registers should be modified. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-CE98DDA6-D809-5DEB-85A0-0332D2472CAA"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-CE98DDA6-D809-5DEB-85A0-0332D2472CAA"><!-- --></a><h2 class="sectiontitle">BTF_SetupRomBank</h2> <p><strong>What the function should do</strong> </p>
 <p>The function should do any required
setup for each ROM bank. </p>
 <p>It is called once immediately after the call
to <a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-52792290-48DA-5F1A-A7AD-0105A8AA37CF">BTF_RomBanks</a> and
then it is subsequently called again for <em>each</em> ROM bank in the list
returned by <samp class="codeph">BTF_RomBanks</samp>. It is not called if the bootstrap
is running in RAM. </p>
 <p>This function is intended to support autodetection
of the system ROM configuration. For example, the first call with <samp class="codeph">R11</samp> set
to zero could be used to set the bus controller to 32 bit width to enable
width detection to be performed on ROM banks other than the boot block. Subsequent
per-bank calls could determine the width (possibly using an algorithm that
repeatedly reads from the same address and checks which bits are consistent)
and the size of the ROM bank. These would be written to the entry pointed
by <samp class="codeph">R11</samp> and the bus controller set up correctly for that ROM
bank. If the bank is absent, then the size in the structure pointed to by <samp class="codeph">R11</samp> is
set to zero to remove it from the list. </p>
 <p><strong>Entry conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-A13AC2C7-01EC-5A15-92F3-1ABF1FB03DD2"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-A13AC2C7-01EC-5A15-92F3-1ABF1FB03DD2"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the super page, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-CB332F6C-1B59-5B77-8396-060C9EE413E3"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-CB332F6C-1B59-5B77-8396-060C9EE413E3"><!-- --></a><p>On the first call: </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-96520453-4106-55AF-A0F2-D3533594EEE9"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-96520453-4106-55AF-A0F2-D3533594EEE9"><!-- --></a><p> <samp class="codeph">R11</samp> contains
0 </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-025A5A35-6A7E-5F84-8B05-39E6427D0F63"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-025A5A35-6A7E-5F84-8B05-39E6427D0F63"><!-- --></a><p> <samp class="codeph">R0</samp> contains
the base address of the list of ROM banks returned by <a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-52792290-48DA-5F1A-A7AD-0105A8AA37CF">BTF_RomBanks</a> </p>
 </li>

</ul>
 <p>On subsequent calls: </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-CFAED6F6-4344-505B-920E-14B99784621A"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-CFAED6F6-4344-505B-920E-14B99784621A"><!-- --></a><p> <samp class="codeph">R11</samp> points
to a RAM copy of the entry corresponding to the ROM bank currently being processed </p>
 </li>

</ul>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4456CB76-38BA-568B-9295-C965B7B70069"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4456CB76-38BA-568B-9295-C965B7B70069"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-0087F2C0-343C-5F81-AC75-DEEE357A8B54"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-0087F2C0-343C-5F81-AC75-DEEE357A8B54"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-37648CD7-CB3D-547F-BC81-B354F64CF827"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-37648CD7-CB3D-547F-BC81-B354F64CF827"><!-- --></a><p>the MMU is disabled. </p>
 </li>

</ul>
 <p><strong>Exit
conditions</strong> </p>
 <p>For calls where <samp class="codeph">R11</samp> is non-zero, the
entry pointed to by <samp class="codeph">R11</samp> may be modified by this function
call. </p>
 <p>If the entry size for a bank is set to zero, then that bank
is assumed not to exist, and is removed from the list of ROM banks. </p>
 <p>Registers <samp class="codeph">R0</samp> -<samp class="codeph">R4</samp> and
flags may be modified by this function; all other registers should be preserved. </p>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-62CD8D6F-6E12-5DFC-85BC-EA24000BA588"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-62CD8D6F-6E12-5DFC-85BC-EA24000BA588"><!-- --></a><h2 class="sectiontitle">BTF_HwBanks</h2> <p><strong>What the function should do</strong> </p>
 <p>This function should return a
pointer to a list of required I/O mappings. </p>
 <p>The list should be a sequence
of one-word and two-word entries, terminated by a zero-filled word. The entries
in the list are defined using the <a href="GUID-25941CD2-D124-55DD-8716-ACC93E3F1D6C.html#GUID-25941CD2-D124-55DD-8716-ACC93E3F1D6C__GUID-7728C7F2-BB04-518B-8B0A-752CB799A561">macros
for declaring I/O mappings</a>: <samp class="codeph">HW_MAPPING</samp>, <samp class="codeph">HW_MAPPING_EXT</samp>, <samp class="codeph">HW_MAPPING_EXT2</samp>,
and <samp class="codeph">HW_MAPPING_EXT3</samp>. </p>
 <p>In the template port, this is
implemented in <span class="filepath">os/kernelhwsrv/bsptemplate/asspandvariant/template_variant/bootstrap/template.s</span>.
Find the symbol <samp class="codeph">GetHwBanks</samp>: </p>
 <pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-93B8920C-C244-5CEE-95B4-1F49BB1D8B19"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-93B8920C-C244-5CEE-95B4-1F49BB1D8B19"><!-- --></a>GetHwBanks    ROUT
        ADR        r0, %FT1
        MOV        pc, lr
        ...
        DCD            0                                            ; terminator
</pre>
 <p>The pointer in the boot table to this list of I/O mappings
is defined by the symbol <samp class="codeph">GetHwBanks</samp>. </p>
 <pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-AAC33135-33B2-5B31-8D3B-906636669310"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-AAC33135-33B2-5B31-8D3B-906636669310"><!-- --></a>BootTable
    ...
    DCD    GetHwBanks                ; get list of HW banks
    ...</pre>
 <p>To support Level 2 cache (either L210 or L220), you
need to add the base address of the Level 2 cache controller to the list of
hardware banks. For example: </p>
 <pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-F28CD3A1-CBB8-5052-ADC1-96A23FE9DA5D"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-F28CD3A1-CBB8-5052-ADC1-96A23FE9DA5D"><!-- --></a>GetHwBanks  ROUT
        ADR     r0, %FT1
        MOV     pc, lr
        ...
        HW_MAPPING  L210CtrlBasePhys, 1, HW_MULT_1M
        ...
        DCD     0                                 ; terminator
</pre>
 <p>See also the<a href="GUID-F67FA7B5-F6D1-5C5C-8E10-A8E317A778E4.html#GUID-F67FA7B5-F6D1-5C5C-8E10-A8E317A778E4__GUID-C111DA06-F7EE-5E70-8D86-26BA2213B506">InitialiseHardware()</a> function. </p>
 <p><strong>Entry
conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-74CDF102-52AD-5BE2-83BB-4486D5DCF904"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-74CDF102-52AD-5BE2-83BB-4486D5DCF904"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the super page, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E6B28758-C709-51E9-9604-12EF39EF95EA"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E6B28758-C709-51E9-9604-12EF39EF95EA"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-BCA82596-751E-5045-BADA-E71659254555"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-BCA82596-751E-5045-BADA-E71659254555"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-5F7B169A-F4C4-587F-AD33-46CF05619113"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-5F7B169A-F4C4-587F-AD33-46CF05619113"><!-- --></a><p>the MMU is disabled. </p>
 </li>

</ul>
 <p><strong>Exit
conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-59BB29EB-3437-5E3A-ADC8-6AA57BD10DFA"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-59BB29EB-3437-5E3A-ADC8-6AA57BD10DFA"><!-- --></a><p> <samp class="codeph">R0</samp> should
contain the base address of the list of banks </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-0CEEEA0C-58CB-5A4E-9D94-EFE0496F264F"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-0CEEEA0C-58CB-5A4E-9D94-EFE0496F264F"><!-- --></a><p> <samp class="codeph">R0</samp> -<samp class="codeph">R3</samp> and
flags may be modified, but no other registers should be modified. </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-B3C6ACE9-A803-59D4-8EBD-314363905427"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-B3C6ACE9-A803-59D4-8EBD-314363905427"><!-- --></a><h2 class="sectiontitle">BTF_Reserve</h2> <p><strong>What the function should do</strong> </p>
 <p>The function reserves physical
RAM if required. </p>
 <p>It is called before the bootstrap's memory allocator
(<a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4C8986CB-0D5A-5D61-8A4B-DAC1B9D2C8B5">BTF_Alloc</a>)
is initialised to allow physical RAM to be reserved for any platform specific
purpose. </p>
 <p>There are two methods available for reserving physical RAM: </p>
 <a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-A68E974D-B79F-5EFF-AC43-FC068B2A0B8C"><!-- --></a><ol id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-A68E974D-B79F-5EFF-AC43-FC068B2A0B8C">
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-37C98A1E-AD3A-5D36-BA64-B24E3EC5045A"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-37C98A1E-AD3A-5D36-BA64-B24E3EC5045A"><!-- --></a><p>Use the generic bootstrap
function <samp class="codeph">ExciseRamArea()</samp>, implemented in <span class="filepath">os/kernelhwsrv/kernel/eka/kernel/arm/bootutils.s</span>.
This removes a specified region from the list of RAM blocks present in the
system. Subsequently, the excised area will no longer be treated as RAM. If
this method is used, then the excised areas must be a multiple of 64K in size
and aligned to a 64K boundary. </p>
 <p>The following entry conditions apply
when calling <samp class="codeph">ExciseRamArea()</samp>: </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-8B81140B-36A5-5DE2-A04A-59D6889935B3"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-8B81140B-36A5-5DE2-A04A-59D6889935B3"><!-- --></a><p> <samp class="codeph">R0</samp> =
physical base address of the area to be excised </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-56DCD069-6683-5585-9DB5-04F540409F18"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-56DCD069-6683-5585-9DB5-04F540409F18"><!-- --></a><p> <samp class="codeph">R1</samp> =
size of area to be excised </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-17C76EFB-E6C3-5645-9E92-4CBC9237EA60"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-17C76EFB-E6C3-5645-9E92-4CBC9237EA60"><!-- --></a><p> <samp class="codeph">R9</samp> = <samp class="codeph">SSuperPageBase::iRamBootData</samp>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-24675744-4FD7-59BE-993A-0A939682C910"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-24675744-4FD7-59BE-993A-0A939682C910"><!-- --></a><p> <samp class="codeph"> R10</samp> points
to the super page </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-39FF3824-78CF-5B83-904A-270E1CC5686B"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-39FF3824-78CF-5B83-904A-270E1CC5686B"><!-- --></a><p> <samp class="codeph"> R11</samp> =
0 </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-2DF3FCAF-BEFC-5A87-AD8C-D38DD2A8DFA3"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-2DF3FCAF-BEFC-5A87-AD8C-D38DD2A8DFA3"><!-- --></a><p> <samp class="codeph"> R13</samp> points
to a valid stack. </p>
 </li>

</ul>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-C99A07B3-BF0A-58CF-9CA1-37891380D7C5"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-C99A07B3-BF0A-58CF-9CA1-37891380D7C5"><!-- --></a><p>Write a list of reserved
RAM blocks to the address passed in R11. The list should consist of two-word
entries, the first word being the physical base address of the block and the
second word the size. The list is terminated by an entry with zero size. The
listed blocks will still be recognised as RAM by the kernel but will be marked
as allocated during kernel boot. The blocks in the list should be multiples
of 4K in size and aligned to a 4K boundary. </p>
 </li>

</ol>
 <p>If both methods are used simultaneously, then the <samp class="codeph">ExciseRamArea()</samp> function
will require recalculation of the value in R11 for the second method. The
correct value can be found by loading <samp class="codeph">R11</samp> first with <samp class="codeph">SSuperPageBase::iRamBootData</samp>,
stepping forward 8 bytes at a time until an entry with a zero-filled second
word is found, and then stepping on by a further 8 bytes. </p>
 <p><strong>Entry conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-701D97D3-629C-5270-9E98-5677B52F12E9"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-701D97D3-629C-5270-9E98-5677B52F12E9"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the super page, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-43402496-5018-5473-859A-3B2C5289FE3B"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-43402496-5018-5473-859A-3B2C5289FE3B"><!-- --></a><p> <samp class="codeph">r11</samp> points
to the place where the pre-allocated block list should be written </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E25602F8-36F8-5C49-B3A8-D2B37DD7DEB7"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E25602F8-36F8-5C49-B3A8-D2B37DD7DEB7"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E53BCEBB-AB2A-52C5-B3C8-FDFC777EB35C"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E53BCEBB-AB2A-52C5-B3C8-FDFC777EB35C"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-61ED18DA-CB5B-50F1-81F1-59C8EEC68E15"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-61ED18DA-CB5B-50F1-81F1-59C8EEC68E15"><!-- --></a><p>the MMU is disabled. </p>
 </li>

</ul>
 <p><strong>Exit
conditions</strong> </p>
 <p>The function can modify <samp class="codeph">R0</samp>, <samp class="codeph">R1</samp>, <samp class="codeph">R2</samp>,<samp class="codeph">R3</samp>, <samp class="codeph">R11</samp> and the flags, but should preserve all other registers. </p>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4DEA1D4C-EC7B-5F9A-A293-A7F80899044B"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4DEA1D4C-EC7B-5F9A-A293-A7F80899044B"><!-- --></a><h2 class="sectiontitle">BTF_Params</h2> <p><strong>What the function should do</strong> </p>
 <p>The function should return the
value of a run-time configurable boot parameter. The parameter is identified
by one of the values of the <samp class="codeph">TBootParam</samp> enumeration, which
is passed in <samp class="codeph">R0</samp>. </p>
 <p>Typically, the function is implemented
as follows: </p>
 <pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-60C84CAA-3B19-5FC1-8192-05519C3E76DD"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-60C84CAA-3B19-5FC1-8192-05519C3E76DD"><!-- --></a>GetParameters ROUT
    ADR    r1, ParameterTable
    B    FindParameter
ParameterTable    ; Include any parameters specified in TBootParam
                ; enum here if you want to override them.
    DCD    BPR_x, value    ; parameter number, parameter value
    DCD    -1                ; terminator
</pre>
 <p>This implementation calls the generic function <samp class="codeph">FindParameter()</samp>,
which performs the necessary lookup of the parameter number in the table.
The parameter table should consist of a list of two-word entries, the first
word being the parameter number and the second the parameter value. The list
should be terminated by a negative parameter number. The generic function
searches this table for the parameter value, and if found, returns it in <samp class="codeph">R0</samp> as
stated in <a href="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE.html#GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-1981A220-876C-5BBD-A84C-E895F133B6B9">Exit
conditions</a>. </p>
 <p>Note that the address of this parameter table is
also passed to the <samp class="codeph">InitCpu()</samp> function by the <a href="GUID-F67FA7B5-F6D1-5C5C-8E10-A8E317A778E4.html#GUID-F67FA7B5-F6D1-5C5C-8E10-A8E317A778E4__GUID-C111DA06-F7EE-5E70-8D86-26BA2213B506">InitialiseHardware()</a> public function. </p>
 <p>Each entry in the boot
parameter table is identified by a <samp class="codeph">TBootParam</samp> enumeration
value that defines its position within that table. The entries have the following
meaning: </p>
 
<div class="tablenoborder"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-B0C82F23-2342-53FE-8CFE-E82DA628D6B5"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-B0C82F23-2342-53FE-8CFE-E82DA628D6B5" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p> <strong>Enumerator symbol</strong>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <strong>Summary description</strong>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph"> BPR_InitialMMUCRClear</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Mask of bits to clear in MMUCR in the <samp class="codeph">InitCpu()</samp> generic
function. Defaults to 0xFFFFFFFF, i.e. clear all bits. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph"> BPR_InitialMMUCRSet</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Mask of bits to set in MMUCR in the <samp class="codeph">InitCpu()</samp> generic
function after clearing those specified by <samp class="codeph">BPR_InitialMMUCRClear</samp>.
Defaults to a CPU-dependent value. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BPR_FinalMMUCRClear</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Mask of bits to clear in MMUCR when the MMU is enabled. Defaults
to 0, which means do not clear any bits. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BPR_FinalMMUCRSet</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Mask of bits to set in MMUCR when the MMU is enabled after clearing
those specified in <samp class="codeph">BPR_FinalMMUCRSet</samp>. Defaults to a CPU-dependent
value. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BPR_AuxCRClear</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Mask of bits to clear in AUXCR in the <samp class="codeph">InitCpu()</samp> Symbian
platform generic function. Defaults to a CPU dependent value. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BPR_AuxCRSet</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Mask of bits to set in AUXCR in the <samp class="codeph">InitCpu()</samp> Symbian
platform generic function after clearing those specified by <samp class="codeph">BPR_InitialAUXCRClear</samp>.
Defaults to a CPU-dependent value. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BPR_CAR</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Initial value to set for coprocessor access register if present.
Defaults to 0. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BPR_UncachedLin</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Mandatory parameter on the direct memory model, not used on other
memory models. The value is copied into <samp class="codeph">SSuperPageBase::iUncachedAddress</samp> for
use by any code which needs to do an uncached memory access, usually for memory
controller synchronisation purposes. On systems with an MMU, this address
will be mapped as an alias of the super page and must refer to the base address
of a 1Mb region of unused virtual address space, aligned on a 1Mb boundary.
On a system with no MMU, this address should be the physical address of some
uncached memory. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph"> BPR_PageTableSpace</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Used only on the direct memory model on systems with an MMU. Specifies
the amount of RAM to reserve for page tables. Defaults to 32K. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BPR_KernDataOffset</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Used only on the direct memory model. Specifies the offset from
the base of the super page to the base of the kernel .data section. Defaults
to 8K. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph"> BPR_BootLdrImgAddr </samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Mandatory parameter for bootloader configurations; not required
for other configurations. Specifies the physical base address of the RAM-loaded
image. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BPR_BootLdrExtraRAM</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Only used on bootloader configurations. Specifies the amount of
'user' memory to reserve (this is in fact used to satisfy <samp class="codeph">Epoc::AllocPhysicalRam</samp> requests,
usually for video RAM) in the case where the RAM-loaded image is at the bottom
of RAM and so the bootloader RAM is at the top. Defaults to 1MB. </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p><strong>Entry
conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-38ED47F2-BD04-5039-8A71-81D787C6B679"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-38ED47F2-BD04-5039-8A71-81D787C6B679"><!-- --></a><p>R0 contains the number
identifying the required parameter; see the <samp class="codeph">TBootParam</samp> enumerator
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/arm/bootdefs.h</span>. </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-151A442C-5903-50F5-B425-0FB80CE950B8"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-151A442C-5903-50F5-B425-0FB80CE950B8"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the super page, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-916DB071-2433-512B-A4C4-70C736DABE15"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-916DB071-2433-512B-A4C4-70C736DABE15"><!-- --></a><p> <samp class="codeph">r11</samp> points
to the place where the pre-allocated block list should be written </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-32D51889-00F9-5968-A3BC-A1752825B8AC"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-32D51889-00F9-5968-A3BC-A1752825B8AC"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-7F5685B5-95EA-5C03-9E92-B50B60DAA2FC"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-7F5685B5-95EA-5C03-9E92-B50B60DAA2FC"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E5D06E47-BF01-51D1-BC15-AF5D588AB5A5"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E5D06E47-BF01-51D1-BC15-AF5D588AB5A5"><!-- --></a><p>the MMU is disabled. </p>
 </li>

</ul>
 <p id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-1981A220-876C-5BBD-A84C-E895F133B6B9"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-1981A220-876C-5BBD-A84C-E895F133B6B9"><!-- --></a><strong>Exit conditions</strong> </p>
 <p>If
the parameter value is specified, it should be returned in <samp class="codeph">R0</samp> and
the <samp class="codeph">N</samp> flag should be cleared. </p>
 <p>If the parameter value
is not specified, the <samp class="codeph">N</samp> flag should be set. </p>
 <p>Registers <samp class="codeph">R0</samp> , <samp class="codeph">R1</samp>, <samp class="codeph">R2</samp> and
the flags may be modified. All other registers should be preserved. </p>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-EEF889E7-915F-57E9-8E2D-DC17B24C7728"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-EEF889E7-915F-57E9-8E2D-DC17B24C7728"><!-- --></a><h2 class="sectiontitle">BTF_Final</h2> <p><strong>What the function should do</strong> </p>
 <p>The function should do any final
setup required before booting the kernel. It is called at the end of the bootstrap,
just before booting the kernel. </p>
 <p>The function should: </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-388B647D-5AD6-58FD-B78A-67DBC6B945A5"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-388B647D-5AD6-58FD-B78A-67DBC6B945A5"><!-- --></a><p>Map any cache flushing
areas required by the CPU. </p>
 <p>Processors that flush the data cache by
reading dummy addresses or by allocating dummy addresses into the cache (e.g.
StrongARM and XScale processors) will need a main cache flush area. If the
processor has an alternate data cache (e.g. StrongARM and XScale mini data
cache) a second flush area may be required for it. On the moving and multiple
memory models the linear addresses used for these flushing areas are fixed
(<samp class="codeph">KDCacheFlushArea</samp> and <samp class="codeph">KDCacheFlushArea</samp> +1MB
respectively). On the direct memory model any unused linear address may be
selected. The linear addresses used should be written into <samp class="codeph">SSuperPageBase::iDCacheFlushArea</samp> and <samp class="codeph">SSuperPageBase::iAltDCacheFlushArea</samp>. In addition, the fields <samp class="codeph">SSuperPageBase::iDCacheFlushWrap</samp> and <samp class="codeph">SSuperPageBase::iAltDCacheFlushWrap</samp> should
be written with a power of 2 at least twice the cache size and no bigger than
half the reserved address area. A value of 0x00080000 (512KB) is usually used. </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-B0061BBC-DEBE-5A12-B11B-39F73FFC7072"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-B0061BBC-DEBE-5A12-B11B-39F73FFC7072"><!-- --></a><p>Populate any super page
or CPU page fields with platform-specific information used by the variant,
for example addresses of CPU idle routines in the bootstrap. Routines can
be placed in the bootstrap if known alignment is required for the routine. </p>
 </li>

</ul>
 <p><strong>Entry
conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-61AA6724-B809-5742-A6FD-F39D5269B2EE"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-61AA6724-B809-5742-A6FD-F39D5269B2EE"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the super page, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-B58A49E2-B4AA-53D4-816A-B48491A707D8"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-B58A49E2-B4AA-53D4-816A-B48491A707D8"><!-- --></a><p> <samp class="codeph">r11</samp> points
to the kernel image header, a <a href="GUID-88C84EC0-B63E-3848-82BF-E3A81E2F7E9A.html"><span class="apiname">TRomImageHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-34A71E2F-9232-5DAF-AF04-D51822B65E8D"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-34A71E2F-9232-5DAF-AF04-D51822B65E8D"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-38C918F2-9769-55EC-A9F1-5D64CCB6EA2B"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-38C918F2-9769-55EC-A9F1-5D64CCB6EA2B"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-538DE8FF-2BE4-5D50-933C-F6D7E94A3CC1"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-538DE8FF-2BE4-5D50-933C-F6D7E94A3CC1"><!-- --></a><p>the MMU is disabled. </p>
 </li>

</ul>
 <p><strong>Exit
conditions</strong> </p>
 <p>Registers <samp class="codeph">R0</samp> to <samp class="codeph">R9</samp> and
flags may be modified; other registers should be preserved. </p>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4C8986CB-0D5A-5D61-8A4B-DAC1B9D2C8B5"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4C8986CB-0D5A-5D61-8A4B-DAC1B9D2C8B5"><!-- --></a><h2 class="sectiontitle">BTF_Alloc</h2> <p><strong>What the function should do</strong> </p>
 <p>Allocates RAM during boot. </p>
 <p>This
function is called at various points to initialise the memory allocator, or
to allocate physical RAM. A generic implementation is provided for this function
and this will normally be sufficient, so a typical implementation for this
function reduces to: </p>
 <pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-90A5743F-4FB5-59A4-9FC8-DAB2CCDF8EB0"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-90A5743F-4FB5-59A4-9FC8-DAB2CCDF8EB0"><!-- --></a>DCD HandleAllocRequest</pre>
 <p>in
the boot table. For systems with no MMU, the function name should be changed
to <samp class="codeph">AllocatorStub</samp>. </p>
 <p>It is advisable not to override
this function. </p>
 <p><strong>Entry
conditions</strong> </p>
 <ul>
<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-72DBAE17-60F1-5EF1-B9B1-2E69E109FE3B"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-72DBAE17-60F1-5EF1-B9B1-2E69E109FE3B"><!-- --></a><p>R2 contains the type
of allocation required; this is defined by one of the values of the <samp class="codeph">TBootMemAlloc</samp> enumeration </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-70690B58-7B7B-51CE-A678-F25222CC6664"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-70690B58-7B7B-51CE-A678-F25222CC6664"><!-- --></a><p>R4 contains the size
to allocate (as a log to base 2) for allocations of type <samp class="codeph">BMA_Kernel</samp> </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-C993DE47-01D2-5D7F-98FE-5CAEDAF16079"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-C993DE47-01D2-5D7F-98FE-5CAEDAF16079"><!-- --></a><p> <samp class="codeph">R10</samp> points
to the super page, represented by the <samp class="codeph">SSuperPageBase</samp> struct
defined in <span class="filepath">os\kernelhwsrv\kernel\eka\include\kernel\kernboot.h</span>  </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-030F04FA-1919-5643-A634-60E9A9228FA9"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-030F04FA-1919-5643-A634-60E9A9228FA9"><!-- --></a><p> <samp class="codeph">R12</samp> points
to the ROM header, a <a href="GUID-DE701BC5-4AA8-345F-BDD5-5737DB8C0098.html"><span class="apiname">TRomHeader</span></a> object </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-DB3E70CC-7B35-5952-BE93-5A47674F3A5A"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-DB3E70CC-7B35-5952-BE93-5A47674F3A5A"><!-- --></a><p> <samp class="codeph">R13</samp> points
to a valid stack </p>
 </li>

<li id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-7D7962A8-57A0-5F16-9651-0A0E71F1605C"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-7D7962A8-57A0-5F16-9651-0A0E71F1605C"><!-- --></a><p>the MMU may be enabled
or disabled. </p>
 </li>

</ul>
 <p>The type of allocation required is defined by the value of the enumerator <samp class="codeph">TBootMemAlloc</samp>,
defined in <span class="filepath">os/kernelhwsrv/kernel/eka/include/kernel/arm/bootdefs.h</span>.
The allocation types are as follows: </p>
 
<div class="tablenoborder"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-756C039B-D079-5EFC-B3A6-37675FD4CCBC"><!-- --></a><table cellpadding="4" cellspacing="0" summary="" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-756C039B-D079-5EFC-B3A6-37675FD4CCBC" frame="border" border="1" rules="all">
<tbody>
<tr>
<td class="cellrowborder" valign="top"><p> <strong>Enumerator symbol</strong>  </p>
 </td>

<td class="cellrowborder" valign="top"><p> <strong>Summary description</strong>  </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BMA_Init</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Called to initialise the memory allocator. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BMA_SuperCPU </samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Should return the physical address of the super page in R0. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BMA_PageDirectory</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Should return the physical address of the page directory in R0. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BMA_PageTable</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Allocate a new page table (1KB size and 1KB alignment) and return
its physical address in R0. It is not necessary to clear the page table here. </p>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BMA_Kernel</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><div class="p">Allocate a page of size 2R4. This must be a valid processor page
size; on ARM this means R4=12, 16 or 20. The returned physical address will
be a multiple of 2R4. If no page of the requested size can be allocated a
page of the largest possible smaller size will be allocated and R4 will be
modified accordingly.<div class="note"><span class="notetitle">Note:</span> If no page of any size can be allocated this call
will fault the system.</div>
 </div>
 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top"><p> <samp class="codeph">BMA_Reloc</samp>  </p>
 </td>

<td class="cellrowborder" valign="top"><p>Called when the allocator data structures need to be relocated in
memory. On entry R0 contains the offset to apply to all pointers (that is,
the new address of data minus the old address). It is assumed that all the
allocator data is contained in the super page or CPU page and that there are
no pointers to areas which could be relocated independently. </p>
 </td>

</tr>

</tbody>

</table>
</div>
 <p><strong>Exit
conditions</strong> </p>
 <p> <samp class="codeph">R0</samp> and flags may be modified. For <samp class="codeph">BMA_Kernel</samp> allocations, <samp class="codeph">R4</samp> may
also be modified. All other registers should be preserved. </p>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-9723F1BA-6B97-5E6A-A913-8B17C100787D"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-9723F1BA-6B97-5E6A-A913-8B17C100787D"><!-- --></a><h2 class="sectiontitle">BTF_GetPdePerm</h2> <p><strong>What the function should do</strong> </p>
 <p>This function is called at various
points to translate a standardised permission descriptor along with the size
of mapping required to the PDE permission/attribute bits needed for such a
mapping. A standardised permission descriptor can be either an index into
the boot table (for any of the standard permission types) or the value generated
by a <a href="GUID-25941CD2-D124-55DD-8716-ACC93E3F1D6C.html#GUID-25941CD2-D124-55DD-8716-ACC93E3F1D6C__GUID-B5EC22B5-B995-5D54-8F33-1B6FCE11BB3F">BTP_ENTRY</a> macro. </p>
 <p>A
generic implementation is provided for this function and it should not be
necessary to override it. A typical implementation for this function then
just reduces to: </p>
 <pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-57B1277B-B322-506B-A5EC-A4D10C5FA420"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-57B1277B-B322-506B-A5EC-A4D10C5FA420"><!-- --></a>DCD GetPdeValue</pre>
 <p>in
the boot table. </p>
 <p>Note that for systems with no MMU, this function is
not required. </p>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-ACAEB6E1-F8D2-51E9-AB57-4E4658E4F004"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-ACAEB6E1-F8D2-51E9-AB57-4E4658E4F004"><!-- --></a><h2 class="sectiontitle">BTF_GetPtePerm</h2> <p><strong>What the function should do</strong> </p>
 <p>This function is called at various
points to translate a standardised permission descriptor along with the size
of mapping required to the PTE permission/attribute bits needed for such a
mapping. A standardised permission descriptor can be either an index into
the boot table (for any of the standard permission types) or the value generated
by <a href="GUID-25941CD2-D124-55DD-8716-ACC93E3F1D6C.html#GUID-25941CD2-D124-55DD-8716-ACC93E3F1D6C__GUID-B5EC22B5-B995-5D54-8F33-1B6FCE11BB3F">BTP_ENTRY</a> macro. </p>
 <p>A
generic implementation is provided for this function and it should not be
necessary to override it. In the boot table, a typical implementation for
this function then reduces to: </p>
 <pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E0836362-3BAE-54CB-9A1E-C81C1E823550"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-E0836362-3BAE-54CB-9A1E-C81C1E823550"><!-- --></a>DCD GetPteValue</pre>
 <p>Note
that for systems with no MMU, this function is not required. </p>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-DF0A1707-49C5-5050-B096-77704EA449DA"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-DF0A1707-49C5-5050-B096-77704EA449DA"><!-- --></a><h2 class="sectiontitle">BTF_PTUpdate</h2> <p><strong>What the function should do</strong> </p>
 <p>This function is called whenever
a PDE or PTE is updated. It performs whatever actions are required to make
sure that the update takes effect. This usually means draining the write buffer
and flushing the TLB (both TLBs on a Harvard architecture system). </p>
 <p>A
generic implementation is provided for this function and it should not be
necessary to override it. In the boot table, a typical implementation for
this function then reduces to: </p>
 <pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-FE889B79-013E-5A93-8ED0-51BEB97623A4"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-FE889B79-013E-5A93-8ED0-51BEB97623A4"><!-- --></a>DCD PageTableUpdate</pre>
 <p>Note
that for systems with no MMU, this function is not required. </p>
 </div>

<div class="section" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-37E8A845-6326-52F1-9607-5488B1E009A8"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-37E8A845-6326-52F1-9607-5488B1E009A8"><!-- --></a><h2 class="sectiontitle">BTF_EnableMMU</h2> <p><strong>What the function should do</strong> </p>
 <p>This function is called to enable
the MMU and thereby switch from operating with physical addresses to operating
with virtual addresses. </p>
 <p>A generic implementation is provided for this
function and it should not be necessary to override it. In the boot table,
a typical implementation for this function then reduces to: </p>
 <pre class="codeblock" id="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4FB9161D-18BA-5ADC-AB32-4D8E86DAF55F"><a name="GUID-B3F6FC45-3BF0-5F92-8325-44C705BA47AE__GUID-4FB9161D-18BA-5ADC-AB32-4D8E86DAF55F"><!-- --></a>DCD EnableMmu</pre>
 <p>Note
that for systems with no MMU, this function is not required. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-08867AEC-5866-5583-9AAB-068CB51F5C18.html" title="The platform-specific layer of the bootstrap must implement a set of standard functions and definitions that are used by the generic layer.">Platform-Specific Source Code</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>