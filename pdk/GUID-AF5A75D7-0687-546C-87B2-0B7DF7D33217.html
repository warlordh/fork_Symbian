<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="SQL WHERE Clause Tips"/>
<meta name="abstract" content="This guide provides tips for using the WHERE clause."/>
<meta name="description" content="This guide provides tips for using the WHERE clause."/>
<meta name="DC.Relation" scheme="URI" content="GUID-831F9AA3-0209-53DC-96C4-04157F22870C.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-F8824165-4B33-50D1-9706-BD2438B5A2EE.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-868D5B32-1CC4-506E-9C49-C86428B9A50F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C6D3827F-8F73-593E-A339-B510EEB9771F.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-831F9AA3-0209-53DC-96C4-04157F22870C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-22844C28-AB5B-5A6F-8863-7269464684B4.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-78773BCA-ADF6-53E6-AC80-5CB2AE1F8BCC.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-1F12E3F5-45B2-55EC-B021-00338277C608.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-43CA02E7-0101-5824-B91B-E15EE20C829A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-49A3419F-D20A-5C5D-B2FF-51724EF37704.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C2FAEBB2-4A1A-5BB0-9670-4801525CBC6A.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B994E6F7-228A-5433-B87F-91857C5D93D6.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-4FC23DB7-4758-5DA4-81FF-0DAB169E2757.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-126FCCCC-0E7D-59AE-959A-2F94A7319C4B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-ACCCB148-DAF9-59EC-B585-8EF632B9BF04.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-B7E978C1-45CA-554C-8028-D901B97BA2E0.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>SQL WHERE Clause Tips</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2859821 id2860178 id2534422 id2534459 id2534479 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-FBCBF8A0-7922-5881-A1C5-5DB41630E75A.html" title="Provides services to enable and support persistence.">Persistent Data Services Guide</a> &gt; <a href="GUID-F8824165-4B33-50D1-9706-BD2438B5A2EE.html" title="The persistent storage collection.">Persistent Storage</a> &gt; <a href="GUID-868D5B32-1CC4-506E-9C49-C86428B9A50F.html" title="The Symbian SQL component.">Symbian SQL</a> &gt; <a href="GUID-C6D3827F-8F73-593E-A339-B510EEB9771F.html">SQL Concept Guides</a> &gt; <a href="GUID-831F9AA3-0209-53DC-96C4-04157F22870C.html" title="This topic discusses tips for SQL developers.">SQL Developer Tips</a> &gt; </div>
<h1 class="topictitle1">SQL WHERE Clause Tips</h1>
<div><p>This guide provides tips for using the WHERE clause. </p>

<div class="section" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-DF59190A-38ED-4ACA-B4F2-C4D08FBE50BB"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-DF59190A-38ED-4ACA-B4F2-C4D08FBE50BB"><!-- --></a><h2 class="sectiontitle">Introduction</h2> <p>You should use indexed column names
rather than expressions in WHERE clauses. </p>
 <p><strong>Intended
audience:</strong> </p>
 <p>This document is intended to be used by Symbian platform
licensees and third party application developers. </p>
 </div>

<div class="section" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-54EE7DC6-1E73-5A90-9442-7056C355DB63"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-54EE7DC6-1E73-5A90-9442-7056C355DB63"><!-- --></a><h2 class="sectiontitle">Used Indexed
Column Names, not Expressions, in WHERE Clauses</h2> <p>Suppose you have
a table with an indexed column you want to search against, like this: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-0BEAF3EE-EFEC-50E2-81AD-38AFC4BA3A79"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-0BEAF3EE-EFEC-50E2-81AD-38AFC4BA3A79"><!-- --></a>
CREATE TABLE demo312(
    id INTEGER PRIMARY KEY,
    name TEXT
);
</pre>
 <p>When you use the demo312.id column in a query, it is important
that the column name appear by itself on one side of the comparison operation
and that it not be part of an expression. So the following query works very
efficiently: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-FA12E021-9464-5F19-B192-84CF46BE6028"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-FA12E021-9464-5F19-B192-84CF46BE6028"><!-- --></a>
SELECT name FROM demo312 WHERE id=?;
</pre>
 <p>But the following variations, although logically equivalent,
result in a full table scan: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-D37A64D9-9480-572E-86DD-D7A6C36CF8F5"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-D37A64D9-9480-572E-86DD-D7A6C36CF8F5"><!-- --></a>
SELECT name FROM demo312 WHERE id-?=0;
SELECT name FROM demo312 WHERE id*1=?;
SELECT name FROM demo312 WHERE +id=?;
</pre>
 <p>In other words, you want to make sure that the indexed column
name appears by itself on one side or the other of the comparison operator,
and not inside an expression of some kind. Even a degenerate expression such
as a single unary “+” operator will disable the optimizer and cause a full
table scan. </p>
 <p>Some variation in terms of the WHERE clause is permitted.
The column name can be enclosed in parentheses, it can be qualified with the
name of its table, and it can occur on either side of the comparison operator.
So all of the following forms are efficient, and will in fact generate identical
bytecode: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-F400BDF3-3A5D-53EB-A94D-D2A75CB156AE"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-F400BDF3-3A5D-53EB-A94D-D2A75CB156AE"><!-- --></a>
SELECT name FROM demo312 WHERE id=?;
SELECT name FROM demo312 WHERE demo312.id=?;
SELECT name FROM demo312 WHERE ?=id;
SELECT name FROM demo312 WHERE (id)=?;
SELECT name FROM demo312 WHERE (((demo321.id))=?);
</pre>
 <p>The previous examples have all shown SELECT statements. But
the same rules apply for the WHERE clause in DELETE and UPDATE statements: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-BFF2D644-12F1-5CF4-9658-CCA9A38A258E"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-BFF2D644-12F1-5CF4-9658-CCA9A38A258E"><!-- --></a>
UPDATE demo312 SET name=? WHERE id=?;
DELETE FROM demo312 WHERE id=?;
</pre>
 </div>

<div class="section" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-DA77E2E3-2F9D-5F56-A699-8BFDFE6CD3ED"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-DA77E2E3-2F9D-5F56-A699-8BFDFE6CD3ED"><!-- --></a><h2 class="sectiontitle">Use Conjunctions
in WHERE Clause Expressions</h2> <p>SQLite works best when the expression
in a WHERE clause is a list of terms connected by the conjunction (AND) operator.
Furthermore, each term should consist of a single comparison operator against
an indexed column. The same rule also applies to ON clauses in a join and
to a HAVING clause. </p>
 <p>SQLite is able to optimize queries such as this: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-0B7F11E0-E50E-5C3B-B0B6-7390BDF7F201"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-0B7F11E0-E50E-5C3B-B0B6-7390BDF7F201"><!-- --></a>
SELECT * FROM demo313 WHERE a=5 AND b IN ('on','off') AND c&gt;15.5;
</pre>
 <p>The WHERE clause in the example above consists of three terms
connected by the AND operator and each term contains a single comparison operator
with a column as one operand. The three terms are: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-A2B87FA7-DBFC-534F-B549-9AAB0AB6A48F"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-A2B87FA7-DBFC-534F-B549-9AAB0AB6A48F"><!-- --></a>
a=5
b IN ('on','off')
c&gt;15.5
</pre>
 <p>The SQLite query optimizer is able to break the WHERE clause
down and analyze each of the terms separately, and possibly use one or more
of those terms with indexes to generate bytecode that runs faster. But consider
the following similar query: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-E6734A32-D04F-5594-B435-4EA15B4B03F9"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-E6734A32-D04F-5594-B435-4EA15B4B03F9"><!-- --></a>
SELECT * FROM demo313 WHERE (a=5 AND b IN ('on','off') AND c&gt;15.5) OR d=0;
</pre>
 <p>In this case, the WHERE clause consist of two terms connected
by an OR. The query optimizer is not able to break this expression up for
analysis. As a result, this query will be implemented as a full table scan
in which the complete WHERE clause expression will be evaluated for each row. </p>
 <p>In
this case, refactoring the WHERE clause does not help much: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-1B5F89D5-F21C-5F53-B427-C2EC6ACEAF21"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-1B5F89D5-F21C-5F53-B427-C2EC6ACEAF21"><!-- --></a>
SELECT * FROM demo313 WHERE (a=5 OR d=0) AND (b IN ('on','off') OR d==0)
    AND (c&gt;15.5 OR d=0)
</pre>
 <p>The WHERE clause is now a conjunctive expression but its terms
are not simple comparison operators against table columns. The query optimizer
will be able to break the WHERE expression into three smaller subexpressions
for analysis, but because each subexpression is a disjunction, no indexes
will be usable and a full table scan will result. </p>
 <p>If you know in advance
that all rows in the result set are unique (or if that is what you want anyway)
then the following query can be used for an efficient implementation: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-D1C700BD-F69C-5C67-8EF4-CC7BED64A2BB"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-D1C700BD-F69C-5C67-8EF4-CC7BED64A2BB"><!-- --></a>
SELECT * FROM demo313 WHERE a=5 AND b IN ('on','off') AND c&gt;15.5
UNION
SELECT * FROM demo313 WHERE d=0
</pre>
 <p>In this form, the two queries are evaluated separately and
their results are merged to get the final result. The WHERE clause on both
queries is a conjunction of simple comparison operators so both queries could
potentially be optimized to use indexes. </p>
 <p>If the result set could potentially
contain two or more identical rows, then you can run the above query efficiently
as follows: </p>
 <pre class="codeblock" id="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-CDCBAE0D-BE30-575B-A7A4-E3E7E8F99000"><a name="GUID-AF5A75D7-0687-546C-87B2-0B7DF7D33217__GUID-CDCBAE0D-BE30-575B-A7A4-E3E7E8F99000"><!-- --></a>
SELECT * FROM demo313 WHERE RowID IN (
    SELECT RowID FROM demo313 WHERE a=5 AND b IN('on','off') AND c&gt;15.5
    UNION ALL
    SELECT RowID FROM demo313 WHERE d=0
)
</pre>
 <p>The subquery computes a set containing the RowID of every
row that should be in the result set. Then the outer query retrieves the desired
rows. When a WHERE clause contains OR terms at the top level, most enterprise-class
SQL database engines such as PostgreSQL or Oracle will automatically convert
the query to a form similar to the above. But in order to keep minimize the
complexity and size of SQLite, such advanced optimizations are omitted. In
the rare cases where such queries are required, than can be optimized manually
by the programmer by recasting the query statements as shown above. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-831F9AA3-0209-53DC-96C4-04157F22870C.html" title="This topic discusses tips for SQL developers.">SQL Developer Tips</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-22844C28-AB5B-5A6F-8863-7269464684B4.html" title="This document introduces you to the Symbian platform implementation of the Structured Query Language(SQL).">SQL Overview</a></div>
<div><a href="GUID-78773BCA-ADF6-53E6-AC80-5CB2AE1F8BCC.html" title="This topic introduces you to the SQL server.">SQL Server
Guide</a></div>
<div><a href="GUID-1F12E3F5-45B2-55EC-B021-00338277C608.html" title="Used to access and query relational databases using the SQL query language.">SQL DB Overview</a></div>
<div><a href="GUID-43CA02E7-0101-5824-B91B-E15EE20C829A.html" title="This guide gives advice for avoiding the use of transient tables.">Avoid Transient
Tables</a></div>
<div><a href="GUID-49A3419F-D20A-5C5D-B2FF-51724EF37704.html">Prevent Datafile
Corruption</a></div>
<div><a href="GUID-C2FAEBB2-4A1A-5BB0-9670-4801525CBC6A.html" title="This document includes several tips for using SQL indexes.">SQL Index
Tips</a></div>
<div><a href="GUID-B994E6F7-228A-5433-B87F-91857C5D93D6.html" title="This guide provides some tips for using COMMIT statements.">SQL Insertion
Tips</a></div>
<div><a href="GUID-4FC23DB7-4758-5DA4-81FF-0DAB169E2757.html" title="This guide gives tips for using the database schema.">SQL Schema
Tips</a></div>
<div><a href="GUID-2A2920E0-5D40-5358-BC0C-8572CEFE078C.html" title="This document explains how the optimizer changes expressions.">SQL Expressions</a></div>
<div><a href="GUID-126FCCCC-0E7D-59AE-959A-2F94A7319C4B.html" title="This guide provides tips for using certain SQL statements.">SQL Statement
Tips</a></div>
<div><a href="GUID-ACCCB148-DAF9-59EC-B585-8EF632B9BF04.html" title="This guide explains how to use CROSS JOIN phrases to override the optimizer's ordering of tables.">SQL Joins</a></div>
<div><a href="GUID-B7E978C1-45CA-554C-8028-D901B97BA2E0.html" title="This guide gives details of how to use the ANALYZE command to help the optimizer."> ANALYZE
Command</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>