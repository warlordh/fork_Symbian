<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="task"/>
<meta name="DC.Title" content="SUPL Push API Tutorial"/>
<meta name="abstract" content="This topic describes how the Symbian SUPL WAP Push plug-in uses the SUPL Push API (deprecated). Device creators can use this information if they want to implement their own SUPL INIT push plug-in."/>
<meta name="description" content="This topic describes how the Symbian SUPL WAP Push plug-in uses the SUPL Push API (deprecated). Device creators can use this information if they want to implement their own SUPL INIT push plug-in."/>
<meta name="DC.Relation" scheme="URI" content="GUID-816334A7-488B-5F91-8C2E-47076D875013.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7F476137-5E7F-5288-9F4A-6C20F0A1AD9B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-01C03839-C88B-5FC3-9E0E-686415888B63.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-816334A7-488B-5F91-8C2E-47076D875013.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E7DD9CFD-F477-5D25-BC10-BEBFB1022F7E.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>SUPL Push API Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2402590 id2403195 id2403262 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-7F476137-5E7F-5288-9F4A-6C20F0A1AD9B.html">Location Based Services (LBS) Guide</a> &gt; <a href="GUID-01C03839-C88B-5FC3-9E0E-686415888B63.html" title="The Network Adaptation collection contains Protocol Module ECOM plug-ins that can be used by the Network Gateway to support location and privacy requests.">Network Adaptation</a> &gt; <a href="GUID-816334A7-488B-5F91-8C2E-47076D875013.html" title="The LBS subsystem contains a reference Network Protocol Module that supports the Open Mobile Alliance (OMA) SUPL V1.0 standard. This section contains documentation that describes the Symbian platform reference SUPL Protocol Module, its supporting components and APIs, its runtime behaviour and details about how it is configured by device creators.">SUPL Protocol Module</a> &gt; </div>
<h1 class="topictitle1">SUPL
Push API Tutorial</h1>
<div><p>This topic describes how the Symbian SUPL WAP Push plug-in uses
the SUPL Push API (deprecated). Device creators can use this information if
they want to implement their own SUPL INIT push plug-in. </p>

<div class="p" id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-D9767AB2-6C0F-410A-869C-C806C581A428"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-D9767AB2-6C0F-410A-869C-C806C581A428"><!-- --></a><p>Read <a href="GUID-CC3454B1-21DA-542E-8949-52C30755AC77.html" title="The SUPL Protocol Module is a Network Protocol Module provided by Symbian to support the OMA SUPL v1.0 standard.">SUPL
Protocol Module Overview</a> and <a href="GUID-E7DD9CFD-F477-5D25-BC10-BEBFB1022F7E.html" title="The SUPL Push API is used to process SUPL INIT messages sent from a SUPL Location Platform (SLP).">SUPL
Push API</a> before reading this document. </p>
<p>Note: From Symbian^3
the SUPL Protocol Module is deprecated. For the preferred way of using SUPL
see <a href="GUID-1F7F543A-8A9C-4460-BDB1-A6866E9DF0B9.html">SUPL Proxy Protocol
Module</a>. </p>
 </div>

<div class="section" id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-DF6B1DC0-BA60-44BC-A7D0-CF7DB1D11684"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-DF6B1DC0-BA60-44BC-A7D0-CF7DB1D11684"><!-- --></a><p>This document describes how the SUPL WAP Push plug-in uses the
SUPL Push API. </p>
 <p>Device creators only need to use the SUPL Push API
to write their own <samp class="codeph">SUPL INIT</samp> message handlers. </p>
 <p>The
Symbian WAP Push plug-in derives from <a href="GUID-56BCBAED-03E5-35D6-A828-9B48ACEBF085.html"><span class="apiname">CContentHandlerBase</span></a>,
the base class of push message handlers. It also implements <a href="GUID-7A1E29E6-CF2C-3B19-BADE-2DDD67F6DC36.html"><span class="apiname">MLbsSuplPushObserver</span></a> to
receive notification of <samp class="codeph">SUPL INIT</samp> message delivery to the
SUPL Protocol Module. </p>
 <p>See <span class="filepath">&lt;LBS_SOURCE_ROOT&gt;/LbsSuplProtocolModule/SuplWapPush</span> for
the code for the WAP Push plug-in. </p>
 </div>

<a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-992D4417-2485-546D-BF2D-698A76D732CA"><!-- --></a><ol id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-992D4417-2485-546D-BF2D-698A76D732CA"><li class="stepexpand" id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-8CC996F5-4CC2-51BE-926A-9011F38FFE26"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-8CC996F5-4CC2-51BE-926A-9011F38FFE26"><!-- --></a><span>Define a SUPL INIT
handler class </span>
 The Symbian WAP Push plug-in derives from <a href="GUID-56BCBAED-03E5-35D6-A828-9B48ACEBF085.html"><span class="apiname">CContentHandlerBase</span></a> to
receive SUPL WAP Push messages. It implements <a href="GUID-7A1E29E6-CF2C-3B19-BADE-2DDD67F6DC36.html"><span class="apiname">MLbsSuplPushObserver</span></a> to
receive notification of successful message delivery to the SUPL Protocol Module. 
 <pre class="codeblock" id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-D538A5F1-5BB8-5C66-8AD6-C754E8E15F83"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-D538A5F1-5BB8-5C66-8AD6-C754E8E15F83"><!-- --></a>
NONSHARABLE_CLASS(CLbsSuplWapPush) : public CContentHandlerBase, public MLbsSuplPushObserver
    {
public:
    static CLbsSuplWapPush* NewL();
    virtual ~CLbsSuplWapPush();
    
    virtual void OnSuplInitComplete(TLbsSuplPushChannel aChannel, TLbsSuplPushRequestId aReqId, 
            TInt aError, TInt aReserved);

    // From CPushHandlerBase
    virtual void HandleMessageL(CPushMessage* aPushMsg);
    
    // Other methods of CContentHandlerBase omitted here...

};
</pre>
 
 The plug-in's <samp class="codeph">ConstructL()</samp> creates a new instance of <a href="GUID-A55B3609-097F-3D14-80FF-76ADA5462621.html"><span class="apiname">CLbsSuplPush</span></a>. 
 <pre class="codeblock" id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-C960E9CF-0B66-5E45-8716-82C2E542ADE2"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-C960E9CF-0B66-5E45-8716-82C2E542ADE2"><!-- --></a>
// This handler uses the WAP channel
iSuplPush = CLbsSuplPush::NewL(ELbsSuplPushChannelWAP, *this);
</pre>
 
</li>
<li class="stepexpand" id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-A2B119BE-7342-5C4A-8304-5CF4BA7A8FBF"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-A2B119BE-7342-5C4A-8304-5CF4BA7A8FBF"><!-- --></a><span>Implement HandleMessageL() </span>
 When the WAP Push plug-in receives a WAP Push message, it extracts the
message body and calls <a href="GUID-A55B3609-097F-3D14-80FF-76ADA5462621.html#GUID-A55B3609-097F-3D14-80FF-76ADA5462621__GUID-5AD5A31B-0DE0-36DF-A19F-E0E57EBCCEA9"><span class="apiname">CLbsSuplPush::SuplInit()</span></a>. 
 <pre class="codeblock" id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-5FF6A0B6-F14D-5103-9D80-87A6560633B7"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-5FF6A0B6-F14D-5103-9D80-87A6560633B7"><!-- --></a>
void CLbsSuplWapPush::HandleMessageL(CPushMessage* aPushMsg)
    {
    LBSLOG(ELogP3, "SUPL WAP Push : CLbsSuplWapPush::HandleMessageL");
    if(aPushMsg)
        {
        TPtrC8 body;
        TBool hasBody=aPushMsg-&gt;GetMessageBody(body);
        if(hasBody)
            {
            TLbsSuplPushRequestId reqId;
            TInt err=iSuplPush-&gt;SuplInit(reqId, body, 0);
            if(KErrNone==err)
                {
                LBSLOG2(ELogP3,"SUPL WAP Push : Started to deliver the message, reqId=%d", reqId);
                delete aPushMsg;
                return;
                }
            else
                {
                LBSLOG2(ELogP3,"SUPL WAP Push : CLbsSuplPush::SuplInit failed, err=%d", err);
                }
            }
        else
            {
            LBSLOG(ELogP3, "SUPL WAP Push : Empty message body, the message is skipped");
            }
        delete aPushMsg;
        }
    else
        {
        LBSLOG(ELogP3, "SUPL WAP Push : Null message pointer, the message is skipped");
        }
 iPluginKiller-&gt;KillPushPlugin();
    }
</pre>
 
</li>
<li class="stepexpand" id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-2A529784-B7FA-5BC4-B5EE-C8A6C1BFC9B7"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-2A529784-B7FA-5BC4-B5EE-C8A6C1BFC9B7"><!-- --></a><span>Implement <samp class="codeph">MLbsSuplPushObserver::OnSuplInitComplete()</samp>  </span>
 When the SUPL Protocol Module processes the SUPL INIT message, the plug-in's <a href="GUID-7A1E29E6-CF2C-3B19-BADE-2DDD67F6DC36.html#GUID-7A1E29E6-CF2C-3B19-BADE-2DDD67F6DC36__GUID-4FC083C9-640B-3CC1-8D8B-3A9AE8E57D17"><span class="apiname">MLbsSuplPushObserver::OnSuplInitComplete()</span></a> method
is called. The parameter <samp class="codeph">aError</samp> may indicate a timeout or
another error condition. 
 The WAP Push plug-in is destroyed by the WAP Push Framework. Another
instance of <a href="GUID-1DC6BEED-1EAA-3CFE-BBFD-DD2E578775E4.html"><span class="apiname">CLbsSuplWapPush</span></a> is created by the framework
to handle the next <samp class="codeph">SUPL INIT</samp> received by WAP Push. 
 <pre class="codeblock" id="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-DA87FBF9-57FC-55F2-8730-10BD6FEBB939"><a name="GUID-EE07DF44-6B3B-5D9A-A794-C49863597721__GUID-DA87FBF9-57FC-55F2-8730-10BD6FEBB939"><!-- --></a>
void CLbsSuplWapPush::OnSuplInitComplete(TLbsSuplPushChannel /*aChannel*/, TLbsSuplPushRequestId aReqId, 
            TInt aError, TInt /*aReserved*/)
    {
    if(aError==KErrNone)
        {
        LBSLOG2(ELogP3,"SUPL WAP Push : Message delivered successfully, reqId=%d", aReqId);
        }
    else
        {
        LBSLOG3(ELogP3,"SUPL WAP Push : Message delivery failed, reqId=%d, err=%d", aReqId, aError);
        }
     iPluginKiller-&gt;KillPushPlugin();
    }
</pre>
 
</li>
</ol>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-816334A7-488B-5F91-8C2E-47076D875013.html" title="The LBS subsystem contains a reference Network Protocol Module that supports the Open Mobile Alliance (OMA) SUPL V1.0 standard. This section contains documentation that describes the Symbian platform reference SUPL Protocol Module, its supporting components and APIs, its runtime behaviour and details about how it is configured by device creators.">SUPL Protocol Module</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-E7DD9CFD-F477-5D25-BC10-BEBFB1022F7E.html" title="The SUPL Push API is used to process SUPL INIT messages sent from a SUPL Location Platform (SLP).">SUPL Push
                API</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>