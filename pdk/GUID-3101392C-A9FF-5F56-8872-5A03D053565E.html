<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Using a Management Plane session to query all Access Points: Tutorial"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E9E2783E-44A0-5BA6-BBF3-D13C8D67B53E.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-8F2D6AC8-8357-55C7-970B-CD2684BA9B04.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-2139B04C-6ED6-599B-A018-D92451B8353E.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-61E0CD76-A2E3-5066-84A8-146EECA8ADCD.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-E9E2783E-44A0-5BA6-BBF3-D13C8D67B53E.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-3101392C-A9FF-5F56-8872-5A03D053565E"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Using a Management Plane session to query all Access Points: Tutorial</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-3101392C-A9FF-5F56-8872-5A03D053565E"><a name="GUID-3101392C-A9FF-5F56-8872-5A03D053565E"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2682451 id2518388 id2518454 id2518515 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-8F2D6AC8-8357-55C7-970B-CD2684BA9B04.html" title="The Communications Framework is the base for all communications, network and telephony services that Symbian platform provides. The Communications Framework manages the communications threads and the flow of information between those threads. The Framework also manages and stores the communications related settings.">Communications Framework Guide</a> &gt; <a href="GUID-2139B04C-6ED6-599B-A018-D92451B8353E.html">Data Communications Server</a> &gt; <a href="GUID-61E0CD76-A2E3-5066-84A8-146EECA8ADCD.html">Socket Server</a> &gt; <a href="GUID-E9E2783E-44A0-5BA6-BBF3-D13C8D67B53E.html">Socket Server Tutorials</a> &gt; </div>
<h1 class="topictitle1"> Using a Management Plane session to query all Access Points: Tutorial</h1>
<div><p>The <a href="GUID-55FE59B7-4FA9-3B1A-BD4C-9B7611FE75C2.html"><span class="apiname">RConnectionServ</span></a> API has to be accessed through the <a href="GUID-61E0CD76-A2E3-5066-84A8-146EECA8ADCD.html">Sockets Server</a> client API, so you need to ensure that <span class="filepath">esock.lib</span> is included in the MMP file. </p>
 <div class="section"><h2 class="sectiontitle">Querying the status of an Access Point</h2> <p>The <a href="GUID-55FE59B7-4FA9-3B1A-BD4C-9B7611FE75C2.html#GUID-55FE59B7-4FA9-3B1A-BD4C-9B7611FE75C2__GUID-E80C3173-3777-317A-8007-E9C331FAD9AE"><span class="apiname">RConnectionServ::AccessPointStatusQuery()</span></a> function retrieves information about the properties of one or more Access Points from the attached Tier specified earlier using the previous <samp class="codeph">Connect()</samp> function. </p>
 <p> <a href="GUID-55FE59B7-4FA9-3B1A-BD4C-9B7611FE75C2.html#GUID-55FE59B7-4FA9-3B1A-BD4C-9B7611FE75C2__GUID-A2ED3E49-53F0-3BFD-8E77-DE543BAADA93"><span class="apiname">RConnectionServ::AccessPointStatusQuery(const
          CConnectionServParameterBundle&amp; aQuery, CConnectionServParameterBundle&amp;
          aResult, TRequestStatus&amp; aStatus)</span></a>  </p>
 <p>The parameter <samp class="codeph">aQuery</samp> is an ‘In’ parameter. It is created and deleted by the caller, <a href="GUID-A0741C04-7E9D-3E20-96C0-22CEEFCE3238.html"><span class="apiname">CConnectionServParameterBundle</span></a>, of this function. The parameter will be deleted after completing the Access Point status query. The parameter contains structured data types in <a href="GUID-9E2F2DFF-2CBE-38E2-BB8D-423C2228C201.html"><span class="apiname">CConnectionServParameterSetContainers</span></a> and <a href="GUID-F4D933B7-A0B4-3D58-BD1E-ECAF4D9953D1.html"><span class="apiname">XParameterSet</span></a> -derived types. These data types specify the group of Access Points to be returned and the information about the Access Points to be queried. </p>
 <p>The parameter <samp class="codeph">aResult</samp> is an ‘Out’ parameter. It is created and deleted by the caller, <a href="GUID-A0741C04-7E9D-3E20-96C0-22CEEFCE3238.html"><span class="apiname">CConnectionServParameterBundle</span></a>, of this function. The parameter will be deleted after completing the Access Point status query. </p>
 <p>The time taken to complete the query depends on the implementation of the <a href="GUID-4841AEDF-D22C-57D0-872D-7BD8B6A29CF5.html" title="This topic describes the concepts of a Tier and a Tier Manager in the Communications Framework.">Tiers Manager</a> stack plug-in that serves the request. It is an asynchronous request. There can only be one outstanding query at a time. Further queries before completion of an outstanding query result in <samp class="codeph">KErrInUse</samp>. </p>
 </div>
 <div class="section"><h2 class="sectiontitle">Cancelling an Access Point status query</h2> <p> <a href="GUID-55FE59B7-4FA9-3B1A-BD4C-9B7611FE75C2.html#GUID-55FE59B7-4FA9-3B1A-BD4C-9B7611FE75C2__GUID-BDF7E376-AC0E-3723-A2FC-1C45D1ED56A4"><span class="apiname">RConnectionServ::CancelAccessPointStatusQuery()</span></a>  </p>
 <p>This function cancels the current Access Point status query. </p>
 </div>
 <div class="section"><h2 class="sectiontitle">Example Code</h2> <p>The following example shows how to find information about all the Access Points that are known to the device. </p>
 <pre class="codeblock" id="GUID-3101392C-A9FF-5F56-8872-5A03D053565E__GUID-79A6D545-BFB4-51E3-9C8A-B0608F36A71C"><a name="GUID-3101392C-A9FF-5F56-8872-5A03D053565E__GUID-79A6D545-BFB4-51E3-9C8A-B0608F36A71C"><!-- --></a>
// Start the session as mentioned in starting a session
 
// Create bundle (This bundle is owned by this class so the destructor of this class    
// must delete the bundle)
iQueryBundle = CConnectionServParameterBundle::NewL();


// Set up the filter for our query
TAccessPointStatusFilter availFilter;

// a) We want to match against this attribute
availFilter.Configured(EAccessPointFlagMatchTrue);

// b) Don’t even try to find these things out as we’re not interested at present
availFilter.Restricted(EAccessPointFlagIgnore);
availFilter.Available(EAccessPointFlagIgnore);
availFilter.Started(EAccessPointFlagIgnore);

// Call helper function to create query structure
iQueryBundle-&gt;AddMatchConditionL(availFilter);

// Call helper function to specify what we want to get for each Access Point
iQueryBundle-&gt;AddParameterSetToReturnL(XAccessPointGenericParameterSet::TypeId());

// Create container for result
iStatusBundle = CConnectionServParameterBundle::NewL();

// Make call- the iStatus is a TRequestStatus owned by your active object
iConnServ.AccessPointStatusQuery(*iQueryBundle, *iStatusBundle, iStatus);
</pre>
 <p>At this point, a return to the Active Scheduler is necessary because the query uses active objects. So the passed in <a href="GUID-E0B34F3E-D4C4-3232-B8B1-7DB35B454646.html"><span class="apiname">TRequestStatus</span></a> functions are not completed until those active objects have run. </p>
 <p>The <samp class="codeph">RunL()</samp> of the active object runs on completion of the <samp class="codeph">AccessPointStatusQuery()</samp> call, as shown below: </p>
 <pre class="codeblock" id="GUID-3101392C-A9FF-5F56-8872-5A03D053565E__GUID-EE660CAC-E120-57CE-9AD4-5B60C61FBB36"><a name="GUID-3101392C-A9FF-5F56-8872-5A03D053565E__GUID-EE660CAC-E120-57CE-9AD4-5B60C61FBB36"><!-- --></a>
/*virtual*/
void CMyActiveObjectClass::RunL()
  {
  // Some function to handle errors
  MyErrorHandler(iStatus.Int());

  // Process results
  CConnectionServParameterSetContainer* parSetCtr;
  TInt i=0;
  while(parSetCtr = iStatusBundle-&gt;GetParamSetContainer(i++))
    {
XAccessPointGenericParameterSet* genParamSet =
       XAccessPointGenericParameterSet::FindInParamSetContainer(parSetCtr);

    if(!genParamSet) continue;
    TUint apId = genParamSet-&gt;AccessPointInfo().AccessPoint();
    TAccessPointStatus apStatus = genParamSet-&gt;AccessPointStatus();

    // Your function to process result
    ProcessResult(apId,apStatus);
  }
}

// Later, in the destructor of this class, the bundles must be deleted
delete iQueryBundle;
delete iStatusBundle;</pre>
 </div>
 </div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-E9E2783E-44A0-5BA6-BBF3-D13C8D67B53E.html">Socket Server Tutorials</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>