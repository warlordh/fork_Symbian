<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Important Changes between EKA1 and Kernel Architecture 2"/>
<meta name="abstract" content=""/>
<meta name="description" content=""/>
<meta name="DC.Relation" scheme="URI" content="GUID-BE85E2A9-510E-5E8E-954F-1278E30D55CC.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-A91C6359-E547-51AD-AA8C-45BCAFBA98AC.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-37F387FD-65EE-5968-A1E1-9C19AF8EB9EA.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-BE85E2A9-510E-5E8E-954F-1278E30D55CC.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Important Changes between EKA1 and Kernel Architecture 2</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2387835 id2399872 id2400240 id2400254 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-C14B2552-43A7-4499-ABFE-1725128DA6EF.html" title="Kernel and Hardware Services performs the fundamental operating system tasks of managing access to device resources.">Kernel and Hardware Services Guide</a> &gt; <a href="GUID-A91C6359-E547-51AD-AA8C-45BCAFBA98AC.html" title="EKA2 is the principal Hardware and Kernel Services module. It manages the CPU and memory resources of a phone, and provides an architecture for device drivers to manage other hardware resources.">Kernel Architecture (EKA2)</a> &gt; <a href="GUID-37F387FD-65EE-5968-A1E1-9C19AF8EB9EA.html">Migration Tutorials</a> &gt; <a href="GUID-BE85E2A9-510E-5E8E-954F-1278E30D55CC.html">Migration Tutorial: EKA1 to Kernel Architecture 2</a> &gt; </div>
<h1 class="topictitle1">Important
Changes between EKA1 and Kernel Architecture 2</h1>
<div><p/>

<p>This document is a summary of the important changes made between EKA2 and
the Kernel Architecture 2. </p>

<ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-39A4F67F-15DD-5443-AF04-B51E659AD158"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-39A4F67F-15DD-5443-AF04-B51E659AD158"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-1F882F2F-3BF4-5891-824D-01144652A771">Real time kernel</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-703989BD-22DD-5B48-BD44-03A6BCDE4B96"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-703989BD-22DD-5B48-BD44-03A6BCDE4B96"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-93FC5632-139C-529C-81BF-723D2931E422">Multi-threaded kernel</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B8B0160F-9762-5CB2-BB0E-F363E89F6DB5"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B8B0160F-9762-5CB2-BB0E-F363E89F6DB5"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-58061C31-3D55-5C92-86A6-9A07748DE12D">Memory model</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E5C26246-2536-5092-B241-49BC0D7639F4"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E5C26246-2536-5092-B241-49BC0D7639F4"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-AEB5D074-7993-5ECE-8168-FFD7C7119842">Bootstrap</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-77CB12E7-B1AA-5B94-AACE-E616289BAC09"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-77CB12E7-B1AA-5B94-AACE-E616289BAC09"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-858E4DFA-3988-566B-9B9C-614D7D64843D">Chunks per process</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-45E655B9-11E5-5790-AA7D-BEA5A57ADC44"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-45E655B9-11E5-5790-AA7D-BEA5A57ADC44"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-4F31E633-3418-5FEF-B034-E4E42D12ECAE">Releasing blocked threads</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-8DC829A6-ECF3-5DA6-A212-C47242B7CF2E"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-8DC829A6-ECF3-5DA6-A212-C47242B7CF2E"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-86BE8113-3442-585D-8AA1-622C6A0E5C33">Stricter checking on the use of invalid handles</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-21898C1A-9AF1-5A6A-B151-2446D8B26210"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-21898C1A-9AF1-5A6A-B151-2446D8B26210"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-70A788E3-EDB4-52B5-85F1-083F0C041161">Kernel is no longer dependent on EUSER.DLL</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-1915EE78-FBCC-5B1A-BA16-84FF781331D1"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-1915EE78-FBCC-5B1A-BA16-84FF781331D1"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-14A08FAE-ADA1-55A8-9398-309E7FE517E3">Kernel-side code no longer leaves</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-7372DD68-A1E0-552B-B83E-6469586F4369"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-7372DD68-A1E0-552B-B83E-6469586F4369"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-BCDC2615-0F4A-55A2-8806-0963C2939349">No kernel-Side support for unicode</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-9D2D33C4-B3E1-5169-B10C-229318C69D9F"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-9D2D33C4-B3E1-5169-B10C-229318C69D9F"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-AA9A48C6-5033-5459-AC1A-809FAEFB9001">Kernel-side code uses DBase instead of CBase</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-080AD2D2-2394-5653-89E8-3ADA0FB9AA38"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-080AD2D2-2394-5653-89E8-3ADA0FB9AA38"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-745A19A0-FA97-5250-B493-C0613EAE162E">Asynchronous deletion</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-125A5C43-0D8C-5CEB-99F0-2FBF80C466FD"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-125A5C43-0D8C-5CEB-99F0-2FBF80C466FD"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-EBD2C3D9-D422-5EDC-B2DF-BEBE713DFF49">Accessing user side memory directly not permitted</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-42EA847A-CC94-5630-BC52-FF2A33DD0D39"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-42EA847A-CC94-5630-BC52-FF2A33DD0D39"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E0313A56-3F85-5614-964A-30972BA0193D">Kernel side code uses DObject instead of CObject</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B16C285F-58CF-543A-91DA-42E12738D70F"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B16C285F-58CF-543A-91DA-42E12738D70F"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-FADA0E2F-A37B-58A1-93AD-5DEF04ECD0D1">Device Driver Model</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-4E25E221-01D6-5F68-A205-2D03EF837DC4"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-4E25E221-01D6-5F68-A205-2D03EF837DC4"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-66C87C5D-D71B-5D98-9B49-C7FD4D18D540">Base porting</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B02F4ACE-2139-588B-AEF4-14773B16EDF3"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B02F4ACE-2139-588B-AEF4-14773B16EDF3"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-FA2341A0-1743-5FE3-9C22-E2575816BE8D">Emulator</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-35FE60FE-0C63-5CC1-BC50-85B050265ADB"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-35FE60FE-0C63-5CC1-BC50-85B050265ADB"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B3073835-E9D7-5219-BC63-D7296ABB9B5C">Kernel-side messages</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-8C1A6D8D-23C7-5A80-A915-0938FC129F28"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-8C1A6D8D-23C7-5A80-A915-0938FC129F28"><!-- --></a><p> <a href="GUID-AD2BD987-E097-5E1F-A914-B91CFB706D51.html" title="Up to 16 separate pieces of information can be passed to a process on creation using Environment Slots. These include handles and binary data.">Environment
Slots</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-A125477D-24BD-5C59-96FA-52C8448A8286"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-A125477D-24BD-5C59-96FA-52C8448A8286"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-8D788A9A-3AE1-5A5E-9761-5DCC81A60603">Power management</a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-6A2B9214-A194-5819-A0FA-EC7B6E060563"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-6A2B9214-A194-5819-A0FA-EC7B6E060563"><!-- --></a><p> <a href="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF.html#GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E8321E95-FEE1-516D-8EED-30B6C2C25E18">Support for alternative heap allocators</a>  </p>
 </li>

</ul>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-1F882F2F-3BF4-5891-824D-01144652A771"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-1F882F2F-3BF4-5891-824D-01144652A771"><!-- --></a><h2 class="sectiontitle">Real time kernel</h2> <p>One
of the main design goals for EKA2 is to provide real-time guarantees for a
subset of kernel operations. Real time performance is one that guarantees
a response time; it does not mean that the response time is necessarily fast,
it means that the time taken is bounded, i.e. it is deterministic or predictable. </p>
 <p>Very
few changes to user side code are needed; the aim has been to maintain compatibility
at the EUSER level as far as possible. Device drivers, however, will need
some changes at the EUSER level, and more so on the kernel side. See the <a href="GUID-0437DB4C-FC4E-51DC-BB4C-95C0B26834F5.html">Device Driver Guide</a> for
details. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-93FC5632-139C-529C-81BF-723D2931E422"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-93FC5632-139C-529C-81BF-723D2931E422"><!-- --></a><h2 class="sectiontitle"> Multi-threaded
kernel</h2> <p>In EKA2, the kernel is multi-threaded, i.e. any number of
threads can now run on the kernel side. This means that a lower priority kernel
thread can be preempted by a higher priority thread. </p>
 <p>Each user thread
has two stacks: a user stack as in EKA1, and an additional kernel stack allowing
it to be preempted virtually anywhere while executing kernel-side code. This
adds approximately 4k to each thread's memory requirements. </p>
 <p>This change
has the effect of simplifying device driver design. It also means that most
kernel-side data structures need to be protected against concurrent accesses
to prevent race conditions. Several synchronisation primitives are available
to achieve this. </p>
 <p>A deadlock prevention strategy must be followed by
kernel-side code. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-58061C31-3D55-5C92-86A6-9A07748DE12D"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-58061C31-3D55-5C92-86A6-9A07748DE12D"><!-- --></a><h2 class="sectiontitle">Memory model</h2> <p>The
EKA2 core kernel is MMU-agnostic. All MMU code is isolated into a “memory
model”, which is linked at build time against the kernel. EKA2 provides three
different memory models: </p>
 <ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-59368906-3EC3-52CF-A1B9-239ABAEB7F21"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-59368906-3EC3-52CF-A1B9-239ABAEB7F21"><!-- --></a><p>Moving memory model:
This is functionally equivalent to EKA1, and is intended for ARMv4 and ARMv5
CPUs. A single page directory is used and page directory entries are moved
between the home and run sections at address space switch time. </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-D4FCDAB7-0D20-5122-86CC-CAAA5F551DF7"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-D4FCDAB7-0D20-5122-86CC-CAAA5F551DF7"><!-- --></a><p>Multiple memory model:
This is a new model for CPUs based on ARMv6 architecture. There is one page
directory per process </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-BE4852CB-3C4C-59A0-807D-D8E6150635EB"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-BE4852CB-3C4C-59A0-807D-D8E6150635EB"><!-- --></a><p>Single memory model:
This model can be used for CPUs that have no MMU, or to simplify of porting
the core kernel to a new MMU-aware CPU. In the latter case, the MMU is enabled
but there is a single address space in the system. This allows incremental
porting to a new CPU, by first porting the kernel and then the MMU. </p>
 </li>

</ul>
 <p>The memory map (e.g. the base address of the ROM image) has changed.
Therefore any code relying on the EKA1 memory map will need changing. The
impact should be minimal, as code outside the kernel should not be making
assumptions about memory layout. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-AEB5D074-7993-5ECE-8168-FFD7C7119842"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-AEB5D074-7993-5ECE-8168-FFD7C7119842"><!-- --></a><h2 class="sectiontitle">Bootstrap</h2> <p>The
C/C++ generic bootstrap used in EKA1 has been replaced with an assembler bootstrap,
which is split into a generic layer usable on any ARM device and a device-specific
layer. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-858E4DFA-3988-566B-9B9C-614D7D64843D"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-858E4DFA-3988-566B-9B9C-614D7D64843D"><!-- --></a><h2 class="sectiontitle">Chunks per
process</h2> <p>The number of chunks per process is limited to 16 in the
moving memory model. This ensures that switching between address spaces operates
in bounded time. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-4F31E633-3418-5FEF-B034-E4E42D12ECAE"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-4F31E633-3418-5FEF-B034-E4E42D12ECAE"><!-- --></a><h2 class="sectiontitle">Releasing blocked
threads</h2> <p>Threads that are blocked on semaphores and mutexes are
now released in priority order, not in FIFO order. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-86BE8113-3442-585D-8AA1-622C6A0E5C33"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-86BE8113-3442-585D-8AA1-622C6A0E5C33"><!-- --></a><h2 class="sectiontitle">Stricter checking
on the use of invalid handles</h2> </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-70A788E3-EDB4-52B5-85F1-083F0C041161"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-70A788E3-EDB4-52B5-85F1-083F0C041161"><!-- --></a><h2 class="sectiontitle">Kernel is no
longer dependent on EUSER.DLL</h2> <p>The kernel no longer has any dependency
on EUSER.DLL. Only user side code can link against EUSER.DLL. </p>
 <p>There
are three main reasons for this: </p>
 <ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-72571CC2-FFC1-56FF-8B64-C3AEF94F2581"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-72571CC2-FFC1-56FF-8B64-C3AEF94F2581"><!-- --></a><p>It allows more robust
on-target application debugging, as it is no longer possible to crash the
kernel by putting an application breakpoint in shared code. </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-91726D13-397C-58E8-9405-185D05C13F0E"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-91726D13-397C-58E8-9405-185D05C13F0E"><!-- --></a><p>It reduces the size
of the minimum system configuration. </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-61B6DEAD-42F4-5BBC-9A83-8C038149E114"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-61B6DEAD-42F4-5BBC-9A83-8C038149E114"><!-- --></a><p>It allows the kernel
to be built using a different compiler to that used to build the user side. </p>
 </li>

</ul>
 <p>This has important consequences for kernel side code. Any code that
runs on the kernel side, including device drivers, cannot use classes, functionality,
or behaviour that is implemented by EUSER.DLL. Although not a complete replacement
for this lost functionality, the Nanokernel and the Symbian platform kernel
do provide a set of utility functions such as <a href="GUID-E2C25A1E-46B4-3697-A939-613CA366D87A.html"><span class="apiname">memcpy()</span></a>, <a href="GUID-5A95E126-A82F-3F29-9810-FA1CD35E8B19.html"><span class="apiname">memset()</span></a>,
and <a href="GUID-AC5005AE-EDC0-36EE-B877-2F91B09B0068.html"><span class="apiname">memmove()</span></a>. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-14A08FAE-ADA1-55A8-9398-309E7FE517E3"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-14A08FAE-ADA1-55A8-9398-309E7FE517E3"><!-- --></a><h2 class="sectiontitle">Kernel-side
code no longer leaves</h2> <p>Kernel-side code can no longer use the leave/cleanup
stack mechanism. If appropriate, functions must now provide a return code,
and callers need to check return values. </p>
 <p>Note that this mechanism
is still available on the user side. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-BCDC2615-0F4A-55A2-8806-0963C2939349"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-BCDC2615-0F4A-55A2-8806-0963C2939349"><!-- --></a><h2 class="sectiontitle">No kernel-Side
support for unicode</h2> <p>The EKA2 kernel only provides support for ASCII
strings. </p>
 <p>All kernel objects such as processes, threads, etc. have
ASCII names. The kernel does use a few unicode strings but it treats them
as opaque types. As kernel object names are limited to ASCII, user-side code
must use only the ASCII subset of unicode when creating such objects. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-AA9A48C6-5033-5459-AC1A-809FAEFB9001"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-AA9A48C6-5033-5459-AC1A-809FAEFB9001"><!-- --></a><h2 class="sectiontitle">Kernel-side
code uses DBase instead of CBase</h2> <p>Classes that are instantiated
on the kernel heap must now use <a href="GUID-4FCB6127-84F3-38F6-8AD2-FC3B94D67DA3.html"><span class="apiname">DBase</span></a> instead of <samp class="codeph">CBase</samp>. <samp class="codeph">CBase</samp> can
only be used by user-side code. </p>
 <p> <samp class="codeph">DBase</samp> is defined
in <span class="filepath">...\e32\include\kernel\klib.h</span> and exported to <span class="filepath">\epoc32\include\kernel\klib.h</span>  </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-745A19A0-FA97-5250-B493-C0613EAE162E"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-745A19A0-FA97-5250-B493-C0613EAE162E"><!-- --></a><h2 class="sectiontitle">Asynchronous
deletion</h2> <p>The <a href="GUID-4FCB6127-84F3-38F6-8AD2-FC3B94D67DA3.html"><span class="apiname">DBase</span></a> class provides the behaviour
that allows objects to be deleted asynchronously. This is particularly useful
when memory deallocation needs to be done by time critical code. </p>
 <p>Deletion
is done by placing the object onto a queue and then triggering a DFC, which
runs in the context of the supervisor thread. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-EBD2C3D9-D422-5EDC-B2DF-BEBE713DFF49"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-EBD2C3D9-D422-5EDC-B2DF-BEBE713DFF49"><!-- --></a><h2 class="sectiontitle">Accessing user
side memory directly not permitted</h2> <p>Kernel side code must not access
user side memory directly. Use the functions specifically provided for the
purpose: </p>
 <p> <a href="GUID-B56A34CD-E5B5-3E3E-A2EE-3BC9D248B210.html"><span class="apiname">kumemget()</span></a>, <a href="GUID-15B62FF1-5D59-3A84-9648-EB0DBFE17232.html"><span class="apiname">kumemget32()</span></a>, <a href="GUID-C7AB0391-99D5-31A2-91D4-A7F195546FC3.html"><span class="apiname">kumemput()</span></a>, <a href="GUID-D141C3C4-F2F6-37DF-BDF6-63DDE9052FA0.html"><span class="apiname">kumemput32()</span></a>, <a href="GUID-B51F91FF-E5CD-3D5F-8BB3-B18E58761B62.html"><span class="apiname">kumemset()</span></a>, <a href="GUID-F5136CAF-B66F-388D-A610-D0153CAF7E23.html"><span class="apiname">umemget()</span></a>, <a href="GUID-B55573FC-B21C-384A-8B1E-A6A4301310E9.html"><span class="apiname">umemget32()</span></a>, <a href="GUID-371860F0-36BF-340D-BEF6-1763EF9874AE.html"><span class="apiname">umemput()</span></a>, <a href="GUID-B2DF3520-01CE-3D2C-8137-746ADBCBAE80.html"><span class="apiname">umemput32()</span></a>, <a href="GUID-16048974-7407-3778-9BD3-B8417E3F795A.html"><span class="apiname">umemset()</span></a>, <a href="GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D.html#GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D__GUID-C505206F-F54F-3760-BA7D-2DB52AB4E0B3"><span class="apiname">Kern::ThreadDesRead()</span></a>, <a href="GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D.html#GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D__GUID-FA321582-6D75-37A1-8DAB-D50638F76593"><span class="apiname">Kern::ThreadDesWrite()</span></a>, <a href="GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D.html#GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D__GUID-904A42A8-8077-3FC6-BEF2-29619F079842"><span class="apiname">Kern::ThreadRawRead()</span></a>, <a href="GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D.html#GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D__GUID-182C88F4-326C-376E-9FBE-889E3CB9B68A"><span class="apiname">Kern::ThreadRawWrite()</span></a>, <a href="GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D.html#GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D__GUID-D7CE1BF2-F1B8-30E9-9D34-7BDDA39C1B0C"><span class="apiname">Kern::KUDesGet()</span></a>,
and <a href="GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D.html#GUID-C6946ECB-775F-3EC2-A56F-78F25B9FBE3D__GUID-8B62DE20-357F-3499-9F2E-FAD4B18C34D6"><span class="apiname">Kern::KUDesPut()</span></a>  </p>
 <p>See also <a href="GUID-F46B87B7-97A9-530B-BAC4-EF1DB9C91E39.html#GUID-F46B87B7-97A9-530B-BAC4-EF1DB9C91E39__GUID-4A7BCB91-C58B-597F-85B6-74463BE9BC04">accessing User Memory</a> in <a href="GUID-F46B87B7-97A9-530B-BAC4-EF1DB9C91E39.html">Porting
a device driver from EKA1 to EKA2</a>  </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E0313A56-3F85-5614-964A-30972BA0193D"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E0313A56-3F85-5614-964A-30972BA0193D"><!-- --></a><h2 class="sectiontitle">Kernel side
code uses DObject instead of CObject</h2> <p>Kernel side objects that are
reference counting, must now derive from <a href="GUID-E48F1435-14B6-37F1-BE47-2EA803AFE497.html"><span class="apiname">DObject</span></a> instead
of <samp class="codeph">CObject</samp>. </p>
 <p> <samp class="codeph">CObjectCon</samp> also has
a kernel-side equivalent <a href="GUID-7FB9067F-D200-382C-84F7-49F0548D0A7F.html"><span class="apiname">DObjectCon</span></a>. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-FADA0E2F-A37B-58A1-93AD-5DEF04ECD0D1"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-FADA0E2F-A37B-58A1-93AD-5DEF04ECD0D1"><!-- --></a><h2 class="sectiontitle">Device Driver
Model</h2> <p>The device driver model has changed. See the <a href="GUID-0437DB4C-FC4E-51DC-BB4C-95C0B26834F5.html">Device
Driver Guide</a> for the detail. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-66C87C5D-D71B-5D98-9B49-C7FD4D18D540"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-66C87C5D-D71B-5D98-9B49-C7FD4D18D540"><!-- --></a><h2 class="sectiontitle">Base porting</h2> <p>EKA1,
allows only a single hardware interfacing architecture. The lowest layer of
the kernel contains the ASSP-specific code and a separate variant DLL contains
variant-specific code called by the kernel. </p>
 <p>In contrast, the EKA2
core kernel, <span class="filepath">ekern.exe</span>, is agnostic as regards the hardware
interfacing architecture. It does not contain any peripheral-related code,
and and only requires a variant DLL. The amount of functionality to be provided
by this DLL is much smaller than in EKA1. </p>
 <p>In general, EKA2 base ports
use one of the following two architectures: </p>
 <ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-57765CBB-ED06-50FD-8A9D-A972BD1FD517"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-57765CBB-ED06-50FD-8A9D-A972BD1FD517"><!-- --></a><p>ASSP+Variant: where
the Variant is split into an ASSP layer (a DLL) and a Variant layer (a DLL).
The first DLL contains all the ASSP-specific / device-agnostic code, and the
second DLL contains the device-specific code. This allows code sharing between
different devices using the same ASSP/ASIC. The interface between the ASSP
and variant DLLs is private. </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-F52159AE-5A0A-5452-A742-F212DF68D948"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-F52159AE-5A0A-5452-A742-F212DF68D948"><!-- --></a><p>Variant alone: Both
the ASSP and the device specific code is included in a single Variant DLL.
This saves the effort of partitioning the code if only one device is planned. </p>
 </li>

</ul>
 <p>In addition, peripheral-related features that are part of the kernel
in EKA1 (e.g. DMA framework) are now implemented as kernel extensions. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-FA2341A0-1743-5FE3-9C22-E2575816BE8D"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-FA2341A0-1743-5FE3-9C22-E2575816BE8D"><!-- --></a><h2 class="sectiontitle">Emulator</h2> <p>A
number of changes in the emulator architecture have a system-wide impact. </p>
 <p><strong>Process emulation</strong> </p>
 <p>The emulator supports multiple Symbian platform
processes. This removes the need for WINS-specific code in various places,
notably in server start-up. </p>
 <p>The emulator still runs as a single WIN32
process, so a Symbian platform process can still accidentally write into the
address space of another Symbian platform process. </p>
 <p><strong>Thread scheduling</strong> </p>
 <p>The emulator uses the same scheduling algorithm
as Symbian platform running on hardware. This is in contrast with EKA1 that
leaves Symbian platform thread scheduling to the Windows kernel leading to
discrepancies in behaviour between the emulator and hardware. </p>
 <p><strong>Calling WIN32 APIs from Symbian platform code</strong> </p>
 <p>Because the
emulator now uses the same scheduling algorithm as native Symbian platform,
the Symbian platform kernel may have to suspend a thread while it is executing
some arbitrary code inside Windows. If the thread holds one or more (Windows)
locks when it is suspended and another thread tries to acquire the same lock(s),
a deadlock occurs. To prevent this, Symbian platform code that calls into
the WIN32 API must use new Symbian platform APIs, <samp class="codeph">Emulator::Lock()/Unlock()</samp> or <samp class="codeph">Emulator::Escape()/Reenter()</samp>.
The impact should be minimal because most of the code interacting with Windows
is in the Base subsystem. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B3073835-E9D7-5219-BC63-D7296ABB9B5C"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B3073835-E9D7-5219-BC63-D7296ABB9B5C"><!-- --></a><h2 class="sectiontitle">Kernel-side
messages</h2> <p>Because the kernel is multi-threaded in EKA2, <a href="GUID-178E140F-BB15-5A82-99A6-D1BC0E11E018.html" title="Kernel-side messages are a means of communication between Symbian platform threads executing kernel-side code.">Kernel-side
messages</a> offer a means of communication between Symbian platform threads
executing kernel-side code. Typically, they are used by device drivers to
communicate between a client thread, usually a user thread, and a kernel thread
running the actual device driver code. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E897C3F8-F275-59F0-BBFC-7981865226F2"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E897C3F8-F275-59F0-BBFC-7981865226F2"><!-- --></a><h2 class="sectiontitle">Passing handles
&amp; data at process creation</h2> <p>In EKA2, handles and binary data
(in the form of descriptors, or integer values) can be passed to a process
at process creation time. Up to 16 separate pieces of information can be passed
to a process on creation. </p>
 <p>See <a href="GUID-AD2BD987-E097-5E1F-A914-B91CFB706D51.html" title="Up to 16 separate pieces of information can be passed to a process on creation using Environment Slots. These include handles and binary data.">Passing
handles &amp; data at process creation</a> for more information. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-8D788A9A-3AE1-5A5E-9761-5DCC81A60603"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-8D788A9A-3AE1-5A5E-9761-5DCC81A60603"><!-- --></a><h2 class="sectiontitle">Power management</h2> <p>The
EKA1 power management framework has been replaced in EKA2 with a new framework
that aims at fixing known issues with the EKA1 one. The main design goal for
this new framework is increased flexibility, i.e.: </p>
 <ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-03A92EBE-669D-50C1-905B-AA7B9A3FC68A"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-03A92EBE-669D-50C1-905B-AA7B9A3FC68A"><!-- --></a><p>providing support for
a wide variety of power management hardware </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-FF1E50F6-6DE3-5919-A703-BDA5440E26A1"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-FF1E50F6-6DE3-5919-A703-BDA5440E26A1"><!-- --></a><p>separating mechanism
and policy to allow different power management strategies. </p>
 </li>

</ul>
 <p>As an example of increased flexibility, the set of supported power
states is extensible by licensees. </p>
 <p>The changes mean that, on the user
side, there is no binary or source compatibility. The impacted components
are app-framework/UIKON and the GUI LAF (e.g. techview/toolkit). </p>
 <p>On
the kernel-side, there is no binary compatibility. Old-style power handlers
can still be built but if one or more of them are active, the system cannot
switch to standby mode. </p>
 <p>In EKA2, the power model DLL no longer exists.
EKA2 replaces the EKA1 user-side framework with a new one based on the concept
of domain. A domain is a set of processes that share the same power management
characteristics. </p>
 <p><strong>User-side
changes</strong> </p>
 <p>A new user-side domain server manages all domains in the
system and centralises interactions with the kernel. The main requests supported
by this server are: </p>
 <ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-63B5CEED-7B05-5F19-A99F-BD51DD144E23"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-63B5CEED-7B05-5F19-A99F-BD51DD144E23"><!-- --></a><p>Transition all processes
in a given domain to a new power state. </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-66E37108-73A4-5844-BA3C-5E2FC3C9E1EC"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-66E37108-73A4-5844-BA3C-5E2FC3C9E1EC"><!-- --></a><p>Transition all domains
to a new power state. </p>
 </li>

</ul>
 <p>The set of all domains forms a tree. A request to transition a domain
D to a new power state is cascaded down to its children first. D is then transitioned
after all its children have themselves transitioned to the new state. </p>
 <p>The
domain server is policy-agnostic. It links against a customisable DLL that
provides the policy part. This DLL notably specifies the structure of the
domain tree. Usage of the domain framework is optional. Licensees are free
to replace it with another user-side scheme or to implement all their power
management policy kernel-side. </p>
 <p><strong>Kernel-side
changes</strong> </p>
 <p>The new kernel-side framework breaks down into the following
items: </p>
 <ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-2E0FC695-8527-59C7-8F56-09C6E9A349FB"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-2E0FC695-8527-59C7-8F56-09C6E9A349FB"><!-- --></a><p>A power manager, embedded
in the core kernel, which implements the power management executive calls
and manages the other kernel-side entities </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-5A04F61E-499A-5CE5-B6EF-19FA26517D53"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-5A04F61E-499A-5CE5-B6EF-19FA26517D53"><!-- --></a><p>A set of power handlers
implemented within device drivers. When a power transition is requested, the
power manager dispatches it to every registered power handler. </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-5576AC0E-4CB6-544A-A547-674EBFC74513"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-5576AC0E-4CB6-544A-A547-674EBFC74513"><!-- --></a><p>A power controller implemented
in a kernel extension. It manages the different sleep modes supported by the
CPU. </p>
 </li>

</ul>
 <p>The power handlers and power controller are device-specific. A specific
implementation could specify a private interface between these components
to extend the generic framework. For example power handlers could notify the
power controller of state changes so the latter can select the most appropriate
sleep mode. </p>
 </div>

<div class="section" id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E8321E95-FEE1-516D-8EED-30B6C2C25E18"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-E8321E95-FEE1-516D-8EED-30B6C2C25E18"><!-- --></a><h2 class="sectiontitle"> Support for
alternative heap allocators</h2> <p>User mode threads and processes can
now instantiate their own concrete heap allocator classes for use as the default
allocator rather than be required to use the Symbian platform supplied <a href="GUID-EFAFDD75-7E59-306A-882D-317F5564979E.html"><span class="apiname">RHeap</span></a> class. </p>
 <p>This
has been done by defining the new abstract class <a href="GUID-9DB4A58C-6FC8-3292-A547-4C161BD188FC.html"><span class="apiname">RAllocator</span></a>. <a href="GUID-EFAFDD75-7E59-306A-882D-317F5564979E.html"><span class="apiname">RHeap</span></a>,
now derives from this new class. </p>
 <p>The new class allows threads and
processes to replace the standard first-fit heap allocator class to improve
allocation performance or solve memory fragmentation problems. </p>
 <p>The
change has been made to minimise binary compatibilty and source compatibility
impact on existing software. The following standard allocation functions are
completely compatible: </p>
 <ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-74113B2B-BA3B-57D8-B0E5-7CDB81E9B7A0"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-74113B2B-BA3B-57D8-B0E5-7CDB81E9B7A0"><!-- --></a><p> <a href="GUID-B89E4D10-0DFD-3270-B45B-565B01421466.html"><span class="apiname">operator new()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-400E98C4-04DC-5608-879B-579D487139DF"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-400E98C4-04DC-5608-879B-579D487139DF"><!-- --></a><p> <a href="GUID-05782A1A-60BF-3D6F-AA78-8C1B25E1A3C8.html"><span class="apiname"> operator
delete()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-317BADC6-0FBB-56A8-9B88-705231ED74AC"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-317BADC6-0FBB-56A8-9B88-705231ED74AC"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-67554CF1-F7D1-37E3-8088-1625B3FCEBB4"><span class="apiname"> User::Alloc()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-C1A56138-2D40-558D-9A00-221F911974EF"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-C1A56138-2D40-558D-9A00-221F911974EF"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-C035F07D-B6D9-3A21-A323-DAC89137280D"><span class="apiname"> User::AllocL()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-0D584313-138F-5463-86B8-E5B558A5FE17"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-0D584313-138F-5463-86B8-E5B558A5FE17"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-8944FF54-F874-3340-872B-CF6AD001F694"><span class="apiname">User::AllocLC()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-84E0415D-66F4-5A61-818F-244790DAD52A"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-84E0415D-66F4-5A61-818F-244790DAD52A"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-A1B58B92-E9B2-3C0F-89B3-BA3230A1E14F"><span class="apiname">User::Free()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-356C7BD2-81BC-59EB-A626-E7DD4E1698DC"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-356C7BD2-81BC-59EB-A626-E7DD4E1698DC"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-076A396B-D9F1-3CB9-8D93-AF2E1D0C9415"><span class="apiname">User::ReAlloc()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-8C59C1D4-F248-5459-9AB8-B19E5F4316D5"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-8C59C1D4-F248-5459-9AB8-B19E5F4316D5"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-7804ECCB-D061-3572-A4C4-A629098F0790"><span class="apiname"> User::ReAllocL()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-A9ABCC69-F7AD-589E-AA3A-B797757C7123"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-A9ABCC69-F7AD-589E-AA3A-B797757C7123"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-AE5D927B-2CFB-3CE0-9EB7-437C4482241F"><span class="apiname">User::AllocLen()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-A1D29CE1-8D07-5587-8FBF-F9B8903561D5"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-A1D29CE1-8D07-5587-8FBF-F9B8903561D5"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-E970D052-A8D6-3430-9E23-EB935DD32335"><span class="apiname"> User::AllocSize()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-D5CDA68B-0172-5A80-99AB-69FFD8985975"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-D5CDA68B-0172-5A80-99AB-69FFD8985975"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-62895F0B-089D-36F8-81C9-718B3D26585A"><span class="apiname">User::Available()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-21AB331F-A559-5D6A-8C5A-C0B65CEAF76F"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-21AB331F-A559-5D6A-8C5A-C0B65CEAF76F"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-6755A02F-524F-3718-AD87-AE4A3BE20D3A"><span class="apiname"> User::CountAllocCells()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-16A3DA52-1513-525A-84B2-B63C85E73DFB"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-16A3DA52-1513-525A-84B2-B63C85E73DFB"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-B2710076-A191-3F8B-B562-E92AE776549C"><span class="apiname"> User::FreeZ()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-7E64E012-BF78-5618-9B07-112A566E892E"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-7E64E012-BF78-5618-9B07-112A566E892E"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-82CD000F-BE5C-37EF-9B85-FC0A57570702"><span class="apiname">User::Check()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-7CD596C5-657A-58D4-91DF-9DE72D5B9CE5"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-7CD596C5-657A-58D4-91DF-9DE72D5B9CE5"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-04A2474D-0A77-37A7-8567-BB7BC33C3CBE"><span class="apiname"> User::CompressAllHeaps()</span></a>  </p>
 </li>

</ul>
 <p>The following functions are compatible assuming that the thread has
not replaced the heap allocator with a different object: </p>
 <ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-7D68B874-0D5B-5432-8F9B-78CAA32B4036"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-7D68B874-0D5B-5432-8F9B-78CAA32B4036"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-E6BB60B3-B367-34EF-B843-3D32568275FF"><span class="apiname">User::Adjust()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-D3324C8B-3FF1-58AA-86AB-C65CAFB7FA76"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-D3324C8B-3FF1-58AA-86AB-C65CAFB7FA76"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-4DDE6BB9-F0D8-3A0F-8F70-03728E80E26C"><span class="apiname">User::AdjustL()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-91DF8623-3DF2-5977-B097-FFC6953B7ACA"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-91DF8623-3DF2-5977-B097-FFC6953B7ACA"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-42AC433D-1C9C-3AC6-8640-EB1A7BA876B5"><span class="apiname">User::Heap()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-D1895B52-9A53-598C-8B64-F97B1956992F"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-D1895B52-9A53-598C-8B64-F97B1956992F"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-D157A678-62BB-3BF8-8166-C9E03F258E2A"><span class="apiname"> User::SwitchHeap()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-F1473064-A52E-511A-91AB-2FC51E01B705"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-F1473064-A52E-511A-91AB-2FC51E01B705"><!-- --></a><p> <a href="GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5.html#GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5__GUID-6FA3E28C-49D8-39CD-BFC7-FEAEADE40BA5"><span class="apiname"> RThread::Heap()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B45BE2A4-944D-51F3-94FA-BC005C8195DD"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B45BE2A4-944D-51F3-94FA-BC005C8195DD"><!-- --></a><p> <a href="GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5.html#GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5__GUID-4A1F473A-A804-3984-AEED-B47ACA79AE49"><span class="apiname"> RThread::SetHeap()</span></a>  </p>
 </li>

</ul>
 <p>The following functions have been added to support software that
wishes to replace the heap allocator: </p>
 <ul>
<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B0E30820-C1F2-5A70-8A04-33EA56ED3602"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-B0E30820-C1F2-5A70-8A04-33EA56ED3602"><!-- --></a><p> <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-25730109-73AF-3F5A-83F5-EE5FB18A5692"><span class="apiname"> User::Allocator()</span></a>  </p>
 </li>

<li id="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-3B23EB7D-D4D5-509A-827A-6853EC7578AE"><a name="GUID-43BC99CA-9D60-557C-A43C-99EF1D6E4ECF__GUID-3B23EB7D-D4D5-509A-827A-6853EC7578AE"><!-- --></a><p> <a href="GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5.html#GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5__GUID-518DF5B4-3454-32B8-BC3F-F0D47274EF97"><span class="apiname"> RThread::Allocator()</span></a>  </p>
 </li>

</ul>
 <p> <samp class="codeph">RThread::GetRamSizes()</samp> is now deprecated – the
heap size is always reported as zero, and the stack size should now be extracted
using the new <a href="GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5.html#GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5__GUID-699F8282-62EF-3F13-85DC-5C0F7910A43D"><span class="apiname">RThread::StackInfo()</span></a> API. </p>
 <p>Software
that is dependent on the layout of the <a href="GUID-EFAFDD75-7E59-306A-882D-317F5564979E.html"><span class="apiname">RHeap</span></a> internal data
or virtual function table may no longer work after this change. Such software
is likely to be rare or limited to test code. There is no legitimate dependency
on this information except where 3rd party software has derived a class from
RHeap, but this is considered to be very unlikely for anything other than
test purposes. </p>
 <p>The default allocator object stored for each heap is
no longer a <a href="GUID-EFAFDD75-7E59-306A-882D-317F5564979E.html"><span class="apiname">RHeap</span></a>, but a <a href="GUID-9DB4A58C-6FC8-3292-A547-4C161BD188FC.html"><span class="apiname">RAllocator</span></a>.
This means that it is possible that <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-42AC433D-1C9C-3AC6-8640-EB1A7BA876B5"><span class="apiname">User::Heap()</span></a> does not
actually return a reference to a <a href="GUID-EFAFDD75-7E59-306A-882D-317F5564979E.html"><span class="apiname">RHeap</span></a> object, possibly
resulting in broken software. However, as the default class used for allocation
is still <a href="GUID-EFAFDD75-7E59-306A-882D-317F5564979E.html"><span class="apiname">RHeap</span></a>, then there is no additional impact unless
a thread or process explicitly instantiates an alternative allocator class.
In the latter case, we would expect that the code using the allocator to also
be updated to use the alternative class. </p>
 <p>The allocator is created
by the owning thread when it first runs, which means that software that depends
on the heap existing before the thread is resumed will no longer work. In
particular calling <a href="GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5.html#GUID-B0E661BC-4058-3256-B9C3-5A4FD52F6DE5__GUID-6FA3E28C-49D8-39CD-BFC7-FEAEADE40BA5"><span class="apiname">RThread::Heap()</span></a> before the thread runs
and creates the heap will return NULL. This was a real pattern found in several
places in Symbian platform code to work around the lack of processes in the
EKA1 emulator, where a ‘command line’ is inserted into the created thread
by allocating a cell on the new thread’s heap. This is not an issue for EKA2
as it supports processes in the emulator and such code should just be removed
when adapting it for the EKA2 emulator. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-BE85E2A9-510E-5E8E-954F-1278E30D55CC.html">Migration Tutorial: EKA1 to Kernel Architecture 2</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>