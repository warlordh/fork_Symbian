<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Using the LBS Administration API"/>
<meta name="abstract" content="This document explains how to get and set LBS Administration settings at runtime."/>
<meta name="description" content="This document explains how to get and set LBS Administration settings at runtime."/>
<meta name="DC.Relation" scheme="URI" content="GUID-23BBC1D8-B3A0-5148-A4F1-22ECF3043E4E.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7F476137-5E7F-5288-9F4A-6C20F0A1AD9B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-55F5F029-6A00-5894-8892-90836DE4BA40.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-45980E0C-4DA4-5AC1-8721-490442DA7F3C.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-23BBC1D8-B3A0-5148-A4F1-22ECF3043E4E.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-852E58C1-EA5C-5B46-9020-4463D3FA06AD.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-9348D79B-D4BF-50B0-B787-DDA2765CE058.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Using the LBS Administration API</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2402590 id2402946 id2402960 id2403063 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-7F476137-5E7F-5288-9F4A-6C20F0A1AD9B.html">Location Based Services (LBS) Guide</a> &gt; <a href="GUID-55F5F029-6A00-5894-8892-90836DE4BA40.html" title="The Location Management collection contains components to manage location requests and to interface with a network. It also contains several common core LBS libraries that are used by many components of the LBS subsystem.">Location Management</a> &gt; <a href="GUID-45980E0C-4DA4-5AC1-8721-490442DA7F3C.html" title="Location Admin is an LBS component that contains several common LBS libraries grouped for convenience in a single system component.">Location Admin</a> &gt; <a href="GUID-23BBC1D8-B3A0-5148-A4F1-22ECF3043E4E.html" title="The documents in this section explain how to configure LBS by using the LBS Administration API or by using a repository initialisation file.">LBS Administration</a> &gt; </div>
<h1 class="topictitle1">Using
the LBS Administration API</h1>
<div><p>This document explains how to get and set LBS Administration settings
at runtime. </p>

<div class="section"><h2 class="sectiontitle">Purpose</h2> <p>This document describes how to use the
LBS administration service via the LBS Administration API. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Required background</h2> <p><a href="GUID-9348D79B-D4BF-50B0-B787-DDA2765CE058.html" title="This document describes the LBS administration service and the API that it supports.">LBS
Administration Service Overview</a> describes the LBS administration service
and the LBS Administration API. </p>
 </div>

<div class="section"><h2 class="sectiontitle">Introduction</h2> <p>Client applications use the LBS Administration
API in two ways: </p>
 <ul>
<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-216C30CC-9B78-5DDD-84F0-7DF5970DAE74"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-216C30CC-9B78-5DDD-84F0-7DF5970DAE74"><!-- --></a><p><a href="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6.html#GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-8C0486E7-CED1-5902-ADC8-742C3A166C6B">Accessing LBS administration settings</a> </p>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-CFAC089A-F282-5AA3-9C8F-AA6551AE3AE8"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-CFAC089A-F282-5AA3-9C8F-AA6551AE3AE8"><!-- --></a><p><a href="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6.html#GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-E9801842-4844-51BA-97D3-5073926E3EDA">Receiving notifications of LBS administration settings changes</a>  </p>
 </li>

</ul>
 <p>The LBS Administration API is packaged in <span class="filepath">lbsadmin.dll</span>.
Client applications include <span class="filepath">lbsadmin.h</span> and link against <span class="filepath">lbsadmin.lib</span>.
To set administration settings, an application must have the capability <em>WriteDeviceData</em>.
No capabilities are required to read administration settings. </p>
 </div>

<div class="section" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-8C0486E7-CED1-5902-ADC8-742C3A166C6B"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-8C0486E7-CED1-5902-ADC8-742C3A166C6B"><!-- --></a><h2 class="sectiontitle">Accessing LBS
administration settings</h2> <p>This section describes how client applications
use the LBS Administration API to get and set LBS administration settings.
Examples are given for the different types of administration settings categories. </p>
 <p><strong>Location request settings </strong> </p>
 <p>These setting are used to turn
location requests on and off. Settings exist for Mobile Originated Location
Requests (MO-LR), Mobile Terminated Location Requests (MT-LR) and Transfer
Location to 3rd Party Requests (X3P). The code example below shows how to: </p>
 <a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-4035F478-DF5C-51E2-BE62-DF61BE39F235"><!-- --></a><ol id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-4035F478-DF5C-51E2-BE62-DF61BE39F235">
<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-F14D1F81-10B9-5BAA-8E7E-56FD57034A71"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-F14D1F81-10B9-5BAA-8E7E-56FD57034A71"><!-- --></a><p>Turn on MO-LR (self
locate) in the home network and when roaming. </p>
 <p> <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-F3E58804-AAEE-32A6-A3C8-9868C9C8283C"><span class="apiname">CLbsAdmin::TSelfLocateService</span></a> defines
the constants used to configure MO-LR. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-B0DD1766-92DA-5E9D-90A3-2B25892B9C29"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-B0DD1766-92DA-5E9D-90A3-2B25892B9C29"><!-- --></a>#include &lt;lbsadmin.h&gt;

...

CLbsAdmin* admin = CLbsAdmin::NewL();
CleanupStack::PushL(admin);

TInt err = KErrNone;

// Turn on MO-LR in home network &amp; when roaming.
err = admin-&gt;Set(KLbsSettingHomeSelfLocate, CLbsAdmin::ESelfLocateOn);
err = admin-&gt;Set(KLbsSettingRoamingSelfLocate, CLbsAdmin::ESelfLocateOn);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

...
</pre>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-33536D62-BE7E-5A90-BC8A-61E8369F8A8E"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-33536D62-BE7E-5A90-BC8A-61E8369F8A8E"><!-- --></a><p>Turn on MT-LR (external
locate) in the home network and off when roaming. <em>Note that Emergency MT-LR
is unaffected and is always on.</em> </p>
 <p> <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-74AF5A08-F6D9-36F7-A904-710C18248569"><span class="apiname">CLbsAdmin::TExternalLocateService</span></a> defines
the constants used to configure MT-LR. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-72B95EC8-68A4-5C17-B0D3-02C9F6F1785A"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-72B95EC8-68A4-5C17-B0D3-02C9F6F1785A"><!-- --></a>
...

// Turn on external locate in home network. Turn off when roaming.
err = admin-&gt;Set(KLbsSettingHomeExternalLocate, CLbsAdmin::EExternalLocateOn);
err = admin-&gt;Set(KLbsSettingRoamingExternalLocate, CLbsAdmin::EExternalLocateOff);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

...
</pre>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-59F1B3AE-BB7F-5928-AEF8-BC15E3603E2C"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-59F1B3AE-BB7F-5928-AEF8-BC15E3603E2C"><!-- --></a><p>Turn on X3P (transfer
to third party) in the home network and off when roaming. </p>
 <p> <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-9FF8B24A-5254-34A3-8626-9BFCF5440158"><span class="apiname">CLbsAdmin::TTransmitLocateService</span></a> defines
the constants used to configure X3P. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-DE2B5662-2B10-5C21-AA78-242EB6B15EDD"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-DE2B5662-2B10-5C21-AA78-242EB6B15EDD"><!-- --></a>
...

// Turn on transfer to 3rd party locate. Turn off when roaming.
err = admin-&gt;Set(KLbsSettingHomeTransmitLocate, CLbsAdmin::ETransmitLocateOn);
err = admin-&gt;Set(KLbsSettingRoamingTransmitLocate, CLbsAdmin::ETransmitLocateOff);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

...
</pre>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-74EB2EBF-1C1A-5824-B63B-5CE15962ABDC"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-74EB2EBF-1C1A-5824-B63B-5CE15962ABDC"><!-- --></a><p>Get the location request
settings </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-20528E10-900C-5EB2-8329-C784024F1D18"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-20528E10-900C-5EB2-8329-C784024F1D18"><!-- --></a>
...

// Get some settings...
CLbsAdmin::TSelfLocateService selfLocate;
CLbsAdmin::TExternalLocateService externalLocate;
CLbsAdmin::TTransmitLocateService transmitLocate;

err = admin-&gt;Get(KLbsSettingHomeSelfLocate, selfLocate);
err = admin-&gt;Get(KLbsSettingHomeExternalLocate, externalLocate);
err = admin-&gt;Get(KLbsSettingHomeTransmitLocate, transmitLocate);


if (err != KErrNone) 
 {
 // Handle error
  ...

 }

CleanupStack::PopAndDestroy();
</pre>
 </li>

</ol>
 <p><strong>Quality profile settings </strong> </p>
 <p>Quality profiles define the quality
of position required by a LBS location request. They are used when a client
makes a LBS location request without specifying any position quality criteria. </p>
 <p>Quality
profiles are defined in the file <span class="filepath">lbsprofile.ini</span>. The
file is located at <span class="filepath">&lt;rom_drive&gt;:\private\10282253\lbs\lbsprofile.ini</span> or <span class="filepath">&lt;system_drive&gt;:\private\10282253\lbs\lbsprofile.ini</span> (the file location is dependent on the licensee OS build and configuration
process). </p>
 <p>An example quality profile file is shown below in which
two quality profiles defined. Each quality profile has a unique ID defined
by the value <samp class="codeph">ProfileID</samp>. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-2BA6B674-48F4-5AE5-A925-7FEDD2C52365"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-2BA6B674-48F4-5AE5-A925-7FEDD2C52365"><!-- --></a>
# lbsprofile.ini
# Quality Profiles for LBS services
#

[1]
ProfileID= 0
MaxTime= 130
HorizontalAccuracy= 50
VerticalAccuracy= 1000
    
[2]
ProfileID= 1
MaxTime= 120
HorizontalAccuracy= 20
VerticalAccuracy= 1000
</pre>
 <p>The default quality profiles for use by MO-LR, MT-LR and X3P
are defined in the LBS administration repository initialisation file. </p>
 <p>The
code example below shows how to use the LBS Administration API to change the
quality profile for MO-LR. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-69A28FAF-0157-5685-A8B5-D37230930897"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-69A28FAF-0157-5685-A8B5-D37230930897"><!-- --></a>
#include &lt;lbsadmin.h&gt;

...

CLbsAdmin* admin = CLbsAdmin::NewL();
CleanupStack::PushL(admin);

TLbsQualityProfileId selfProfileId;
TLbsQualityProfileId newProfileId = 1;

TInt err = KErrNone;

// Set quality profile for MO-LR
err = admin-&gt;Get(KLbsSettingQualityProfileSelfLocate, selfProfileId);
if (err != KErrNone)
 {
 // Handle error
 ...
 }

if (selfProfileId != 1)
 {
 err = admin-&gt;Set(KLbsSettingQualityProfileSelfLocate, newProfileId);
 if (err != KErrNone)
  {
  // Handle error
  ...
  }
 }

CleanupStack::PopAndDestroy();
</pre>
 <p><strong>GPS operation mode settings </strong> </p>
 <p>These settings configure the
mode of operation of GPS in the home network and when roaming. </p>
 <p> <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-9F902F01-29A3-3929-B045-83C72DB96E39"><span class="apiname">CLbsAdmin::TGpsMode</span></a> defines
the constants used to configure GPS. </p>
 <p>The code example below shows
how to use the LBS Administration API to configure GPS to calculate position
using assistance data from the network. LBS tries to get assistance data from
the network to calculate the location, but if this data is not available then
LBS attempts to get a GPS fix without it. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-C86B287A-BE20-5EAC-87A1-DD43C3B22235"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-C86B287A-BE20-5EAC-87A1-DD43C3B22235"><!-- --></a>
#include &lt;lbsadmin.h&gt;

...

CLbsAdmin* admin = CLbsAdmin::NewL();
CleanupStack::PushL(admin);

TInt err = KErrNone;

// 1. Use assisted mode GPS in home network and when roaming
err = admin-&gt;Set(KLbsSettingHomeGpsMode, CLbsAdmin::EGpsPreferTerminalBased);
err = admin-&gt;Set(KLbsSettingRoamingGpsMode, CLbsAdmin::EGpsPreferTerminalBased);

// 2. Get home GPS mode setting
CLbsAdmin::TGpsMode gpsMode;
err = admin-&gt;Get(KLbsSettingHomeGpsMode, gpsMode);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

CleanupStack::PopAndDestroy();
</pre>
 <p><strong>Network protocol module setting </strong> </p>
 <p>This setting gets and sets
the UID of the network protocol module that is used in both the home network
and when roaming. </p>
 <p>Note that the value of the UID must be that of the
ECom protocol module implementation as defined by <samp class="codeph">implementation_uid</samp> in
the ECom resource file. </p>
 <p>The code example below shows how to use the
LBS Administration API to set the network protocol module. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-E27A8EB5-73BF-5C06-AFB1-124BA213ED8E"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-E27A8EB5-73BF-5C06-AFB1-124BA213ED8E"><!-- --></a>
#include &lt;lbsadmin.h&gt;

...

CLbsAdmin* admin = CLbsAdmin::NewL();
CleanupStack::PushL(admin);

TInt err = KErrNone;
TUid modUid;

// Get the UID of licensee network protocol module ECom plug-in
...

// Set the network protocol module
err= admin-&gt;Set(KLbsSettingHomeProtocolModule, modUid);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

CleanupStack::PopAndDestroy();
</pre>
 <p> <em>Note that changing the KLbsSettingHomeProtocolModule setting
requires a restart of the LBS subsystem. This may require a reboot of the
mobile device for the change to take effect, but not if the LBS subsystem
is configured to start in transient mode, as is the case in Standalone Privacy
Mode.</em>  </p>
 <p><strong>Privacy notifier settings </strong> </p>
 <p>These settings are used to: </p>
 <ul>
<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-DE62EDC7-9838-5E1C-A7E1-5EFABA73CFC0"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-DE62EDC7-9838-5E1C-A7E1-5EFABA73CFC0"><!-- --></a><p>Configure LBS to use
a privacy controller or privacy notifiers </p>
 <p> <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-E10A0475-7286-3AC1-9131-DEC07BA5B75B"><span class="apiname">CLbsAdmin::TPrivacyHandler</span></a> defines
the constants that configure LBS to use a privacy controller or privacy notifiers. </p>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-0EC51415-C82A-5745-8D92-02308F2157C0"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-0EC51415-C82A-5745-8D92-02308F2157C0"><!-- --></a><p>Set the action to take
on timeout of a MT-LR privacy request </p>
 <p> <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-F063FE21-9996-3F0E-9BE2-95067EF5B5E6"><span class="apiname">CLbsAdmin::TPrivacyTimeoutAction</span></a> defines
the constants that configure the action to take on timeout. <em/>  </p>
 <p> <em>Note
that setting this to reject MT-LR does not reject Emergency MT-LR.</em>  </p>
 </li>

</ul>
 <p>The code example below shows how to use the LBS Administration API
to configure LBS to use privacy notifiers and to reject privacy requests on
timeout. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-10647598-E6E6-5AC6-B8B9-A9821A6A102B"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-10647598-E6E6-5AC6-B8B9-A9821A6A102B"><!-- --></a>
#include &lt;lbsadmin.h&gt;

...

CLbsAdmin* admin = CLbsAdmin::NewL();
CleanupStack::PushL(admin);

TInt err = KErrNone;

// Set LBS to use privacy notifiers
err = admin-&gt;Set(KLbsSettingPrivacyHandler, CLbsAdmin::EPrivacyHandleByNotifier);

// Set LBS to reject privacy requests on timeout
err = admin-&gt;Set(KLbsSettingPrivacyTimeoutAction, CLbsAdmin::EPrivacyTimeoutReject);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

CleanupStack::PopAndDestroy();
</pre>
 <p> <em>Note that changing the KLbsSettingPrivacyHandler setting
requires a restart of the LBS subsystem. This may require a reboot of the
mobile device for the change to take effect, but not if the LBS subsystem
is configured to start in transient mode, as is the case in Standalone Privacy
Mode.</em>  </p>
 <p><strong>GPS set clock module settings </strong> </p>
 <p>These settings are used to: </p>
 <a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-C7318704-53F4-5924-90BA-3C21E4124D97"><!-- --></a><ol id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-C7318704-53F4-5924-90BA-3C21E4124D97">
<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-3BE29F03-BBB8-5BB5-A0FC-A91A7B1B244B"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-3BE29F03-BBB8-5BB5-A0FC-A91A7B1B244B"><!-- --></a><p>Configure LBS to allow
the system clock to be synchronised with GPS </p>
 <p> <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-43E5D177-778D-304C-BE11-18FBABE66E28"><span class="apiname">CLbsAdmin::TClockAdjust</span></a> defines
the constants that configure system clock synchronisation. </p>
 <p>LBS can
be configured to allow fully automatic system clock synchronisation. This
means the system clock is synchronised with GPS at regular intervals. </p>
 <p>The
code example below shows how to turn on automatic clock adjustment. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-4363CC8B-5B5C-5B67-AAF1-6A9C7BEF8924"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-4363CC8B-5B5C-5B67-AAF1-6A9C7BEF8924"><!-- --></a>#include &lt;lbsadmin.h&gt;

...

TInt err = KErrNone;

CLbsAdmin* admin = CLbsAdmin::NewL();
CleanupStack::PushL(admin);

// Configure LBS to allow automatic clock synchronisation 
err = admin-&gt;Set(KLbsSettingClockAdjust, CLbsAdmin::EClockAdjustOn);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

...
</pre>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-08EAB46C-E380-5894-A5DC-EFB772C38FDA"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-08EAB46C-E380-5894-A5DC-EFB772C38FDA"><!-- --></a><p>Specify the UID of the
GPS set clock plug-in </p>
 <p>A GPS set clock plug-in is an ECom plug-in that
allows LBS to set the system time on the mobile device. </p>
 <p>LBS contains
a default implementation of a set clock plug-in that sets the system time
by calling <a href="GUID-C197C9A7-EA05-3F24-9854-542E984C612D.html#GUID-C197C9A7-EA05-3F24-9854-542E984C612D__GUID-145F52E6-2A29-3FF1-8AD1-7009BE0074D7"><span class="apiname">User::SetUTCTime()</span></a>. It is only necessary to
change the <samp class="codeph">KLbsSettingSetClockModule</samp> setting if a licensee
wishes to use some other means to set the system time. Setting <samp class="codeph">KLbsSettingSetClockModule</samp> to
0 specifies that LBS will use the default plug-in. </p>
 <p>If <samp class="codeph">KLbsSettingSetClockModule</samp> is
set to some value other than 0, it must be set to the UID of a licensee set
clock plug-in. The UID must be that of the ECom implementation as defined
by <samp class="codeph">implementation_uid</samp> in the ECom resource file. </p>
 <p>The
code example below shows setting the clock module to a licensee set clock
plug-in UID. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-E8C94942-D695-5C21-A481-BFAD90EA5C27"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-E8C94942-D695-5C21-A481-BFAD90EA5C27"><!-- --></a>
...

TUid KLicenseeClockModule;

// Get the licensee clock module ID 
// (only if licensee uses a module other than the default)

...

// Set UID of GPS Clock module
err = admin-&gt;Set(KLbsSettingSetClockModule, KLicenseeClockModule);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

...
</pre>
 <p> <em>Note that changing the KLbsSettingSetClockModule setting
requires a reboot of the mobile device for the change to take effect.</em>  </p>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-86074A94-591E-5492-9C1C-85556DE9E8A9"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-86074A94-591E-5492-9C1C-85556DE9E8A9"><!-- --></a><p>Set the clock adjustment
interval </p>
 <p>This is the time in milliseconds between system clock updates.
This setting is only used if LBS is configured to allow automatic system clock
adjustment (see 1 above). </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-2D92311E-85BF-5C4A-8431-134A3FB4DA9C"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-2D92311E-85BF-5C4A-8431-134A3FB4DA9C"><!-- --></a>
...

TUint KClockInterval(604800000); // 7 days in milliseconds

// Set the clock adjustment interval
err = admin-&gt;Set(KLbsSettingClockAdjustInterval, KClockInterval);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

...
</pre>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-9175992C-AAD5-500F-A49D-C09F5B18F0CB"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-9175992C-AAD5-500F-A49D-C09F5B18F0CB"><!-- --></a><p>Set the clock adjustment
threshold </p>
 <p>This is a time in milliseconds. The system clock is adjusted
if the time difference between it and the GPS clock is greater than this threshold
time. This setting is only used if LBS is configured to allow automatic system
clock adjustment (see 1 above). </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-9B34634C-D30F-5568-ABAC-60A721FDECBA"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-9B34634C-D30F-5568-ABAC-60A721FDECBA"><!-- --></a>
...

TUint KClockThreshold(1000); // 1 second 
err = admin-&gt;Set(KLbsSettingClockAdjustThreshold, KClockInterval);

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

...
</pre>
 </li>

</ol>
 </div>

<div class="section" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-56DA510B-4BBE-57B6-B616-888845435276"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-56DA510B-4BBE-57B6-B616-888845435276"><!-- --></a><h2 class="sectiontitle">Resetting the
administration settings</h2> <p>An application can reset administration
settings to the defaults specified in the administration settings initialisation
file by calling <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-42D1B1DF-A5BD-3143-BBC3-EDFC1151356D"><span class="apiname">CLbsAdmin::ResetToDefault()</span></a>. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-1666A431-4F00-5907-A713-93AD12E0ED9D"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-1666A431-4F00-5907-A713-93AD12E0ED9D"><!-- --></a>#include &lt;lbsadmin.h&gt;

...

TInt err = KErrNone;

CLbsAdmin* admin = CLbsAdmin::NewL();
CleanupStack::PushL(admin);

err = admin-&gt;ResetToDefault();

if (err != KErrNone) 
 {
 // Handle error
  ...

 }

CleanupStack::PopAndDestroy();
</pre>
 </div>

<div class="section" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-E9801842-4844-51BA-97D3-5073926E3EDA"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-E9801842-4844-51BA-97D3-5073926E3EDA"><!-- --></a><h2 class="sectiontitle">Receiving notifications
of LBS administration settings           changes</h2> <p>Applications can
register to receive notifications of changes to LBS administration settings.
To create a class to receive notifications of LBS administration settings
changes, a developer: </p>
 <a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-54DA2B43-59FB-5D1A-8378-E5997544C86E"><!-- --></a><ol id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-54DA2B43-59FB-5D1A-8378-E5997544C86E">
<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-78B58802-F98E-5ADB-8346-5C4365AD0C6A"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-78B58802-F98E-5ADB-8346-5C4365AD0C6A"><!-- --></a><p>Defines an observer
class derived from <a href="GUID-800E7AE0-0115-3483-A010-933C05759532.html"><span class="apiname">MLbsAdminObserver</span></a>  </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-3224D2FA-B7D0-5B6A-8D86-A370460D6B06"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-3224D2FA-B7D0-5B6A-8D86-A370460D6B06"><!-- --></a>
#include &lt;lbsadmin.h&gt;


class CLbsAdminObserver : public MLbsAdminObserver
 {
 
 public:
 
 static CLbsAdminObserver* NewL();

 // From MLbsAdminObserver
 void OnSettingUpdateEvent(TInt aError, const TLbsAdminSetting&amp; aSetting);

 protected:
  CLbsAdminObserver();
  ~CLbsAdminObserver();
 void ConstructL();

 private:
  CLbsAdmin* iLbsAdmin;
  TLbsAdminSettingGroup iGroup; 
 
 };    
 </pre>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-E85A37EC-5134-569A-89CD-43948A90B80D"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-E85A37EC-5134-569A-89CD-43948A90B80D"><!-- --></a><p>Defines the types of
administration settings changes of interest to the observer by creating a <a href="GUID-CB92B5FC-CD68-34F8-A866-BED0686C08B5.html"><span class="apiname">TLbsAdminSettingGroup</span></a> bitmask. </p>
 <p>The
code example below shows the observer class constructor in which a <samp class="codeph">TLbsAdminSettingGroup</samp> bitmask
is defined. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-BDF1E269-AC43-5875-9BD6-E2C2CB75564E"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-BDF1E269-AC43-5875-9BD6-E2C2CB75564E"><!-- --></a>
CLbsAdminObserver::CLbsAdminObserver()
 {
  iGroup = KLbsSettingHomeSelfLocate | KLbsSettingRoamingSelfLocate | KLbsSettingHomeExternalLocate |
           KLbsSettingRoamingExternalLocate |  KLbsSettingHomeTransmitLocate |
           KLbsSettingRoamingTransmitLocate;
        
 }
</pre>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-B2DE2F36-64E1-5BD3-B6AE-4080CBEA0345"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-B2DE2F36-64E1-5BD3-B6AE-4080CBEA0345"><!-- --></a><p>Writes an implementation
of the <a href="GUID-800E7AE0-0115-3483-A010-933C05759532.html#GUID-800E7AE0-0115-3483-A010-933C05759532__GUID-8CAC965D-6CC3-325C-AFB2-4471F27D9CC1"><span class="apiname">MLbsAdminObserver::OnSettingUpdateEvent()</span></a> method.
This method is called when there is a change in one of the administration
settings defined in the bitmask (see point 2 above). </p>
 <p>The code example
below shows a partial method implementation in which the value of the <samp class="codeph">aSetting</samp> parameter
value is checked. Once the value of <samp class="codeph">aSetting</samp> is known, the
value of the setting is obtained by calling <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-299B1851-2DE9-3BDF-8DA0-E11E50101466"><span class="apiname">CLbsAdmin::Get()</span></a> with
the appropriate parameters. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-BBDD9AEE-C1D1-500D-A969-101851BAB6C7"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-BBDD9AEE-C1D1-500D-A969-101851BAB6C7"><!-- --></a>
void CLbsAdminObserver::OnSettingUpdateEvent(TInt aError, const TLbsAdminSetting&amp; aSetting)
 {

  if (aSetting == KLbsSettingHomeSelfLocate)
   {
   // Setting for MO-LR in home network has changed
   // Get the new setting

   TInt err;
   CLbsAdmin::TSelfLocateService selfLocate;
   err = iLbsAdmin-&gt;Get(KLbsSettingHomeSelfLocate, selfLocate);

   if (err != KErrNone) 
    {
    // Handle error
    ...

    }

   }

   // And similar for other TLbsAdminSetting types in the TLbsAdminSetting bitmask
   ...

 }
</pre>
 </li>

<li id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-3E1C9550-DEFA-5383-9DA9-0E22799AA275"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-3E1C9550-DEFA-5383-9DA9-0E22799AA275"><!-- --></a><p>Registers an observer
object to receive notification of status change events by calling <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-297BD9C9-36E3-38C5-BB79-35A785B49744"><span class="apiname">CLbsAdmin::NewL()</span></a> with
the observer object and a <a href="GUID-CB92B5FC-CD68-34F8-A866-BED0686C08B5.html"><span class="apiname">TLbsAdminSettingGroup</span></a> bitmask
as parameters. The code example below shows this in the NewL() method of the
observer class. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-9F8D7AE4-77A0-5D39-A831-CEF1E5E790B9"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-9F8D7AE4-77A0-5D39-A831-CEF1E5E790B9"><!-- --></a>
CLbsAdminObserver* CLbsAdminObserver::NewL()
 {
 CLbsAdminObserver* self = new(ELeave)CLbsAdminObserver();
 CleanupStack::PushL(self);
 self-&gt;ConstructL();
 CleanupStack::Pop();
 return self;
 }

void CLbsAdminObserver::ConstructL()
 {
 iLbsAdmin = CLbsAdmin::NewL(*this, const_cast&lt;TLbsAdminSettingGroup&amp;&gt;(iGroup));
 }
</pre>
 </li>

</ol>
 <p>An application can stop receiving notification of administration
settings changes by calling <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-2CAC0F41-B58B-30D6-8742-23B38338ED1A"><span class="apiname">CLbsAdmin::ClearNotificationMask()</span></a>. </p>
 <p>An
application can change the administration settings changes for which it receives
notification by calling <a href="GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945.html#GUID-E8B4B321-6B45-3764-ADD2-CD05A5533945__GUID-C04ED964-9259-3B96-8144-0A022C3D26BA"><span class="apiname">CLbsAdmin::SetNotificationMaskL()</span></a>. </p>
 <p>The
code example below shows the use of these methods to receive notification
of GPS mode settings changes. </p>
 <pre class="codeblock" id="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-5EB78AAE-375B-5102-9D07-BDFDD587F1D8"><a name="GUID-65448364-0EE6-5903-B2C0-28F49DD2BEA6__GUID-5EB78AAE-375B-5102-9D07-BDFDD587F1D8"><!-- --></a>
iLbsAdmin-&gt;ClearNotificationMask();

// Change the notification mask to get changes to GPS mode
iGroup = KLbsSettingHomeGpsMode |  KLbsSettingRoamingGpsMode;

iLbsAdmin-&gt;SetNotificationMaskL(iGroup);
</pre>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-23BBC1D8-B3A0-5148-A4F1-22ECF3043E4E.html" title="The documents in this section explain how to configure LBS by using the LBS Administration API or by using a repository initialisation file.">LBS Administration</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-852E58C1-EA5C-5B46-9020-4463D3FA06AD.html" title="This topic describes the LBS administration repository initialisation file.">The LBS Administration
Repository Initialisation File</a></div>
<div><a href="GUID-9348D79B-D4BF-50B0-B787-DDA2765CE058.html" title="This document describes the LBS administration service and the API that it supports.">LBS  Administration
Service Overview</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>