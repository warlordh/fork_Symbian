<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Creating a Graphics Resource Adaptation"/>
<meta name="abstract" content="This topic provides information about creating a graphics resource adaptation."/>
<meta name="description" content="This topic provides information about creating a graphics resource adaptation."/>
<meta name="DC.Relation" scheme="URI" content="GUID-26E51AB0-C0FC-55EA-B747-C834E2D4FD27.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-26E51AB0-C0FC-55EA-B747-C834E2D4FD27.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-26E51AB0-C0FC-55EA-B747-C834E2D4FD27.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Creating a Graphics Resource Adaptation</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2384330 id2387131 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-975CBC70-81E6-5FA2-80CE-88DD2ABE9595.html">Graphics Guide</a> &gt; <a href="GUID-26E51AB0-C0FC-55EA-B747-C834E2D4FD27.html" title="The Graphics Resource Services collection provides an abstraction layer for the memory management of graphics data (which can be pixel data or non-pixel data, such as lists of OpenVG commands).">Graphics Resource Services Collection</a> &gt; </div>
<h1 class="topictitle1">Creating
a Graphics Resource Adaptation</h1>
<div><p>This topic provides information about creating a graphics resource
adaptation. </p>

<p><strong>Target audience</strong>: Device creators.</p>

<div class="note"><span class="notetitle">Note:</span> The Graphics Resource and Graphics Resource Adaptation components
are deprecated in Symbian^3 and will be removed in Symbian^4 (S^4). However,
new Graphics Resource Interface and Implementation components are planned
for S^4. The new interface component will provide a similar but reduced API
that is optimized for sharing images across processes.  </div>

<div class="section" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-1169B355-204B-4E32-A4E3-B083FE3A8456"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-1169B355-204B-4E32-A4E3-B083FE3A8456"><!-- --></a><h2 class="sectiontitle">Required background</h2> <p>This
topic assumes an understanding of the material contained in the following: </p>
 <ul>
<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-36766311-AE66-5835-88BA-A196A02E6118"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-36766311-AE66-5835-88BA-A196A02E6118"><!-- --></a><p><a href="GUID-59C9EF92-8207-5FA5-AA20-0DB00C211BF1.html" title="This topic provides an introduction to the Graphics Resource Services collection.">Graphics
Resource Services Collection Overview</a>  </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-DBB1E138-C862-555B-8CC3-089DA0933950"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-DBB1E138-C862-555B-8CC3-089DA0933950"><!-- --></a><p><a href="GUID-82B0B4B9-6BC2-5BEF-B3B0-D57AC57F8D8A.html" title="The Graphics Resource component is not available on all systems. When present, together with the Graphics Resource Adaptation component, it provides an abstraction layer for the memory management of graphics data, both pixel data and non-pixel data (such as OpenVG command lists). The Graphics Resource component is the generic part, which provides the client API, whereas the Graphics Resource Adaptation component provides the adaptation part, which device creators can adapt to suit their graphics acceleration hardware if any is available.">Graphics
Resource Component Overview</a>  </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-73947232-DE71-590F-A553-44E601936CD7"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-73947232-DE71-590F-A553-44E601936CD7"><!-- --></a><p><a href="GUID-29C7FBFB-2F33-58CA-86BE-978E3187E4D6.html">Image
Compatibility Guarantees</a>  </p>
 </li>

</ul>
 </div>

<div class="section" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-254498CD-E4C3-4D4B-B3A2-F6AFB78B7F14"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-254498CD-E4C3-4D4B-B3A2-F6AFB78B7F14"><!-- --></a><h2 class="sectiontitle">Packaging the
DLL</h2> <p>When packaging the adaptation, the following rules apply: </p>
 <ul>
<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-07F0C6AB-39FB-56EA-B760-70756EB63687"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-07F0C6AB-39FB-56EA-B760-70756EB63687"><!-- --></a><p>The graphics resource
adaptation must be packaged as a DLL with the name <strong>graphicsresourceadapter.dll</strong>. </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-5DB1D47F-269C-5756-B61E-6435CD3D0066"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-5DB1D47F-269C-5756-B61E-6435CD3D0066"><!-- --></a><p>The second and third
UIDs must be <samp class="codeph">0x1000008D</samp> and <samp class="codeph">0x10285A71</samp>,
respectively. </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-7EE8AE66-E8C2-5A06-B07D-23032EBE3C51"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-7EE8AE66-E8C2-5A06-B07D-23032EBE3C51"><!-- --></a><p>All capabilities except
TCB (Trusted Computing Base) are required. </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-164F71FE-3BC8-5433-AC9B-2A3876073980"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-164F71FE-3BC8-5433-AC9B-2A3876073980"><!-- --></a><p>The <samp class="codeph">NOEXPORTLIBRARY</samp> keyword
must be used in the MMP file to prevent the generation of LIB/DSO files during
the build process. </p>
 </li>

</ul>
 <p>Here is a snippet of an example MMP file: </p>
 <pre class="codeblock" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-98AD4AEC-60CC-56ED-9099-B83E8261CE75"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-98AD4AEC-60CC-56ED-9099-B83E8261CE75"><!-- --></a>TARGET graphicsresourceadapter.dll
TARGETTYPE DLL
CAPABILITY All -Tcb
UID 0x1000008D 0x10285A71
VENDORID &lt;Your vendor ID in hex&gt;
NOEXPORTLIBRARY</pre>
 <p>The reference adaptation component has one
implementation for the emulator and several implementations for different
hardware configurations. These latter ones have different names and the one
that is to be used in the device is renamed to <span class="filepath">graphicsresourceadapter.dll</span> during
the ROM building process. You may want to use a similar approach. See <a href="GUID-946E64D6-3E5D-5264-AD5D-29D3AD296543.html" title="The Graphics package contains a number of adaptation and customization components. These are called adaptations in this topic. Symbian provides implementations of these components. However, device creators can create their own implementationsâ€”for example, to take advantage of the specific hardware that is available in a particular device. This topic describes how to select adaptations for inclusion in a ROM.">Selection of Adaptations</a> for
more information. </p>
 <p>Because the Graphics Resource Adaptation component
is optional, the <a href="GUID-82B0B4B9-6BC2-5BEF-B3B0-D57AC57F8D8A.html" title="The Graphics Resource component is not available on all systems. When present, together with the Graphics Resource Adaptation component, it provides an abstraction layer for the memory management of graphics data, both pixel data and non-pixel data (such as OpenVG command lists). The Graphics Resource component is the generic part, which provides the client API, whereas the Graphics Resource Adaptation component provides the adaptation part, which device creators can adapt to suit their graphics acceleration hardware if any is available.">Graphics
Resource component</a> provides a <strong>stub implementation</strong> for platform
security reasons. When a functional adaptation is not present, the stub implementation
is compiled into a DLL called <span class="filepath">graphicsresourceadapter.dll</span> and
is installed in the ROM in order to prevent a SIS file installing a rogue
DLL with this name. </p>
 </div>

<div class="section" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-DA7CA4DC-0830-4962-A648-7CE7520069FC"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-DA7CA4DC-0830-4962-A648-7CE7520069FC"><!-- --></a><h2 class="sectiontitle">The exported
function</h2> <p>The graphics resource adaptation DLL is a polymorphic
interface DLL that must export a single function at ordinal position one.
The function that must be exported is <a href="GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127.html#GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127__GUID-695826EA-AD3A-31B5-BC6F-0D29066AE3B3"><span class="apiname">MSgDriverAdapter::New()</span></a>.
Here is its definition from the stub implementation: </p>
 <pre class="codeblock" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-52F4C7DE-0F65-54F0-ACB1-878145BA29CA"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-52F4C7DE-0F65-54F0-ACB1-878145BA29CA"><!-- --></a>
EXPORT_C TInt MSgDriverAdapter::New(MSgDriverAdapter*&amp; /*aPtr*/)
    {
    return KErrNotSupported;
    }</pre>
 <p>This simply returns <a href="GUID-F89DA3F0-2A48-3F9B-8F08-29350E92D0E4.html"><span class="apiname">KErrNotSupported</span></a> to
indicate that the graphics resource functionality is not supported. This is
because, as mentioned above, the stub implementation is used for platform
security reasons when no functional Graphics Resource adaptation is present. </p>
 <p>In
a functional implementation, the function must create a multi-threaded heap,
allocate from it and initialize a new instance of the singleton class that
implements the <a href="GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127.html"><span class="apiname">MSgDriverAdapter</span></a> interface and return it
in the pointer argument. </p>
 </div>

<div class="section" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-2792BB88-8B70-4B6D-AD3D-FBACE870B3A7"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-2792BB88-8B70-4B6D-AD3D-FBACE870B3A7"><!-- --></a><h2 class="sectiontitle">Implementing
the interfaces</h2> <p>The <a href="GUID-82B0B4B9-6BC2-5BEF-B3B0-D57AC57F8D8A.html" title="The Graphics Resource component is not available on all systems. When present, together with the Graphics Resource Adaptation component, it provides an abstraction layer for the memory management of graphics data, both pixel data and non-pixel data (such as OpenVG command lists). The Graphics Resource component is the generic part, which provides the client API, whereas the Graphics Resource Adaptation component provides the adaptation part, which device creators can adapt to suit their graphics acceleration hardware if any is available.">Graphics
Resource Component</a> provides a Hardware Adaptation Interface (HAI),
which separates the generic and adaptation parts. This defines a set of interfaces
for which the adaptation must provide an implementation. As long as the implementation
conforms to the interface specifications and contracts, you are free to write
the adaptation as you see fit. </p>
 <p>The following is a class diagram of
the interfaces. </p>
 <div class="fignone" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-D23E912B-C752-5F20-A595-3F779B4E7C5D"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-D23E912B-C752-5F20-A595-3F779B4E7C5D"><!-- --></a><span class="figcap">Figure 1.               Figure 1: The graphics resource adapter interfaces  
         </span>

<img src="GUID-BFA254D4-5104-5B15-8035-2491B57D136D_d0e276579_href.png"/>
</div>
 <p> <strong>Driver adapter</strong>. You must provide a concrete driver adapter
class that implements the <a href="GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127.html"><span class="apiname">MSgDriverAdapter</span></a> interface. This
is a singleton class. A single instance of it is created for each process
that uses the Graphics Resource API. The singleton is responsible for creating
image adapter and image collection adapter objects. </p>
 <p> <strong>Image adapter</strong>.
You must provide at least one concrete image adapter class that implements
the <a href="GUID-B339AA1C-5E2B-314D-A220-07893AA1B10A.html"><span class="apiname">MSgImageAdapter</span></a> interface. You can provide as many
concrete image adapter classes as needed. The driver adapter singleton creates
an instance of the appropriate image adapter class for each image that is
created or opened by the process. </p>
 <p>There are three different ways in
which an image adapter object can be created: </p>
 <ul>
<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-C02BEF84-57D6-52FB-B631-02AFCF6AE387"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-C02BEF84-57D6-52FB-B631-02AFCF6AE387"><!-- --></a><p>A call to <a href="GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127.html#GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127__GUID-EE8F0719-E923-3B79-8D8D-068625B8BE09"><span class="apiname">MSgDriverAdapter::CreateImage()</span></a>,
which creates an image and its image adapter object. </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-64159685-6CC5-5ED7-9B69-2ACF97576492"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-64159685-6CC5-5ED7-9B69-2ACF97576492"><!-- --></a><p>A call to <a href="GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127.html#GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127__GUID-21D8361F-5F19-3F5F-8BAB-A8EA2171ADAD"><span class="apiname">MSgDriverAdapter::OpenDrawable()</span></a>,
which opens an existing image for which the ID is known. This also creates
an image adapter object for the image if one does not already exist within
the process. This function enables images to be shared between processes.
Note that the driver adapter singleton does not create image adapter objects
in a process (A) for images that are created by another process (B) if they
are not opened in process A. </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-CAF50D78-4656-5831-BBF9-44F25A5F0A7E"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-CAF50D78-4656-5831-BBF9-44F25A5F0A7E"><!-- --></a><p>A call to <a href="GUID-95174AD4-74FB-37E2-8D71-E182467581B4.html#GUID-95174AD4-74FB-37E2-8D71-E182467581B4__GUID-C9C6153B-1D71-3790-BE3D-56C2CC6DF14F"><span class="apiname">MSgImageCollectionAdapter::OpenImage()</span></a>,
which creates an image adapter object to encapsulate a surface buffer belonging
to an existing image collection. </p>
 </li>

</ul>
 <p>The implementation of these functions must use the shared multi-threaded
heap owned by the driver adapter singleton for all allocations and perform
any initialization that is required. </p>
 <p> <strong>Image collection adapter</strong>.
You must provide a concrete image collection adapter class that implements
the <a href="GUID-95174AD4-74FB-37E2-8D71-E182467581B4.html"><span class="apiname">MSgImageCollectionAdapter</span></a> interface. The driver adapter
singleton creates an instance of this class for each image collection that
is created by the process. </p>
 <p>The purpose of the image collection class
is to provide interoperability with the <a href="GUID-0DC3E5AA-1706-5255-ACD6-E7AB732E1095.html" title="This topic provides an introduction to the Graphics Composition collection.">composition
engine</a> and <a href="GUID-8E8FE99A-5F4D-5B0F-87AB-A58EB4BEB6E9.html" title="Each graphics composition surface has at least two interested stakeholders: the process responsible for drawing and maintaining the content and the composition engine, which uses the surface for creating the display. When one of the stakeholders does something to the surface, it usually means that another stakeholder needs to do something too. The Surface Update component provides a channel for the stakeholders to inform each other of changes.">Surface
Update Server</a>. Therefore, unlike image adapters and platform-specific
resource adapters, which you are free to implement as you see fit, you must
implement the image collection adapter in terms of surfaces that are compatible
with the Surface Manager. The implementation of the <a href="GUID-95174AD4-74FB-37E2-8D71-E182467581B4.html#GUID-95174AD4-74FB-37E2-8D71-E182467581B4__GUID-3E96077B-FB6D-33D4-B10D-299350496DEF"><span class="apiname">MSgImageCollectionAdapter::SurfaceId()</span></a> function
must return the surface ID of the image collection's surface. </p>
 <p>There
are two different methods that create image collections: </p>
 <ul>
<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-4F3335D5-0D6A-57F5-88BF-0493F36E5A6B"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-4F3335D5-0D6A-57F5-88BF-0493F36E5A6B"><!-- --></a><p> <a href="GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127.html#GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127__GUID-4BA00DC9-85BD-36D5-9B3F-A1B27BA78D84"><span class="apiname">MSgDriverAdapter::CreateImageCollection()</span></a>.
This creates a single image collection and its associated image collection
adapter object. </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-73E36A71-4981-5A3F-BF17-43068705427C"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-73E36A71-4981-5A3F-BF17-43068705427C"><!-- --></a><p> <a href="GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127.html#GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127__GUID-DD16AD64-4459-3067-9165-6B1BB574DDBD"><span class="apiname">MSgDriverAdapter::CreateImageCollections()</span></a>.
This creates a number of image collections that share a single memory chunk
(in order to save memory if only one of the image collections will be in use
at a time). Although they share a memory chunk, each of these image collections
has its own surface ID and image collection adapter object. This function
also creates the associated image collection adapter objects. </p>
 </li>

</ul>
 <p>The implementation of these functions must use the shared multi-threaded
heap owned by the driver adapter singleton for all allocations and perform
any initialization that is required. </p>
 <p>For interoperability with applications
that expect images, you must provide an implementation of <a href="GUID-95174AD4-74FB-37E2-8D71-E182467581B4.html#GUID-95174AD4-74FB-37E2-8D71-E182467581B4__GUID-C9C6153B-1D71-3790-BE3D-56C2CC6DF14F"><span class="apiname">MSgImageCollectionAdapter::OpenImage()</span></a>.
This wraps up a surface buffer as an image by creating a suitable image adapter
object for it. </p>
 </div>

<div class="section" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-4AEFB09D-0E75-476E-BFEF-03A5E97B3925"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-4AEFB09D-0E75-476E-BFEF-03A5E97B3925"><!-- --></a><h2 class="sectiontitle">Resource types</h2> <p>The
Symbian reference adaptation provides only one type of resourceâ€”the image
(2D pixel buffer). However, you can define additional types of resourcesâ€”for
example, for handling vector data. A UID is used to identify the <strong>resource
type</strong>. The <a href="GUID-1129AC1A-3A70-3B2E-9E23-E6491B50EFB2.html"><span class="apiname">KSgImageTypeUid</span></a> constant represents the UID
for images. This is defined as follows: </p>
 <pre class="codeblock" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-B93AB2AB-AA24-5664-93BD-09D395C623BE"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-B93AB2AB-AA24-5664-93BD-09D395C623BE"><!-- --></a>const TUid KSgImageTypeUid = {0x10285A73};</pre>
 <p>If you create a new resource type, you must obtain a UID from Symbian
Signed to represent its runtime type. The implementation of the <a href="GUID-185B6C03-E4F3-382A-AAD5-BA5D85334CBB.html#GUID-185B6C03-E4F3-382A-AAD5-BA5D85334CBB__GUID-E557C57C-0808-3DD9-83C3-45181AAE56A7"><span class="apiname">MSgDrawableAdapter::DrawableType()</span></a> function
must return the UID of the resource type. </p>
 <p>Related to the resource
type is the <strong>handle type</strong>. This constrains the type of resource that
can be opened by calls to the <a href="GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127.html#GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127__GUID-21D8361F-5F19-3F5F-8BAB-A8EA2171ADAD"><span class="apiname">MSgDriverAdapter::OpenDrawable()</span></a> function.
The implementation of this function must check that the actual runtime type
of the resource to be opened is compatible with the handle that will contain
a reference to it. The function must return an error if the runtime resource
type is not compatible with the specified handle type. </p>
 <p>Two handle
types are defined by Symbian: </p>
 <ul>
<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-DF05975C-0C71-5BA3-84CA-CCEA4289E481"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-DF05975C-0C71-5BA3-84CA-CCEA4289E481"><!-- --></a><p>The image handle type,
which can contain a reference to an image resource only. This has the same
UID as the image resource type (mentioned above). </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-685E7C70-A10D-56E2-9F0A-D4A742ECD3F8"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-685E7C70-A10D-56E2-9F0A-D4A742ECD3F8"><!-- --></a><p>The drawable handle
type, which can contain a reference to an image or any platform-specific resource
type. This is defined as follows: </p>
 <pre class="codeblock" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-83427673-6CE0-511B-BB15-BACFD87AAE03"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-83427673-6CE0-511B-BB15-BACFD87AAE03"><!-- --></a>const TUid KSgDrawableTypeUid = {0x102858EB};</pre>
 </li>

</ul>
 </div>

<div class="section" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-D435C12A-782C-5CC7-9E19-8FBD35C9D652"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-D435C12A-782C-5CC7-9E19-8FBD35C9D652"><!-- --></a><h2 class="sectiontitle">Reference counting</h2> <p>All
of the adapter objects apart from the driver adapter singleton must be reference
counted as follows: </p>
 <ul>
<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-6004AAE4-CEF4-565C-A073-3095DCA27A3E"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-6004AAE4-CEF4-565C-A073-3095DCA27A3E"><!-- --></a><p>Each time that an adapter
object is created, its reference count must be set to one. </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-5DAC9C2E-9700-59A7-8B26-16E29D93F65F"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-5DAC9C2E-9700-59A7-8B26-16E29D93F65F"><!-- --></a><p>For resources that can
be shared between processes, the implementation of <a href="GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127.html#GUID-62D3F49B-E048-3C07-ABDC-2DB6CC268127__GUID-21D8361F-5F19-3F5F-8BAB-A8EA2171ADAD"><span class="apiname">MSgDriverAdapter::OpenDrawable()</span></a> checks
for the existence of the resource adapter object in the process in which the
resource is to be opened. If the adapter object exists in that process, the
implementation increments its reference count. If the adapter object does
not exist in that process, the implementation creates one and sets its reference
count to one. </p>
 </li>

<li id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-5E2A9601-AE6B-5ED4-AB1F-B84BDF3C56C8"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-5E2A9601-AE6B-5ED4-AB1F-B84BDF3C56C8"><!-- --></a><p>All reference-counted
adapter objects are destroyed in the same wayâ€”the implementation of the <samp class="codeph">Close()</samp> function
decrements the reference count and destroys the adapter object when the reference
count reaches zero. When the adapter object is destroyed, the reference count
on the underlying resource must also be decremented and the underlying resource
must be destroyed when its reference count reaches zero. </p>
 <p>The <samp class="codeph">Close()</samp> function
is part of the <a href="GUID-47124FC9-A94D-3687-8CAA-61DEE3C1805E.html"><span class="apiname">MSgResourceAdapter</span></a> interface, from which <a href="GUID-95174AD4-74FB-37E2-8D71-E182467581B4.html"><span class="apiname">MSgImageCollectionAdapter</span></a> and <a href="GUID-185B6C03-E4F3-382A-AAD5-BA5D85334CBB.html"><span class="apiname">MSgDrawableAdapter</span></a> (and ultimately <a href="GUID-B339AA1C-5E2B-314D-A220-07893AA1B10A.html"><span class="apiname">MSgImageAdapter</span></a>) inherit. </p>
 <p> </p>
 </li>

</ul>
 <p>The following diagram shows an image that is shared between two processesâ€”one
of which has two handles to the image and the other a single handle. When
all of the handles to the image are closed, the image itself is destroyed. </p>
 <div class="fignone" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-189A3A15-947A-5C39-9B84-630679944C30"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-189A3A15-947A-5C39-9B84-630679944C30"><!-- --></a><span class="figcap">Figure 2.               Figure 2: Reference counting resources and adapter objects
           </span>

<img src="GUID-582B36BD-88B3-5B5B-8A20-058318E80D0B_d0e276815_href.png"/>
</div>
 </div>

<div class="section" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-A254D2A4-AAF4-43CA-9C4F-DB41F5F2F13B"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-A254D2A4-AAF4-43CA-9C4F-DB41F5F2F13B"><!-- --></a><h2 class="sectiontitle">Thread safety</h2> <p>All
of the adapter objects can potentially be shared between all of the threads
in the process. This means that they must all be thread safe. Normally you
implement thread safety by using mutexes. The reference implementation handles
this by using a single mutex per process to synchronize access to all of the
adapter objects in the process. </p>
 <p>When running on multiple processors,
such as symmetric multiprocessing (SMP), using a separate mutex for each adapter
object might provide a more efficient solution. This approach can improve
performance by avoiding unnecessary serialization but it has drawbacks. For
example, each additional mutex increases the memory usage. In addition multiple
mutexes are more complex to program and require very careful program design
in order to prevent the occurrence of deadlocks and other synchronization
problems. </p>
 <p>All of the adapter objects, including the driver adapter
singleton, can potentially be created in the context of one thread and destroyed
in the context of a different thread. Therefore they must be allocated from
a multi-threaded heap shared between all the threads in the process and owned
by the driver adapter singleton. </p>
 </div>

<div class="section" id="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-D0F63C01-8CAE-436C-9058-4E570A858D58"><a name="GUID-11F00FB3-7353-5545-9A39-BEB3B489A15C__GUID-D0F63C01-8CAE-436C-9058-4E570A858D58"><!-- --></a><h2 class="sectiontitle">Extension interfaces</h2> <p>The <a href="GUID-185B6C03-E4F3-382A-AAD5-BA5D85334CBB.html#GUID-185B6C03-E4F3-382A-AAD5-BA5D85334CBB__GUID-D1BFFF76-37B5-3DD5-A4E3-51B98264CB91"><span class="apiname">MSgDrawableAdapter::GetInterface()</span></a> function provides an optional mechanism for platforms to extend the HAI
by defining extension interfaces. These can be accessed by using the <a href="GUID-6F23F34A-A0BE-349C-ADE7-61A5AEF48018.html#GUID-6F23F34A-A0BE-349C-ADE7-61A5AEF48018__GUID-0D64A708-42C3-361A-B463-E9C0F3542919"><span class="apiname">RSgDrawable::GetInterface()</span></a> method,
which delegates to <a href="GUID-185B6C03-E4F3-382A-AAD5-BA5D85334CBB.html#GUID-185B6C03-E4F3-382A-AAD5-BA5D85334CBB__GUID-D1BFFF76-37B5-3DD5-A4E3-51B98264CB91"><span class="apiname">MSgDrawableAdapter::GetInterface()</span></a>. </p>
 </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-26E51AB0-C0FC-55EA-B747-C834E2D4FD27.html" title="The Graphics Resource Services collection provides an abstraction layer for the memory management of graphics data (which can be pixel data or non-pixel data, such as lists of OpenVG commands).">Graphics Resource Services Collection</a></div>
</div>
<div class="relinfo relconcepts"><strong>Related concepts</strong><br/>
<div><a href="GUID-26E51AB0-C0FC-55EA-B747-C834E2D4FD27.html" title="The Graphics Resource Services collection provides an abstraction layer for the memory management of graphics data (which can be pixel data or non-pixel data, such as lists of OpenVG commands).">Graphics
Resource Services Collection</a></div>
</div>
</div>   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>