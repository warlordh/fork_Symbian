<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="copyright" content="(C) Copyright 2010"/>
<meta name="DC.rights.owner" content="(C) Copyright 2010"/>
<meta name="DC.Type" content="concept"/>
<meta name="DC.Title" content="Implementing the MLbsPrivacyObserver Methods"/>
<meta name="abstract" content="A Privacy Controller must implement the virtual functions of the MLbsPrivacyObserver interface (and the shutdown function of the MLbsPrivacyObserver2 interface if appropriate)."/>
<meta name="description" content="A Privacy Controller must implement the virtual functions of the MLbsPrivacyObserver interface (and the shutdown function of the MLbsPrivacyObserver2 interface if appropriate)."/>
<meta name="DC.Relation" scheme="URI" content="GUID-3078D198-0FCB-58A0-8152-9CD319906D58.html"/>
<meta name="DC.Relation" scheme="URI" content="index.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-32E29020-1956-461A-B79A-1492E06049E7.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-7F476137-5E7F-5288-9F4A-6C20F0A1AD9B.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-710BC22B-E4F0-5E16-B970-E2D21F5571FC.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CE970F0F-C922-516F-9D7E-EA1F4754A205.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-CDE5CC9D-F6DE-5A21-97C3-59A2F3398A15.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-63681C76-3E0A-5A7A-9723-93F4142A7E7E.html"/>
<meta name="DC.Relation" scheme="URI" content="GUID-3078D198-0FCB-58A0-8152-9CD319906D58.html"/>
<meta name="DC.Format" content="XHTML"/>
<meta name="DC.Identifier" content="GUID-D01CE5F5-CC66-4976-B67F-A6D2E02FFEA5"/>
<meta name="DC.Language" content="en"/>
<link rel="stylesheet" type="text/css" href="commonltr.css"/>
<title>Implementing the MLbsPrivacyObserver Methods</title>

     
<link type="text/css" rel="stylesheet" href="css/common.css" media="screen"/>
<link type="text/css" rel="stylesheet" href="css/sdl.css" media="screen"/>

<!--[if IE]>
<link href="css/iefix.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->



     <link rel="stylesheet" type="text/css" href="nokiacxxref.css"/></head>
<body id="GUID-D01CE5F5-CC66-4976-B67F-A6D2E02FFEA5"><a name="GUID-D01CE5F5-CC66-4976-B67F-A6D2E02FFEA5"><!-- --></a>


<?php include_once (CURRENT_SKIN_PATH.'/sdl_header.html'); ?>
<div id="sdl_container">
   <div id="leftMenu">  
 <div id="expandcontractdiv">
    <a id="collapseTree" href="javascript:tree.collapseAll()">Collapse all</a>
    <a id="index" href="index.html">Symbian^3 Product Developer Library</a>        
</div>
     <iframe style="border:none" height="800" width="300" src="index-toc.html"></iframe>
<div id="treeDiv1">&#160;</div>
     <script type="text/javascript">
	var currentIconMode = 0; window.name="id2563754 id2402590 id2402671 id2402731 id2402745 id2402794 id2402803 ";
	YAHOO.util.Event.onDOMReady(buildTree, this,true);
    </script>
     
</div>

<div id="sdl_content">


<div class="breadcrumb"><a href="index.html" title="Symbian^3 Product Developer Library">Symbian^3 Product Developer Library</a> &gt; <a href="GUID-32E29020-1956-461A-B79A-1492E06049E7.html" title="The Symbian Guide describes the architecture and functionality of the platform, and provides guides on using its APIs.">Symbian Guide</a> &gt; <a href="GUID-7F476137-5E7F-5288-9F4A-6C20F0A1AD9B.html">Location Based Services (LBS) Guide</a> &gt; <a href="GUID-710BC22B-E4F0-5E16-B970-E2D21F5571FC.html" title="The Location Request Management collection contains components that handle requests for location request information both from installed applications and from the network.">Location Request Management</a> &gt; <a href="GUID-CE970F0F-C922-516F-9D7E-EA1F4754A205.html" title="The Network Request Handler processes privacy and location requests received from the network.">Network Request Handler</a> &gt; <a href="GUID-CDE5CC9D-F6DE-5A21-97C3-59A2F3398A15.html" title="A privacy request is a request for permission to obtain the mobile device's location. Privacy requests are usually sent from the network to the mobile device as part of an MT-LR.">Privacy Requests</a> &gt; <a href="GUID-63681C76-3E0A-5A7A-9723-93F4142A7E7E.html" title="This section contains links to topics that explain how to create a Privacy Controller and Privacy Notifiers.">Privacy Request Tutorials</a> &gt; <a href="GUID-3078D198-0FCB-58A0-8152-9CD319906D58.html" title="This section gives guidance on how a Symbian platform licensee can use the LBS Privacy Controller API to create a Privacy Controller.">Using the Privacy Controller API</a> &gt; </div>
<h1 class="topictitle1">Implementing
the MLbsPrivacyObserver Methods</h1>
<div><p>A Privacy Controller must implement the virtual functions of the <samp class="codeph">MLbsPrivacyObserver</samp> interface
(and the shutdown function of the <samp class="codeph">MLbsPrivacyObserver2</samp> interface
if appropriate).   </p>

<p>Note that because the design of a Privacy Controller is a licensee task,
it is only possible to describe the implementation of these functions in broad
outline here. <a href="GUID-76C6B540-DCA5-33CB-9ABD-8951A2F1DD5D.html"><span class="apiname">MLbsPrivacyObserver</span></a> defines three methods: </p>

<ul>
<li><p><a href="GUID-76C6B540-DCA5-33CB-9ABD-8951A2F1DD5D.html#GUID-76C6B540-DCA5-33CB-9ABD-8951A2F1DD5D__GUID-74F567E4-1BD8-38A0-AF7E-51031DBFA625"><span class="apiname">MLbsPrivacyObserver::ProcessNetworkLocationRequest()</span></a> is
called to process a privacy request. The code example below shows the following:</p>
<ul>
<li><p>How the encoding of the requester ID and client name parameters (as
defined by 3GPP specifications) can be obtained from the <samp class="codeph">TLbsExternalRequestInfo</samp> parameter.
The parameter encoding schemes are defined by <samp class="codeph">TLbsExternalRequestInfo::_TCodingScheme</samp>. </p>
</li>

<li><p>How the format of the requester ID and client name parameters are obtained.
The formats are defined by <samp class="codeph">TLbsExternalRequestInfo::_TFormatIndicator</samp>. </p>
<p>The
parameter <samp class="codeph">aRequestId</samp> is a unique identifier for a privacy
request.</p>
<p>The parameter <samp class="codeph">aNotifyType</samp> specifies whether
the request is a privacy verification request or a privacy notification request.</p>
<pre class="codeblock">// Process a privacy verification request or a location notification request
void CMyLbsPrivacyControllerObserver::ProcessNetworkLocationRequest
   (TUint aRequestId, const TLbsExternalRequestInfo&amp; aRequestInfo,
    const TNotificationType&amp; aNotifyType)
	{
	// Get the Requester Id, Client name and external requester Id as specified by 3GPP specifications
	
	// Coding scheme and format for the requester id and client name
	TLbsExternalRequestInfo::TCodingScheme requesterIdScheme, nameScheme;
	TLbsExternalRequestInfo::TFormatIndicator requesterIdFormat, nameFormat;
	
	// Get the coding schemes for the requester ID and the client name
	requesterIdScheme = aRequestInfo.RequesterIdCodingScheme();
	nameScheme = aRequestInfo.ClientNameCodingScheme();
	
	// Get the data format for the requester ID and the client name
	requesterIdFormat = aRequestInfo.RequesterIdFormat();
	nameFormat = aRequestInfo.ClientNameFormat();

	TLbsClientName clientName;
	TLbsRequesterId requesterId;
	TLbsClientExternalId externalId;
	
	// Get the ids and client name from the request info object
	aRequestInfo.GetClientName(clientName);
	aRequestInfo.GetRequesterId(requesterId);
	aRequestInfo.GetClientExternalId(externalId);
	
	// Check the encoding schemes of requesterId and clientScheme
	switch (requesterIdScheme)
		{
		case TLbsExternalRequestInfo::ECodingSchemeUCS2 :
		
		/*
		Handle any character conversion that may
		be required by the licensee Privacy Controller
		Details are licensee specific...
		*/
		
		break;
		
		case TLbsExternalRequestInfo::ECodingSchemeUTF8:
		
		/*
		Handle any character conversion that may
		be required by the licensee Privacy Controller
		Details are licensee specific...
		*/

		break;
		
		case TLbsExternalRequestInfo::ECodingSchemeGSMDefault :
		
		/*
		Handle any character conversion that may
		be required by the licensee Privacy Controller
		Details are licensee specific...
		*/
		
		break;
		
		}
	
	/*
	And similar to the above for the clientName parameter
	Details omitted...
 */
	
 /*
	Check the format of the data held by requesterId and clientName
	e.g. Email address, MSISDN etc.
	*/
	
	switch (requesterIdFormat)
		{
		case TLbsExternalRequestInfo::EFormatLogicalName :
		
			/*
			requesterId is a name
			Licensee Privacy Controller can use the name to lookup the user in contacts
			or format it for display to the user
			Implementation details omitted...
			*/
		
			break;
		
		case TLbsExternalRequestInfo::EFormatEmailAddress :
		
			/*
			requesterId is an email address
			Licensee Privacy Controller can use the email address to lookup the user in contacts
			or format it for display to the user
			Implementation details omitted...
			*/
		
			break;
		
			/*
			And so on to check for the other possible formats
			defined in TLbsExternalRequestInfo::_TFormatIndicator
	  ...

			*/
		}
	
	/*
	 After getting the data encoding and the data format, the Privacy Controller
	 can either :
	 
	 1. Automatically process the privacy request based on privacy rules
	 2. Use privacy dialogs to obtain a response from the user
	 3. Some combination of 1 &amp; 2
	 
	 These are implementation details for the licensee...
	*/ 
	}</pre>
<p>As described in LBS <a href="GUID-D857413A-D5A1-5F9F-A780-C980A9E0BEE0.html" title="A Privacy Controller is an application that a licensee can create in order to process privacy requests.">Privacy
Controller</a>, when LBS is configured in the <a href="GUID-3618ECE9-C22B-5AE2-837E-FEBC55D42330.html" title="This document describes the steps necessary to configure the LBS subsystem with the Privacy Protocol Module.">Standalone
Privacy Mode</a> configuration it is possible for large buffers to be passed
over the <a href="GUID-B3000A78-3BE5-5E0A-A718-87BC9BA03726.html" title="The Network Privacy API is an interface through which the LBS subsystem can receive and respond to privacy requests when it is built to include the Privacy Protocol Module.">Network Privacy
API</a> from the licensee domestic operating system into Symbian LBS. In
this case it is necessary to cast the received <samp class="codeph">TLbsExternalRequestInfo</samp> reference
to a <samp class="codeph">TLbsExternalRequestInfo2</samp> reference before using it.
Failure to do so may result in truncated data being returned if the length
of the requester descriptors exceeds the size of the buffers in <samp class="codeph">TLbsExternalRequestInfo</samp>.
A simple static case is required:</p>
<pre class="codeblock">const TLbsExternalRequestInfo2&amp; info = static_cast&lt;const TLbsExternalRequestInfo2&amp;&gt;(aRequestInfo);

// Now use info instead of aRequestInfo...</pre>
</li>

</ul>
</li>

<li><p><samp class="codeph">MLbsPrivacyObserver::ProcessNetworkPositionUpdate()</samp> notifies
the Privacy Controller that a position fix has been calculated or received
from the network. When a Privacy Controller receives such a notification a
licensee can choose to notify the user. The parameter <samp class="codeph">aRequestId</samp> associates
a position update with a previous <a href="GUID-0592B2C5-15A4-3574-9844-10CCF418DAA4.html"><span class="apiname">ProcessNetworkLocationRequest()</span></a> call. </p>
<pre class="codeblock">// Handle notification of a position update
void CMyLbsPrivacyControllerObserver::ProcessNetworkPositionUpdate(TUint aRequestId, 
                                                                   const TPositionInfo&amp; aPosInfo)
	{
		/*
		A Privacy Controller is informed when the LBS subsystem calculates or receives a position update
		The user can be informed if the licensee chooses to do so
		
	    This is an implementation task for the licensee...
	 */
	}</pre>
</li>

<li><p><a href="GUID-76C6B540-DCA5-33CB-9ABD-8951A2F1DD5D.html#GUID-76C6B540-DCA5-33CB-9ABD-8951A2F1DD5D__GUID-B800119C-C15A-3FCE-9CEE-DCDA72499CC4"><span class="apiname">MLbsPrivacyObserver::ProcessNetworkRequestComplete()</span></a> notifies
the Privacy Controller that the privacy request uniquely identified by <samp class="codeph">aRequestId</samp> is
complete. The parameter <samp class="codeph">aReason</samp> specifies why the request
was completed and is <samp class="codeph">KErrNone</samp> for normal processing, <samp class="codeph">KErrCancel</samp> if
the network cancels the request or <samp class="codeph">KErrTimedOut</samp> if the network
times out the request because the Privacy Controller has not returned a response. </p>
<pre class="codeblock">// Privacy controller is notified that a request is completed
void CMyLbsPrivacyControllerObserver::ProcessRequestComplete(TUint aRequestId, TInt aReason)
	{
		/*
		The LBS subsystem notifies the Privacy Controller 
		when a request is complete
		*/
	}</pre>
</li>

</ul>

<div class="section" id="GUID-D01CE5F5-CC66-4976-B67F-A6D2E02FFEA5__GUID-3420C82C-9B15-43A6-89BC-32B23A368041"><a name="GUID-D01CE5F5-CC66-4976-B67F-A6D2E02FFEA5__GUID-3420C82C-9B15-43A6-89BC-32B23A368041"><!-- --></a><h2 class="sectiontitle">Implementing the MLbsPrivacyObserver2 shutdown method</h2>        
     <p>A Privacy Controller observer must implement <a href="GUID-BF88837F-1ADC-3DB2-98E5-CFBF75E2BE86.html"><span class="apiname">MLbsPrivacyObserver2</span></a> if
it is to receive notice to shutdown when the LBS subsystem shuts down (this
is only supported in the LBS <a href="GUID-3618ECE9-C22B-5AE2-837E-FEBC55D42330.html" title="This document describes the steps necessary to configure the LBS subsystem with the Privacy Protocol Module.">Standalone
Privacy Mode</a> configuration). The implementation should ensure that
any owned resources are freed. </p>
<pre class="codeblock">// Privacy Controller is told to shutdown

void CMyLbsPrivacyControllerObserver2::ProcessCloseDownNotification()
	{
		/*
		Free up all resources allocated by the Privacy Controller
		such as dialog resources, file sessions etc.
		
		The implementation of this method is specific
		to the licensee Privacy Controller, but all owned resources must be freed
		*/
	}</pre>
     </div>

</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="GUID-3078D198-0FCB-58A0-8152-9CD319906D58.html" title="This section gives guidance on how a Symbian platform licensee can use the LBS Privacy Controller API to create a Privacy Controller.">Using the Privacy Controller API</a></div>
</div>
</div>
   
<p class="copyright">Copyright &#169;2010 Nokia Corporation and/or its subsidiary(-ies).<br /> All rights
reserved. Unless otherwise stated, these materials are provided under the terms of the <a href=" http://www.eclipse.org/legal/epl-v10.html"> Eclipse Public License
v1.0</a>.</p> 
</div>
</div>
<?php include_once (CURRENT_SKIN_PATH.'/sdl_footer.html'); ?>

</body>
</html>